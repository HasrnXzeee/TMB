--[[Protected by Sen Obsfucator V3 | RMPG Services | Generated Time: 2025-11-27 14:48:04]] (function() local __b = "bG9jYWwgSHR0cFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIikKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCgpsb2NhbCBXSElURUxJU1RfVVJMID0gImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9IYXNyblh6ZWVlL1RNQi9yZWZzL2hlYWRzL21haW4vV2hpdGVsaXN0ZWRVc2Vycy5sdWEiCgpsb2NhbCBmdW5jdGlvbiBmZXRjaFdoaXRlbGlzdCh1cmwpCiAgICBsb2NhbCBzdWNjZXNzLCByZXNwb25zZSA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICByZXR1cm4gSHR0cFNlcnZpY2U6R2V0QXN5bmModXJsKQogICAgZW5kKQogICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgICAgIHdhcm4oIkZhaWxlZCB0byBmZXRjaCB3aGl0ZWxpc3Q6ICIgLi4gdG9zdHJpbmcocmVzcG9uc2UpKQogICAgICAgIHJldHVybiB7fQogICAgZW5kCgogICAgbG9jYWwgdXNlcnMgPSB7fQogICAgLS0gUGFyc2UgbGluZXMgbGlrZTogVXNlcm5hbWUgPSB0cnVlLAogICAgZm9yIGxpbmUgaW4gc3RyaW5nLmdtYXRjaChyZXNwb25zZSwgIlteXHJcbl0rIikgZG8KICAgICAgICBsb2NhbCB1c2VybmFtZSwgdmFsdWUgPSBzdHJpbmcubWF0Y2gobGluZSwgIl4lcyooWyV3X10rKSVzKj0lcyooJXcrKSVzKiwlcyokIikKICAgICAgICBpZiB1c2VybmFtZSBhbmQgdmFsdWUgYW5kIHZhbHVlOmxvd2VyKCkgPT0gInRydWUiIHRoZW4KICAgICAgICAgICAgdXNlcnNbdXNlcm5hbWVdID0gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gdXNlcnMKZW5kCgpsb2NhbCB3aGl0ZWxpc3RlZFVzZXJuYW1lcyA9IGZldGNoV2hpdGVsaXN0KFdISVRFTElTVF9VUkwpCgpsb2NhbCBmdW5jdGlvbiBpc1doaXRlbGlzdGVkKHVzZXJuYW1lKQogICAgcmV0dXJuIHdoaXRlbGlzdGVkVXNlcm5hbWVzW3VzZXJuYW1lXSA9PSB0cnVlCmVuZAoKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIGlmIG5vdCBpc1doaXRlbGlzdGVkKHBsYXllci5OYW1lKSB0aGVuCiAgICAgICAgcGxheWVyOktpY2soIllvdSBhcmUgbm90IHdoaXRlbGlzdGVkLiIpCiAgICBlbHNlCiAgICAgICAgcHJpbnQocGxheWVyLk5hbWUgLi4gIiBpcyB3aGl0ZWxpc3RlZCEiKQogICAgZW5kCmVuZCkKCmxvY2FsIGxpYnJhcnkgPSBsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0hhc3JuWHplZWUvTi9yZWZzL2hlYWRzL21haW4vSW1hZ2UucG5nIiwgdHJ1ZSkpKCkKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIHBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgc3RhcnRUaW1lID0gb3MudGltZSgpCmxvY2FsIHN0YXJ0UmViaXJ0aHMgPSBwbGF5ZXIubGVhZGVyc3RhdHMuUmViaXJ0aHMuVmFsdWUKbG9jYWwgZGlzcGxheU5hbWUgPSBwbGF5ZXIuRGlzcGxheU5hbWUKCi0tIENyZWF0ZSBNYWluIFdpbmRvdwpsb2NhbCB3aW5kb3cgPSBsaWJyYXJ5OkFkZFdpbmRvdygiVE1CIHx8IFByaXYgU2NyaXB0IiwgewogICAgbWFpbl9jb2xvciA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApLAogICAgbWluX3NpemUgPSBWZWN0b3IyLm5ldyg2NzAsIDEwMDApLAogICAgY2FuX3Jlc2l6ZSA9IHRydWUsCn0pCgotLSBNYWluIFRhYgpsb2NhbCBNYWluID0gd2luZG93OkFkZFRhYigiTWFpbiIpCmxvY2FsIGZhcm1QbHVzVGFiID0gd2luZG93OkFkZFRhYigiRmFybSIpCgpNYWluOkFkZExhYmVsKCJMb2NhbCBQbGF5ZXIiKQoKbG9jYWwgd2Fsa1NwZWVkVmFsdWUgPSAxNgpNYWluOkFkZFRleHRCb3goIldhbGtTcGVlZCIsIGZ1bmN0aW9uKHRleHQpCiAgICBsb2NhbCBzcGVlZCA9IHRvbnVtYmVyKHRleHQpCiAgICBpZiBzcGVlZCBhbmQgc3BlZWQgPj0gMSBhbmQgc3BlZWQgPD0gNTAwIHRoZW4KICAgICAgICB3YWxrU3BlZWRWYWx1ZSA9IHNwZWVkCiAgICBlbmQKZW5kKQoKbG9jYWwgc2V0U3BlZWQgPSBmYWxzZQpNYWluOkFkZFN3aXRjaCgiU2V0IFNwZWVkIiwgZnVuY3Rpb24oc3RhdGUpCiAgICBzZXRTcGVlZCA9IHN0YXRlCiAgICB3aGlsZSBzZXRTcGVlZCBkbwogICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuV2Fsa1NwZWVkID0gd2Fsa1NwZWVkVmFsdWUKICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgZW5kCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLldhbGtTcGVlZCA9IDE2CmVuZCkKCmxvY2FsIGp1bXBQb3dlclZhbHVlID0gNTAKTWFpbjpBZGRUZXh0Qm94KCJKdW1wUG93ZXIiLCBmdW5jdGlvbih0ZXh0KQogICAgbG9jYWwganVtcCA9IHRvbnVtYmVyKHRleHQpCiAgICBpZiBqdW1wIHRoZW4KICAgICAgICBqdW1wUG93ZXJWYWx1ZSA9IGp1bXAKICAgIGVuZAplbmQpCgpsb2NhbCBhcHBseUp1bXBQb3dlciA9IGZhbHNlCk1haW46QWRkU3dpdGNoKCJBcHBseSBKdW1wUG93ZXIiLCBmdW5jdGlvbihzdGF0ZSkKICAgIGFwcGx5SnVtcFBvd2VyID0gc3RhdGUKICAgIGxvY2FsIGh1bWFub2lkID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZAogICAgaHVtYW5vaWQuVXNlSnVtcFBvd2VyID0gdHJ1ZQogICAgaHVtYW5vaWQuSnVtcFBvd2VyID0gYXBwbHlKdW1wUG93ZXIgYW5kIGp1bXBQb3dlclZhbHVlIG9yIDUwCmVuZCkKCmxvY2FsIHNpemVWYWx1ZSA9IDEKTWFpbjpBZGRUZXh0Qm94KCJTaXplIiwgZnVuY3Rpb24odGV4dCkKICAgIGxvY2FsIHNpemUgPSB0b251bWJlcih0ZXh0KQogICAgaWYgc2l6ZSBhbmQgc2l6ZSA+PSAxIGFuZCBzaXplIDw9IDEwMCB0aGVuCiAgICAgICAgc2l6ZVZhbHVlID0gc2l6ZQogICAgZW5kCmVuZCkKCmxvY2FsIHNldFNpemUgPSBmYWxzZQpNYWluOkFkZFN3aXRjaCgiU2V0IFNpemVzIiwgZnVuY3Rpb24oc3RhdGUpCiAgICBzZXRTaXplID0gc3RhdGUKICAgIGxvY2FsIGNoYXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBjaGFyIHRoZW4KICAgICAgICBsb2NhbCBodW1hbm9pZCA9IGNoYXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCiAgICAgICAgaWYgaHVtYW5vaWQgdGhlbgogICAgICAgICAgICBmb3IgXywgc2NhbGUgaW4gcGFpcnMoeyJCb2R5RGVwdGhTY2FsZSIsICJCb2R5SGVpZ2h0U2NhbGUiLCAiQm9keVdpZHRoU2NhbGUiLCAiSGVhZFNjYWxlIn0pIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBzY2FsZUluc3RhbmNlID0gaHVtYW5vaWQ6RmluZEZpcnN0Q2hpbGQoc2NhbGUpCiAgICAgICAgICAgICAgICBpZiBzY2FsZUluc3RhbmNlIHRoZW4KICAgICAgICAgICAgICAgICAgICBzY2FsZUluc3RhbmNlLlZhbHVlID0gc3RhdGUgYW5kIHNpemVWYWx1ZSBvciAxCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKbG9jYWwgcmViaXJ0aFRhYiA9IHdpbmRvdzpBZGRUYWIoIk9QIEZhcm0iKQoKLS0gVGFyZ2V0IHJlYmlydGggaW5wdXQgLSBkaXJlY3QgdGV4dCBpbnB1dApyZWJpcnRoVGFiOkFkZFRleHRCb3goIlJlYmlydGggVGFyZ2V0IiwgZnVuY3Rpb24odGV4dCkKICAgIGxvY2FsIG5ld1ZhbHVlID0gdG9udW1iZXIodGV4dCkKICAgIGlmIG5ld1ZhbHVlIGFuZCBuZXdWYWx1ZSA+IDAgdGhlbgogICAgICAgIHRhcmdldFJlYmlydGhWYWx1ZSA9IG5ld1ZhbHVlCiAgICAgICAgdXBkYXRlU3RhdHMoKSAtLSBDYWxsIHRoZSBzdGF0cyB1cGRhdGUgZnVuY3Rpb24KICAgICAgICAKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgICAgICBUaXRsZSA9ICJVcGRhdGVkIE9iamVjdGl2ZSIsCiAgICAgICAgICAgIFRleHQgPSAiTmV3IGdvYWw6ICIgLi4gdG9zdHJpbmcodGFyZ2V0UmViaXJ0aFZhbHVlKSAuLiAiIHJlYmlydGgiLAogICAgICAgICAgICBEdXJhdGlvbiA9IDAKICAgICAgICB9KQogICAgZWxzZQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgICAgIFRpdGxlID0gIkludmFsaWQgRW50cnkiLAogICAgICAgICAgICBUZXh0ID0gIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlciIsCiAgICAgICAgICAgIER1cmF0aW9uID0gMAogICAgICAgIH0pCiAgICBlbmQKZW5kKQoKLS0gQ3JlYXRlIHRvZ2dsZSBzd2l0Y2hlcwpsb2NhbCBpbmZpbml0ZVN3aXRjaCAtLSBGb3J3YXJkIGRlY2xhcmF0aW9uCgpsb2NhbCB0YXJnZXRTd2l0Y2ggPSByZWJpcnRoVGFiOkFkZFN3aXRjaCgiQXV0byBSZWJpcnRoIFRhcmdldCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy50YXJnZXRSZWJpcnRoQWN0aXZlID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICAtLSBUdXJuIG9mZiBpbmZpbml0ZSByZWJpcnRoIGlmIGl0J3Mgb24KICAgICAgICBpZiBfRy5pbmZpbml0ZVJlYmlydGhBY3RpdmUgYW5kIGluZmluaXRlU3dpdGNoIHRoZW4KICAgICAgICAgICAgaW5maW5pdGVTd2l0Y2g6U2V0KGZhbHNlKQogICAgICAgICAgICBfRy5pbmZpbml0ZVJlYmlydGhBY3RpdmUgPSBmYWxzZQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIC0tIFN0YXJ0IHRhcmdldCByZWJpcnRoIGxvb3AKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLnRhcmdldFJlYmlydGhBY3RpdmUgYW5kIHdhaXQoMC4xKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgY3VycmVudFJlYmlydGhzID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLmxlYWRlcnN0YXRzLlJlYmlydGhzLlZhbHVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGN1cnJlbnRSZWJpcnRocyA+PSB0YXJnZXRSZWJpcnRoVmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhcmdldFN3aXRjaDpTZXQoZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgX0cudGFyZ2V0UmViaXJ0aEFjdGl2ZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgVGl0bGUgPSAiR29hbCBBY2hpZXZlZCEhIiwKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICJZb3UgaGF2ZSByZWFjaGVkICIgLi4gdG9zdHJpbmcodGFyZ2V0UmViaXJ0aFZhbHVlKSAuLiAiIHJlYmlydGgiLAogICAgICAgICAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDUKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMucmViaXJ0aFJlbW90ZTpJbnZva2VTZXJ2ZXIoInJlYmlydGhSZXF1ZXN0IikKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCwgIkF1dG9tYXRpYyByZWJpcnRoIHVudGlsIHRoZSBnb2FsIGlzIHJlYWNoZWQiKQoKLS0gRmFzdCBXZWlnaHQgdG9nZ2xlIHdpdGggYXV0by13ZWlnaHQgZnVuY3Rpb25hbGl0eSBhbmQgcGVyc2lzdGVudCBlcXVpcHBpbmcKcmViaXJ0aFRhYjpBZGRTd2l0Y2goIkF1dG8gV2VpZ2h0IiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLkZhc3RXZWlnaHQgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIC0tIENvbnRpbnVvdXNseSBlcXVpcCBhbmQgbW9kaWZ5IHdlaWdodCB0b29sCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5GYXN0V2VpZ2h0IGRvCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gQ2hlY2sgaWYgdG9vbCBpcyBub3QgZXF1aXBwZWQKICAgICAgICAgICAgICAgIGlmIGNoYXJhY3RlciBhbmQgbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHdlaWdodFRvb2wgPSBwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpCiAgICAgICAgICAgICAgICAgICAgaWYgd2VpZ2h0VG9vbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHdlaWdodFRvb2w6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ZWlnaHRUb29sLnJlcFRpbWUuVmFsdWUgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBjaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHdlaWdodFRvb2wpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAtLSBNYWtlIHN1cmUgZXF1aXBwZWQgdG9vbCBpcyBtb2RpZmllZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKQogICAgICAgICAgICAgICAgICAgIGlmIGVxdWlwcGVkOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBlcXVpcHBlZC5yZXBUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHdhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgLS0gQXV0byBkbyB3ZWlnaHQgbGlmdGluZwogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuRmFzdFdlaWdodCBkbwogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgLS0gVW5lcXVpcCBhbmQgcmVzZXQgdG9vbAogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikKICAgICAgICBpZiBlcXVpcHBlZCB0aGVuCiAgICAgICAgICAgIGlmIGVxdWlwcGVkOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgZXF1aXBwZWQucmVwVGltZS5WYWx1ZSA9IDEKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIC0tIEFsc28gcmVzZXQgdGhlIGJhY2twYWNrIHRvb2wKICAgICAgICBsb2NhbCBiYWNrcGFja1Rvb2wgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpCiAgICAgICAgaWYgYmFja3BhY2tUb29sIGFuZCBiYWNrcGFja1Rvb2w6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgIGJhY2twYWNrVG9vbC5yZXBUaW1lLlZhbHVlID0gMQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmxvY2FsIHNpemVTd2l0Y2ggPSByZWJpcnRoVGFiOkFkZFN3aXRjaCgiQXV0byBTaXplIDEiLCBmdW5jdGlvbihib29sKQogICAgX0cuYXV0b1NpemVBY3RpdmUgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuYXV0b1NpemVBY3RpdmUgYW5kIHdhaXQoKSBkbwogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMuY2hhbmdlU3BlZWRTaXplUmVtb3RlOkludm9rZVNlcnZlcigiY2hhbmdlU2l6ZSIsIDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQsICJBdXRvIFNldCBTaXplIDEiKQoKCmxvY2FsIHRlbGVwb3J0U3dpdGNoID0gcmViaXJ0aFRhYjpBZGRTd2l0Y2goIkF1dG8gVGVsZXBvcnQgdG8gTXVzY2xlIEtpbmciLCBmdW5jdGlvbihib29sKQogICAgX0cudGVsZXBvcnRBY3RpdmUgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cudGVsZXBvcnRBY3RpdmUgYW5kIHdhaXQoKSBkbwogICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpNb3ZlVG8oVmVjdG9yMy5uZXcoLTg2NDYsIDE3LCAtNTczOCkpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCwgIkNvbnRpbnVvdXMgdGVsZXBvcnRhdGlvbiB0byBNdXNjbGUgS2luZyIpCgpyZWJpcnRoVGFiOkFkZExhYmVsKCItLS1UTUIgT1AgU1RVRkYtLS0iKQoKbG9jYWwgZnVuY3Rpb24gdW5lcXVpcEFsbFBldHMoKQogICAgbG9jYWwgcGV0c0ZvbGRlciA9IHBsYXllci5wZXRzRm9sZGVyCiAgICBmb3IgXywgZm9sZGVyIGluIHBhaXJzKHBldHNGb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiBmb2xkZXI6SXNBKCJGb2xkZXIiKSB0aGVuCiAgICAgICAgICAgIGZvciBfLCBwZXQgaW4gcGFpcnMoZm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5yRXZlbnRzLmVxdWlwUGV0RXZlbnQ6RmlyZVNlcnZlcigidW5lcXVpcFBldCIsIHBldCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHRhc2sud2FpdCgwLjEpCmVuZAoKbG9jYWwgZnVuY3Rpb24gZXF1aXBVbmlxdWVQZXQocGV0TmFtZSkKICAgIHVuZXF1aXBBbGxQZXRzKCkKICAgIHRhc2sud2FpdCgwLjAxKQogICAgZm9yIF8sIHBldCBpbiBwYWlycyhwbGF5ZXIucGV0c0ZvbGRlci5VbmlxdWU6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiBwZXQuTmFtZSA9PSBwZXROYW1lIHRoZW4KICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuckV2ZW50cy5lcXVpcFBldEV2ZW50OkZpcmVTZXJ2ZXIoImVxdWlwUGV0IiwgcGV0KQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gZmluZE1hY2hpbmUobWFjaGluZU5hbWUpCiAgICBsb2NhbCBtYWNoaW5lID0gd29ya3NwYWNlLm1hY2hpbmVzRm9sZGVyOkZpbmRGaXJzdENoaWxkKG1hY2hpbmVOYW1lKQogICAgaWYgbm90IG1hY2hpbmUgdGhlbgogICAgICAgIGZvciBfLCBmb2xkZXIgaW4gcGFpcnMod29ya3NwYWNlOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGlmIGZvbGRlcjpJc0EoIkZvbGRlciIpIGFuZCBmb2xkZXIuTmFtZTpmaW5kKCJtYWNoaW5lcyIpIHRoZW4KICAgICAgICAgICAgICAgIG1hY2hpbmUgPSBmb2xkZXI6RmluZEZpcnN0Q2hpbGQobWFjaGluZU5hbWUpCiAgICAgICAgICAgICAgICBpZiBtYWNoaW5lIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gbWFjaGluZQplbmQKCmxvY2FsIGZ1bmN0aW9uIHByZXNzRSgpCiAgICBsb2NhbCB2aW0gPSBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKQogICAgdmltOlNlbmRLZXlFdmVudCh0cnVlLCAiRSIsIGZhbHNlLCBnYW1lKQogICAgdGFzay53YWl0KDAuMSkKICAgIHZpbTpTZW5kS2V5RXZlbnQoZmFsc2UsICJFIiwgZmFsc2UsIGdhbWUpCmVuZAoKbG9jYWwgZnVuY3Rpb24gdXNlT25lRWdnKCkKICAgIFJlcGxpY2F0ZWRTdG9yYWdlLnJFdmVudHMucHJvdGVpbkVnZ0V2ZW50OkZpcmVTZXJ2ZXIoInVzZUVnZyIpCmVuZAoKbG9jYWwgcGFja0Zhcm0gPSByZWJpcnRoVGFiOkFkZFN3aXRjaCgiRmFzdCBSZWJpcnRoIiwgZnVuY3Rpb24oYm9vbCkKICAgIGlzUnVubmluZyA9IGJvb2wKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgaXNSdW5uaW5nIGRvCiAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRSZWJpcnRocyA9IHBsYXllci5sZWFkZXJzdGF0cy5SZWJpcnRocy5WYWx1ZQogICAgICAgICAgICBsb2NhbCByZWJpcnRoQ29zdCA9IDEwMDAwICsgKDUwMDAgKiBjdXJyZW50UmViaXJ0aHMpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwbGF5ZXIudWx0aW1hdGVzRm9sZGVyOkZpbmRGaXJzdENoaWxkKCJHb2xkZW4gUmViaXJ0aCIpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGdvbGRlblJlYmlydGhzID0gcGxheWVyLnVsdGltYXRlc0ZvbGRlclsiR29sZGVuIFJlYmlydGgiXS5WYWx1ZQogICAgICAgICAgICAgICAgcmViaXJ0aENvc3QgPSBtYXRoLmZsb29yKHJlYmlydGhDb3N0ICogKDEgLSAoZ29sZGVuUmViaXJ0aHMgKiAwLjEpKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHVuZXF1aXBBbGxQZXRzKCkKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgZXF1aXBVbmlxdWVQZXQoIlN3aWZ0IFNhbXVyYWkiKQogICAgICAgICAgICAKICAgICAgICAgICAgd2hpbGUgaXNSdW5uaW5nIGFuZCBwbGF5ZXIubGVhZGVyc3RhdHMuU3RyZW5ndGguVmFsdWUgPCByZWJpcnRoQ29zdCBkbwogICAgICAgICAgICAgICAgZm9yIGkgPSAxLCAxMCBkbwogICAgICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdW5lcXVpcEFsbFBldHMoKQogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBlcXVpcFVuaXF1ZVBldCgiVHJpYmFsIE92ZXJsb3JkIikKICAgICAgICAgICAgbG9jYWwgbWFjaGluZSA9IGZpbmRNYWNoaW5lKCJKdW5nbGUgQmFyIExpZnQiKQogICAgICAgICAgICBpZiBtYWNoaW5lIGFuZCBtYWNoaW5lOkZpbmRGaXJzdENoaWxkKCJpbnRlcmFjdFNlYXQiKSB0aGVuCiAgICAgICAgICAgICAgICBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gbWFjaGluZS5pbnRlcmFjdFNlYXQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAzLCAwKQogICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBwcmVzc0UoKQogICAgICAgICAgICAgICAgdW50aWwgcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5TaXQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGxvY2FsIGluaXRpYWxSZWJpcnRocyA9IHBsYXllci5sZWFkZXJzdGF0cy5SZWJpcnRocy5WYWx1ZQogICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlLnJFdmVudHMucmViaXJ0aFJlbW90ZTpJbnZva2VTZXJ2ZXIoInJlYmlydGhSZXF1ZXN0IikKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIHVudGlsIHBsYXllci5sZWFkZXJzdGF0cy5SZWJpcnRocy5WYWx1ZSA+IGluaXRpYWxSZWJpcnRocwogICAgICAgICAgICBpZiBub3QgaXNSdW5uaW5nIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmxvY2FsIHNwZWVkR3JpbmQgPSByZWJpcnRoVGFiOkFkZFN3aXRjaCgiRmFzdCBTdHJlbmd0aCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBsb2NhbCBpc0dyaW5kaW5nID0gYm9vbAogICAgCiAgICBpZiBub3QgYm9vbCB0aGVuCiAgICAgICAgdW5lcXVpcEFsbFBldHMoKQogICAgICAgIHJldHVybgogICAgZW5kCiAgICAKICAgIGVxdWlwVW5pcXVlUGV0KCJTd2lmdCBTYW11cmFpIikKICAgIAogICAgZm9yIGkgPSAxLCAxMCBkbwogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBpc0dyaW5kaW5nIGRvCiAgICAgICAgICAgICAgICBwbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgpsb2NhbCBmcmFtZVRvZ2dsZSA9IHJlYmlydGhUYWI6QWRkU3dpdGNoKCJIaWRlIEZyYW1lcyIsIGZ1bmN0aW9uKGJvb2wpCiAgICBsb2NhbCByU3RvID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCiAgICBmb3IgXywgb2JqIGluIHBhaXJzKHJTdG86R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiBvYmouTmFtZTptYXRjaCgiRnJhbWUkIikgdGhlbgogICAgICAgICAgICBvYmouVmlzaWJsZSA9IG5vdCBib29sCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKcmViaXJ0aFRhYjpBZGRTd2l0Y2goIkhpZGUgUGV0cyIsIGZ1bmN0aW9uKFN0YXRlKQogICAgaWYgU3RhdGUgdGhlbgogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLnNob3dQZXRzRXZlbnQ6RmlyZVNlcnZlcigiaGlkZVBldHMiKQogICAgZWxzZQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLnNob3dQZXRzRXZlbnQ6RmlyZVNlcnZlcigic2hvd1BldHMiKQogICAgZW5kCmVuZCkKCgotLSBGcmVlIEF1dG9MaWZ0IEdhbWVwYXNzIEJ1dHRvbgpmYXJtUGx1c1RhYjpBZGRCdXR0b24oIlVubG9jayBBdXRvTGlmdCBHYW1lcGFzcyIsIGZ1bmN0aW9uKCkKICAgIGxvY2FsIGdhbWVwYXNzRm9sZGVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLmdhbWVwYXNzSWRzCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgogICAgZm9yIF8sIGdhbWVwYXNzIGluIHBhaXJzKGdhbWVwYXNzRm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgbG9jYWwgdmFsdWUgPSBJbnN0YW5jZS5uZXcoIkludFZhbHVlIikKICAgICAgICB2YWx1ZS5OYW1lID0gZ2FtZXBhc3MuTmFtZQogICAgICAgIHZhbHVlLlZhbHVlID0gZ2FtZXBhc3MuVmFsdWUKICAgICAgICB2YWx1ZS5QYXJlbnQgPSBwbGF5ZXIub3duZWRHYW1lcGFzc2VzCiAgICBlbmQKZW5kLCAiVW5sb2NrIHRoZSBBdXRvTGlmdCBHYW1lIFBhc3MgZm9yIGZyZWUiKQpsb2NhbCBhdXRvRXF1aXBUb29sc0ZvbGRlciA9IGZhcm1QbHVzVGFiOkFkZEZvbGRlcigiQXV0byBFcXVpcCBUb29scyIpCgotLSBBdXRvIFdlaWdodCBUb2dnbGUKYXV0b0VxdWlwVG9vbHNGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIFdlaWdodCIsIGZ1bmN0aW9uKFZhbHVlKQogICAgX0cuQXV0b1dlaWdodCA9IFZhbHVlCiAgICAKICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICBsb2NhbCB3ZWlnaHRUb29sID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKQogICAgICAgIGlmIHdlaWdodFRvb2wgdGhlbgogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh3ZWlnaHRUb29sKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikKICAgICAgICBpZiBlcXVpcHBlZCB0aGVuCiAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIF9HLkF1dG9XZWlnaHQgZG8KICAgICAgICAgICAgaWYgbm90IF9HLkF1dG9XZWlnaHQgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kLCAiRG8gbGlmdGluZyBhdXRvbWF0aWNhbGx5IikKCi0tIEF1dG8gUHVzaHVwcyBUb2dnbGUKYXV0b0VxdWlwVG9vbHNGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIFB1c2h1cHMiLCBmdW5jdGlvbihWYWx1ZSkKICAgIF9HLkF1dG9QdXNodXBzID0gVmFsdWUKICAgIAogICAgaWYgVmFsdWUgdGhlbgogICAgICAgIGxvY2FsIHB1c2h1cHNUb29sID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdXNodXBzIikKICAgICAgICBpZiBwdXNodXBzVG9vbCB0aGVuCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHB1c2h1cHNUb29sKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVzaHVwcyIpCiAgICAgICAgaWYgZXF1aXBwZWQgdGhlbgogICAgICAgICAgICBlcXVpcHBlZC5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBfRy5BdXRvUHVzaHVwcyBkbwogICAgICAgICAgICBpZiBub3QgX0cuQXV0b1B1c2h1cHMgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kLCAiRG8gcHVzaC11cHMgYXV0b21hdGljYWxseSIpCgotLSBBdXRvIEhhbmRzdGFuZHMgVG9nZ2xlCmF1dG9FcXVpcFRvb2xzRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBIYW5kc3RhbmRzIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBfRy5BdXRvSGFuZHN0YW5kcyA9IFZhbHVlCiAgICAKICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICBsb2NhbCBoYW5kc3RhbmRzVG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiSGFuZHN0YW5kcyIpCiAgICAgICAgaWYgaGFuZHN0YW5kc1Rvb2wgdGhlbgogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChoYW5kc3RhbmRzVG9vbCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhhbmRzdGFuZHMiKQogICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgZXF1aXBwZWQuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgX0cuQXV0b0hhbmRzdGFuZHMgZG8KICAgICAgICAgICAgaWYgbm90IF9HLkF1dG9IYW5kc3RhbmRzIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCwgIkRvIGhhbmQtc3RhbmRzIGF1dG9tYXRpY2FsbHkiKQoKLS0gQXV0byBTaXR1cHMgVG9nZ2xlCmF1dG9FcXVpcFRvb2xzRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBTaXR1cHMiLCBmdW5jdGlvbihWYWx1ZSkKICAgIF9HLkF1dG9TaXR1cHMgPSBWYWx1ZQogICAgCiAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgbG9jYWwgc2l0dXBzVG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiU2l0dXBzIikKICAgICAgICBpZiBzaXR1cHNUb29sIHRoZW4KICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woc2l0dXBzVG9vbCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlNpdHVwcyIpCiAgICAgICAgaWYgZXF1aXBwZWQgdGhlbgogICAgICAgICAgICBlcXVpcHBlZC5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBfRy5BdXRvU2l0dXBzIGRvCiAgICAgICAgICAgIGlmIG5vdCBfRy5BdXRvU2l0dXBzIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCwgIkRvIHNpdC11cHMgYXV0b21hdGljYWxseSIpCgotLSBBdXRvIFB1bmNoIFRvZ2dsZQphdXRvRXF1aXBUb29sc0ZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gUHVuY2giLCBmdW5jdGlvbihWYWx1ZSkKICAgIF9HLmZhc3RIaXRBY3RpdmUgPSBWYWx1ZQogICAgCiAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgLS0gRnVuY3Rpb24gdG8gZXF1aXAgYW5kIG1vZGlmeSBwdW5jaAogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5mYXN0SGl0QWN0aXZlIGRvCiAgICAgICAgICAgICAgICBpZiBub3QgX0cuZmFzdEhpdEFjdGl2ZSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIHB1bmNoID0gcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgICAgICAgICBpZiBwdW5jaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHVuY2guUGFyZW50ID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIGlmIHB1bmNoOkZpbmRGaXJzdENoaWxkKCJhdHRhY2tUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwdW5jaC5hdHRhY2tUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgLS0gRnVuY3Rpb24gZm9yIHJhcGlkIHB1bmNoaW5nCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLmZhc3RIaXRBY3RpdmUgZG8KICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5mYXN0SGl0QWN0aXZlIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgInJpZ2h0SGFuZCIpCiAgICAgICAgICAgICAgICBwbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAibGVmdEhhbmQiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBpZiBjaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHB1bmNoVG9vbCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgICAgICAgICAgICAgIGlmIHB1bmNoVG9vbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHB1bmNoVG9vbDpBY3RpdmF0ZSgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgaWYgZXF1aXBwZWQgdGhlbgogICAgICAgICAgICBlcXVpcHBlZC5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICBlbmQKICAgIGVuZAplbmQsICJIaXRzIGF1dG9tYXRpY2FsbHkiKQoKLS0gRmFzdCBUb29scyBUb2dnbGUKYXV0b0VxdWlwVG9vbHNGb2xkZXI6QWRkU3dpdGNoKCJGYXN0IFRvb2xzIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBfRy5GYXN0VG9vbHMgPSBWYWx1ZQogICAgCiAgICBsb2NhbCBkZWZhdWx0U3BlZWRzID0gewogICAgICAgIHsKICAgICAgICAgICAgIlB1bmNoIiwKICAgICAgICAgICAgImF0dGFja1RpbWUiLAogICAgICAgICAgICBWYWx1ZSBhbmQgMCBvciAwLjM1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJHcm91bmQgU2xhbSIsCiAgICAgICAgICAgICJhdHRhY2tUaW1lIiwKICAgICAgICAgICAgVmFsdWUgYW5kIDAgb3IgNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiU3RvbXAiLAogICAgICAgICAgICAiYXR0YWNrVGltZSIsCiAgICAgICAgICAgIFZhbHVlIGFuZCAwIG9yIDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkhhbmRzdGFuZHMiLAogICAgICAgICAgICAicmVwVGltZSIsCiAgICAgICAgICAgIFZhbHVlIGFuZCAwIG9yIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlB1c2h1cHMiLAogICAgICAgICAgICAicmVwVGltZSIsCiAgICAgICAgICAgIFZhbHVlIGFuZCAwIG9yIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIldlaWdodCIsCiAgICAgICAgICAgICJyZXBUaW1lIiwKICAgICAgICAgICAgVmFsdWUgYW5kIDAgb3IgMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiU2l0dXBzIiwKICAgICAgICAgICAgInJlcFRpbWUiLAogICAgICAgICAgICBWYWx1ZSBhbmQgMCBvciAxCiAgICAgICAgfQogICAgfQogICAgCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIGJhY2twYWNrID0gcGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKQogICAgCiAgICBmb3IgXywgdG9vbEluZm8gaW4gaXBhaXJzKGRlZmF1bHRTcGVlZHMpIGRvCiAgICAgICAgbG9jYWwgdG9vbCA9IGJhY2twYWNrOkZpbmRGaXJzdENoaWxkKHRvb2xJbmZvWzFdKQogICAgICAgIGlmIHRvb2wgYW5kIHRvb2w6RmluZEZpcnN0Q2hpbGQodG9vbEluZm9bMl0pIHRoZW4KICAgICAgICAgICAgdG9vbFt0b29sSW5mb1syXV0uVmFsdWUgPSB0b29sSW5mb1szXQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIGVxdWlwcGVkVG9vbCA9IHBsYXllci5DaGFyYWN0ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQodG9vbEluZm9bMV0pCiAgICAgICAgaWYgZXF1aXBwZWRUb29sIGFuZCBlcXVpcHBlZFRvb2w6RmluZEZpcnN0Q2hpbGQodG9vbEluZm9bMl0pIHRoZW4KICAgICAgICAgICAgZXF1aXBwZWRUb29sW3Rvb2xJbmZvWzJdXS5WYWx1ZSA9IHRvb2xJbmZvWzNdCiAgICAgICAgZW5kCiAgICBlbmQKZW5kLCAiQWNjZWxlcmF0ZXMgYWxsIHRvb2xzIikKCi0tIEluaWNpYWxpemFyIHZhcmlhYmxlcyBkZSBzZWd1aW1pZW50bwpsb2NhbCBzZXNzaW9uU3RhcnRUaW1lID0gb3MudGltZSgpCmxvY2FsIHNlc3Npb25TdGFydFN0cmVuZ3RoID0gMApsb2NhbCBzZXNzaW9uU3RhcnREdXJhYmlsaXR5ID0gMApsb2NhbCBzZXNzaW9uU3RhcnRLaWxscyA9IDAKbG9jYWwgc2Vzc2lvblN0YXJ0UmViaXJ0aHMgPSAwCmxvY2FsIHNlc3Npb25TdGFydEJyYXdscyA9IDAKbG9jYWwgaGFzU3RhcnRlZFRyYWNraW5nID0gZmFsc2UKCmxvY2FsIGp1bmdsZUd5bUZvbGRlciA9IGZhcm1QbHVzVGFiOkFkZEZvbGRlcigiSnVuZ2xlIEd5bSIpCgotLSBDYWNoZSBzZXJ2aWNlcyBmb3IgZmFzdGVyIGFjY2Vzcwpsb2NhbCBWSU0gPSBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKQpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCgotLSBIZWxwZXIgZnVuY3Rpb25zIGZvciBKdW5nbGUgR3ltCmxvY2FsIGZ1bmN0aW9uIHByZXNzRSgpCiAgICBWSU06U2VuZEtleUV2ZW50KHRydWUsICJFIiwgZmFsc2UsIGdhbWUpCiAgICB0YXNrLndhaXQoMC4xKQogICAgVklNOlNlbmRLZXlFdmVudChmYWxzZSwgIkUiLCBmYWxzZSwgZ2FtZSkKZW5kCgpsb2NhbCBmdW5jdGlvbiBhdXRvTGlmdCgpCiAgICB3aGlsZSBnZXRnZW52KCkud29ya2luZyBkbwogICAgICAgIExvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgdGFzay53YWl0KCkgLS0gTW9yZSBlZmZpY2llbnQgdGhhbiB0YXNrLndhaXQoMCkgb3IgdGFzay53YWl0KHNtYWxsIG51bWJlcikKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIHRlbGVwb3J0QW5kU3RhcnQobWFjaGluZU5hbWUsIHBvc2l0aW9uKQogICAgbG9jYWwgY2hhcmFjdGVyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICBjaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBwb3NpdGlvbgogICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgcHJlc3NFKCkKICAgICAgICB0YXNrLnNwYXduKGF1dG9MaWZ0KSAtLSBVc2UgdGFzay5zcGF3biB0byBwcmV2ZW50IFVJIGZyZWV6aW5nCiAgICBlbmQKZW5kCgotLSBKdW5nbGUgR3ltIEJlbmNoIFByZXNzCmp1bmdsZUd5bUZvbGRlcjpBZGRTd2l0Y2goIkp1bmdsZSBCZW5jaCBQcmVzcyIsIGZ1bmN0aW9uKGJvb2wpCiAgICBpZiBnZXRnZW52KCkud29ya2luZyBhbmQgbm90IGJvb2wgdGhlbgogICAgICAgIGdldGdlbnYoKS53b3JraW5nID0gZmFsc2UKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgCiAgICBnZXRnZW52KCkud29ya2luZyA9IGJvb2wKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIHRlbGVwb3J0QW5kU3RhcnQoIkJlbmNoIFByZXNzIiwgQ0ZyYW1lLm5ldygtODE3MywgNjQsIDE4OTgpKQogICAgZW5kCmVuZCkKCi0tIEp1bmdsZSBHeW0gU3F1YXQKanVuZ2xlR3ltRm9sZGVyOkFkZFN3aXRjaCgiSnVuZ2xlIFNxdWF0IiwgZnVuY3Rpb24oYm9vbCkKICAgIGlmIGdldGdlbnYoKS53b3JraW5nIGFuZCBub3QgYm9vbCB0aGVuCiAgICAgICAgZ2V0Z2VudigpLndvcmtpbmcgPSBmYWxzZQogICAgICAgIHJldHVybgogICAgZW5kCiAgICAKICAgIGdldGdlbnYoKS53b3JraW5nID0gYm9vbAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgdGVsZXBvcnRBbmRTdGFydCgiU3F1YXQiLCBDRnJhbWUubmV3KC04MzUyLCAzNCwgMjg3OCkpCiAgICBlbmQKZW5kKQoKLS0gSnVuZ2xlIEd5bSBQdWxsIFVwCmp1bmdsZUd5bUZvbGRlcjpBZGRTd2l0Y2goIkp1bmdsZSBQdWxsIFVwcyIsIGZ1bmN0aW9uKGJvb2wpCiAgICBpZiBnZXRnZW52KCkud29ya2luZyBhbmQgbm90IGJvb2wgdGhlbgogICAgICAgIGdldGdlbnYoKS53b3JraW5nID0gZmFsc2UKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgCiAgICBnZXRnZW52KCkud29ya2luZyA9IGJvb2wKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIHRlbGVwb3J0QW5kU3RhcnQoIlB1bGwgVXAiLCBDRnJhbWUubmV3KC04NjY2LCAzNCwgMjA3MCkpCiAgICBlbmQKZW5kKQoKLS0gSnVuZ2xlIEd5bSBCb3VsZGVyCmp1bmdsZUd5bUZvbGRlcjpBZGRTd2l0Y2goIkp1bmdsZSBCb3VsZGVyIiwgZnVuY3Rpb24oYm9vbCkKICAgIGlmIGdldGdlbnYoKS53b3JraW5nIGFuZCBub3QgYm9vbCB0aGVuCiAgICAgICAgZ2V0Z2VudigpLndvcmtpbmcgPSBmYWxzZQogICAgICAgIHJldHVybgogICAgZW5kCiAgICAKICAgIGdldGdlbnYoKS53b3JraW5nID0gYm9vbAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgdGVsZXBvcnRBbmRTdGFydCgiQm91bGRlciIsIENGcmFtZS5uZXcoLTg2MjEsIDM0LCAyNjg0KSkKICAgIGVuZAplbmQpCgotLSBORVc6IEZhcm0gR3ltcyBGb2xkZXIKbG9jYWwgZmFybUd5bXNGb2xkZXIgPSBmYXJtUGx1c1RhYjpBZGRGb2xkZXIoIkd5bSBXb3Jrb3V0cyIpCgotLSBXb3Jrb3V0IHBvc2l0aW9ucyBkYXRhCmxvY2FsIHdvcmtvdXRQb3NpdGlvbnMgPSB7CiAgICBbIkJlbmNoIFByZXNzIl0gPSB7CiAgICAgICAgWyJFdGVybmFsIEd5bSJdID0gQ0ZyYW1lLm5ldygtNzE3Ni4xOTE0MSwgNDUuMzk0MTA0LCAtMTEwNi4zMTQyMSksCiAgICAgICAgWyJMZWdlbmQgR3ltIl0gPSBDRnJhbWUubmV3KDQxMTEuOTE3NDgsIDEwMjAuNDY2NzQsIC0zNzk5Ljk3MjE3KSwKICAgICAgICBbIk11c2NsZSBLaW5nIEd5bSJdID0gQ0ZyYW1lLm5ldygtODU5MC4wNjE1MiwgNDYuMDE2NzQyNywgLTYwNDMuMzQ3MTcpCiAgICB9LAogICAgWyJTcXVhdCJdID0gewogICAgICAgIFsiRXRlcm5hbCBHeW0iXSA9IENGcmFtZS5uZXcoLTcxNzYuMTkxNDEsIDQ1LjM5NDEwNCwgLTExMDYuMzE0MjEpLAogICAgICAgIFsiTGVnZW5kIEd5bSJdID0gQ0ZyYW1lLm5ldyg0MzA0Ljk5MDIzLCA5ODcuODI5OTU2LCAtNDEyNC4yMzM0KSwKICAgICAgICBbIk11c2NsZSBLaW5nIEd5bSJdID0gQ0ZyYW1lLm5ldygtODk0MC4xMjQwMiwgMTMuMTY0MjA4NCwgLTU2OTkuMTM0NzcpCiAgICB9LAogICAgWyJEZWFkbGlmdCJdID0gewogICAgICAgIFsiRXRlcm5hbCBHeW0iXSA9IENGcmFtZS5uZXcoLTcxNzYuMTkxNDEsIDQ1LjM5NDEwNCwgLTExMDYuMzE0MjEpLAogICAgICAgIFsiTGVnZW5kIEd5bSJdID0gQ0ZyYW1lLm5ldyg0MzA0Ljk5MDIzLCA5ODcuODI5OTU2LCAtNDEyNC4yMzM0KSwKICAgICAgICBbIk11c2NsZSBLaW5nIEd5bSJdID0gQ0ZyYW1lLm5ldygtODk0MC4xMjQwMiwgMTMuMTY0MjA4NCwgLTU2OTkuMTM0NzcpCiAgICB9LAogICAgWyJQdWxsIFVwIl0gPSB7CiAgICAgICAgWyJFdGVybmFsIEd5bSJdID0gQ0ZyYW1lLm5ldygtNzE3Ni4xOTE0MSwgNDUuMzk0MTA0LCAtMTEwNi4zMTQyMSksCiAgICAgICAgWyJMZWdlbmQgR3ltIl0gPSBDRnJhbWUubmV3KDQzMDQuOTkwMjMsIDk4Ny44Mjk5NTYsIC00MTI0LjIzMzQpLAogICAgICAgIFsiTXVzY2xlIEtpbmcgR3ltIl0gPSBDRnJhbWUubmV3KC04OTQwLjEyNDAyLCAxMy4xNjQyMDg0LCAtNTY5OS4xMzQ3NykKICAgIH0KfQoKLS0gV29ya291dCB0eXBlcwpsb2NhbCB3b3Jrb3V0VHlwZXMgPSB7CiAgICAiQmVuY2ggUHJlc3MiLAogICAgIlNxdWF0IiwKICAgICJEZWFkbGlmdCIsCiAgICAiUHVsbCBVcCIKfQoKLS0gR3ltIGxvY2F0aW9ucyAob25seSB0aGUgdGhyZWUgcmVxdWVzdGVkKQpsb2NhbCBneW1Mb2NhdGlvbnMgPSB7CiAgICAiRXRlcm5hbCBHeW0iLAogICAgIkxlZ2VuZCBHeW0iLAogICAgIk11c2NsZSBLaW5nIEd5bSIKfQoKLS0gU3BhbmlzaCB0cmFuc2xhdGlvbnMgZm9yIHdvcmtvdXQgdHlwZXMKbG9jYWwgd29ya291dFRyYW5zbGF0aW9ucyA9IHsKICAgIFsiQmVuY2ggUHJlc3MiXSA9ICJCZW5jaCBQcmVzcyIsCiAgICBbIlNxdWF0Il0gPSAiU3F1YXQiLAogICAgWyJEZWFkbGlmdCJdID0gIkRlYWQgTGlmdCIsCiAgICBbIlB1bGwgVXAiXSA9ICJQdWxsIFVwIgp9CgotLSBTdG9yZSByZWZlcmVuY2VzIHRvIHRvZ2dsZSBvYmplY3RzCmxvY2FsIGd5bVRvZ2dsZXMgPSB7fQoKLS0gQ3JlYXRlIGRyb3Bkb3ducyBhbmQgdG9nZ2xlcyBmb3IgZWFjaCB3b3Jrb3V0IHR5cGUKZm9yIF8sIHdvcmtvdXRUeXBlIGluIGlwYWlycyh3b3Jrb3V0VHlwZXMpIGRvCiAgICAtLSBDcmVhdGUgZHJvcGRvd24gZm9yIGd5bSBzZWxlY3Rpb24KICAgIGxvY2FsIGRyb3Bkb3duTmFtZSA9IHdvcmtvdXRUeXBlIC4uICJHeW1Ecm9wZG93biIKICAgIGxvY2FsIHNwYW5pc2hXb3Jrb3V0TmFtZSA9IHdvcmtvdXRUcmFuc2xhdGlvbnNbd29ya291dFR5cGVdCiAgICAKICAgIC0tIENyZWF0ZSB0aGUgZHJvcGRvd24gd2l0aCB0aGUgY29ycmVjdCBmb3JtYXQKICAgIGxvY2FsIGRyb3Bkb3duID0gZmFybUd5bXNGb2xkZXI6QWRkRHJvcGRvd24oc3BhbmlzaFdvcmtvdXROYW1lIC4uICIgLSBHeW0iLCBmdW5jdGlvbihzZWxlY3RlZCkKICAgICAgICBfR1sic2VsZWN0ZWQiIC4uIHN0cmluZy5nc3ViKHdvcmtvdXRUeXBlLCAiICIsICIiKSAuLiAiR3ltIl0gPSBzZWxlY3RlZAogICAgZW5kKQogICAgCiAgICAtLSBBZGQgZ3ltIGxvY2F0aW9ucyB0byB0aGUgZHJvcGRvd24KICAgIGZvciBfLCBneW1OYW1lIGluIGlwYWlycyhneW1Mb2NhdGlvbnMpIGRvCiAgICAgICAgZHJvcGRvd246QWRkKGd5bU5hbWUpCiAgICBlbmQKICAgIAogICAgLS0gQ3JlYXRlIHRvZ2dsZSBmb3Igd29ya291dAogICAgbG9jYWwgdG9nZ2xlTmFtZSA9IHdvcmtvdXRUeXBlIC4uICJHeW1Ub2dnbGUiCiAgICBsb2NhbCB0b2dnbGUgPSBmYXJtR3ltc0ZvbGRlcjpBZGRTd2l0Y2goc3BhbmlzaFdvcmtvdXROYW1lLCBmdW5jdGlvbihib29sKQogICAgICAgIGdldGdlbnYoKS53b3JraW5nR3ltID0gYm9vbAogICAgICAgIGdldGdlbnYoKS5jdXJyZW50V29ya291dFR5cGUgPSB3b3Jrb3V0VHlwZQogICAgICAgIAogICAgICAgIGlmIGJvb2wgdGhlbgogICAgICAgICAgICBsb2NhbCBzZWxlY3RlZEd5bSA9IF9HWyJzZWxlY3RlZCIgLi4gc3RyaW5nLmdzdWIod29ya291dFR5cGUsICIgIiwgIiIpIC4uICJHeW0iXSBvciBneW1Mb2NhdGlvbnNbMV0KICAgICAgICAgICAgCiAgICAgICAgICAgIC0tIE1ha2Ugc3VyZSB3ZSBoYXZlIGEgdmFsaWQgcG9zaXRpb24KICAgICAgICAgICAgaWYgd29ya291dFBvc2l0aW9uc1t3b3Jrb3V0VHlwZV0gYW5kIHdvcmtvdXRQb3NpdGlvbnNbd29ya291dFR5cGVdW3NlbGVjdGVkR3ltXSB0aGVuCiAgICAgICAgICAgICAgICAtLSBTdG9wIGFueSBvdGhlciB3b3Jrb3V0IHRoYXQgbWlnaHQgYmUgcnVubmluZwogICAgICAgICAgICAgICAgZm9yIG90aGVyVHlwZSwgb3RoZXJUb2dnbGUgaW4gcGFpcnMoZ3ltVG9nZ2xlcykgZG8KICAgICAgICAgICAgICAgICAgICBpZiBvdGhlclR5cGUgfj0gd29ya291dFR5cGUgYW5kIG90aGVyVG9nZ2xlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgb3RoZXJUb2dnbGU6U2V0KGZhbHNlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tIFN0YXJ0IHRoZSB3b3Jrb3V0CiAgICAgICAgICAgICAgICB0ZWxlcG9ydEFuZFN0YXJ0KHdvcmtvdXRUeXBlLCB3b3Jrb3V0UG9zaXRpb25zW3dvcmtvdXRUeXBlXVtzZWxlY3RlZEd5bV0pCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIC0tIE5vdGlmeSB1c2VyIGlmIHBvc2l0aW9uIGlzIG5vdCBmb3VuZAogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICAgICAgICAgICAgICBUaXRsZSA9ICJFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICJQb3NpdGlvbiBub3QgZm91bmQgZm9yICIgLi4gd29ya291dFR5cGUgLi4gIiBpbiAiIC4uIHNlbGVjdGVkR3ltLAogICAgICAgICAgICAgICAgICAgIER1cmF0aW9uID0gNQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICAKICAgIC0tIFN0b3JlIHJlZmVyZW5jZSB0byB0b2dnbGUKICAgIGd5bVRvZ2dsZXNbd29ya291dFR5cGVdID0gdG9nZ2xlCmVuZAoKbG9jYWwgc3RhdHMgPSB3aW5kb3c6QWRkVGFiKCJTdGF0cyIpCmxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBsZWFkZXJzdGF0cyA9IHBsYXllcjpXYWl0Rm9yQ2hpbGQoImxlYWRlcnN0YXRzIikKbG9jYWwgc3RyZW5ndGhTdGF0ID0gbGVhZGVyc3RhdHM6V2FpdEZvckNoaWxkKCJTdHJlbmd0aCIpCmxvY2FsIHJlYmlydGhzU3RhdCA9IGxlYWRlcnN0YXRzOldhaXRGb3JDaGlsZCgiUmViaXJ0aHMiKQpsb2NhbCBkdXJhYmlsaXR5U3RhdCA9IHBsYXllcjpXYWl0Rm9yQ2hpbGQoIkR1cmFiaWxpdHkiKQpsb2NhbCBraWxsc1N0YXQgPSBsZWFkZXJzdGF0czpXYWl0Rm9yQ2hpbGQoIktpbGxzIikKbG9jYWwgYWdpbGl0eVN0YXQgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJBZ2lsaXR5IikKbG9jYWwgZXZpbEthcm1hU3RhdCA9IHBsYXllcjpXYWl0Rm9yQ2hpbGQoImV2aWxLYXJtYSIpCmxvY2FsIGdvb2RLYXJtYVN0YXQgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJnb29kS2FybWEiKQpsb2NhbCBicmF3bHNTdGF0ID0gbGVhZGVyc3RhdHM6V2FpdEZvckNoaWxkKCJCcmF3bHMiKQoKbG9jYWwgZnVuY3Rpb24gQWJicmV2TnVtYmVyKG51bSkKICAgIGxvY2FsIGFiYnJldiA9IHsiIiwgIksiLCAiTSIsICJCIiwgIlQiLCAiUWEiLCAiUWkifQogICAgbG9jYWwgaSA9IDEKICAgIHdoaWxlIG51bSA+PSAxMDAwIGFuZCBpIDwgI2FiYnJldiBkbwogICAgICAgIG51bSA9IG51bSAvIDEwMDAKICAgICAgICBpID0gaSArIDEKICAgIGVuZAogICAgcmV0dXJuIHN0cmluZy5mb3JtYXQoIiUuMmYlcyIsIG51bSwgYWJicmV2W2ldKQplbmQKCnN0YXRzOkFkZExhYmVsKCLij7HvuI8gU2Vzc2lvbiBTdGF0aXN0aWNzIikuVGV4dFNpemUgPSAzMApsb2NhbCBzdG9wd2F0Y2hMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJTZXNzaW9uIFRpbWU6IDBkIDBoIDBtIDBzIikKc3RvcHdhdGNoTGFiZWwuVGV4dFNpemUgPSAyMAoKbG9jYWwgY3VzdG9tVGltZXJMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJDdXN0b20gVGltZXI6IE5vdCBzdGFydGVkIikKY3VzdG9tVGltZXJMYWJlbC5UZXh0U2l6ZSA9IDIwCgpsb2NhbCBpc0N1c3RvbVJ1bm5pbmcgPSBmYWxzZQpsb2NhbCBjdXN0b21TdGFydCA9IDAKbG9jYWwgY3VzdG9tRWxhcHNlZCA9IDAKCnN0YXRzOkFkZEJ1dHRvbigiU3RhcnQvU3RvcCBDdXN0b20gVGltZXIiLCBmdW5jdGlvbigpCiAgICBpZiBub3QgaXNDdXN0b21SdW5uaW5nIHRoZW4KICAgICAgICBpc0N1c3RvbVJ1bm5pbmcgPSB0cnVlCiAgICAgICAgY3VzdG9tU3RhcnQgPSB0aWNrKCkgLSBjdXN0b21FbGFwc2VkCiAgICBlbHNlCiAgICAgICAgaXNDdXN0b21SdW5uaW5nID0gZmFsc2UKICAgICAgICBjdXN0b21FbGFwc2VkID0gdGljaygpIC0gY3VzdG9tU3RhcnQKICAgIGVuZAplbmQpCgpzdGF0czpBZGRCdXR0b24oIlJlc2V0IEN1c3RvbSBUaW1lciIsIGZ1bmN0aW9uKCkKICAgIGlzQ3VzdG9tUnVubmluZyA9IGZhbHNlCiAgICBjdXN0b21TdGFydCA9IDAKICAgIGN1c3RvbUVsYXBzZWQgPSAwCiAgICBjdXN0b21UaW1lckxhYmVsLlRleHQgPSAiQ3VzdG9tIFRpbWVyOiBOb3Qgc3RhcnRlZCIKZW5kKQoKbG9jYWwgcmVzZXRTZXNzaW9uID0gZmFsc2UKc3RhdHM6QWRkQnV0dG9uKCJSZXNldCBTZXNzaW9uIFN0YXRzIiwgZnVuY3Rpb24oKQogICAgcmVzZXRTZXNzaW9uID0gdHJ1ZQplbmQpCgpzdGF0czpBZGRMYWJlbCgiLS0tLS0tLS0tLS0tLS0tLS0tIikuVGV4dFNpemUgPSAxNAoKc3RhdHM6QWRkTGFiZWwoIlByb2plY3RlZCBTdGF0cyIpLlRleHRTaXplID0gMzAKbG9jYWwgcHJvamVjdGVkU3RyZW5ndGhMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJTdHJlbmd0aCBQYWNlOiAtIikKcHJvamVjdGVkU3RyZW5ndGhMYWJlbC5UZXh0U2l6ZSA9IDIwCmxvY2FsIHByb2plY3RlZER1cmFiaWxpdHlMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJEdXJhYmlsaXR5IFBhY2U6IC0iKQpwcm9qZWN0ZWREdXJhYmlsaXR5TGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBwcm9qZWN0ZWRSZWJpcnRoc0xhYmVsID0gc3RhdHM6QWRkTGFiZWwoIlJlYmlydGggUGFjZTogLSIpCnByb2plY3RlZFJlYmlydGhzTGFiZWwuVGV4dFNpemUgPSAyMAoKc3RhdHM6QWRkTGFiZWwoIi0tLS0tLS0tLS0tLS0tLS0tLSIpLlRleHRTaXplID0gMTQKCnN0YXRzOkFkZExhYmVsKCJMZWFkZXJib2FyZCBTdGF0cyIpLlRleHRTaXplID0gMzAKbG9jYWwgc3RyZW5ndGhMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJTdHJlbmd0aDogLSIpCnN0cmVuZ3RoTGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCByZWJpcnRoc0xhYmVsID0gc3RhdHM6QWRkTGFiZWwoIlJlYmlydGhzOiAtIikKcmViaXJ0aHNMYWJlbC5UZXh0U2l6ZSA9IDIwCmxvY2FsIGtpbGxzTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiS2lsbHM6IC0iKQpraWxsc0xhYmVsLlRleHRTaXplID0gMjAKbG9jYWwgYnJhd2xzTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiQnJhd2xzOiAtIikKYnJhd2xzTGFiZWwuVGV4dFNpemUgPSAyMAoKc3RhdHM6QWRkTGFiZWwoIi0tLS0tLS0tLS0tLS0tLS0tLSIpLlRleHRTaXplID0gMTQKCnN0YXRzOkFkZExhYmVsKCJQbGF5ZXIgU3RhdHMiKS5UZXh0U2l6ZSA9IDMwCmxvY2FsIGdvb2RLYXJtYUxhYmVsID0gc3RhdHM6QWRkTGFiZWwoIkdvb2QgS2FybWE6IC0iKQpnb29kS2FybWFMYWJlbC5UZXh0U2l6ZSA9IDIwCmxvY2FsIGV2aWxLYXJtYUxhYmVsID0gc3RhdHM6QWRkTGFiZWwoIkV2aWwgS2FybWE6IC0iKQpldmlsS2FybWFMYWJlbC5UZXh0U2l6ZSA9IDIwCmxvY2FsIGR1cmFiaWxpdHlMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJEdXJhYmlsaXR5OiAtIikKZHVyYWJpbGl0eUxhYmVsLlRleHRTaXplID0gMjAKbG9jYWwgYWdpbGl0eUxhYmVsID0gc3RhdHM6QWRkTGFiZWwoIkFnaWxpdHk6IC0iKQphZ2lsaXR5TGFiZWwuVGV4dFNpemUgPSAyMAoKbG9jYWwgc3RhcnRUaW1lID0gdGljaygpCmxvY2FsIGluaXRpYWxTdHJlbmd0aCA9IHN0cmVuZ3RoU3RhdC5WYWx1ZQpsb2NhbCBpbml0aWFsRHVyYWJpbGl0eSA9IGR1cmFiaWxpdHlTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxSZWJpcnRocyA9IHJlYmlydGhzU3RhdC5WYWx1ZQpsb2NhbCBpbml0aWFsS2lsbHMgPSBraWxsc1N0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbEFnaWxpdHkgPSBhZ2lsaXR5U3RhdC5WYWx1ZQpsb2NhbCBpbml0aWFsRXZpbEthcm1hID0gZXZpbEthcm1hU3RhdC5WYWx1ZQpsb2NhbCBpbml0aWFsR29vZEthcm1hID0gZ29vZEthcm1hU3RhdC5WYWx1ZQpsb2NhbCBpbml0aWFsQnJhd2xzID0gYnJhd2xzU3RhdC5WYWx1ZQoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICBsb2NhbCBsYXN0VXBkYXRlID0gMAogICAgd2hpbGUgdGFzay53YWl0KDAuMikgZG8KICAgICAgICBsb2NhbCBlbGFwc2VkVGltZSA9IHRpY2soKSAtIHN0YXJ0VGltZQogICAgICAgIGxvY2FsIGRheXMgPSBtYXRoLmZsb29yKGVsYXBzZWRUaW1lIC8gKDI0ICogMzYwMCkpCiAgICAgICAgbG9jYWwgaG91cnMgPSBtYXRoLmZsb29yKChlbGFwc2VkVGltZSAlICgyNCAqIDM2MDApKSAvIDM2MDApCiAgICAgICAgbG9jYWwgbWludXRlcyA9IG1hdGguZmxvb3IoKGVsYXBzZWRUaW1lICUgMzYwMCkgLyA2MCkKICAgICAgICBsb2NhbCBzZWNvbmRzID0gbWF0aC5mbG9vcihlbGFwc2VkVGltZSAlIDYwKQogICAgICAgIHN0b3B3YXRjaExhYmVsLlRleHQgPSBzdHJpbmcuZm9ybWF0KCJTZXNzaW9uIFRpbWU6ICVkZCAlZGggJWRtICVkcyIsIGRheXMsIGhvdXJzLCBtaW51dGVzLCBzZWNvbmRzKQoKICAgICAgICBpZiBpc0N1c3RvbVJ1bm5pbmcgdGhlbgogICAgICAgICAgICBjdXN0b21FbGFwc2VkID0gdGljaygpIC0gY3VzdG9tU3RhcnQKICAgICAgICBlbmQKICAgICAgICBpZiBjdXN0b21FbGFwc2VkID4gMCB0aGVuCiAgICAgICAgICAgIGxvY2FsIGQgPSBtYXRoLmZsb29yKGN1c3RvbUVsYXBzZWQgLyAoMjQgKiAzNjAwKSkKICAgICAgICAgICAgbG9jYWwgaCA9IG1hdGguZmxvb3IoKGN1c3RvbUVsYXBzZWQgJSAoMjQgKiAzNjAwKSkgLyAzNjAwKQogICAgICAgICAgICBsb2NhbCBtID0gbWF0aC5mbG9vcigoY3VzdG9tRWxhcHNlZCAlIDM2MDApIC8gNjApCiAgICAgICAgICAgIGxvY2FsIHMgPSBtYXRoLmZsb29yKGN1c3RvbUVsYXBzZWQgJSA2MCkKICAgICAgICAgICAgY3VzdG9tVGltZXJMYWJlbC5UZXh0ID0gc3RyaW5nLmZvcm1hdCgiQ3VzdG9tIFRpbWVyOiAlZGQgJWRoICVkbSAlZHMiLCBkLCBoLCBtLCBzKQogICAgICAgIGVuZAoKICAgICAgICBpZiByZXNldFNlc3Npb24gdGhlbgogICAgICAgICAgICBzdGFydFRpbWUgPSB0aWNrKCkKICAgICAgICAgICAgaW5pdGlhbFN0cmVuZ3RoID0gc3RyZW5ndGhTdGF0LlZhbHVlCiAgICAgICAgICAgIGluaXRpYWxEdXJhYmlsaXR5ID0gZHVyYWJpbGl0eVN0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbFJlYmlydGhzID0gcmViaXJ0aHNTdGF0LlZhbHVlCiAgICAgICAgICAgIGluaXRpYWxLaWxscyA9IGtpbGxzU3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsQWdpbGl0eSA9IGFnaWxpdHlTdGF0LlZhbHVlCiAgICAgICAgICAgIGluaXRpYWxFdmlsS2FybWEgPSBldmlsS2FybWFTdGF0LlZhbHVlCiAgICAgICAgICAgIGluaXRpYWxHb29kS2FybWEgPSBnb29kS2FybWFTdGF0LlZhbHVlCiAgICAgICAgICAgIGluaXRpYWxCcmF3bHMgPSBicmF3bHNTdGF0LlZhbHVlCiAgICAgICAgICAgIHJlc2V0U2Vzc2lvbiA9IGZhbHNlCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGNTdHIgPSBzdHJlbmd0aFN0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjUmViID0gcmViaXJ0aHNTdGF0LlZhbHVlCiAgICAgICAgbG9jYWwgY0R1ciA9IGR1cmFiaWxpdHlTdGF0LlZhbHVlCiAgICAgICAgbG9jYWwgY0tpbGxzID0ga2lsbHNTdGF0LlZhbHVlCiAgICAgICAgbG9jYWwgY0FnaSA9IGFnaWxpdHlTdGF0LlZhbHVlCiAgICAgICAgbG9jYWwgY0V2aWwgPSBldmlsS2FybWFTdGF0LlZhbHVlCiAgICAgICAgbG9jYWwgY0dvb2QgPSBnb29kS2FybWFTdGF0LlZhbHVlCiAgICAgICAgbG9jYWwgY0JyYXdsID0gYnJhd2xzU3RhdC5WYWx1ZQoKICAgICAgICBsb2NhbCBkU3RyID0gY1N0ciAtIGluaXRpYWxTdHJlbmd0aAogICAgICAgIGxvY2FsIGREdXIgPSBjRHVyIC0gaW5pdGlhbER1cmFiaWxpdHkKICAgICAgICBsb2NhbCBkUmViID0gY1JlYiAtIGluaXRpYWxSZWJpcnRocwogICAgICAgIGxvY2FsIGRLaWxscyA9IGNLaWxscyAtIGluaXRpYWxLaWxscwogICAgICAgIGxvY2FsIGRBZ2kgPSBjQWdpIC0gaW5pdGlhbEFnaWxpdHkKICAgICAgICBsb2NhbCBkRXZpbCA9IGNFdmlsIC0gaW5pdGlhbEV2aWxLYXJtYQogICAgICAgIGxvY2FsIGRHb29kID0gY0dvb2QgLSBpbml0aWFsR29vZEthcm1hCiAgICAgICAgbG9jYWwgZEJyYXdsID0gY0JyYXdsIC0gaW5pdGlhbEJyYXdscwoKICAgICAgICBzdHJlbmd0aExhYmVsLlRleHQgPSAiU3RyZW5ndGg6ICIgLi4gQWJicmV2TnVtYmVyKGNTdHIpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZFN0cikKICAgICAgICByZWJpcnRoc0xhYmVsLlRleHQgPSAiUmViaXJ0aHM6ICIgLi4gQWJicmV2TnVtYmVyKGNSZWIpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZFJlYikKICAgICAgICBraWxsc0xhYmVsLlRleHQgPSAiS2lsbHM6ICIgLi4gQWJicmV2TnVtYmVyKGNLaWxscykgLi4gIiB8ICsiIC4uIEFiYnJldk51bWJlcihkS2lsbHMpCiAgICAgICAgYnJhd2xzTGFiZWwuVGV4dCA9ICJCcmF3bHM6ICIgLi4gQWJicmV2TnVtYmVyKGNCcmF3bCkgLi4gIiB8ICsiIC4uIEFiYnJldk51bWJlcihkQnJhd2wpCgogICAgICAgIGdvb2RLYXJtYUxhYmVsLlRleHQgPSAiR29vZCBLYXJtYTogIiAuLiBBYmJyZXZOdW1iZXIoY0dvb2QpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZEdvb2QpCiAgICAgICAgZXZpbEthcm1hTGFiZWwuVGV4dCA9ICJFdmlsIEthcm1hOiAiIC4uIEFiYnJldk51bWJlcihjRXZpbCkgLi4gIiB8ICsiIC4uIEFiYnJldk51bWJlcihkRXZpbCkKICAgICAgICBkdXJhYmlsaXR5TGFiZWwuVGV4dCA9ICJEdXJhYmlsaXR5OiAiIC4uIEFiYnJldk51bWJlcihjRHVyKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGREdXIpCiAgICAgICAgYWdpbGl0eUxhYmVsLlRleHQgPSAiQWdpbGl0eTogIiAuLiBBYmJyZXZOdW1iZXIoY0FnaSkgLi4gIiB8ICsiIC4uIEFiYnJldk51bWJlcihkQWdpKQoKICAgICAgICBpZiB0aWNrKCkgLSBsYXN0VXBkYXRlID49IDYgdGhlbgogICAgICAgICAgICBsYXN0VXBkYXRlID0gdGljaygpCiAgICAgICAgICAgIGxvY2FsIHNTZWMgPSBkU3RyIC8gZWxhcHNlZFRpbWUKICAgICAgICAgICAgbG9jYWwgZFNlYyA9IGREdXIgLyBlbGFwc2VkVGltZQogICAgICAgICAgICBsb2NhbCByU2VjID0gZFJlYiAvIGVsYXBzZWRUaW1lCgogICAgICAgICAgICBsb2NhbCBoID0gMzYwMAogICAgICAgICAgICBsb2NhbCBkID0gODY0MDAKCiAgICAgICAgICAgIHByb2plY3RlZFN0cmVuZ3RoTGFiZWwuVGV4dCA9ICJTdHJlbmd0aCBQYWNlOiAiIC4uIEFiYnJldk51bWJlcihtYXRoLmZsb29yKHNTZWMgKiBoKSkgLi4gIi9oIHwgIiAuLiBBYmJyZXZOdW1iZXIobWF0aC5mbG9vcihzU2VjICogZCkpIC4uICIvZCIKICAgICAgICAgICAgcHJvamVjdGVkRHVyYWJpbGl0eUxhYmVsLlRleHQgPSAiRHVyYWJpbGl0eSBQYWNlOiAiIC4uIEFiYnJldk51bWJlcihtYXRoLmZsb29yKGRTZWMgKiBoKSkgLi4gIi9oIHwgIiAuLiBBYmJyZXZOdW1iZXIobWF0aC5mbG9vcihkU2VjICogZCkpIC4uICIvZCIKICAgICAgICAgICAgcHJvamVjdGVkUmViaXJ0aHNMYWJlbC5UZXh0ID0gIlJlYmlydGggUGFjZTogIiAuLiBBYmJyZXZOdW1iZXIobWF0aC5mbG9vcihyU2VjICogaCkpIC4uICIvaCB8ICIgLi4gQWJicmV2TnVtYmVyKG1hdGguZmxvb3IoclNlYyAqIGQpKSAuLiAiL2QiCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKbG9jYWwgZXN0YWRpc3RpY2FzID0gd2luZG93OkFkZFRhYigiU3BlY3MiKQoKbG9jYWwgU2VsZWN0UGxheWVyTmFtZSA9ICIiCgpsb2NhbCBQbGF5ZXJEcm9wID0gZXN0YWRpc3RpY2FzOkFkZERyb3Bkb3duKCJTZWxlY3QgUGxheWVyIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBTZWxlY3RQbGF5ZXJOYW1lID0gVmFsdWU6bWF0Y2goInwgKC4rKSIpCiAgICBwcmV2aW91c1ZhbHVlcyA9IHt9CmVuZCkKCmxvY2FsIFBsYXllcnNsaXN0ID0ge30KZm9yIF8sIFBsciBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKTpHZXRQbGF5ZXJzKCkpIGRvCiAgICBsb2NhbCBkaXNwbGF5TmFtZSA9IFBsci5EaXNwbGF5TmFtZSAuLiAiIHwgIiAuLiBQbHIuTmFtZQogICAgdGFibGUuaW5zZXJ0KFBsYXllcnNsaXN0LCBkaXNwbGF5TmFtZSkKZW5kCmZvciBfLCBBZGRQbHIgaW4gaXBhaXJzKFBsYXllcnNsaXN0KSBkbwogICAgUGxheWVyRHJvcDpBZGQoQWRkUGxyKQplbmQKCmxvY2FsIGZ1bmN0aW9uIEZvcm1hdE51bWJlcldpdGhDb21tYXMobnVtYmVyKQogICAgbG9jYWwgZm9ybWF0dGVkID0gdG9zdHJpbmcobnVtYmVyKTpyZXZlcnNlKCk6Z3N1YigiKCVkJWQlZCkiLCAiJTEsIik6cmV2ZXJzZSgpCiAgICByZXR1cm4gZm9ybWF0dGVkOmdzdWIoIl4sIiwgIiIpCmVuZAoKbG9jYWwgZnVuY3Rpb24gRm9ybWF0QWJicmV2aWF0ZWQobnVtYmVyKQogICAgbG9jYWwgYWJicmV2aWF0aW9ucyA9IHsiIiwgIksiLCAiTSIsICJCIiwgIlQiLCAiUWEiLCAiUWkifQogICAgbG9jYWwgYWJicmV2aWF0aW9uSW5kZXggPSAxCiAgICB3aGlsZSBudW1iZXIgPj0gMTAwMCBkbwogICAgICAgIG51bWJlciA9IG51bWJlciAvIDEwMDAKICAgICAgICBhYmJyZXZpYXRpb25JbmRleCA9IGFiYnJldmlhdGlvbkluZGV4ICsgMQogICAgZW5kCiAgICByZXR1cm4gc3RyaW5nLmZvcm1hdCgiJS4yZiIsIG51bWJlcikgLi4gYWJicmV2aWF0aW9uc1thYmJyZXZpYXRpb25JbmRleF0KZW5kCgpsb2NhbCBmdW5jdGlvbiBGb3JtYXREaXNwbGF5KHZhbHVlKQogICAgbG9jYWwgbm9ybWFsID0gRm9ybWF0TnVtYmVyV2l0aENvbW1hcyh2YWx1ZSkKICAgIGxvY2FsIGFiYnJldmlhdGVkID0gRm9ybWF0QWJicmV2aWF0ZWQodmFsdWUpCiAgICByZXR1cm4gIlsgIiAuLiBub3JtYWwgLi4gIiB8ICIgLi4gYWJicmV2aWF0ZWQgLi4gIiBdIgplbmQKCmxvY2FsIHByZXZpb3VzVmFsdWVzID0ge30KCmxvY2FsIFVwZGF0ZSA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMSA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMiA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMyA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlNCA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlNSA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlNiA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlOSA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMTAgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTExID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUxMiA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMTMgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCgp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwKSBkbwogICAgICAgIGlmIFNlbGVjdFBsYXllck5hbWUgfj0gIiIgdGhlbgogICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnM6RmluZEZpcnN0Q2hpbGQoU2VsZWN0UGxheWVyTmFtZSkKICAgICAgICAgICAgaWYgcGxheWVyIHRoZW4KICAgICAgICAgICAgICAgIGlmIHBsYXllcjpGaW5kRmlyc3RDaGlsZCgiR2VtcyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGUxLlRleHQgPSAiR2VtczogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5HZW1zLlZhbHVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkFnaWxpdHkiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlMy5UZXh0ID0gIkFnaWxpdHk6ICIgLi4gRm9ybWF0RGlzcGxheShwbGF5ZXIuQWdpbGl0eS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJEdXJhYmlsaXR5IikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTQuVGV4dCA9ICJEdXJhYmlsaXR5OiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLkR1cmFiaWxpdHkuVmFsdWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHBsYXllcjpGaW5kRmlyc3RDaGlsZCgibXVzY2xlS2luZ1RpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlNi5UZXh0ID0gIk11c2NsZSBLaW5nIFRpbWU6ICIgLi4gRm9ybWF0RGlzcGxheShwbGF5ZXIubXVzY2xlS2luZ1RpbWUuVmFsdWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHBsYXllcjpGaW5kRmlyc3RDaGlsZCgiY3VzdG9tU2l6ZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGUxMC5UZXh0ID0gIkN1c3RvbSBTaXplOiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLmN1c3RvbVNpemUuVmFsdWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHBsYXllcjpGaW5kRmlyc3RDaGlsZCgiY3VzdG9tU3BlZWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlMTEuVGV4dCA9ICJDdXN0b20gU3BlZWQ6ICIgLi4gRm9ybWF0RGlzcGxheShwbGF5ZXIuY3VzdG9tU3BlZWQuVmFsdWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHBsYXllcjpGaW5kRmlyc3RDaGlsZCgiZXZpbEthcm1hIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTEyLlRleHQgPSAiRXZpbCBLYXJtYTogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5ldmlsS2FybWEuVmFsdWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHBsYXllcjpGaW5kRmlyc3RDaGlsZCgiZ29vZEthcm1hIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTEzLlRleHQgPSAiR29vZCBLYXJtYTogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5nb29kS2FybWEuVmFsdWUpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBsb2NhbCBsZWFkZXJzdGF0cyA9IHBsYXllcjpGaW5kRmlyc3RDaGlsZCgibGVhZGVyc3RhdHMiKQogICAgICAgICAgICAgICAgaWYgbGVhZGVyc3RhdHMgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGxlYWRlcnN0YXRzOkZpbmRGaXJzdENoaWxkKCJTdHJlbmd0aCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlLlRleHQgPSAiU3RyZW5ndGg6ICIgLi4gRm9ybWF0RGlzcGxheShsZWFkZXJzdGF0cy5TdHJlbmd0aC5WYWx1ZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBsZWFkZXJzdGF0czpGaW5kRmlyc3RDaGlsZCgiUmViaXJ0aHMiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFVwZGF0ZTIuVGV4dCA9ICJSZWJpcnRoOiAiIC4uIEZvcm1hdERpc3BsYXkobGVhZGVyc3RhdHMuUmViaXJ0aHMuVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbGVhZGVyc3RhdHM6RmluZEZpcnN0Q2hpbGQoIktpbGxzIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGU1LlRleHQgPSAiS2lsbHM6ICIgLi4gRm9ybWF0RGlzcGxheShsZWFkZXJzdGF0cy5LaWxscy5WYWx1ZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIHBsYXllcjpGaW5kRmlyc3RDaGlsZCgiY3VycmVudE1hcCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGU5LlRleHQgPSAiQ3VycmVudCBNYXA6ICIgLi4gdG9zdHJpbmcocGxheWVyLmN1cnJlbnRNYXAuVmFsdWUpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlOS5UZXh0ID0gIkN1cnJlbnQgTWFwOiBBdWN1bmUgZG9ubsODxpLDhuKAmcOD4oCgw6LigqzihKLDg8aSw6LigqzFocOD4oCaw4LCqWUiCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKbG9jYWwgcGV0cyA9IHdpbmRvdzpBZGRUYWIoICAgICAgICJQZXQgU2hvcCIpCmxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCgotLSBDcnlzdGFsIGRhdGEgc3RydWN0dXJlIHdpdGggZXhhY3QgbmFtZXMgZnJvbSB5b3VyIG9yaWdpbmFsIGNvZGUKbG9jYWwgY3J5c3RhbERhdGEgPSB7CiAgICBbIkJsdWUgQ3J5c3RhbCJdID0gewogICAgICAgIHtuYW1lID0gIkJsdWUgQmlyZGllIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiT3JhbmdlIEhlZGdlaG9nIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiQmx1ZSBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiUmVkIEtpdHR5IiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiRGFyayBWYW1weSIsIHJhcml0eSA9ICJBZHZhbmNlZCJ9LAogICAgICAgIHtuYW1lID0gIkJsdWUgQnVubnkiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJSZWQgQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIkJsdWUgQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIkdyZWVuIEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJQdXJwbGUgQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIlJlZCBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiWWVsbG93IEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifQogICAgfSwKICAgIFsiR3JlZW4gQ3J5c3RhbCJdID0gewogICAgICAgIHtuYW1lID0gIlNpbHZlciBEb2ciLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJHcmVlbiBBdXJhIiwgcmFyaXR5ID0gIkFkdmFuY2VkIn0sCiAgICAgICAge25hbWUgPSAiRGFyayBHb2xlbSIsIHJhcml0eSA9ICJBZHZhbmNlZCJ9LAogICAgICAgIHtuYW1lID0gIkdyZWVuIEJ1dHRlcmZseSIsIHJhcml0eSA9ICJBZHZhbmNlZCJ9LAogICAgICAgIHtuYW1lID0gIkNyaW1zb24gRmFsY29uIiwgcmFyaXR5ID0gIlJhcmUifSwKICAgICAgICB7bmFtZSA9ICJSZWQgQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIkJsdWUgQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIkdyZWVuIEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJQdXJwbGUgQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIlJlZCBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiWWVsbG93IEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifQogICAgfSwKICAgIFsiRnJvc3QgQ3J5c3RhbCJdID0gewogICAgICAgIHtuYW1lID0gIlllbGxvdyBCdXR0ZXJmbHkiLCByYXJpdHkgPSAiQWR2YW5jZWQifSwKICAgICAgICB7bmFtZSA9ICJQdXJwbGUgRHJhZ29uIiwgcmFyaXR5ID0gIlJhcmUifSwKICAgICAgICB7bmFtZSA9ICJCbHVlIFBoZW9uaXgiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIk9yYW5nZSBQZWdhc3VzIiwgcmFyaXR5ID0gIlJhcmUifSwKICAgICAgICB7bmFtZSA9ICJMaWdodG5pbmciLCByYXJpdHkgPSAiUmFyZSJ9LAogICAgICAgIHtuYW1lID0gIkVsZWN0cm8iLCByYXJpdHkgPSAiQWR2YW5jZWQifQogICAgfSwKICAgIFsiTXl0aGljYWwgQ3J5c3RhbCJdID0gewogICAgICAgIHtuYW1lID0gIlB1cnBsZSBGYWxjb24iLCByYXJpdHkgPSAiUmFyZSJ9LAogICAgICAgIHtuYW1lID0gIlJlZCBEcmFnb24iLCByYXJpdHkgPSAiUmFyZSJ9LAogICAgICAgIHtuYW1lID0gIkJsdWUgRmlyZWNhc3RlciIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiR29sZGVuIFBoZW9uaXgiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIlBvd2VyIExpZ2h0bmluZyIsIHJhcml0eSA9ICJSYXJlIn0sCiAgICAgICAge25hbWUgPSAiRGFyayBMaWdodG5pbmciLCByYXJpdHkgPSAiRXBpYyJ9CiAgICB9LAogICAgWyJJbmZlcm5vIENyeXN0YWwiXSA9IHsKICAgICAgICB7bmFtZSA9ICJSZWQgRmlyZWNhc3RlciIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiSW5mZXJuYWwgRHJhZ29uIiwgcmFyaXR5ID0gIlVuaXF1ZSJ9LAogICAgICAgIHtuYW1lID0gIldoaXRlIFBlZ2FzdXMiLCByYXJpdHkgPSAiUmFyZSJ9LAogICAgICAgIHtuYW1lID0gIkdvbGRlbiBQaGVvbml4IiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJJbmZlcm5vIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJEYXJrIFN0b3JtIiwgcmFyaXR5ID0gIlVuaXF1ZSJ9CiAgICB9LAogICAgWyJMZWdlbmRzIENyeXN0YWwiXSA9IHsKICAgICAgICB7bmFtZSA9ICJVbHRyYSBCaXJkaWUiLCByYXJpdHkgPSAiVW5pcXVlIn0sCiAgICAgICAge25hbWUgPSAiTWFnaWMgQnV0dGVyZmx5IiwgcmFyaXR5ID0gIlVuaXF1ZSJ9LAogICAgICAgIHtuYW1lID0gIkdyZWVuIEZpcmVjYXN0ZXIiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIldoaXRlIFBoZW9uaXgiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIlN1cGVybm92YSIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiUHVycGxlIE5vdmEiLCByYXJpdHkgPSAiVW5pcXVlIn0KICAgIH0sCiAgICBbIk11c2NsZSBFbGl0ZSBDcnlzdGFsIl0gPSB7CiAgICAgICAge25hbWUgPSAiRnJvc3R3YXZlIExlZ2VuZHMgUGVuZ3VpbiIsIHJhcml0eSA9ICJSYXJlIn0sCiAgICAgICAge25hbWUgPSAiUGhhbnRvbSBHZW5lc2lzIERyYWdvbiIsIHJhcml0eSA9ICJSYXJlIn0sCiAgICAgICAge25hbWUgPSAiRGFyayBMZWdlbmRzIE1hbnRpY29yZSIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiVWx0aW1hdGUgU3VwZXJub3ZhIFBlZ2FzdXMiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIkFldGhlciBTcGlyaXQgQnVubnkiLCByYXJpdHkgPSAiVW5pcXVlIn0sCiAgICAgICAge25hbWUgPSAiQ3liZXJuZXRpYyBTaG93ZG93biBEcmFnb24iLCByYXJpdHkgPSAiVW5pcXVlIn0KICAgIH0sCiAgICBbIkdhbGF4eSBPcmFjbGUgQ3J5c3RhbCJdID0gewogICAgICAgIHtuYW1lID0gIkV0ZXJuYWwgU3RyaWtlIExldmlhdGhhbiIsIHJhcml0eSA9ICJSYXJlIn0sCiAgICAgICAge25hbWUgPSAiTGlnaHRuaW5nIFN0cmlrZSBQaGFudG9tIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJEYXJrc3RhciBIdW50ZXIiLCByYXJpdHkgPSAiVW5pcXVlIn0sCiAgICAgICAge25hbWUgPSAiTXVzY2xlIEtpbmciLCByYXJpdHkgPSAiVW5pcXVlIn0sCiAgICAgICAge25hbWUgPSAiQXp1cmUgVHVuZHJhIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJVbHRyYSBJbmZlcm5vIiwgcmFyaXR5ID0gIlJhcmUifQogICAgfSwKICAgIFsiSnVuZ2xlIENyeXN0YWwiXSA9IHsKICAgICAgICB7bmFtZSA9ICJFbnRyb3BpYyBCbGFzdCIsIHJhcml0eSA9ICJVbmlxdWUifSwKICAgICAgICB7bmFtZSA9ICJNdXNjbGUgU2Vuc2VpIiwgcmFyaXR5ID0gIlVuaXF1ZSJ9LAogICAgICAgIHtuYW1lID0gIkdyYW5kIFN1cGVybm92YSIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiTmVvbiBHdWFyZGlhbiIsIHJhcml0eSA9ICJVbmlxdWUifSwKICAgICAgICB7bmFtZSA9ICJFdGVybmFsIE1lZ2FzdHJpa2UiLCByYXJpdHkgPSAiVW5pcXVlIn0sCiAgICAgICAge25hbWUgPSAiR29sZGVuIFZpa2luZyIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiQXN0cmFsIEVsZWN0cm8iLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIkRhcmsgRWxlY3RybyIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiRW5jaGFudGVkIE1pcmFnZSIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiVWx0cmEgTWlyYWdlIiwgcmFyaXR5ID0gIlVuaXF1ZSJ9LAogICAgICAgIHtuYW1lID0gIlVuc3RhYmxlIE1pcmFnZSIsIHJhcml0eSA9ICJVbmlxdWUifQogICAgfQp9CgotLSBGdW5jdGlvbiB0byBjb2xsZWN0IGFsbCB1bmlxdWUgcGV0cyBhbmQgYXVyYXMKbG9jYWwgZnVuY3Rpb24gZ2V0QWxsUGV0c0FuZEF1cmFzKCkKICAgIGxvY2FsIGFsbFBldHMgPSB7fQogICAgbG9jYWwgYWxsQXVyYXMgPSB7fQogICAgCiAgICBmb3IgY3J5c3RhbE5hbWUsIHBldHMgaW4gcGFpcnMoY3J5c3RhbERhdGEpIGRvCiAgICAgICAgZm9yIF8sIHBldCBpbiBpcGFpcnMocGV0cykgZG8KICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQocGV0Lm5hbWUsICJBdXJhIikgdGhlbgogICAgICAgICAgICAgICAgaWYgbm90IGFsbEF1cmFzW3BldC5uYW1lXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgYWxsQXVyYXNbcGV0Lm5hbWVdID0ge25hbWUgPSBwZXQubmFtZSwgcmFyaXR5ID0gcGV0LnJhcml0eSwgY3J5c3RhbCA9IGNyeXN0YWxOYW1lfQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlmIG5vdCBhbGxQZXRzW3BldC5uYW1lXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgYWxsUGV0c1twZXQubmFtZV0gPSB7bmFtZSA9IHBldC5uYW1lLCByYXJpdHkgPSBwZXQucmFyaXR5LCBjcnlzdGFsID0gY3J5c3RhbE5hbWV9CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgcmV0dXJuIGFsbFBldHMsIGFsbEF1cmFzCmVuZAoKLS0gRnVuY3Rpb24gdG8gZmluZCB3aGljaCBjcnlzdGFsIGNvbnRhaW5zIGEgc3BlY2lmaWMgcGV0L2F1cmEKbG9jYWwgZnVuY3Rpb24gZmluZENyeXN0YWxGb3JJdGVtKGl0ZW1OYW1lKQogICAgZm9yIGNyeXN0YWxOYW1lLCBwZXRzIGluIHBhaXJzKGNyeXN0YWxEYXRhKSBkbwogICAgICAgIGZvciBfLCBwZXQgaW4gaXBhaXJzKHBldHMpIGRvCiAgICAgICAgICAgIGlmIHBldC5uYW1lID09IGl0ZW1OYW1lIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBjcnlzdGFsTmFtZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIG5pbAplbmQKCi0tIFZhcmlhYmxlcyB0byB0cmFjayBjdXJyZW50IHNlbGVjdGlvbnMKbG9jYWwgc2VsZWN0ZWRQZXQgPSAiIgpsb2NhbCBzZWxlY3RlZEF1cmEgPSAiIgoKLS0gR2V0IGFsbCBwZXRzIGFuZCBhdXJhcwpsb2NhbCBhbGxQZXRzLCBhbGxBdXJhcyA9IGdldEFsbFBldHNBbmRBdXJhcygpCgpwZXRzOkFkZExhYmVsKCJBdXJhICYgUGV0IFNob3AiKQoKLS0gUGV0IGRyb3Bkb3duCmxvY2FsIHBldERyb3Bkb3duID0gcGV0czpBZGREcm9wZG93bigiU2VsZWN0IHBldCIsIGZ1bmN0aW9uKHRleHQpCiAgICBzZWxlY3RlZFBldCA9IHRleHQKICAgIGxvY2FsIGNyeXN0YWwgPSBmaW5kQ3J5c3RhbEZvckl0ZW0odGV4dCkKICAgIHByaW50KCJQZXQgc2VsZWN0ZWQ6ICIgLi4gdGV4dCAuLiAiIChGb3VuZCBpbjogIiAuLiAoY3J5c3RhbCBvciAiVW5rbm93biIpIC4uICIpIikKZW5kKQoKLS0gQWRkIGFsbCBwZXRzIG1hbnVhbGx5IChzb3J0ZWQgYnkgcmFyaXR5KQotLSBCYXNpYyBQZXRzCnBldERyb3Bkb3duOkFkZCgiQmx1ZSBCaXJkaWUgKEJhc2ljKSIpCnBldERyb3Bkb3duOkFkZCgiT3JhbmdlIEhlZGdlaG9nIChCYXNpYykiKQpwZXREcm9wZG93bjpBZGQoIlJlZCBLaXR0eSAoQmFzaWMpIikKcGV0RHJvcGRvd246QWRkKCJCbHVlIEJ1bm55IChCYXNpYykiKQpwZXREcm9wZG93bjpBZGQoIlNpbHZlciBEb2cgKEJhc2ljKSIpCgotLSBBZHZhbmNlZCBQZXRzCnBldERyb3Bkb3duOkFkZCgiRGFyayBWYW1weSAoQWR2YW5jZWQpIikKcGV0RHJvcGRvd246QWRkKCJEYXJrIEdvbGVtIChBZHZhbmNlZCkiKQpwZXREcm9wZG93bjpBZGQoIkdyZWVuIEJ1dHRlcmZseSAoQWR2YW5jZWQpIikKcGV0RHJvcGRvd246QWRkKCJZZWxsb3cgQnV0dGVyZmx5IChBZHZhbmNlZCkiKQoKLS0gUmFyZSBQZXRzCnBldERyb3Bkb3duOkFkZCgiQ3JpbXNvbiBGYWxjb24gKFJhcmUpIikKcGV0RHJvcGRvd246QWRkKCJQdXJwbGUgRHJhZ29uIChSYXJlKSIpCnBldERyb3Bkb3duOkFkZCgiT3JhbmdlIFBlZ2FzdXMgKFJhcmUpIikKcGV0RHJvcGRvd246QWRkKCJQdXJwbGUgRmFsY29uIChSYXJlKSIpCnBldERyb3Bkb3duOkFkZCgiUmVkIERyYWdvbiAoUmFyZSkiKQpwZXREcm9wZG93bjpBZGQoIldoaXRlIFBlZ2FzdXMgKFJhcmUpIikKcGV0RHJvcGRvd246QWRkKCJGcm9zdHdhdmUgTGVnZW5kcyBQZW5ndWluIChSYXJlKSIpCnBldERyb3Bkb3duOkFkZCgiUGhhbnRvbSBHZW5lc2lzIERyYWdvbiAoUmFyZSkiKQpwZXREcm9wZG93bjpBZGQoIkV0ZXJuYWwgU3RyaWtlIExldmlhdGhhbiAoUmFyZSkiKQoKLS0gRXBpYyBQZXRzCnBldERyb3Bkb3duOkFkZCgiQmx1ZSBQaGVvbml4IChFcGljKSIpCnBldERyb3Bkb3duOkFkZCgiQmx1ZSBGaXJlY2FzdGVyIChFcGljKSIpCnBldERyb3Bkb3duOkFkZCgiR29sZGVuIFBoZW9uaXggKEVwaWMpIikKcGV0RHJvcGRvd246QWRkKCJSZWQgRmlyZWNhc3RlciAoRXBpYykiKQpwZXREcm9wZG93bjpBZGQoIkdyZWVuIEZpcmVjYXN0ZXIgKEVwaWMpIikKcGV0RHJvcGRvd246QWRkKCJXaGl0ZSBQaGVvbml4IChFcGljKSIpCnBldERyb3Bkb3duOkFkZCgiRGFyayBMZWdlbmRzIE1hbnRpY29yZSAoRXBpYykiKQpwZXREcm9wZG93bjpBZGQoIlVsdGltYXRlIFN1cGVybm92YSBQZWdhc3VzIChFcGljKSIpCnBldERyb3Bkb3duOkFkZCgiTGlnaHRuaW5nIFN0cmlrZSBQaGFudG9tIChFcGljKSIpCnBldERyb3Bkb3duOkFkZCgiR29sZGVuIFZpa2luZyAoRXBpYykiKQoKLS0gVW5pcXVlIFBldHMKcGV0RHJvcGRvd246QWRkKCJJbmZlcm5hbCBEcmFnb24gKFVuaXF1ZSkiKQpwZXREcm9wZG93bjpBZGQoIlVsdHJhIEJpcmRpZSAoVW5pcXVlKSIpCnBldERyb3Bkb3duOkFkZCgiTWFnaWMgQnV0dGVyZmx5IChVbmlxdWUpIikKcGV0RHJvcGRvd246QWRkKCJBZXRoZXIgU3Bpcml0IEJ1bm55IChVbmlxdWUpIikKcGV0RHJvcGRvd246QWRkKCJDeWJlcm5ldGljIFNob3dkb3duIERyYWdvbiAoVW5pcXVlKSIpCnBldERyb3Bkb3duOkFkZCgiRGFya3N0YXIgSHVudGVyIChVbmlxdWUpIikKcGV0RHJvcGRvd246QWRkKCJNdXNjbGUgU2Vuc2VpIChVbmlxdWUpIikKcGV0RHJvcGRvd246QWRkKCJOZW9uIEd1YXJkaWFuIChVbmlxdWUpIikKCi0tIEF1cmEgZHJvcGRvd24KbG9jYWwgYXVyYURyb3Bkb3duID0gcGV0czpBZGREcm9wZG93bigiU2VsZWN0IEF1cmEiLCBmdW5jdGlvbih0ZXh0KQogICAgc2VsZWN0ZWRBdXJhID0gdGV4dAogICAgbG9jYWwgY3J5c3RhbCA9IGZpbmRDcnlzdGFsRm9ySXRlbSh0ZXh0KQogICAgcHJpbnQoIkF1cmEgc2VsZWN0ZWQ6ICIgLi4gdGV4dCAuLiAiIChGb3VuZCBpbjogIiAuLiAoY3J5c3RhbCBvciAiVW5rbm93biIpIC4uICIpIikKZW5kKQoKLS0gQWRkIGFsbCBhdXJhcyBtYW51YWxseSAoc29ydGVkIGJ5IHJhcml0eSkKLS0gQmFzaWMgQXVyYXMKYXVyYURyb3Bkb3duOkFkZCgiQmx1ZSBBdXJhIChCYXNpYykiKQphdXJhRHJvcGRvd246QWRkKCJHcmVlbiBBdXJhIChCYXNpYykiKQphdXJhRHJvcGRvd246QWRkKCJQdXJwbGUgQXVyYSAoQmFzaWMpIikKYXVyYURyb3Bkb3duOkFkZCgiUmVkIEF1cmEgKEJhc2ljKSIpCmF1cmFEcm9wZG93bjpBZGQoIlllbGxvdyBBdXJhIChCYXNpYykiKQphdXJhRHJvcGRvd246QWRkKCJVbHRyYSBJbmZlcm5vICAoUmFyZSkiKQphdXJhRHJvcGRvd246QWRkKCJBenVyZSBUdW5kcmEgKEVwaWMpIikKYXVyYURyb3Bkb3duOkFkZCgiR3JhbmQgU3VwZXJub3ZhIChFcGljKSIpCmF1cmFEcm9wZG93bjpBZGQoIk11c2NsZSBLaW5nIChVbmlxdWUpIikKYXVyYURyb3Bkb3duOkFkZCgiRW50cm9waWMgQmxhc3QgKFVuaXF1ZSkiKQphdXJhRHJvcGRvd246QWRkKCJFdGVybmFsIE1lZ2FzdHJpa2UgKFVuaXF1ZSkiKQoKcGV0czpBZGRMYWJlbCgiQXV0byBCdXkiKQoKLS0gQXV0byBidXkgcGV0IHRvZ2dsZQpwZXRzOkFkZFN3aXRjaCgiQXV0byBCdXkgUGV0IiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLkF1dG9CdXlQZXQgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIGlmIHNlbGVjdGVkUGV0ID09ICIiIHRoZW4KICAgICAgICAgICAgcHJpbnQoIlBsZWFzZSBzZWxlY3QgYSBwZXQgZmlyc3QhIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgLS0gRXh0cmFjdCBwZXQgbmFtZSBmcm9tIGRyb3Bkb3duIHNlbGVjdGlvbiAocmVtb3ZlIHJhcml0eSBwYXJ0KQogICAgICAgIGxvY2FsIHBldE5hbWUgPSBzZWxlY3RlZFBldDptYXRjaCgiXiguLSklcyolKCIpCiAgICAgICAgaWYgbm90IHBldE5hbWUgdGhlbgogICAgICAgICAgICBwZXROYW1lID0gc2VsZWN0ZWRQZXQKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCBjcnlzdGFsID0gZmluZENyeXN0YWxGb3JJdGVtKHBldE5hbWUpCiAgICAgICAgaWYgbm90IGNyeXN0YWwgdGhlbgogICAgICAgICAgICBwcmludCgiQ291bGQgbm90IGZpbmQgY3J5c3RhbCBmb3IgcGV0OiAiIC4uIHBldE5hbWUpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIHByaW50KCJBdXRvIGJ1eSBwZXQgc3RhcnRlZCBmb3I6ICIgLi4gcGV0TmFtZSAuLiAiIGZyb20gIiAuLiBjcnlzdGFsKQogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuQXV0b0J1eVBldCBhbmQgc2VsZWN0ZWRQZXQgfj0gIiIgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHBldFRvQnV5ID0gUmVwbGljYXRlZFN0b3JhZ2UuY1BldFNob3BGb2xkZXI6RmluZEZpcnN0Q2hpbGQocGV0TmFtZSkKICAgICAgICAgICAgICAgIGlmIHBldFRvQnV5IHRoZW4KICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5jUGV0U2hvcFJlbW90ZTpJbnZva2VTZXJ2ZXIocGV0VG9CdXkpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIkJvdWdodCBwZXQ6ICIgLi4gcGV0TmFtZSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBwcmludCgiUGV0IG5vdCBmb3VuZDogIiAuLiBwZXROYW1lKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgcHJpbnQoIkF1dG8gYnV5IHBldCBzdG9wcGVkIikKICAgIGVuZAplbmQpCgotLSBBdXRvIGJ1eSBhdXJhIHRvZ2dsZQpwZXRzOkFkZFN3aXRjaCgiQXV0byBidXkgQXVyYSIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5BdXRvQnV5QXVyYSA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgaWYgc2VsZWN0ZWRBdXJhID09ICIiIHRoZW4KICAgICAgICAgICAgcHJpbnQoIlBsZWFzZSBzZWxlY3QgYW4gYXVyYSBmaXJzdCEiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSBFeHRyYWN0IGF1cmEgbmFtZSBmcm9tIGRyb3Bkb3duIHNlbGVjdGlvbiAocmVtb3ZlIHJhcml0eSBwYXJ0KQogICAgICAgIGxvY2FsIGF1cmFOYW1lID0gc2VsZWN0ZWRBdXJhOm1hdGNoKCJeKC4tKSVzKiUoIikKICAgICAgICBpZiBub3QgYXVyYU5hbWUgdGhlbgogICAgICAgICAgICBhdXJhTmFtZSA9IHNlbGVjdGVkQXVyYQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIGNyeXN0YWwgPSBmaW5kQ3J5c3RhbEZvckl0ZW0oYXVyYU5hbWUpCiAgICAgICAgaWYgbm90IGNyeXN0YWwgdGhlbgogICAgICAgICAgICBwcmludCgiQ291bGQgbm90IGZpbmQgY3J5c3RhbCBmb3IgYXVyYTogIiAuLiBhdXJhTmFtZSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgcHJpbnQoIkF1dG8gYnV5IGF1cmEgc3RhcnRlZCBmb3I6ICIgLi4gYXVyYU5hbWUgLi4gIiBmcm9tICIgLi4gY3J5c3RhbCkKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkF1dG9CdXlBdXJhIGFuZCBzZWxlY3RlZEF1cmEgfj0gIiIgZG8KICAgICAgICAgICAgICAgIGxvY2FsIGF1cmFUb0J1eSA9IFJlcGxpY2F0ZWRTdG9yYWdlLmNQZXRTaG9wRm9sZGVyOkZpbmRGaXJzdENoaWxkKGF1cmFOYW1lKQogICAgICAgICAgICAgICAgaWYgYXVyYVRvQnV5IHRoZW4KICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5jUGV0U2hvcFJlbW90ZTpJbnZva2VTZXJ2ZXIoYXVyYVRvQnV5KQogICAgICAgICAgICAgICAgICAgIHByaW50KCJCb3VnaHQgYXVyYTogIiAuLiBhdXJhTmFtZSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBwcmludCgiQXVyYSBub3QgZm91bmQ6ICIgLi4gYXVyYU5hbWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVsc2UKICAgICAgICBwcmludCgiQXV0byBidXkgYXVyYSBzdG9wcGVkIikKICAgIGVuZAplbmQpCgotLSBTaG93IHRoZSBwZXRzIHRhYgpwZXRzOlNob3coKQoKcGV0czpBZGRMYWJlbCgiVE1CIEF1dG8gQnV5IFVsdGltYXRlcyIpCgotLSBVbHRpbWF0ZSBvcHRpb25zCmxvY2FsIHVsdGltYXRlT3B0aW9ucyA9IHsKICAgICIrMSBEYWlseSBTcGluIiwKICAgICIrMSBQZXQgU2xvdCIsCiAgICAiKzEwIEl0ZW0gQ2FwYWNpdHkiLAogICAgIis1JSBSZXAgU3BlZWQiLAogICAgIkRlbW9uIERhbWFnZSIsCiAgICAiR2FsYXh5IEdhaW5zIiwKICAgICJHb2xkZW4gUmViaXJ0aCIsCiAgICAiSnVuZ2xlIFN3aWZ0IiwKICAgICJNdXNjbGUgTWluZCIsCiAgICAieDIgQ2hlc3QgUmV3YXJkcyIsCiAgICAieDIgUXVlc3QgUmV3YXJkcyIKfQoKLS0gVmFyaWFibGUgdG8gdHJhY2sgc2VsZWN0ZWQgdWx0aW1hdGUKbG9jYWwgc2VsZWN0ZWRVbHRpbWF0ZSA9ICIiCgotLSBVbHRpbWF0ZSBkcm9wZG93bgpsb2NhbCB1bHRpbWF0ZURyb3Bkb3duID0gcGV0czpBZGREcm9wZG93bigiU2VsZWN0IHVsdGltYXRlIiwgZnVuY3Rpb24odGV4dCkKICAgIHNlbGVjdGVkVWx0aW1hdGUgPSB0ZXh0CiAgICBwcmludCgiVWx0aW1hdGUgc2VsZWN0ZWQ6ICIgLi4gdGV4dCkKZW5kKQoKLS0gQWRkIGFsbCB1bHRpbWF0ZSBvcHRpb25zIHRvIGRyb3Bkb3duCmZvciBfLCB1bHRpbWF0ZSBpbiBpcGFpcnModWx0aW1hdGVPcHRpb25zKSBkbwogICAgdWx0aW1hdGVEcm9wZG93bjpBZGQodWx0aW1hdGUpCmVuZAoKLS0gQXV0byB1cGdyYWRlIHVsdGltYXRlIHRvZ2dsZQpwZXRzOkFkZFN3aXRjaCgiQXV0byBCdXkgVWx0aW1hdGVzIiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLkF1dG9VcGdyYWRlVWx0aW1hdGUgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIGlmIHNlbGVjdGVkVWx0aW1hdGUgPT0gIiIgdGhlbgogICAgICAgICAgICBwcmludCgiUGxlYXNlIHNlbGVjdCBhbiB1bHRpbWF0ZSBmaXJzdCEiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBwcmludCgiQXV0byB1cGdyYWRlIHVsdGltYXRlIHN0YXJ0ZWQgZm9yOiAiIC4uIHNlbGVjdGVkVWx0aW1hdGUpCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5BdXRvVXBncmFkZVVsdGltYXRlIGFuZCBzZWxlY3RlZFVsdGltYXRlIH49ICIiIGRvCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy51bHRpbWF0ZXNSZW1vdGU6SW52b2tlU2VydmVyKAogICAgICAgICAgICAgICAgICAgICJ1cGdyYWRlVWx0aW1hdGUiLAogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkVWx0aW1hdGUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHByaW50KCJVcGdyYWRlZCB1bHRpbWF0ZTogIiAuLiBzZWxlY3RlZFVsdGltYXRlKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVsc2UKICAgICAgICBwcmludCgiQXV0byBjb21wcmFyIHVsdGltYXRlcyIpCiAgICBlbmQKZW5kKQoKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBwbGF5ZXJXaGl0ZWxpc3QgPSB7fQpsb2NhbCB0YXJnZXRQbGF5ZXJOYW1lcyA9IHt9CmxvY2FsIGF1dG9Hb29kS2FybWEgPSBmYWxzZQpsb2NhbCBhdXRvQmFkS2FybWEgPSBmYWxzZQpsb2NhbCBhdXRvS2lsbCA9IGZhbHNlCmxvY2FsIGtpbGxUYXJnZXQgPSBmYWxzZQpsb2NhbCBzcHlpbmcgPSBmYWxzZQpsb2NhbCBhdXRvRXF1aXBQdW5jaCA9IGZhbHNlCmxvY2FsIGF1dG9QdW5jaE5vQW5pbSA9IGZhbHNlCmxvY2FsIHRhcmdldERyb3Bkb3duSXRlbXMgPSB7fQpsb2NhbCBhdmFpbGFibGVUYXJnZXRzID0ge30KCmxvY2FsIEtpbGxlciA9IHdpbmRvdzpBZGRUYWIoIk9QIEtpbGxpbmciKQoKbG9jYWwgZHJvcGRvd24gPSBLaWxsZXI6QWRkRHJvcGRvd24oIlNlbGVjdCBQZXQiLCBmdW5jdGlvbih0ZXh0KQogICAgbG9jYWwgcGV0c0ZvbGRlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoInBldHNGb2xkZXIiKQogICAgZm9yIF8sIGZvbGRlciBpbiBwYWlycyhwZXRzRm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgZm9sZGVyOklzQSgiRm9sZGVyIikgdGhlbgogICAgICAgICAgICBmb3IgXywgcGV0IGluIHBhaXJzKGZvbGRlcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMuZXF1aXBQZXRFdmVudDpGaXJlU2VydmVyKCJ1bmVxdWlwUGV0IiwgcGV0KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgdGFzay53YWl0KDAuMikKICAgIGxvY2FsIHBldE5hbWUgPSB0ZXh0CiAgICBsb2NhbCBwZXRzVG9FcXVpcCA9IHt9CiAgICBmb3IgXywgcGV0IGluIHBhaXJzKHBldHNGb2xkZXIuVW5pcXVlOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgcGV0Lk5hbWUgPT0gcGV0TmFtZSB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChwZXRzVG9FcXVpcCwgcGV0KQogICAgICAgIGVuZAogICAgZW5kCiAgICBsb2NhbCBtYXhQZXRzID0gOAogICAgbG9jYWwgZXF1aXBwZWRDb3VudCA9IG1hdGgubWluKCNwZXRzVG9FcXVpcCwgbWF4UGV0cykKICAgIGZvciBpID0gMSwgZXF1aXBwZWRDb3VudCBkbwogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLmVxdWlwUGV0RXZlbnQ6RmlyZVNlcnZlcigiZXF1aXBQZXQiLCBwZXRzVG9FcXVpcFtpXSkKICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgZW5kCmVuZCkKZHJvcGRvd246QWRkKCJXaWxkIFdpemFyZCIpCmRyb3Bkb3duOkFkZCgiTWlnaHR5IE1vbnN0ZXIiKQoKS2lsbGVyOkFkZFN3aXRjaCgiQXV0byBQdW5jaCBbTm8gQW5pbWF0aW9uXSIsIGZ1bmN0aW9uKHN0YXRlKQoJYXV0b1B1bmNoTm9BbmltID0gc3RhdGUKCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCXdoaWxlIGF1dG9QdW5jaE5vQW5pbSBkbwoJCQlsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpIG9yIExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJCWlmIHB1bmNoIHRoZW4KCQkJCWlmIHB1bmNoLlBhcmVudCB+PSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbgoJCQkJCXB1bmNoLlBhcmVudCA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgoJCQkJZW5kCgkJCQlMb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJyaWdodEhhbmQiKQoJCQkJTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAibGVmdEhhbmQiKQoJCQllbHNlCgkJCQlhdXRvUHVuY2hOb0FuaW0gPSBmYWxzZQoJCQllbmQKCQkJdGFzay53YWl0KDAuMDEpCgkJZW5kCgllbmQpCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIkF1dG8gUHVuY2giLCBmdW5jdGlvbihzdGF0ZSkKCV9HLmZhc3RIaXRBY3RpdmUgPSBzdGF0ZQoJaWYgc3RhdGUgdGhlbgoJCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCQl3aGlsZSBfRy5mYXN0SGl0QWN0aXZlIGRvCgkJCQlsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJCQlpZiBwdW5jaCB0aGVuCgkJCQkJcHVuY2guUGFyZW50ID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCgkJCQkJaWYgcHVuY2g6RmluZEZpcnN0Q2hpbGQoImF0dGFja1RpbWUiKSB0aGVuCgkJCQkJCXB1bmNoLmF0dGFja1RpbWUuVmFsdWUgPSAwCgkJCQkJZW5kCgkJCQllbmQKCQkJCXRhc2sud2FpdCgwLjEpCgkJCWVuZAoJCWVuZCkKCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJd2hpbGUgX0cuZmFzdEhpdEFjdGl2ZSBkbwoJCQkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCQkJaWYgcHVuY2ggdGhlbgoJCQkJCXB1bmNoOkFjdGl2YXRlKCkKCQkJCWVuZAoJCQkJdGFzay53YWl0KDAuMSkKCQkJZW5kCgkJZW5kKQoJZWxzZQoJCWxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKCQlpZiBwdW5jaCB0aGVuCgkJCXB1bmNoLlBhcmVudCA9IExvY2FsUGxheWVyLkJhY2twYWNrCgkJZW5kCgllbmQKZW5kKQoKS2lsbGVyOkFkZFN3aXRjaCgiRmFzdCBQdW5jaCIsIGZ1bmN0aW9uKHN0YXRlKQoJX0cuYXV0b1B1bmNoQWN0aXZlID0gc3RhdGUKCWlmIHN0YXRlIHRoZW4KCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJd2hpbGUgX0cuYXV0b1B1bmNoQWN0aXZlIGRvCgkJCQlsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJCQlpZiBwdW5jaCB0aGVuCgkJCQkJcHVuY2guUGFyZW50ID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCgkJCQkJaWYgcHVuY2g6RmluZEZpcnN0Q2hpbGQoImF0dGFja1RpbWUiKSB0aGVuCgkJCQkJCXB1bmNoLmF0dGFja1RpbWUuVmFsdWUgPSAwCgkJCQkJZW5kCgkJCQllbmQKCQkJCXRhc2sud2FpdCgpCgkJCWVuZAoJCWVuZCkKCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJd2hpbGUgX0cuYXV0b1B1bmNoQWN0aXZlIGRvCgkJCQlsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJCQlpZiBwdW5jaCB0aGVuCgkJCQkJcHVuY2g6QWN0aXZhdGUoKQoJCQkJZW5kCgkJCQl0YXNrLndhaXQoKQoJCQllbmQKCQllbmQpCgllbHNlCgkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCWlmIHB1bmNoIHRoZW4KCQkJcHVuY2guUGFyZW50ID0gTG9jYWxQbGF5ZXIuQmFja3BhY2sKCQllbmQKCWVuZAplbmQpCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCmxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCmxvY2FsIFN0YXJ0ZXJQYWNrID0gZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyUGFjayIpCmxvY2FsIGxpZ2h0aW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgoKLS0gU3RhdGUgJiBjb25uZWN0aW9uIHRyYWNraW5nCmxvY2FsIGNvbWJvQWN0aXZlID0gZmFsc2UKbG9jYWwgY29ubmVjdGlvbnMgPSB7fSAtLSBtYXAga2V5cyAtPiBSQlhTY3JpcHRDb25uZWN0aW9uIC8gdGFzay50aHJlYWQKbG9jYWwgbG9vcHMgPSB7fSAtLSBzdG9yZSBjb3JvdXRpbmUvdGhyZWFkIHJlZmVyZW5jZXMgdG8gYWxsb3cgc2FmZSBzdG9wcGluZwoKbG9jYWwgZnVuY3Rpb24gc2FmZURpc2Nvbm5lY3Qoa2V5KQoJbG9jYWwgY29ubiA9IGNvbm5lY3Rpb25zW2tleV0KCWlmIG5vdCBjb25uIHRoZW4gcmV0dXJuIGVuZAoJcGNhbGwoZnVuY3Rpb24oKQoJCWlmIHR5cGVvZihjb25uKSA9PSAiUkJYU2NyaXB0Q29ubmVjdGlvbiIgYW5kIGNvbm4uRGlzY29ubmVjdCB0aGVuCgkJCWNvbm46RGlzY29ubmVjdCgpCgkJZWxzZWlmIHR5cGUoY29ubikgPT0gInRhYmxlIiBhbmQgY29ubi5EaXNjb25uZWN0IHRoZW4KCQkJY29ubjpEaXNjb25uZWN0KCkKCQllbmQKCWVuZCkKCWNvbm5lY3Rpb25zW2tleV0gPSBuaWwKZW5kCgpsb2NhbCBmdW5jdGlvbiBzdG9wTG9vcHMoKQoJZm9yIGssIHRociBpbiBwYWlycyhsb29wcykgZG8KCQlsb29wc1trXSA9IG5pbAoJZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gY2xlYW51cEFsbCgpCglfRy5BdXRvUHVuY2hUb2dnbGUgPSBmYWxzZQoJX0cuQXV0b1Byb3RlaW5FZ2cgPSBmYWxzZQoJZ2V0Z2VudigpLkFudGlGbHlBY3RpdmUgPSBmYWxzZQoKCWZvciBrLCBfIGluIHBhaXJzKGNvbm5lY3Rpb25zKSBkbwoJCXNhZmVEaXNjb25uZWN0KGspCgllbmQKCWNvbm5lY3Rpb25zID0ge30KCXN0b3BMb29wcygpCmVuZAoKbG9jYWwgZnVuY3Rpb24gcmVzcGF3blBsYXllcigpCglwY2FsbChmdW5jdGlvbigpCgkJaWYgTG9jYWxQbGF5ZXIgYW5kIExvY2FsUGxheWVyOklzQSgiUGxheWVyIikgdGhlbgoJCQlpZiBwY2FsbChmdW5jdGlvbigpIExvY2FsUGxheWVyOkxvYWRDaGFyYWN0ZXIoKSBlbmQpIHRoZW4gcmV0dXJuIGVuZAoJCQlwY2FsbChmdW5jdGlvbigpCgkJCQlsb2NhbCBTdGFydGVyR3VpID0gZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIikKCQkJCVN0YXJ0ZXJHdWk6U2V0Q29yZSgiUmVzZXRCdXR0b25DYWxsYmFjayIsIHRydWUpCgkJCWVuZCkKCQllbmQKCWVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBhcHBseVNpemVOYU4oKQoJcGNhbGwoZnVuY3Rpb24oKQoJCWxvY2FsIGV2ZW50cyA9IFJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJyRXZlbnRzIikKCQlpZiBldmVudHMgdGhlbgoJCQlsb2NhbCBjaGFuZ2UgPSBldmVudHM6RmluZEZpcnN0Q2hpbGQoImNoYW5nZVNwZWVkU2l6ZVJlbW90ZSIpCgkJCWlmIGNoYW5nZSBhbmQgY2hhbmdlLkludm9rZVNlcnZlciB0aGVuCgkJCQlwY2FsbChmdW5jdGlvbigpCgkJCQkJY2hhbmdlOkludm9rZVNlcnZlcigiY2hhbmdlU2l6ZSIsIDAvMCkKCQkJCWVuZCkKCQkJZW5kCgkJZW5kCgllbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gc3RhcnRBdXRvUHVuY2goKQoJX0cuQXV0b1B1bmNoVG9nZ2xlID0gdHJ1ZQoJbG9jYWwgaWQgPSAiQXV0b1B1bmNoIgoJbG9vcHNbaWRdID0gdHJ1ZQoJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJbG9jYWwgYmFja3BhY2sgPSBMb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIkJhY2twYWNrIikKCQlsb2NhbCBoYW5kID0gInJpZ2h0SGFuZCIKCQlsb2NhbCBmdW5jdGlvbiBnZXRNdXNjbGVFdmVudCgpIHJldHVybiBMb2NhbFBsYXllcjpGaW5kRmlyc3RDaGlsZCgibXVzY2xlRXZlbnQiKSBlbmQKCgkJc2FmZURpc2Nvbm5lY3QoIkNoYXJBZGRlZEZvckF1dG9QdW5jaCIpCgkJY29ubmVjdGlvbnMuQ2hhckFkZGVkRm9yQXV0b1B1bmNoID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGFyKQoJCQlpZiBjb21ib0FjdGl2ZSBhbmQgY29ubmVjdGlvbnMuSHVtYW5vaWRSZXNldEhvb2sgPT0gbmlsIHRoZW4KCQkJCWxvY2FsIGh1bSA9IGNoYXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCgkJCQlpZiBodW0gdGhlbgoJCQkJCXNhZmVEaXNjb25uZWN0KCJSZXNldERlYXRoIikKCQkJCQljb25uZWN0aW9ucy5SZXNldERlYXRoID0gaHVtLkRpZWQ6Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJCXRhc2sud2FpdCgwLjUpCgkJCQkJCXJlc3Bhd25QbGF5ZXIoKQoJCQkJCWVuZCkKCQkJCWVuZAoJCQllbmQKCQllbmQpCgoJCXNhZmVEaXNjb25uZWN0KCJCYWNrcGFja0NoaWxkRm9yQXV0b1B1bmNoIikKCQljb25uZWN0aW9ucy5CYWNrcGFja0NoaWxkRm9yQXV0b1B1bmNoID0gTG9jYWxQbGF5ZXIuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQoJCQlpZiBjaGlsZC5OYW1lID09ICJCYWNrcGFjayIgdGhlbgoJCQkJYmFja3BhY2sgPSBjaGlsZAoJCQllbmQKCQllbmQpCgoJCXdoaWxlIF9HLkF1dG9QdW5jaFRvZ2dsZSBhbmQgbG9vcHNbaWRdIGRvCgkJCWxvY2FsIG11c2NsZUV2ZW50ID0gZ2V0TXVzY2xlRXZlbnQoKQoJCQlsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKCQkJaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIG11c2NsZUV2ZW50IHRoZW4KCQkJCWxvY2FsIHB1bmNoRXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKCQkJCWxvY2FsIHB1bmNoSW5CYWNrcGFjayA9IChMb2NhbFBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQmFja3BhY2siKSBhbmQgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikpCgkJCQlpZiBub3QgcHVuY2hFcXVpcHBlZCBhbmQgcHVuY2hJbkJhY2twYWNrIHRoZW4KCQkJCQlwY2FsbChmdW5jdGlvbigpIGNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wocHVuY2hJbkJhY2twYWNrKSBlbmQpCgkJCQllbmQKCQkJCXBjYWxsKGZ1bmN0aW9uKCkgbXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCBoYW5kKSBlbmQpCgkJCWVuZAoJCQl0YXNrLndhaXQoMC4wMDAxKQoJCWVuZAoJZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0YXJ0UHJvdGVpbkVnZ0xvZ2ljKCkKCV9HLkF1dG9Qcm90ZWluRWdnID0gdHJ1ZQoJbG9jYWwgaWQgPSAiUHJvdGVpbkVnZyIKCWxvb3BzW2lkXSA9IHRydWUKCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCWxvY2FsIHRvb2xOYW1lID0gIlByb3RlaW4gRWdnIgoJCWxvY2FsIGNoYXJhY3RlciA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKCgkJbG9jYWwgZnVuY3Rpb24gcmVzdG9yZVZpc2liaWxpdHkodG9vbCkKCQkJZm9yIF8sIHBhcnQgaW4gaXBhaXJzKHRvb2w6R2V0RGVzY2VuZGFudHMoKSkgZG8KCQkJCWlmIHBhcnQ6SXNBKCJCYXNlUGFydCIpIHRoZW4KCQkJCQlwY2FsbChmdW5jdGlvbigpIHBhcnQuVHJhbnNwYXJlbmN5ID0gMCBlbmQpCgkJCQkJcGNhbGwoZnVuY3Rpb24oKSBwYXJ0LkxvY2FsVHJhbnNwYXJlbmN5TW9kaWZpZXIgPSAwIGVuZCkKCQkJCWVuZAoJCQllbmQKCQllbmQKCgkJbG9jYWwgZnVuY3Rpb24gZmluZFRvb2woKQoJCQlsb2NhbCB0b29sID0gKExvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJCYWNrcGFjayIpIGFuZCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCh0b29sTmFtZSkpCgkJCWlmIHRvb2wgdGhlbiByZXR1cm4gdG9vbCBlbmQKCQkJdG9vbCA9IFN0YXJ0ZXJQYWNrOkZpbmRGaXJzdENoaWxkKHRvb2xOYW1lKQoJCQlpZiB0b29sIHRoZW4gcmV0dXJuIHRvb2wgZW5kCgkJCXRvb2wgPSBSZXBsaWNhdGVkU3RvcmFnZTpGaW5kRmlyc3RDaGlsZCh0b29sTmFtZSkKCQkJcmV0dXJuIHRvb2wKCQllbmQKCgkJbG9jYWwgZnVuY3Rpb24gZm9yY2VFcXVpcCh0b29sKQoJCQlpZiBub3QgKGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpKSB0aGVuIHJldHVybiBlbmQKCQkJcGNhbGwoZnVuY3Rpb24oKSBjaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHRvb2wpIGVuZCkKCQkJdGFzay53YWl0KDAuMSkKCQkJaWYgbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCh0b29sTmFtZSkgdGhlbgoJCQkJcGNhbGwoZnVuY3Rpb24oKSB0b29sLlBhcmVudCA9IGNoYXJhY3RlciBlbmQpCgkJCQl0YXNrLndhaXQoMC4xKQoJCQllbmQKCQkJbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQodG9vbE5hbWUpCgkJCWlmIGVxdWlwcGVkIHRoZW4gcmVzdG9yZVZpc2liaWxpdHkoZXF1aXBwZWQpIGVuZAoJCWVuZAoKCQlsb2NhbCBmdW5jdGlvbiBzYW5pdGl6ZVRvb2wodG9vbCkKCQkJZm9yIF8sIGRlc2MgaW4gaXBhaXJzKHRvb2w6R2V0RGVzY2VuZGFudHMoKSkgZG8KCQkJCWlmIGRlc2M6SXNBKCJTY3JpcHQiKSB0aGVuCgkJCQkJcGNhbGwoZnVuY3Rpb24oKSBkZXNjOkRlc3Ryb3koKSBlbmQpCgkJCQllbHNlaWYgZGVzYzpJc0EoIkxvY2FsU2NyaXB0IikgdGhlbgoJCQkJCXBjYWxsKGZ1bmN0aW9uKCkgZGVzYy5EaXNhYmxlZCA9IHRydWUgZW5kKQoJCQkJZW5kCgkJCQlpZiBkZXNjOklzQSgiUmVtb3RlRXZlbnQiKSB0aGVuCgkJCQkJcGNhbGwoZnVuY3Rpb24oKSBkZXNjLkZpcmVTZXJ2ZXIgPSBmdW5jdGlvbigpIGVuZCBlbmQpCgkJCQllbmQKCQkJZW5kCgkJZW5kCgoJCWxvY2FsIGZ1bmN0aW9uIGVxdWlwSWZOZWVkZWQoKQoJCQlpZiBub3QgX0cuQXV0b1Byb3RlaW5FZ2cgdGhlbiByZXR1cm4gZW5kCgkJCWNoYXJhY3RlciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgoJCQlsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKHRvb2xOYW1lKQoJCQlsb2NhbCBuZWVkRXF1aXAgPSBmYWxzZQoJCQlpZiBub3QgZXF1aXBwZWQgdGhlbgoJCQkJbmVlZEVxdWlwID0gdHJ1ZQoJCQllbHNlCgkJCQlmb3IgXywgcGFydCBpbiBpcGFpcnMoZXF1aXBwZWQ6R2V0RGVzY2VuZGFudHMoKSkgZG8KCQkJCQlpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSBhbmQgcGFydC5UcmFuc3BhcmVuY3kgPiAwIHRoZW4KCQkJCQkJbmVlZEVxdWlwID0gdHJ1ZQoJCQkJCQlicmVhawoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCQlpZiBuZWVkRXF1aXAgdGhlbgoJCQkJbG9jYWwgdG9vbCA9IGZpbmRUb29sKCkKCQkJCWlmIHRvb2wgdGhlbgoJCQkJCWlmIHRvb2wuUGFyZW50IH49IChMb2NhbFBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQmFja3BhY2siKSBhbmQgTG9jYWxQbGF5ZXIuQmFja3BhY2spIHRoZW4KCQkJCQkJbG9jYWwgY2xvbmUgPSB0b29sOkNsb25lKCkKCQkJCQkJY2xvbmUuUGFyZW50ID0gTG9jYWxQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkJhY2twYWNrIikgb3IgTG9jYWxQbGF5ZXIKCQkJCQkJdG9vbCA9IGNsb25lCgkJCQkJZW5kCgkJCQkJc2FuaXRpemVUb29sKHRvb2wpCgkJCQkJZm9yY2VFcXVpcCh0b29sKQoJCQkJZW5kCgkJCWVuZAoJCWVuZAoKCQlsb2NhbCBmdW5jdGlvbiBtb25pdG9yVG9vbENvbnRhaW5lcihjb250YWluZXIpCgkJCWlmIG5vdCBjb250YWluZXIgdGhlbiByZXR1cm4gZW5kCgkJCWZvciBfLCB0b29sIGluIGlwYWlycyhjb250YWluZXI6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJCWlmIHRvb2w6SXNBKCJUb29sIikgYW5kIHRvb2wuTmFtZSA9PSB0b29sTmFtZSB0aGVuCgkJCQkJc2FuaXRpemVUb29sKHRvb2wpCgkJCQllbmQKCQkJZW5kCgkJCWxvY2FsIGNvbm4gPSBjb250YWluZXIuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQoJCQkJaWYgY2hpbGQ6SXNBKCJUb29sIikgYW5kIGNoaWxkLk5hbWUgPT0gdG9vbE5hbWUgdGhlbgoJCQkJCXRhc2suZGVmZXIoZnVuY3Rpb24oKQoJCQkJCQlzYW5pdGl6ZVRvb2woY2hpbGQpCgkJCQkJZW5kKQoJCQkJZW5kCgkJCWVuZCkKCQkJcmV0dXJuIGNvbm4KCQllbmQKCgkJc2FmZURpc2Nvbm5lY3QoIk1vbml0b3JCYWNrcGFjayIpCgkJc2FmZURpc2Nvbm5lY3QoIk1vbml0b3JDaGFyYWN0ZXIiKQoJCWNvbm5lY3Rpb25zLk1vbml0b3JCYWNrcGFjayA9IG1vbml0b3JUb29sQ29udGFpbmVyKExvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJCYWNrcGFjayIpIG9yIExvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKSkKCQljb25uZWN0aW9ucy5Nb25pdG9yQ2hhcmFjdGVyID0gbW9uaXRvclRvb2xDb250YWluZXIoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyKQoKCQlzYWZlRGlzY29ubmVjdCgiQ2hhcmFjdGVyQWRkZWRQcm90ZWluIikKCQljb25uZWN0aW9ucy5DaGFyYWN0ZXJBZGRlZFByb3RlaW4gPSBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoYXIpCgkJCWNoYXJhY3RlciA9IGNoYXIKCQkJdGFzay53YWl0KDEpCgkJCXNhZmVEaXNjb25uZWN0KCJNb25pdG9yQmFja3BhY2siKQoJCQlzYWZlRGlzY29ubmVjdCgiTW9uaXRvckNoYXJhY3RlciIpCgkJCWNvbm5lY3Rpb25zLk1vbml0b3JCYWNrcGFjayA9IG1vbml0b3JUb29sQ29udGFpbmVyKExvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJCYWNrcGFjayIpIG9yIExvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKSkKCQkJY29ubmVjdGlvbnMuTW9uaXRvckNoYXJhY3RlciA9IG1vbml0b3JUb29sQ29udGFpbmVyKGNoYXIpCgkJCWVxdWlwSWZOZWVkZWQoKQoJCWVuZCkKCgkJc2FmZURpc2Nvbm5lY3QoIkJhY2twYWNrQ2hpbGRQcm90ZWluIikKCQljb25uZWN0aW9ucy5CYWNrcGFja0NoaWxkUHJvdGVpbiA9IExvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKS5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCgkJCWlmIF9HLkF1dG9Qcm90ZWluRWdnIGFuZCBjaGlsZC5OYW1lID09IHRvb2xOYW1lIHRoZW4KCQkJCXRhc2sud2FpdCgwLjIpCgkJCQllcXVpcElmTmVlZGVkKCkKCQkJZW5kCgkJZW5kKQoKCQl3aGlsZSBfRy5BdXRvUHJvdGVpbkVnZyBhbmQgbG9vcHNbaWRdIGRvCgkJCXBjYWxsKGVxdWlwSWZOZWVkZWQpCgkJCXRhc2sud2FpdCgwLjUpCgkJZW5kCgllbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gc3RhcnRBbnRpRmx5KCkKCWdldGdlbnYoKS5BbnRpRmx5QWN0aXZlID0gdHJ1ZQoJc2FmZURpc2Nvbm5lY3QoIkFudGlGbHkiKQoJY29ubmVjdGlvbnMuQW50aUZseSA9IFJ1blNlcnZpY2UuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oKQoJCWxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKCQlpZiBub3QgY2hhciB0aGVuIHJldHVybiBlbmQKCQlsb2NhbCByb290ID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCgkJaWYgbm90IHJvb3QgdGhlbiByZXR1cm4gZW5kCgkJbG9jYWwgaHVtYW5vaWQgPSBjaGFyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQoJCWlmIG5vdCBodW1hbm9pZCB0aGVuIHJldHVybiBlbmQKCQlsb2NhbCByYXkgPSBSYXkubmV3KHJvb3QuUG9zaXRpb24sIFZlY3RvcjMubmV3KDAsIC01MDAsIDApKQoJCWxvY2FsIGhpdCwgcG9zaXRpb24gPSB3b3Jrc3BhY2U6RmluZFBhcnRPblJheShyYXksIGNoYXIpCgkJaWYgaGl0IHRoZW4KCQkJbG9jYWwgZ3JvdW5kWSA9IHBvc2l0aW9uLlkKCQkJbG9jYWwgY3VycmVudFkgPSByb290LlBvc2l0aW9uLlkKCQkJaWYgY3VycmVudFkgLSBncm91bmRZID4gMC41IHRoZW4KCQkJCXJvb3QuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhyb290LlBvc2l0aW9uLlgsIGdyb3VuZFkgKyAwLjUsIHJvb3QuUG9zaXRpb24uWikKCQkJCWh1bWFub2lkLlBsYXRmb3JtU3RhbmQgPSB0cnVlCgkJCQlodW1hbm9pZC5QbGF0Zm9ybVN0YW5kID0gZmFsc2UKCQkJZW5kCgkJZW5kCgllbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gc29mdEFudGlMYWdBbmRTdW5zZXQoKQoJcGNhbGwoZnVuY3Rpb24oKQoJCWxvY2FsIGNsYXNzZXNUb0NsZWFuID0ge1siUGFydGljbGVFbWl0dGVyIl09dHJ1ZSwgWyJUcmFpbCJdPXRydWUsIFsiU21va2UiXT10cnVlLCBbIkZpcmUiXT10cnVlfQoJCWZvciBfLCBvYmogaW4gaXBhaXJzKHdvcmtzcGFjZTpHZXRDaGlsZHJlbigpKSBkbwoJCQlpZiBvYmo6SXNBKCJNb2RlbCIpIG9yIG9iajpJc0EoIlBhcnQiKSB0aGVuCgkJCQlmb3IgXywgc3ViIGluIGlwYWlycyhvYmo6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJCQlpZiBjbGFzc2VzVG9DbGVhbltzdWIuQ2xhc3NOYW1lXSB0aGVuCgkJCQkJCXBjYWxsKGZ1bmN0aW9uKCkgc3ViOkRlc3Ryb3koKSBlbmQpCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgkJZW5kCgkJbG9jYWwgdGVycmFpbiA9IHdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIlRlcnJhaW4iKQoJCWlmIHRlcnJhaW4gdGhlbgoJCQl0ZXJyYWluLldhdGVyV2F2ZVNpemUgPSAwCgkJCXRlcnJhaW4uV2F0ZXJSZWZsZWN0YW5jZSA9IDAKCQkJdGVycmFpbi5XYXRlclRyYW5zcGFyZW5jeSA9IDEKCQllbmQKCWVuZCkKCXBjYWxsKGZ1bmN0aW9uKCkKCQlsaWdodGluZy5DbG9ja1RpbWUgPSAxOAoJCWxpZ2h0aW5nLkJyaWdodG5lc3MgPSAxLjUKCQlsaWdodGluZy5PdXRkb29yQW1iaWVudCA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTAwLCA4MCkKCQlsaWdodGluZy5Gb2dDb2xvciA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMTIwLCAxMDApCgkJbGlnaHRpbmcuRm9nRW5kID0gNTAwCgkJZm9yIF8sIHYgaW4gaXBhaXJzKGxpZ2h0aW5nOkdldENoaWxkcmVuKCkpIGRvCgkJCWlmIHY6SXNBKCJTa3kiKSB0aGVuCgkJCQlwY2FsbChmdW5jdGlvbigpIHY6RGVzdHJveSgpIGVuZCkKCQkJZW5kCgkJZW5kCgkJbG9jYWwgc2t5ID0gSW5zdGFuY2UubmV3KCJTa3kiKQoJCXNreS5OYW1lID0gIlN1bnNldFNreSIKCQlza3kuU2t5Ym94QmsgPSAicmJ4YXNzZXRpZDovLzEzMTg4OTAxNyIKCQlza3kuU2t5Ym94RG4gPSAicmJ4YXNzZXRpZDovLzEzMTg4OTAxNyIKCQlza3kuU2t5Ym94RnQgPSAicmJ4YXNzZXRpZDovLzEzMTg4OTAxNyIKCQlza3kuU2t5Ym94TGYgPSAicmJ4YXNzZXRpZDovLzEzMTg4OTAxNyIKCQlza3kuU2t5Ym94UnQgPSAicmJ4YXNzZXRpZDovLzEzMTg4OTAxNyIKCQlza3kuU2t5Ym94VXAgPSAicmJ4YXNzZXRpZDovLzEzMTg4OTAxNyIKCQlza3kuU3VuQW5ndWxhclNpemUgPSAxMAoJCXNreS5Nb29uQW5ndWxhclNpemUgPSAwCgkJc2t5LlN1blRleHR1cmVJZCA9ICJyYnhhc3NldGlkOi8vNjQ0NDMyOTkyIgoJCXNreS5QYXJlbnQgPSBsaWdodGluZwoJZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGhvb2tSZXNldE9uQ2hhcmFjdGVyKGNoYXIpCglpZiBub3QgY2hhciB0aGVuIHJldHVybiBlbmQKCWxvY2FsIGh1bWFub2lkID0gY2hhcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikKCXNhZmVEaXNjb25uZWN0KCJSZXNldERlYXRoIikKCWNvbm5lY3Rpb25zLlJlc2V0RGVhdGggPSBodW1hbm9pZC5EaWVkOkNvbm5lY3QoZnVuY3Rpb24oKQoJCXRhc2sud2FpdCgwLjUpCgkJcmVzcGF3blBsYXllcigpCgllbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gc3RhcnRUaW55SXNsYW5kTG9vcCgpCglsb2NhbCBpZCA9ICJUaW55SXNsYW5kTG9vcCIKCWxvb3BzW2lkXSA9IHRydWUKCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCWxvY2FsIHRlbGVwb3J0UG9zID0gQ0ZyYW1lLm5ldygtMzcuMSwgOS4yLCAxOTE5KQoJCXdoaWxlIGNvbWJvQWN0aXZlIGFuZCBsb29wc1tpZF0gZG8KCQkJcGNhbGwoZnVuY3Rpb24oKQoJCQkJbG9jYWwgY2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgoJCQkJaWYgY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KCQkJCQljaGFyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gdGVsZXBvcnRQb3MKCQkJCWVuZAoJCQllbmQpCgkJCXRhc2sud2FpdCgwLjIpCgkJZW5kCgllbmQpCmVuZAoKLS0g8J+UuSBLaWxsZXI6QWRkU3dpdGNoIHZlcnNpb24KS2lsbGVyOkFkZFN3aXRjaCgiT1AgUHVuY2ggV2hlbiBEZWFkIHwgQ29tYm8iLCBmdW5jdGlvbihlbmFibGVkKQoJY29tYm9BY3RpdmUgPSBlbmFibGVkCgljbGVhbnVwQWxsKCkKCglpZiBlbmFibGVkIHRoZW4KCQlhcHBseVNpemVOYU4oKQoJCXN0YXJ0QXV0b1B1bmNoKCkKCQlzdGFydFByb3RlaW5FZ2dMb2dpYygpCgkJc3RhcnRBbnRpRmx5KCkKCQlzb2Z0QW50aUxhZ0FuZFN1bnNldCgpCgkJc3RhcnRUaW55SXNsYW5kTG9vcCgpCgoJCWlmIExvY2FsUGxheWVyLkNoYXJhY3RlciB0aGVuCgkJCWhvb2tSZXNldE9uQ2hhcmFjdGVyKExvY2FsUGxheWVyLkNoYXJhY3RlcikKCQllbmQKCQlzYWZlRGlzY29ubmVjdCgiQ2hhcmFjdGVyQWRkZWRSZXNldCIpCgkJY29ubmVjdGlvbnMuQ2hhcmFjdGVyQWRkZWRSZXNldCA9IExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hhcikKCQkJdGFzay53YWl0KDAuNSkKCQkJaG9va1Jlc2V0T25DaGFyYWN0ZXIoY2hhcikKCQllbmQpCgllbmQKZW5kKQoKS2lsbGVyOkFkZEJ1dHRvbigiTmFOIFNpemUiLCBmdW5jdGlvbigpCiAgICBsb2NhbCBhcmdzID0geyJjaGFuZ2VTaXplIiwgMC8wfQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgickV2ZW50cyIpOldhaXRGb3JDaGlsZCgiY2hhbmdlU3BlZWRTaXplUmVtb3RlIik6SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKZW5kKQoKbG9jYWwgYnV0dG9uID0gS2lsbGVyOkFkZEJ1dHRvbigiUmVtb3ZlIFB1bmNoIEFuaW0iLCBmdW5jdGlvbigpCiAgICBsb2NhbCBibG9ja2VkQW5pbWF0aW9ucyA9IHsKICAgICAgICBbInJieGFzc2V0aWQ6Ly8zNjM4NzI5MDUzIl0gPSB0cnVlLAogICAgICAgIFsicmJ4YXNzZXRpZDovLzM2Mzg3Njc0MjciXSA9IHRydWUsCiAgICB9CgogICAgbG9jYWwgZnVuY3Rpb24gc2V0dXBBbmltYXRpb25CbG9ja2luZygpCiAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBpZiBub3QgY2hhciBvciBub3QgY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCgogICAgICAgIGZvciBfLCB0cmFjayBpbiBwYWlycyhodW1hbm9pZDpHZXRQbGF5aW5nQW5pbWF0aW9uVHJhY2tzKCkpIGRvCiAgICAgICAgICAgIGlmIHRyYWNrLkFuaW1hdGlvbiB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBhbmltSWQgPSB0cmFjay5BbmltYXRpb24uQW5pbWF0aW9uSWQKICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1OYW1lID0gdHJhY2suTmFtZTpsb3dlcigpCgogICAgICAgICAgICAgICAgaWYgYmxvY2tlZEFuaW1hdGlvbnNbYW5pbUlkXSBvcgogICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJwdW5jaCIpIG9yCiAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goImF0dGFjayIpIG9yCiAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInJpZ2h0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRyYWNrOlN0b3AoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgX0cuQW5pbUJsb2NrQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgIGxvY2FsIGNvbm5lY3Rpb24gPSBodW1hbm9pZC5BbmltYXRpb25QbGF5ZWQ6Q29ubmVjdChmdW5jdGlvbih0cmFjaykKICAgICAgICAgICAgICAgIGlmIHRyYWNrLkFuaW1hdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5pbUlkID0gdHJhY2suQW5pbWF0aW9uLkFuaW1hdGlvbklkCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5pbU5hbWUgPSB0cmFjay5OYW1lOmxvd2VyKCkKCiAgICAgICAgICAgICAgICAgICAgaWYgYmxvY2tlZEFuaW1hdGlvbnNbYW5pbUlkXSBvcgogICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicHVuY2giKSBvcgogICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgiYXR0YWNrIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInJpZ2h0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0cmFjazpTdG9wKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBfRy5BbmltQmxvY2tDb25uZWN0aW9uID0gY29ubmVjdGlvbgogICAgICAgIGVuZAogICAgZW5kCgogICAgc2V0dXBBbmltYXRpb25CbG9ja2luZygpCgogICAgbG9jYWwgZnVuY3Rpb24gb3ZlcnJpZGVUb29sQWN0aXZhdGlvbigpCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gcHJvY2Vzc1Rvb2wodG9vbCkKICAgICAgICAgICAgaWYgdG9vbCBhbmQgKHRvb2wuTmFtZSA9PSAiUHVuY2giIG9yIHRvb2wuTmFtZTptYXRjaCgiQXR0YWNrIikgb3IgdG9vbC5OYW1lOm1hdGNoKCJSaWdodCIpKSB0aGVuCiAgICAgICAgICAgICAgICBpZiBub3QgdG9vbDpHZXRBdHRyaWJ1dGUoIkFjdGl2YXRlZE92ZXJyaWRlIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvb2w6U2V0QXR0cmlidXRlKCJBY3RpdmF0ZWRPdmVycmlkZSIsIHRydWUpCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGNvbm5lY3Rpb24gPSB0b29sLkFjdGl2YXRlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGFyIGFuZCBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCB0cmFjayBpbiBwYWlycyhjaGFyLkh1bWFub2lkOkdldFBsYXlpbmdBbmltYXRpb25UcmFja3MoKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0cmFjay5BbmltYXRpb24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbmltSWQgPSB0cmFjay5BbmltYXRpb24uQW5pbWF0aW9uSWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5pbU5hbWUgPSB0cmFjay5OYW1lOmxvd2VyKCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJsb2NrZWRBbmltYXRpb25zW2FuaW1JZF0gb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJwdW5jaCIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgiYXR0YWNrIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJyaWdodCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrOlN0b3AoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5Ub29sQ29ubmVjdGlvbnMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBfRy5Ub29sQ29ubmVjdGlvbnMgPSB7fQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIF9HLlRvb2xDb25uZWN0aW9uc1t0b29sXSA9IGNvbm5lY3Rpb24KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgZm9yIF8sIHRvb2wgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIHByb2Nlc3NUb29sKHRvb2wpCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGNoYXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgaWYgY2hhciB0aGVuCiAgICAgICAgICAgIGZvciBfLCB0b29sIGluIHBhaXJzKGNoYXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGlmIHRvb2w6SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NUb29sKHRvb2wpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBfRy5CYWNrcGFja0FkZGVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgIF9HLkJhY2twYWNrQWRkZWRDb25uZWN0aW9uID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKICAgICAgICAgICAgICAgIGlmIGNoaWxkOklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NUb29sKGNoaWxkKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKCiAgICAgICAgaWYgbm90IF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb24gYW5kIGNoYXIgdGhlbgogICAgICAgICAgICBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uID0gY2hhci5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCiAgICAgICAgICAgICAgICBpZiBjaGlsZDpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzVG9vbChjaGlsZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBvdmVycmlkZVRvb2xBY3RpdmF0aW9uKCkKCiAgICBpZiBub3QgX0cuQW5pbU1vbml0b3JDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5BbmltTW9uaXRvckNvbm5lY3Rpb24gPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIHRpY2soKSAlIDAuNSA8IDAuMDEgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGlmIGNoYXIgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBfLCB0cmFjayBpbiBwYWlycyhjaGFyLkh1bWFub2lkOkdldFBsYXlpbmdBbmltYXRpb25UcmFja3MoKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHJhY2suQW5pbWF0aW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1JZCA9IHRyYWNrLkFuaW1hdGlvbi5BbmltYXRpb25JZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5pbU5hbWUgPSB0cmFjay5OYW1lOmxvd2VyKCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBibG9ja2VkQW5pbWF0aW9uc1thbmltSWRdIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInB1bmNoIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgiYXR0YWNrIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicmlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2s6U3RvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCgogICAgaWYgbm90IF9HLkNoYXJhY3RlckFkZGVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQ2hhcmFjdGVyQWRkZWRDb25uZWN0aW9uID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24obmV3Q2hhcikKICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgIHNldHVwQW5pbWF0aW9uQmxvY2tpbmcoKQogICAgICAgICAgICBvdmVycmlkZVRvb2xBY3RpdmF0aW9uKCkKCiAgICAgICAgICAgIGlmIF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb24gdGhlbgogICAgICAgICAgICAgICAgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uID0gbmV3Q2hhci5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCiAgICAgICAgICAgICAgICBpZiBjaGlsZDpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzVG9vbChjaGlsZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCmZ1bmN0aW9uIFJlY292ZXJ5UHVuY2goKQogICAgaWYgX0cuQW5pbUJsb2NrQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQW5pbUJsb2NrQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBfRy5BbmltQmxvY2tDb25uZWN0aW9uID0gbmlsCiAgICBlbmQKICAgIGlmIF9HLkFuaW1Nb25pdG9yQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQW5pbU1vbml0b3JDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgIF9HLkFuaW1Nb25pdG9yQ29ubmVjdGlvbiA9IG5pbAogICAgZW5kCiAgICBpZiBfRy5Ub29sQ29ubmVjdGlvbnMgdGhlbgogICAgICAgIGZvciBfLCBjb25uIGluIHBhaXJzKF9HLlRvb2xDb25uZWN0aW9ucykgZG8KICAgICAgICAgICAgaWYgY29ubiB0aGVuIGNvbm46RGlzY29ubmVjdCgpIGVuZAogICAgICAgIGVuZAogICAgICAgIF9HLlRvb2xDb25uZWN0aW9ucyA9IG5pbAogICAgZW5kCiAgICBpZiBfRy5CYWNrcGFja0FkZGVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQmFja3BhY2tBZGRlZENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgX0cuQmFja3BhY2tBZGRlZENvbm5lY3Rpb24gPSBuaWwKICAgIGVuZAogICAgaWYgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uID0gbmlsCiAgICBlbmQKICAgIGlmIF9HLkNoYXJhY3RlckFkZGVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQ2hhcmFjdGVyQWRkZWRDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgIF9HLkNoYXJhY3RlckFkZGVkQ29ubmVjdGlvbiA9IG5pbAogICAgZW5kCmVuZAoKS2lsbGVyOkFkZEJ1dHRvbigiUmVjb3ZlciBQdW5jaCBBbmltIiwgZnVuY3Rpb24oKQogICAgUmVjb3ZlcnlQdW5jaCgpCmVuZCkKCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgZnJpZW5kV2hpdGVsaXN0QWN0aXZlID0gZmFsc2UKCktpbGxlcjpBZGRTd2l0Y2goIkF1dG8gV2hpdGVsaXN0IEZyaWVuZHMgKEZhc3QgRnVuY3Rpb24pICIsIGZ1bmN0aW9uKHN0YXRlKQogICAgZnJpZW5kV2hpdGVsaXN0QWN0aXZlID0gc3RhdGUKCiAgICBpZiBzdGF0ZSB0aGVuCiAgICAgICAgZm9yIF8sIHBsYXllciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciBhbmQgTG9jYWxQbGF5ZXI6SXNGcmllbmRzV2l0aChwbGF5ZXIuVXNlcklkKSB0aGVuCiAgICAgICAgICAgICAgICBwbGF5ZXJXaGl0ZWxpc3RbcGxheWVyLk5hbWVdID0gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgICAgICAgICAgaWYgZnJpZW5kV2hpdGVsaXN0QWN0aXZlIGFuZCBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgYW5kIExvY2FsUGxheWVyOklzRnJpZW5kc1dpdGgocGxheWVyLlVzZXJJZCkgdGhlbgogICAgICAgICAgICAgICAgcGxheWVyV2hpdGVsaXN0W3BsYXllci5OYW1lXSA9IHRydWUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIGZvciBuYW1lIGluIHBhaXJzKHBsYXllcldoaXRlbGlzdCkgZG8KICAgICAgICAgICAgbG9jYWwgZnJpZW5kID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZChuYW1lKQogICAgICAgICAgICBpZiBmcmllbmQgYW5kIExvY2FsUGxheWVyOklzRnJpZW5kc1dpdGgoZnJpZW5kLlVzZXJJZCkgdGhlbgogICAgICAgICAgICAgICAgcGxheWVyV2hpdGVsaXN0W25hbWVdID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCktpbGxlcjpBZGRUZXh0Qm94KCJXaGl0ZWxpc3QiLCBmdW5jdGlvbih0ZXh0KQogICAgbG9jYWwgdGFyZ2V0ID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZCh0ZXh0KQogICAgaWYgdGFyZ2V0IHRoZW4KICAgICAgICBwbGF5ZXJXaGl0ZWxpc3RbdGFyZ2V0Lk5hbWVdID0gdHJ1ZQogICAgZW5kCmVuZCkKCktpbGxlcjpBZGRUZXh0Qm94KCJVbldoaXRlbGlzdCIsIGZ1bmN0aW9uKHRleHQpCiAgICBsb2NhbCB0YXJnZXQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKHRleHQpCiAgICBpZiB0YXJnZXQgdGhlbgogICAgICAgIHBsYXllcldoaXRlbGlzdFt0YXJnZXQuTmFtZV0gPSBuaWwKICAgIGVuZAplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJBdXRvIEtpbGwiLCBmdW5jdGlvbihib29sKQogICAgYXV0b0tpbGwgPSBib29sCgogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgYXV0b0tpbGwgZG8KICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIG9yIExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgICAgICAgICBsb2NhbCByaWdodEhhbmQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpCiAgICAgICAgICAgIGxvY2FsIGxlZnRIYW5kID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpCgogICAgICAgICAgICBsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgICAgIGlmIHB1bmNoIGFuZCBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpIHRoZW4KICAgICAgICAgICAgICAgIHB1bmNoLlBhcmVudCA9IGNoYXJhY3RlcgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIHJpZ2h0SGFuZCBhbmQgbGVmdEhhbmQgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHRhcmdldCBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0IH49IExvY2FsUGxheWVyIGFuZCBub3QgcGxheWVyV2hpdGVsaXN0W3RhcmdldC5OYW1lXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldENoYXIgPSB0YXJnZXQuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gdGFyZ2V0Q2hhciBhbmQgdGFyZ2V0Q2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJvb3RQYXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChyaWdodEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGxlZnRIYW5kLCByb290UGFydCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChyaWdodEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGxlZnRIYW5kLCByb290UGFydCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICB0YXNrLndhaXQoMC4wNSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKbG9jYWwgdGFyZ2V0RHJvcGRvd24gPSBLaWxsZXI6QWRkRHJvcGRvd24oIlNlbGVjdCBUYXJnZXQiLCBmdW5jdGlvbihuYW1lKQogICAgaWYgbmFtZSBhbmQgbm90IHRhYmxlLmZpbmQodGFyZ2V0UGxheWVyTmFtZXMsIG5hbWUpIHRoZW4KICAgICAgICB0YWJsZS5pbnNlcnQodGFyZ2V0UGxheWVyTmFtZXMsIG5hbWUpCiAgICBlbmQKZW5kKQoKS2lsbGVyOkFkZFRleHRCb3goIlJlbW92ZSBUYXJnZXQiLCBmdW5jdGlvbihuYW1lKQogICAgZm9yIGksIHYgaW4gaXBhaXJzKHRhcmdldFBsYXllck5hbWVzKSBkbwogICAgICAgIGlmIHYgPT0gbmFtZSB0aGVuCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZSh0YXJnZXRQbGF5ZXJOYW1lcywgaSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpmb3IgXywgcGxheWVyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgdGFyZ2V0RHJvcGRvd246QWRkKHBsYXllci5OYW1lKQogICAgICAgIHRhcmdldERyb3Bkb3duSXRlbXNbcGxheWVyLk5hbWVdID0gdHJ1ZQogICAgZW5kCmVuZAoKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgdGFyZ2V0RHJvcGRvd246QWRkKHBsYXllci5OYW1lKQogICAgICAgIHRhcmdldERyb3Bkb3duSXRlbXNbcGxheWVyLk5hbWVdID0gdHJ1ZQogICAgZW5kCmVuZCkKClBsYXllcnMuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpCiAgICBpZiB0YXJnZXREcm9wZG93bkl0ZW1zW3BsYXllci5OYW1lXSB0aGVuCiAgICAgICAgdGFyZ2V0RHJvcGRvd25JdGVtc1twbGF5ZXIuTmFtZV0gPSBuaWwKICAgICAgICB0YXJnZXREcm9wZG93bjpDbGVhcigpCiAgICAgICAgZm9yIG5hbWUgaW4gcGFpcnModGFyZ2V0RHJvcGRvd25JdGVtcykgZG8KICAgICAgICAgICAgdGFyZ2V0RHJvcGRvd246QWRkKG5hbWUpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgaSA9ICN0YXJnZXRQbGF5ZXJOYW1lcywgMSwgLTEgZG8KICAgICAgICBpZiB0YXJnZXRQbGF5ZXJOYW1lc1tpXSA9PSBwbGF5ZXIuTmFtZSB0aGVuCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZSh0YXJnZXRQbGF5ZXJOYW1lcywgaSkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJTdGFydCBLaWxsIFRhcmdldCIsIGZ1bmN0aW9uKHN0YXRlKQogICAga2lsbFRhcmdldCA9IHN0YXRlCgogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUga2lsbFRhcmdldCBkbwogICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3IgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCgogICAgICAgICAgICBsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgICAgIGlmIHB1bmNoIGFuZCBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpIHRoZW4KICAgICAgICAgICAgICAgIHB1bmNoLlBhcmVudCA9IGNoYXJhY3RlcgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHJpZ2h0SGFuZCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIlJpZ2h0SGFuZCIsIDUpCiAgICAgICAgICAgIGxvY2FsIGxlZnRIYW5kID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiTGVmdEhhbmQiLCA1KQoKICAgICAgICAgICAgaWYgcmlnaHRIYW5kIGFuZCBsZWZ0SGFuZCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgbmFtZSBpbiBpcGFpcnModGFyZ2V0UGxheWVyTmFtZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0ID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZChuYW1lKQogICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldCBhbmQgdGFyZ2V0IH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSB0YXJnZXQuQ2hhcmFjdGVyIGFuZCB0YXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcm9vdFBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpsb2NhbCBzcHlUYXJnZXREcm9wZG93biA9IEtpbGxlcjpBZGREcm9wZG93bigiU2VsZWN0IFZpZXcgVGFyZ2V0IiwgZnVuY3Rpb24obmFtZSkKICAgIHRhcmdldFBsYXllck5hbWUgPSBuYW1lCmVuZCkKCmZvciBfLCBwbGF5ZXIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICBzcHlUYXJnZXREcm9wZG93bjpBZGQocGxheWVyLk5hbWUpCiAgICBlbmQKZW5kCgpQbGF5ZXJzLlBsYXllckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24ocGxheWVyKQogICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICBzcHlUYXJnZXREcm9wZG93bjpBZGQocGxheWVyLk5hbWUpCiAgICBlbmQKZW5kKQoKUGxheWVycy5QbGF5ZXJSZW1vdmluZzpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgc3B5VGFyZ2V0RHJvcGRvd246Q2xlYXIoKQogICAgICAgIGZvciBfLCBwbHIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgICAgICBpZiBwbHIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgc3B5VGFyZ2V0RHJvcGRvd246QWRkKHBsci5OYW1lKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJWaWV3IFBsYXllciIsIGZ1bmN0aW9uKGJvb2wpCiAgICBzcHlpbmcgPSBib29sCiAgICBpZiBub3Qgc3B5aW5nIHRoZW4KICAgICAgICBsb2NhbCBjYW0gPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYQogICAgICAgIGNhbS5DYW1lcmFTdWJqZWN0ID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgb3IgTG9jYWxQbGF5ZXIKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgc3B5aW5nIGRvCiAgICAgICAgICAgIGxvY2FsIHRhcmdldCA9IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQodGFyZ2V0UGxheWVyTmFtZSkKICAgICAgICAgICAgaWYgdGFyZ2V0IGFuZCB0YXJnZXQgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSB0YXJnZXQuQ2hhcmFjdGVyIGFuZCB0YXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCiAgICAgICAgICAgICAgICBpZiBodW1hbm9pZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ2FtZXJhU3ViamVjdCA9IGh1bWFub2lkCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIkF1dG8gR29vZCBLYXJtYSIsIGZ1bmN0aW9uKGJvb2wpCiAgICBhdXRvR29vZEthcm1hID0gYm9vbAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgYXV0b0dvb2RLYXJtYSBkbwogICAgICAgICAgICBsb2NhbCBwbGF5ZXJDaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgIGxvY2FsIHJpZ2h0SGFuZCA9IHBsYXllckNoYXIgYW5kIHBsYXllckNoYXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpCiAgICAgICAgICAgIGxvY2FsIGxlZnRIYW5kID0gcGxheWVyQ2hhciBhbmQgcGxheWVyQ2hhcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKQogICAgICAgICAgICBpZiBwbGF5ZXJDaGFyIGFuZCByaWdodEhhbmQgYW5kIGxlZnRIYW5kIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCB0YXJnZXQgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldCB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGV2aWxLYXJtYSA9IHRhcmdldDpGaW5kRmlyc3RDaGlsZCgiZXZpbEthcm1hIikKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZ29vZEthcm1hID0gdGFyZ2V0OkZpbmRGaXJzdENoaWxkKCJnb29kS2FybWEiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBldmlsS2FybWEgYW5kIGdvb2RLYXJtYSBhbmQgZXZpbEthcm1hOklzQSgiSW50VmFsdWUiKSBhbmQgZ29vZEthcm1hOklzQSgiSW50VmFsdWUiKSBhbmQgZXZpbEthcm1hLlZhbHVlID4gZ29vZEthcm1hLlZhbHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gdGFyZ2V0LkNoYXJhY3RlciBhbmQgdGFyZ2V0LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByb290UGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocmlnaHRIYW5kLCByb290UGFydCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChsZWZ0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocmlnaHRIYW5kLCByb290UGFydCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChsZWZ0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAxKQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJBdXRvIEJhZCBLYXJtYSAoRmFzdCBBdXRvIEtpbGwpICIsIGZ1bmN0aW9uKGJvb2wpCiAgICBhdXRvQmFkS2FybWEgPSBib29sCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBhdXRvQmFkS2FybWEgZG8KICAgICAgICAgICAgbG9jYWwgcGxheWVyQ2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICBsb2NhbCByaWdodEhhbmQgPSBwbGF5ZXJDaGFyIGFuZCBwbGF5ZXJDaGFyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKQogICAgICAgICAgICBsb2NhbCBsZWZ0SGFuZCA9IHBsYXllckNoYXIgYW5kIHBsYXllckNoYXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikKICAgICAgICAgICAgaWYgcGxheWVyQ2hhciBhbmQgcmlnaHRIYW5kIGFuZCBsZWZ0SGFuZCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdGFyZ2V0IGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB0YXJnZXQgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBldmlsS2FybWEgPSB0YXJnZXQ6RmluZEZpcnN0Q2hpbGQoImV2aWxLYXJtYSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGdvb2RLYXJtYSA9IHRhcmdldDpGaW5kRmlyc3RDaGlsZCgiZ29vZEthcm1hIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZXZpbEthcm1hIGFuZCBnb29kS2FybWEgYW5kIGV2aWxLYXJtYTpJc0EoIkludFZhbHVlIikgYW5kIGdvb2RLYXJtYTpJc0EoIkludFZhbHVlIikgYW5kIGdvb2RLYXJtYS5WYWx1ZSA+IGV2aWxLYXJtYS5WYWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCByb290UGFydCA9IHRhcmdldC5DaGFyYWN0ZXIgYW5kIHRhcmdldC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcm9vdFBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB0YXNrLndhaXQoMC4wMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgoKbG9jYWwgZm9sbG93aW5nID0gZmFsc2UKbG9jYWwgZm9sbG93VGFyZ2V0ID0gbmlsCgotLSDwn5OMIEZ1bmNpw7NuOiBUUCBkZXRyw6FzIGRlbCBqdWdhZG9yCmxvY2FsIGZ1bmN0aW9uIGZvbGxvd1BsYXllcih0YXJnZXRQbGF5ZXIpCiAgICBsb2NhbCBteUNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGxvY2FsIHRhcmdldENoYXIgPSB0YXJnZXRQbGF5ZXIuQ2hhcmFjdGVyCgogICAgaWYgbm90IChteUNoYXIgYW5kIHRhcmdldENoYXIpIHRoZW4gcmV0dXJuIGVuZAogICAgbG9jYWwgbXlIUlAgPSBteUNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgbG9jYWwgdGFyZ2V0SFJQID0gdGFyZ2V0Q2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCgogICAgaWYgbXlIUlAgYW5kIHRhcmdldEhSUCB0aGVuCiAgICAgICAgbG9jYWwgZm9sbG93UG9zID0gdGFyZ2V0SFJQLlBvc2l0aW9uIC0gKHRhcmdldEhSUC5DRnJhbWUuTG9va1ZlY3RvciAqIDMpCiAgICAgICAgbXlIUlAuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhmb2xsb3dQb3MsIHRhcmdldEhSUC5Qb3NpdGlvbikKICAgIGVuZAplbmQKCi0tIPCfk4wgRHJvcGRvd24gZGluw6FtaWNvIGRlIGp1Z2Fkb3Jlcwpsb2NhbCBmb2xsb3dEcm9wZG93biA9IEtpbGxlcjpBZGREcm9wZG93bigiVGVsZXBvcnQgcGxheWVyIiwgZnVuY3Rpb24oc2VsZWN0ZWREaXNwbGF5TmFtZSkKICAgIGlmIHNlbGVjdGVkRGlzcGxheU5hbWUgYW5kIHNlbGVjdGVkRGlzcGxheU5hbWUgfj0gIiIgdGhlbgogICAgICAgIC0tIEJ1c2NhciBqdWdhZG9yIHBvciBEaXNwbGF5TmFtZQogICAgICAgIGxvY2FsIHRhcmdldCA9IG5pbAogICAgICAgIGZvciBfLCBwbHIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgICAgICBpZiBwbHIuRGlzcGxheU5hbWUgPT0gc2VsZWN0ZWREaXNwbGF5TmFtZSB0aGVuCiAgICAgICAgICAgICAgICB0YXJnZXQgPSBwbHIKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiB0YXJnZXQgdGhlbgogICAgICAgICAgICBmb2xsb3dUYXJnZXQgPSB0YXJnZXQuTmFtZSAtLSBHdWFyZGFtb3MgTmFtZSByZWFsIHBhcmEgc2VndWlyCiAgICAgICAgICAgIGZvbGxvd2luZyA9IHRydWUKICAgICAgICAgICAgcHJpbnQoIuKchSBTdGFydGVkIGZvbGxvd2luZzoiLCB0YXJnZXQuTmFtZSkKCiAgICAgICAgICAgIC0tIFRQIGlubWVkaWF0bwogICAgICAgICAgICBmb2xsb3dQbGF5ZXIodGFyZ2V0KQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCi0tIPCfk4wgSW5pY2lhbGl6YXIgbGlzdGEgY29uIERpc3BsYXlOYW1lcwpmb3IgXywgcGxheWVyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgZm9sbG93RHJvcGRvd246QWRkKHBsYXllci5EaXNwbGF5TmFtZSkKICAgIGVuZAplbmQKCi0tIPCfk4wgQWN0dWFsaXphciBsaXN0YSBjdWFuZG8gZW50cmVuIGp1Z2Fkb3JlcwpQbGF5ZXJzLlBsYXllckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24ocGxheWVyKQogICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICBmb2xsb3dEcm9wZG93bjpBZGQocGxheWVyLkRpc3BsYXlOYW1lKQogICAgZW5kCmVuZCkKCi0tIPCfk4wgQWN0dWFsaXphciBsaXN0YSBjdWFuZG8gc2UgdmF5YW4ganVnYWRvcmVzClBsYXllcnMuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpCiAgICAtLSBMaW1waWFtb3MgeSBhZ3JlZ2Ftb3MgZGUgbnVldm8KICAgIGZvbGxvd0Ryb3Bkb3duOkNsZWFyKCkKICAgIGZvciBfLCBwbHIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgIGlmIHBsciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgICAgIGZvbGxvd0Ryb3Bkb3duOkFkZChwbHIuRGlzcGxheU5hbWUpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLSBEZWphciBkZSBzZWd1aXIgc2kgc2UgZnVlCiAgICBpZiBmb2xsb3dUYXJnZXQgPT0gcGxheWVyLk5hbWUgdGhlbgogICAgICAgIGZvbGxvd1RhcmdldCA9IG5pbAogICAgICAgIGZvbGxvd2luZyA9IGZhbHNlCiAgICBlbmQKZW5kKQoKLS0g8J+TjCBCb3TDs24gcGFyYSBkZWphciBkZSBzZWd1aXIKS2lsbGVyOkFkZEJ1dHRvbigiU3RvcCBGb2xsb3ciLCBmdW5jdGlvbigpCiAgICBmb2xsb3dpbmcgPSBmYWxzZQogICAgZm9sbG93VGFyZ2V0ID0gbmlsCiAgICBwcmludCgi4puUIFN0b3BwZWQgZm9sbG93aW5nIikKZW5kKQoKLS0g8J+TjCBMb29wIGRlIHNlZ3VpbWllbnRvIGF1dG9tw6F0aWNvCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDAuMDEpIGRvCiAgICAgICAgaWYgZm9sbG93aW5nIGFuZCBmb2xsb3dUYXJnZXQgdGhlbgogICAgICAgICAgICBsb2NhbCB0YXJnZXQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKGZvbGxvd1RhcmdldCkKICAgICAgICAgICAgaWYgdGFyZ2V0IHRoZW4KICAgICAgICAgICAgICAgIGZvbGxvd1BsYXllcih0YXJnZXQpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGZvbGxvd2luZyA9IGZhbHNlCiAgICAgICAgICAgICAgICBmb2xsb3dUYXJnZXQgPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKLS0g8J+TjCBSZWludGVudGFyIGN1YW5kbyByZXNwYXduZWVzCkxvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgdGFzay53YWl0KDEpCiAgICBpZiBmb2xsb3dpbmcgYW5kIGZvbGxvd1RhcmdldCB0aGVuCiAgICAgICAgbG9jYWwgdGFyZ2V0ID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZChmb2xsb3dUYXJnZXQpCiAgICAgICAgaWYgdGFyZ2V0IHRoZW4KICAgICAgICAgICAgZm9sbG93UGxheWVyKHRhcmdldCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpsb2NhbCBnb2REYW1hZ2VBY3RpdmUgPSBmYWxzZQoKS2lsbGVyOkFkZFN3aXRjaCgiYXV0byBzbGFtcyIsIGZ1bmN0aW9uKHN0YXRlKQogICAgZ29kRGFtYWdlQWN0aXZlID0gc3RhdGUKICAgIGlmIHN0YXRlIHRoZW4KICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgZ29kRGFtYWdlQWN0aXZlIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBMb2NhbFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgZ3JvdW5kU2xhbSA9IHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiR3JvdW5kIFNsYW0iKSBvciAocGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiR3JvdW5kIFNsYW0iKSkKCiAgICAgICAgICAgICAgICBpZiBncm91bmRTbGFtIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBncm91bmRTbGFtLlBhcmVudCA9PSBwbGF5ZXIuQmFja3BhY2sgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBncm91bmRTbGFtLlBhcmVudCA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBncm91bmRTbGFtOkZpbmRGaXJzdENoaWxkKCJhdHRhY2tUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBncm91bmRTbGFtLmF0dGFja1RpbWUuVmFsdWUgPSAwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInNsYW0iKQogICAgICAgICAgICAgICAgICAgIGdyb3VuZFNsYW06QWN0aXZhdGUoKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCmxvY2FsIHNlcnZlclRhYiA9IHdpbmRvdzpBZGRUYWIoIlNlcnZlciIpCgpzZXJ2ZXJUYWI6QWRkTGFiZWwoIlNlcnZlciBPcHRpb25zIikKCi0tIEFkZCBhZCByZW1vdmFsIGJ1dHRvbiB0byBNaXNjIDEKc2VydmVyVGFiOkFkZEJ1dHRvbigiUmVtb3ZlIFBvcnRhbHMiLCBmdW5jdGlvbigpCiAgICAtLSBSZW1vdmUgZXhpc3RpbmcgYWQgcG9ydGFscwogICAgZm9yIF8sIHBvcnRhbCBpbiBwYWlycyhnYW1lOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgaWYgcG9ydGFsLk5hbWUgPT0gIlJvYmxveEZvcndhcmRQb3J0YWxzIiB0aGVuCiAgICAgICAgICAgIHBvcnRhbDpEZXN0cm95KCkKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICAtLSBTZXQgdXAgY29ubmVjdGlvbiB0byByZW1vdmUgZnV0dXJlIGFkIHBvcnRhbHMKICAgIGlmIF9HLkFkUmVtb3ZhbENvbm5lY3Rpb24gdGhlbgogICAgICAgIF9HLkFkUmVtb3ZhbENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICBlbmQKICAgIAogICAgX0cuQWRSZW1vdmFsQ29ubmVjdGlvbiA9IGdhbWUuRGVzY2VuZGFudEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oZGVzY2VuZGFudCkKICAgICAgICBpZiBkZXNjZW5kYW50Lk5hbWUgPT0gIlJvYmxveEZvcndhcmRQb3J0YWxzIiB0aGVuCiAgICAgICAgICAgIGRlc2NlbmRhbnQ6RGVzdHJveSgpCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICAKICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgVGl0bGUgPSAiQWRzIFJlbW92ZWQiLAogICAgICAgIFRleHQgPSAiUm9ibG94IGFkcyBoYXZlIGJlZW4gcmVtb3ZlZCIsCiAgICAgICAgRHVyYXRpb24gPSAwCiAgICB9KQplbmQpCgpzZXJ2ZXJUYWI6QWRkQnV0dG9uKCJBbnRpIEFGSyIsIGZ1bmN0aW9uKCkKICAgICBsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1Nvbnp5eERldi9HUE1SL3JlZnMvaGVhZHMvbWFpbi9HYXJhbW9uZFYyIikpKCkKZW5kKQoKc2VydmVyVGFiOkFkZEJ1dHRvbigiTGVzcyBMYWciLCBmdW5jdGlvbigpCiAgICBmb3IgXywgdiBpbiBwYWlycyhnYW1lOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgaWYgdjpJc0EoIlBhcnRpY2xlRW1pdHRlciIpIG9yIHY6SXNBKCJTbW9rZSIpIG9yIHY6SXNBKCJGaXJlIikgb3IgdjpJc0EoIlNwYXJrbGVzIikgdGhlbgogICAgICAgICAgICB2LkVuYWJsZWQgPSBmYWxzZQogICAgICAgIGVuZAogICAgZW5kCiAKICAgIGxvY2FsIGxpZ2h0aW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpCiAgICBsaWdodGluZy5HbG9iYWxTaGFkb3dzID0gZmFsc2UKICAgIGxpZ2h0aW5nLkZvZ0VuZCA9IDllOQogICAgbGlnaHRpbmcuQnJpZ2h0bmVzcyA9IDAKIAogICAgc2V0dGluZ3MoKS5SZW5kZXJpbmcuUXVhbGl0eUxldmVsID0gMQogCiAgICBmb3IgXywgdiBpbiBwYWlycyhnYW1lOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgaWYgdjpJc0EoIkRlY2FsIikgb3IgdjpJc0EoIlRleHR1cmUiKSB0aGVuCiAgICAgICAgICAgIHYuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgIGVsc2VpZiB2OklzQSgiQmFzZVBhcnQiKSBhbmQgbm90IHY6SXNBKCJNZXNoUGFydCIpIHRoZW4KICAgICAgICAgICAgdi5NYXRlcmlhbCA9IEVudW0uTWF0ZXJpYWwuU21vb3RoUGxhc3RpYwogICAgICAgICAgICBpZiB2LlBhcmVudCBhbmQgKHYuUGFyZW50OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIG9yIHYuUGFyZW50LlBhcmVudDpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSkgdGhlbgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB2LlJlZmxlY3RhbmNlID0gMAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogCiAgICBmb3IgXywgdiBpbiBwYWlycyhsaWdodGluZzpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIHY6SXNBKCJCbHVyRWZmZWN0Iikgb3IgdjpJc0EoIlN1blJheXNFZmZlY3QiKSBvciB2OklzQSgiQ29sb3JDb3JyZWN0aW9uRWZmZWN0Iikgb3IgdjpJc0EoIkJsb29tRWZmZWN0Iikgb3IgdjpJc0EoIkRlcHRoT2ZGaWVsZEVmZmVjdCIpIHRoZW4KICAgICAgICAgICAgdi5FbmFibGVkID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAogCiAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgIFRpdGxlID0gIk9wdGltaXphdGlvbiIsCiAgICAgICAgVGV4dCA9ICJGdWxsIG9wdGltaXphdGlvbiBhcHBsaWVkISIsCiAgICAgICAgRHVyYXRpb24gPSA1CiAgICB9KQplbmQpCgpzZXJ2ZXJUYWI6QWRkQnV0dG9uKCJSZWpvaW4gU2VydmVyIiwgZnVuY3Rpb24oKQogICAgbG9jYWwgdHMgPSBnYW1lOkdldFNlcnZpY2UoIlRlbGVwb3J0U2VydmljZSIpCiAgICBsb2NhbCBwID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKICAgIHRzOlRlbGVwb3J0KGdhbWUuUGxhY2VJZCwgcCkKZW5kKQogCmxvY2FsIGpvaW5Mb3dQbGF5ZXJTZXJ2ZXJTd2l0Y2ggPSBzZXJ2ZXJUYWI6QWRkU3dpdGNoKCJKb2luIExvdyBQbGF5ZXIgU2VydmVyIiwgZnVuY3Rpb24oYm9vbCkKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIGxvY2FsIG1vZHVsZSA9IGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vTGVvS2hvbFl0L3JvYmxveC9tYWluL2xrX3NlcnZlcmhvcC5sdWEiKSkoKQogICAgICAgIG1vZHVsZTpUZWxlcG9ydChnYW1lLlBsYWNlSWQsICJMb3dlc3QiKQogICAgZW5kCmVuZCkKCmxvY2FsIGF1dG9Sb2NrVGFiID0gd2luZG93OkFkZFRhYigiUm9ja3MiKQoKYXV0b1JvY2tUYWI6QWRkTGFiZWwoIi0tLVRNQiBGYXN0IEdsaXRjaC0tLSIpCgotLSBEZWZpbmUgdGhlIGdldHRvb2wgZnVuY3Rpb24gZmlyc3QKZnVuY3Rpb24gZ2V0dG9vbCgpCiAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiB2Lk5hbWUgPT0gIlB1bmNoIiBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHYpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgImxlZnRIYW5kIikKICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgInJpZ2h0SGFuZCIpCmVuZAoKLS0gQWRkIGFsbCByb2NrIGZhcm1pbmcgdG9nZ2xlcyB0byB0aGUgQXV0byBSb2NrIGZvbGRlcgphdXRvUm9ja1RhYjpBZGRTd2l0Y2goIkF1dG8gUHVuY2ggVGlueSBSb2NrICgwKSIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJUaW55IElzbGFuZCBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKYXV0b1JvY2tUYWI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIFN0YXJ0ZXIgUm9jayAoMTAwKSIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJTdGFydGVyIElzbGFuZCBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gMTAwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDEwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmF1dG9Sb2NrVGFiOkFkZFN3aXRjaCgiQXV0byBQdW5jaCBMZWdlbmQgQmVhY2ggUm9jayAoNUspIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIkxlZ2VuZCBCZWFjaCBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gNTAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSA1MDAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKYXV0b1JvY2tUYWI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIEZyb3plbiBSb2NrICgxNTBLKSIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJGcm9zdCBHeW0gUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDE1MDAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSAxNTAwMDAgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgphdXRvUm9ja1RhYjpBZGRTd2l0Y2goIkF1dG8gUHVuY2ggTXl0aGljYWwgUm9jayAoNDAwSykiLCBmdW5jdGlvbihWYWx1ZSkKICAgIHNlbGVjdHJvY2sgPSAiTXl0aGljYWwgR3ltIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0Zhcm0gZG8KICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvRmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSA+PSA0MDAwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gNDAwMDAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKYXV0b1JvY2tUYWI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIEluZmVybm8gUm9jayAoNzUwSykiLCBmdW5jdGlvbihWYWx1ZSkKICAgIHNlbGVjdHJvY2sgPSAiSW5mZXJubyBHeW0gUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDc1MDAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSA3NTAwMDAgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgphdXRvUm9ja1RhYjpBZGRTd2l0Y2goIkF1dG8gUHVuY2ggTGVnZW5kIFJvY2sgKDFNKSIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJMZWdlbmQgR3ltIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0Zhcm0gZG8KICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvRmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSA+PSAxMDAwMDAwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDEwMDAwMDAgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgphdXRvUm9ja1RhYjpBZGRTd2l0Y2goIkF1dG8gUHVuY2ggTXVzY2xlIEtpbmcgUm9jayAoNU0pIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIk11c2NsZSBLaW5nIEd5bSBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gNTAwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSA1MDAwMDAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKYXV0b1JvY2tUYWI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIEp1bmdsZSBSb2NrICgxME0pIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIkFuY2llbnQgSnVuZ2xlIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0Zhcm0gZG8KICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvRmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSA+PSAxMDAwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSAxMDAwMDAwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmxvY2FsIEdpZnQgPSB3aW5kb3c6QWRkVGFiKCJHaWZ0IikKR2lmdDpBZGRMYWJlbCgiR2lmdGluZyBQcm90ZWluIGVnZzoiKS5UZXh0U2l6ZSA9IDIyCgpsb2NhbCBwcm90ZWluRWdnTGFiZWwgPSBHaWZ0OkFkZExhYmVsKCJQcm90ZWluIEVnZ3M6IDAiKQpwcm90ZWluRWdnTGFiZWwuVGV4dFNpemUgPSAyMAoKbG9jYWwgc2VsZWN0ZWRFZ2dQbGF5ZXIgPSBuaWwKbG9jYWwgZWdnQ291bnQgPSAwCgpsb2NhbCBlZ2dEcm9wZG93biA9IEdpZnQ6QWRkRHJvcGRvd24oIlBsYXllciB0byBHaWZ0IEVnZ3MiLCBmdW5jdGlvbihzZWxlY3RlZERpc3BsYXlOYW1lKQogICAgZm9yIF8sIHBsciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgaWYgcGxyLkRpc3BsYXlOYW1lID09IHNlbGVjdGVkRGlzcGxheU5hbWUgdGhlbgogICAgICAgICAgICBzZWxlY3RlZEVnZ1BsYXllciA9IHBscgogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmZvciBfLCBwbHIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgaWYgcGxyIH49IFBsYXllcnMuTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIGVnZ0Ryb3Bkb3duOkFkZChwbHIuRGlzcGxheU5hbWUpCiAgICBlbmQKZW5kCgpQbGF5ZXJzLlBsYXllckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24ocGxyKQogICAgaWYgcGxyIH49IFBsYXllcnMuTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIGVnZ0Ryb3Bkb3duOkFkZChwbHIuRGlzcGxheU5hbWUpCiAgICBlbmQKZW5kKQoKR2lmdDpBZGRUZXh0Qm94KCJBbW91bnQgb2YgRWdncyIsIGZ1bmN0aW9uKHRleHQpCiAgICBlZ2dDb3VudCA9IHRvbnVtYmVyKHRleHQpIG9yIDAKZW5kKQoKR2lmdDpBZGRCdXR0b24oIkdpZnQgRWdncyIsIGZ1bmN0aW9uKCkKICAgIGlmIHNlbGVjdGVkRWdnUGxheWVyIGFuZCBlZ2dDb3VudCA+IDAgdGhlbgogICAgICAgIGZvciBpID0gMSwgZWdnQ291bnQgZG8KICAgICAgICAgICAgbG9jYWwgZWdnID0gUGxheWVycy5Mb2NhbFBsYXllci5jb25zdW1hYmxlc0ZvbGRlcjpGaW5kRmlyc3RDaGlsZCgiUHJvdGVpbiBFZ2ciKQogICAgICAgICAgICBpZiBlZ2cgdGhlbgogICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuckV2ZW50cy5naWZ0UmVtb3RlOkludm9rZVNlcnZlcigiZ2lmdFJlcXVlc3QiLCBzZWxlY3RlZEVnZ1BsYXllciwgZWdnKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKR2lmdDpBZGRMYWJlbCgiR2lmdGluZyBUcm9waWNhbCBTaGFrZXM6IikuVGV4dFNpemUgPSAyMgoKbG9jYWwgdHJvcGljYWxTaGFrZUxhYmVsID0gR2lmdDpBZGRMYWJlbCgiVHJvcGljYWwgU2hha2VzOiAwIikKdHJvcGljYWxTaGFrZUxhYmVsLlRleHRTaXplID0gMTgKCmxvY2FsIHNlbGVjdGVkU2hha2VQbGF5ZXIgPSBuaWwKbG9jYWwgc2hha2VDb3VudCA9IDAKCmxvY2FsIHNoYWtlRHJvcGRvd24gPSBHaWZ0OkFkZERyb3Bkb3duKCJQbGF5ZXIgdG8gR2lmdCBUcm9waWNhbCBTaGFrZXMiLCBmdW5jdGlvbihzZWxlY3RlZERpc3BsYXlOYW1lKQogICAgZm9yIF8sIHBsciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgaWYgcGxyLkRpc3BsYXlOYW1lID09IHNlbGVjdGVkRGlzcGxheU5hbWUgdGhlbgogICAgICAgICAgICBzZWxlY3RlZFNoYWtlUGxheWVyID0gcGxyCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKZm9yIF8sIHBsciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICBpZiBwbHIgfj0gUGxheWVycy5Mb2NhbFBsYXllciB0aGVuCiAgICAgICAgc2hha2VEcm9wZG93bjpBZGQocGxyLkRpc3BsYXlOYW1lKQogICAgZW5kCmVuZAoKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBscikKICAgIGlmIHBsciB+PSBQbGF5ZXJzLkxvY2FsUGxheWVyIHRoZW4KICAgICAgICBzaGFrZURyb3Bkb3duOkFkZChwbHIuRGlzcGxheU5hbWUpCiAgICBlbmQKZW5kKQoKR2lmdDpBZGRUZXh0Qm94KCJUcm9waWNhbCBTaGFrZXMgZ2lmdCIsIGZ1bmN0aW9uKHRleHQpCiAgICBzaGFrZUNvdW50ID0gdG9udW1iZXIodGV4dCkgb3IgMAplbmQpCgpHaWZ0OkFkZEJ1dHRvbigiR2lmdCBUcm9waWNhbCBTaGFrZXMiLCBmdW5jdGlvbigpCiAgICBpZiBzZWxlY3RlZFNoYWtlUGxheWVyIGFuZCBzaGFrZUNvdW50ID4gMCB0aGVuCiAgICAgICAgZm9yIGkgPSAxLCBzaGFrZUNvdW50IGRvCiAgICAgICAgICAgIGxvY2FsIHNoYWtlID0gUGxheWVycy5Mb2NhbFBsYXllci5jb25zdW1hYmxlc0ZvbGRlcjpGaW5kRmlyc3RDaGlsZCgiVHJvcGljYWwgU2hha2UiKQogICAgICAgICAgICBpZiBzaGFrZSB0aGVuCiAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5yRXZlbnRzLmdpZnRSZW1vdGU6SW52b2tlU2VydmVyKCJnaWZ0UmVxdWVzdCIsIHNlbGVjdGVkU2hha2VQbGF5ZXIsIHNoYWtlKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKbG9jYWwgZnVuY3Rpb24gdXBkYXRlSXRlbUNvdW50KCkKICAgIGxvY2FsIHByb3RlaW5FZ2dDb3VudCA9IDAKICAgIGxvY2FsIHRyb3BpY2FsU2hha2VDb3VudCA9IDAKCiAgICBsb2NhbCBiYWNrcGFjayA9IFBsYXllcnMuTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJCYWNrcGFjayIpCiAgICBpZiBiYWNrcGFjayB0aGVuCiAgICAgICAgZm9yIF8sIGl0ZW0gaW4gaXBhaXJzKGJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGlmIGl0ZW0uTmFtZSA9PSAiUHJvdGVpbiBFZ2ciIHRoZW4KICAgICAgICAgICAgICAgIHByb3RlaW5FZ2dDb3VudCA9IHByb3RlaW5FZ2dDb3VudCArIDEKICAgICAgICAgICAgZWxzZWlmIGl0ZW0uTmFtZSA9PSAiVHJvcGljYWwgU2hha2UiIG9yIGl0ZW0uTmFtZSA9PSAiUGnDsWFzIiB0aGVuCiAgICAgICAgICAgICAgICB0cm9waWNhbFNoYWtlQ291bnQgPSB0cm9waWNhbFNoYWtlQ291bnQgKyAxCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgcHJvdGVpbkVnZ0xhYmVsLlRleHQgPSAiUHJvdGVpbiBFZ2dzOiAiIC4uIHByb3RlaW5FZ2dDb3VudAogICAgdHJvcGljYWxTaGFrZUxhYmVsLlRleHQgPSAiVHJvcGljYWwgU2hha2VzOiAiIC4uIHRyb3BpY2FsU2hha2VDb3VudAplbmQKCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIHVwZGF0ZUl0ZW1Db3VudCgpCiAgICAgICAgdGFzay53YWl0KDAuMjUpCiAgICBlbmQKZW5kKQoKbG9jYWwgbWlzY1RhYiA9IHdpbmRvdzpBZGRUYWIoIk1pc2MiKQoKbG9jYWwgbWlzYzFGb2xkZXIgPSBtaXNjVGFiOkFkZEZvbGRlcigiTWlzYyAxIikKCi0tIEZhc3QgUHVuY2ggdG9nZ2xlIHdpdGggYXV0by1wdW5jaCBmdW5jdGlvbmFsaXR5IGFuZCBwZXJzaXN0ZW50IGVxdWlwcGluZwptaXNjMUZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gUHVuY2giLCBmdW5jdGlvbihib29sKQogICAgX0cuRmFzdFB1bmNoID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICAtLSBGdW5jdGlvbiB0byBjb250aW51b3VzbHkgZXF1aXAgYW5kIG1vZGlmeSBwdW5jaAogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuRmFzdFB1bmNoIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gQ2hlY2sgaWYgdG9vbCBpcyBub3QgZXF1aXBwZWQKICAgICAgICAgICAgICAgIGlmIGNoYXJhY3RlciBhbmQgbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcHVuY2ggPSBwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICAgICAgICAgICAgICBpZiBwdW5jaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHB1bmNoOkZpbmRGaXJzdENoaWxkKCJhdHRhY2tUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVuY2guYXR0YWNrVGltZS5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wocHVuY2gpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikgdGhlbgogICAgICAgICAgICAgICAgICAgIC0tIE1ha2Ugc3VyZSBlcXVpcHBlZCB0b29sIGlzIG1vZGlmaWVkCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICAgICAgICAgICAgICBpZiBlcXVpcHBlZDpGaW5kRmlyc3RDaGlsZCgiYXR0YWNrVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZXF1aXBwZWQuYXR0YWNrVGltZS5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIC0tIEZ1bmN0aW9uIHRvIHJhcGlkbHkgcHVuY2gKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkZhc3RQdW5jaCBkbwogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBwbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAicmlnaHRIYW5kIikKICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJsZWZ0SGFuZCIpCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBpZiBjaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHB1bmNoVG9vbCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgICAgICAgICAgICAgIGlmIHB1bmNoVG9vbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHB1bmNoVG9vbDpBY3RpdmF0ZSgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHdhaXQoMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIC0tIFVuZXF1aXAgYW5kIHJlc2V0IHRvb2wKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICBpZiBlcXVpcHBlZCB0aGVuCiAgICAgICAgICAgIGlmIGVxdWlwcGVkOkZpbmRGaXJzdENoaWxkKCJhdHRhY2tUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgZXF1aXBwZWQuYXR0YWNrVGltZS5WYWx1ZSA9IDAuMzUKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIC0tIEFsc28gcmVzZXQgdGhlIGJhY2twYWNrIHRvb2wKICAgICAgICBsb2NhbCBiYWNrcGFja1Rvb2wgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICBpZiBiYWNrcGFja1Rvb2wgYW5kIGJhY2twYWNrVG9vbDpGaW5kRmlyc3RDaGlsZCgiYXR0YWNrVGltZSIpIHRoZW4KICAgICAgICAgICAgYmFja3BhY2tUb29sLmF0dGFja1RpbWUuVmFsdWUgPSAwLjM1CiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKLS0gRmFzdCBXZWlnaHQgdG9nZ2xlIHdpdGggYXV0by13ZWlnaHQgZnVuY3Rpb25hbGl0eSBhbmQgcGVyc2lzdGVudCBlcXVpcHBpbmcKbWlzYzFGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIFdlaWdodCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5GYXN0V2VpZ2h0ID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICAtLSBDb250aW51b3VzbHkgZXF1aXAgYW5kIG1vZGlmeSB3ZWlnaHQgdG9vbAogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuRmFzdFdlaWdodCBkbwogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tIENoZWNrIGlmIHRvb2wgaXMgbm90IGVxdWlwcGVkCiAgICAgICAgICAgICAgICBpZiBjaGFyYWN0ZXIgYW5kIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCB3ZWlnaHRUb29sID0gcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKQogICAgICAgICAgICAgICAgICAgIGlmIHdlaWdodFRvb2wgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiB3ZWlnaHRUb29sOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2VpZ2h0VG9vbC5yZXBUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh3ZWlnaHRUb29sKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgLS0gTWFrZSBzdXJlIGVxdWlwcGVkIHRvb2wgaXMgbW9kaWZpZWQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikKICAgICAgICAgICAgICAgICAgICBpZiBlcXVpcHBlZDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZXF1aXBwZWQucmVwVGltZS5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIC0tIEF1dG8gZG8gd2VpZ2h0IGxpZnRpbmcKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkZhc3RXZWlnaHQgZG8KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIC0tIFVuZXF1aXAgYW5kIHJlc2V0IHRvb2wKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpCiAgICAgICAgaWYgZXF1aXBwZWQgdGhlbgogICAgICAgICAgICBpZiBlcXVpcHBlZDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgIGVxdWlwcGVkLnJlcFRpbWUuVmFsdWUgPSAxCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlcXVpcHBlZC5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSBBbHNvIHJlc2V0IHRoZSBiYWNrcGFjayB0b29sCiAgICAgICAgbG9jYWwgYmFja3BhY2tUb29sID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKQogICAgICAgIGlmIGJhY2twYWNrVG9vbCBhbmQgYmFja3BhY2tUb29sOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICBiYWNrcGFja1Rvb2wucmVwVGltZS5WYWx1ZSA9IDEKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgotLSBGYXN0IFB1c2h1cHMgdG9nZ2xlIHdpdGggYXV0by1wdXNodXBzIGZ1bmN0aW9uYWxpdHkgYW5kIHBlcnNpc3RlbnQgZXF1aXBwaW5nCm1pc2MxRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBQdXNodXBzIiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLkZhc3RQdXNodXBzID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICAtLSBDb250aW51b3VzbHkgZXF1aXAgYW5kIG1vZGlmeSBwdXNodXBzIHRvb2wKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkZhc3RQdXNodXBzIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gQ2hlY2sgaWYgdG9vbCBpcyBub3QgZXF1aXBwZWQKICAgICAgICAgICAgICAgIGlmIGNoYXJhY3RlciBhbmQgbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVzaHVwcyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwdXNodXBzVG9vbCA9IHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVzaHVwcyIpCiAgICAgICAgICAgICAgICAgICAgaWYgcHVzaHVwc1Rvb2wgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBwdXNodXBzVG9vbDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2h1cHNUb29sLnJlcFRpbWUuVmFsdWUgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBjaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHB1c2h1cHNUb29sKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdXNodXBzIikgdGhlbgogICAgICAgICAgICAgICAgICAgIC0tIE1ha2Ugc3VyZSBlcXVpcHBlZCB0b29sIGlzIG1vZGlmaWVkCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1c2h1cHMiKQogICAgICAgICAgICAgICAgICAgIGlmIGVxdWlwcGVkOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBlcXVpcHBlZC5yZXBUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHdhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgLS0gQXV0byBkbyBwdXNodXBzCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5GYXN0UHVzaHVwcyBkbwogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgLS0gVW5lcXVpcCBhbmQgcmVzZXQgdG9vbAogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVzaHVwcyIpCiAgICAgICAgaWYgZXF1aXBwZWQgdGhlbgogICAgICAgICAgICBpZiBlcXVpcHBlZDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgIGVxdWlwcGVkLnJlcFRpbWUuVmFsdWUgPSAxCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlcXVpcHBlZC5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSBBbHNvIHJlc2V0IHRoZSBiYWNrcGFjayB0b29sCiAgICAgICAgbG9jYWwgYmFja3BhY2tUb29sID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdXNodXBzIikKICAgICAgICBpZiBiYWNrcGFja1Rvb2wgYW5kIGJhY2twYWNrVG9vbDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgYmFja3BhY2tUb29sLnJlcFRpbWUuVmFsdWUgPSAxCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKLS0gRmFzdCBIYW5kc3RhbmRzIHRvZ2dsZSB3aXRoIGF1dG8taGFuZHN0YW5kcyBmdW5jdGlvbmFsaXR5IGFuZCBwZXJzaXN0ZW50IGVxdWlwcGluZwptaXNjMUZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gSGFuZHN0YW5kcyIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5GYXN0SGFuZHN0YW5kcyA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgLS0gQ29udGludW91c2x5IGVxdWlwIGFuZCBtb2RpZnkgaGFuZHN0YW5kcyB0b29sCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5GYXN0SGFuZHN0YW5kcyBkbwogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tIENoZWNrIGlmIHRvb2wgaXMgbm90IGVxdWlwcGVkCiAgICAgICAgICAgICAgICBpZiBjaGFyYWN0ZXIgYW5kIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhhbmRzdGFuZHMiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaGFuZHN0YW5kc1Rvb2wgPSBwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkhhbmRzdGFuZHMiKQogICAgICAgICAgICAgICAgICAgIGlmIGhhbmRzdGFuZHNUb29sIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGFuZHN0YW5kc1Rvb2w6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kc3RhbmRzVG9vbC5yZXBUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChoYW5kc3RhbmRzVG9vbCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGFuZHN0YW5kcyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAtLSBNYWtlIHN1cmUgZXF1aXBwZWQgdG9vbCBpcyBtb2RpZmllZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIYW5kc3RhbmRzIikKICAgICAgICAgICAgICAgICAgICBpZiBlcXVpcHBlZDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZXF1aXBwZWQucmVwVGltZS5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIC0tIEF1dG8gZG8gaGFuZHN0YW5kcwogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuRmFzdEhhbmRzdGFuZHMgZG8KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIC0tIFVuZXF1aXAgYW5kIHJlc2V0IHRvb2wKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhhbmRzdGFuZHMiKQogICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgaWYgZXF1aXBwZWQ6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICBlcXVpcHBlZC5yZXBUaW1lLlZhbHVlID0gMQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZXF1aXBwZWQuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgLS0gQWxzbyByZXNldCB0aGUgYmFja3BhY2sgdG9vbAogICAgICAgIGxvY2FsIGJhY2twYWNrVG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiSGFuZHN0YW5kcyIpCiAgICAgICAgaWYgYmFja3BhY2tUb29sIGFuZCBiYWNrcGFja1Rvb2w6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgIGJhY2twYWNrVG9vbC5yZXBUaW1lLlZhbHVlID0gMQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCi0tIENyZWF0ZSB0aGUgZmlyc3QgZm9sZGVyCmxvY2FsIG1pc2MyRm9sZGVyID0gbWlzY1RhYjpBZGRGb2xkZXIoIk1pc2MgMiIpCgotLSBBZGQgQXV0byBTcGluIFdoZWVsIHRvZ2dsZQptaXNjMkZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gU3BpbiBXaGVlbCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5BdXRvU3BpbldoZWVsID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkF1dG9TcGluV2hlZWwgYW5kIHdhaXQoMSkgZG8KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLm9wZW5Gb3J0dW5lV2hlZWxSZW1vdGU6SW52b2tlU2VydmVyKCJvcGVuRm9ydHVuZVdoZWVsIiwgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLmZvcnR1bmVXaGVlbENoYW5jZXNbIkZvcnR1bmUgV2hlZWwiXSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCi0tIEFkZCBBdXRvIENsYWltIEdpZnRzIHRvZ2dsZQptaXNjMkZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gQ2xhaW0gR2lmdHMiLCBmdW5jdGlvbihib29sKQogICAgX0cuQXV0b0NsYWltR2lmdHMgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuQXV0b0NsYWltR2lmdHMgYW5kIHdhaXQoMSkgZG8KICAgICAgICAgICAgICAgIGZvciBpID0gMSwgOCBkbwogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLmZyZWVHaWZ0Q2xhaW1SZW1vdGU6SW52b2tlU2VydmVyKCJjbGFpbUdpZnQiLCBpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgotLSBBZGQgcG9zaXRpb24gbG9jayB0b2dnbGUKbWlzYzJGb2xkZXI6QWRkU3dpdGNoKCJMb2NrIFBvc2l0aW9uIiwgZnVuY3Rpb24oYm9vbCkKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIC0tIEdldCBjdXJyZW50IHBvc2l0aW9uIGFuZCBsb2NrIGl0CiAgICAgICAgaWYgcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgbG9jYWwgY3VycmVudFBvc2l0aW9uID0gcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQogICAgICAgICAgICBsb2NrUGxheWVyUG9zaXRpb24oY3VycmVudFBvc2l0aW9uKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIC0tIFVubG9jayBwb3NpdGlvbgogICAgICAgIHVubG9ja1BsYXllclBvc2l0aW9uKCkKICAgIGVuZAplbmQpCgpsb2NhbCBmcmFtZVRvZ2dsZSA9IG1pc2MyRm9sZGVyOkFkZFN3aXRjaCgiSGlkZSBGcmFtZXMiLCBmdW5jdGlvbihib29sKQogICAgbG9jYWwgclN0byA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQogICAgZm9yIF8sIG9iaiBpbiBwYWlycyhyU3RvOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgb2JqLk5hbWU6bWF0Y2goIkZyYW1lJCIpIHRoZW4KICAgICAgICAgICAgb2JqLlZpc2libGUgPSBub3QgYm9vbAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCi0tIEF1dG8gRWF0IEVnZ3MgRmVhdHVyZQptaXNjMkZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gRWF0IEVnZ3MiLCBmdW5jdGlvbihlbmFibGVkKQogICAgX0cuQXV0b0VnZyA9IGVuYWJsZWQKICAgIGlmIGVuYWJsZWQgdGhlbgogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5BdXRvRWdnIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBwcm90ZWluRWdnID0gcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQcm90ZWluIEVnZyIpCiAgICAgICAgICAgICAgICBpZiBwcm90ZWluRWdnIHRoZW4KICAgICAgICAgICAgICAgICAgICBwcm90ZWluRWdnLlBhcmVudCA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICBmb3IgaSA9IDEsIDUgZG8KICAgICAgICAgICAgICAgICAgICAgICAgVmlydHVhbElucHV0TWFuYWdlcjpTZW5kTW91c2VCdXR0b25FdmVudCgwLCAwLCAwLCB0cnVlLCBnYW1lLCAxKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRNb3VzZUJ1dHRvbkV2ZW50KDAsIDAsIDAsIGZhbHNlLCBnYW1lLCAxKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCi0tIEF1dG8gRWF0IFRyb3BpY2FsIFNoYWtlIChQaW5lYXBwbGUpIEZlYXR1cmUKbWlzYzJGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIEVhdCBQaW5lYXBwbGUiLCBmdW5jdGlvbihlbmFibGVkKQogICAgX0cuQXV0b1BpbmVhcHBsZSA9IGVuYWJsZWQKICAgIGlmIGVuYWJsZWQgdGhlbgogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5BdXRvUGluZWFwcGxlIGRvCiAgICAgICAgICAgICAgICBsb2NhbCB0cm9waWNhbFNoYWtlID0gcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJUcm9waWNhbCBTaGFrZSIpCiAgICAgICAgICAgICAgICBpZiB0cm9waWNhbFNoYWtlIHRoZW4KICAgICAgICAgICAgICAgICAgICB0cm9waWNhbFNoYWtlLlBhcmVudCA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAgZm9yIGkgPSAxLCA1IGRvCiAgICAgICAgICAgICAgICAgICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZE1vdXNlQnV0dG9uRXZlbnQoMCwgMCwgMCwgdHJ1ZSwgZ2FtZSwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgVmlydHVhbElucHV0TWFuYWdlcjpTZW5kTW91c2VCdXR0b25FdmVudCgwLCAwLCAwLCBmYWxzZSwgZ2FtZSwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgptaXNjMkZvbGRlcjpBZGRTd2l0Y2goIkhpZGUgUGV0cyIsIGZ1bmN0aW9uKFN0YXRlKQogICAgaWYgU3RhdGUgdGhlbgogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLnNob3dQZXRzRXZlbnQ6RmlyZVNlcnZlcigiaGlkZVBldHMiKQogICAgZWxzZQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLnNob3dQZXRzRXZlbnQ6RmlyZVNlcnZlcigic2hvd1BldHMiKQogICAgZW5kCmVuZCkKCgptaXNjMkZvbGRlcjpBZGRTd2l0Y2goIlVuYWJsZSBUcmFkZSIsIGZ1bmN0aW9uKFN0YXRlKQogICAgaWYgU3RhdGUgdGhlbgogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLnRyYWRpbmdFdmVudDpGaXJlU2VydmVyKCJkaXNhYmxlVHJhZGluZyIpCiAgICBlbHNlCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMudHJhZGluZ0V2ZW50OkZpcmVTZXJ2ZXIoImVuYWJsZVRyYWRpbmciKQogICAgZW5kCmVuZCkKCgotLSBDcmVhdGUgdGhlIGZpcnN0IGZvbGRlcgpsb2NhbCBtaXNjM0ZvbGRlciA9IG1pc2NUYWI6QWRkRm9sZGVyKCJNaXNjIDMiKQoKbG9jYWwgZ29kTW9kZVRvZ2dsZSA9IGZhbHNlCm1pc2MzRm9sZGVyOkFkZFN3aXRjaCgiR29kIE1vZGUgKEJyYXdsKSIsIGZ1bmN0aW9uKFN0YXRlKQogICAgZ29kTW9kZVRvZ2dsZSA9IFN0YXRlCiAgICBpZiBTdGF0ZSB0aGVuCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIGdvZE1vZGVUb2dnbGUgZG8KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLmJyYXdsRXZlbnQ6RmlyZVNlcnZlcigiam9pbkJyYXdsIikKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKbG9jYWwgYXV0b0pvaW5Ub2dnbGUgPSBmYWxzZQptaXNjM0ZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gSm9pbiBCcmF3bCIsIGZ1bmN0aW9uKFN0YXRlKQogICAgYXV0b0pvaW5Ub2dnbGUgPSBTdGF0ZQogICAgaWYgU3RhdGUgdGhlbgogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBhdXRvSm9pblRvZ2dsZSBkbwogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMuYnJhd2xFdmVudDpGaXJlU2VydmVyKCJqb2luQnJhd2wiKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDIpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgotLSBXYWxrIG9uIFdhdGVyIGZlYXR1cmUKbG9jYWwgcGFydHMgPSB7fQpsb2NhbCBwYXJ0U2l6ZSA9IDIwNDgKbG9jYWwgdG90YWxEaXN0YW5jZSA9IDUwMDAwCmxvY2FsIHN0YXJ0UG9zaXRpb24gPSBWZWN0b3IzLm5ldygtMiwgLTkuNSwgLTIpCmxvY2FsIG51bWJlck9mUGFydHMgPSBtYXRoLmNlaWwodG90YWxEaXN0YW5jZSAvIHBhcnRTaXplKQoKbG9jYWwgZnVuY3Rpb24gY3JlYXRlUGFydHMoKQogICAgZm9yIHggPSAwLCBudW1iZXJPZlBhcnRzIC0gMSBkbwogICAgICAgIGZvciB6ID0gMCwgbnVtYmVyT2ZQYXJ0cyAtIDEgZG8KICAgICAgICAgICAgbG9jYWwgbmV3UGFydFNpZGUgPSBJbnN0YW5jZS5uZXcoIlBhcnQiKQogICAgICAgICAgICBuZXdQYXJ0U2lkZS5TaXplID0gVmVjdG9yMy5uZXcocGFydFNpemUsIDEsIHBhcnRTaXplKQogICAgICAgICAgICBuZXdQYXJ0U2lkZS5Qb3NpdGlvbiA9IHN0YXJ0UG9zaXRpb24gKyBWZWN0b3IzLm5ldyh4ICogcGFydFNpemUsIDAsIHogKiBwYXJ0U2l6ZSkKICAgICAgICAgICAgbmV3UGFydFNpZGUuQW5jaG9yZWQgPSB0cnVlCiAgICAgICAgICAgIG5ld1BhcnRTaWRlLlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgbmV3UGFydFNpZGUuQ2FuQ29sbGlkZSA9IHRydWUKICAgICAgICAgICAgbmV3UGFydFNpZGUuTmFtZSA9ICJQYXJ0X1NpZGVfIiAuLiB4IC4uICJfIiAuLiB6CiAgICAgICAgICAgIG5ld1BhcnRTaWRlLlBhcmVudCA9IHdvcmtzcGFjZQogICAgICAgICAgICB0YWJsZS5pbnNlcnQocGFydHMsIG5ld1BhcnRTaWRlKQogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgbmV3UGFydExlZnRSaWdodCA9IEluc3RhbmNlLm5ldygiUGFydCIpCiAgICAgICAgICAgIG5ld1BhcnRMZWZ0UmlnaHQuU2l6ZSA9IFZlY3RvcjMubmV3KHBhcnRTaXplLCAxLCBwYXJ0U2l6ZSkKICAgICAgICAgICAgbmV3UGFydExlZnRSaWdodC5Qb3NpdGlvbiA9IHN0YXJ0UG9zaXRpb24gKyBWZWN0b3IzLm5ldygteCAqIHBhcnRTaXplLCAwLCB6ICogcGFydFNpemUpCiAgICAgICAgICAgIG5ld1BhcnRMZWZ0UmlnaHQuQW5jaG9yZWQgPSB0cnVlCiAgICAgICAgICAgIG5ld1BhcnRMZWZ0UmlnaHQuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICBuZXdQYXJ0TGVmdFJpZ2h0LkNhbkNvbGxpZGUgPSB0cnVlCiAgICAgICAgICAgIG5ld1BhcnRMZWZ0UmlnaHQuTmFtZSA9ICJQYXJ0X0xlZnRSaWdodF8iIC4uIHggLi4gIl8iIC4uIHoKICAgICAgICAgICAgbmV3UGFydExlZnRSaWdodC5QYXJlbnQgPSB3b3Jrc3BhY2UKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBhcnRzLCBuZXdQYXJ0TGVmdFJpZ2h0KQogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgbmV3UGFydFVwTGVmdCA9IEluc3RhbmNlLm5ldygiUGFydCIpCiAgICAgICAgICAgIG5ld1BhcnRVcExlZnQuU2l6ZSA9IFZlY3RvcjMubmV3KHBhcnRTaXplLCAxLCBwYXJ0U2l6ZSkKICAgICAgICAgICAgbmV3UGFydFVwTGVmdC5Qb3NpdGlvbiA9IHN0YXJ0UG9zaXRpb24gKyBWZWN0b3IzLm5ldygteCAqIHBhcnRTaXplLCAwLCAteiAqIHBhcnRTaXplKQogICAgICAgICAgICBuZXdQYXJ0VXBMZWZ0LkFuY2hvcmVkID0gdHJ1ZQogICAgICAgICAgICBuZXdQYXJ0VXBMZWZ0LlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgbmV3UGFydFVwTGVmdC5DYW5Db2xsaWRlID0gdHJ1ZQogICAgICAgICAgICBuZXdQYXJ0VXBMZWZ0Lk5hbWUgPSAiUGFydF9VcExlZnRfIiAuLiB4IC4uICJfIiAuLiB6CiAgICAgICAgICAgIG5ld1BhcnRVcExlZnQuUGFyZW50ID0gd29ya3NwYWNlCiAgICAgICAgICAgIHRhYmxlLmluc2VydChwYXJ0cywgbmV3UGFydFVwTGVmdCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIG5ld1BhcnRVcFJpZ2h0ID0gSW5zdGFuY2UubmV3KCJQYXJ0IikKICAgICAgICAgICAgbmV3UGFydFVwUmlnaHQuU2l6ZSA9IFZlY3RvcjMubmV3KHBhcnRTaXplLCAxLCBwYXJ0U2l6ZSkKICAgICAgICAgICAgbmV3UGFydFVwUmlnaHQuUG9zaXRpb24gPSBzdGFydFBvc2l0aW9uICsgVmVjdG9yMy5uZXcoeCAqIHBhcnRTaXplLCAwLCAteiAqIHBhcnRTaXplKQogICAgICAgICAgICBuZXdQYXJ0VXBSaWdodC5BbmNob3JlZCA9IHRydWUKICAgICAgICAgICAgbmV3UGFydFVwUmlnaHQuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICBuZXdQYXJ0VXBSaWdodC5DYW5Db2xsaWRlID0gdHJ1ZQogICAgICAgICAgICBuZXdQYXJ0VXBSaWdodC5OYW1lID0gIlBhcnRfVXBSaWdodF8iIC4uIHggLi4gIl8iIC4uIHoKICAgICAgICAgICAgbmV3UGFydFVwUmlnaHQuUGFyZW50ID0gd29ya3NwYWNlCiAgICAgICAgICAgIHRhYmxlLmluc2VydChwYXJ0cywgbmV3UGFydFVwUmlnaHQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBtYWtlUGFydHNXYWxrdGhyb3VnaCgpCiAgICBmb3IgXywgcGFydCBpbiBpcGFpcnMocGFydHMpIGRvCiAgICAgICAgaWYgcGFydCBhbmQgcGFydC5QYXJlbnQgdGhlbgogICAgICAgICAgICBwYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gbWFrZVBhcnRzU29saWQoKQogICAgZm9yIF8sIHBhcnQgaW4gaXBhaXJzKHBhcnRzKSBkbwogICAgICAgIGlmIHBhcnQgYW5kIHBhcnQuUGFyZW50IHRoZW4KICAgICAgICAgICAgcGFydC5DYW5Db2xsaWRlID0gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0gQWRkIFdhbGsgb24gV2F0ZXIgdG9nZ2xlCm1pc2MzRm9sZGVyOkFkZFN3aXRjaCgiV2FsayBvbiBXYXRlciIsIGZ1bmN0aW9uKGJvb2wpCiAgICBpZiBib29sIHRoZW4KICAgICAgICBjcmVhdGVQYXJ0cygpCiAgICBlbHNlCiAgICAgICAgbWFrZVBhcnRzV2Fsa3Rocm91Z2goKQogICAgZW5kCmVuZCkKCi0tIEFkZCBOby1DbGlwIHRvZ2dsZQptaXNjM0ZvbGRlcjpBZGRTd2l0Y2goIk5vLUNsaXAiLCBmdW5jdGlvbihib29sKQogICAgX0cuTm9DbGlwID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICBsb2NhbCBub2NsaXBMb29wCiAgICAgICAgbm9jbGlwTG9vcCA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLlN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIF9HLk5vQ2xpcCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgcGFydCBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgcGFydDpJc0EoIkJhc2VQYXJ0IikgYW5kIHBhcnQuQ2FuQ29sbGlkZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbm9jbGlwTG9vcDpEaXNjb25uZWN0KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgICAgIFRpdGxlID0gIk5vLUNsaXAiLAogICAgICAgICAgICBUZXh0ID0gIlRhdGFnb3Mga2EgYmEiLAogICAgICAgICAgICBEdXJhdGlvbiA9IDAKICAgICAgICB9KQogICAgZW5kCmVuZCkKCi0tIEFkZCBJbmZpbml0ZSBKdW1wIHRvZ2dsZQptaXNjM0ZvbGRlcjpBZGRTd2l0Y2goIkp1bXB5IEluZmluaXRlIiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLkluZmluaXRlSnVtcCA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgbG9jYWwgSW5maW5pdGVKdW1wQ29ubmVjdGlvbgogICAgICAgIEluZmluaXRlSnVtcENvbm5lY3Rpb24gPSBnYW1lOkdldFNlcnZpY2UoIlVzZXJJbnB1dFNlcnZpY2UiKS5KdW1wUmVxdWVzdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgX0cuSW5maW5pdGVKdW1wIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIik6Q2hhbmdlU3RhdGUoIkp1bXBpbmciKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBJbmZpbml0ZUp1bXBDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICAgICAgVGl0bGUgPSAiSGlnaCBuYSBIaWdoIiwKICAgICAgICAgICAgVGV4dCA9ICJTdW1ha3NlcyBrYSBlaCIsCiAgICAgICAgICAgIER1cmF0aW9uID0gMAogICAgICAgIH0pCiAgICBlbmQKZW5kKQoKbG9jYWwgdGltZURyb3Bkb3duID0gbWlzYzNGb2xkZXI6QWRkRHJvcGRvd24oIkNoYW5nZSBUaW1lIiwgZnVuY3Rpb24oc2VsZWN0aW9uKQogICAgbG9jYWwgbGlnaHRpbmcgPSBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikKICAgIAogICAgaWYgc2VsZWN0aW9uID09ICJOaWdodCIgdGhlbgogICAgICAgIGxpZ2h0aW5nLkNsb2NrVGltZSA9IDAKICAgIGVsc2VpZiBzZWxlY3Rpb24gPT0gIkRheSIgdGhlbgogICAgICAgIGxpZ2h0aW5nLkNsb2NrVGltZSA9IDEyCiAgICBlbHNlaWYgc2VsZWN0aW9uID09ICJNaWRuaWdodCIgdGhlbgogICAgICAgIGxpZ2h0aW5nLkNsb2NrVGltZSA9IDYKICAgIGVuZAogICAgCiAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgIFRpdGxlID0gIkhvcmEgQ2FtYmlhZGEiLAogICAgICAgIFRleHQgPSAiTGEgaG9yYSBkZWwgZMOtYSBoYSBzaWRvIGNhbWJpYWRhIGE6ICIgLi4gc2VsZWN0aW9uLAogICAgICAgIER1cmF0aW9uID0gMAogICAgfSkKZW5kKQoKLS0gQWRkIHRpbWUgb3B0aW9ucwp0aW1lRHJvcGRvd246QWRkKCJOaWdodCIpCnRpbWVEcm9wZG93bjpBZGQoIkRheSIpCnRpbWVEcm9wZG93bjpBZGQoIk1pZG5pZ2h0IikKCm1pc2NUYWI6QWRkTGFiZWwoIj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0iKS5UZXh0U2l6ZSA9IDE1CgptaXNjVGFiOkFkZExhYmVsKCIgIikuVGV4dFNpemUgPSAxNQptaXNjVGFiOkFkZExhYmVsKCJUZWxlcG9ydCIpLlRleHRTaXplID0gMjAKbWlzY1RhYjpBZGRMYWJlbCgiICIpLlRleHRTaXplID0gMTUKCm1pc2NUYWI6QWRkQnV0dG9uKCJUaW55IElzbGFuZCIsIGZ1bmN0aW9uKCkKICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC0zMS44NjI2MTk0LCA2LjA1ODgwMjYsIDIwODcuODg2NzIpCmVuZCkKCm1pc2NUYWI6QWRkQnV0dG9uKCJTdGFydGVyIElzbGFuZCIsIGZ1bmN0aW9uKCkKICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDIyNi4yNTI0NzIsIDguMTUyNjk0NywgMjE5LjM2NjUxNikKZW5kKQoKbWlzY1RhYjpBZGRCdXR0b24oIkxlZ2VuZCBCZWFjaCIsIGZ1bmN0aW9uKCkKICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC0zNjUuNzk4MzA5LCA0NC41MDgyOTMyLCAtNTAxLjYxODU5MSkKZW5kKQoKbWlzY1RhYjpBZGRCdXR0b24oIkZyb3N0IEd5bSIsIGZ1bmN0aW9uKCkKICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC0yOTMzLjQ3OTk4LCAyOS42Mzk5NjEyLCAtNTc5Ljk0NjA0NSkKZW5kKQoKbWlzY1RhYjpBZGRCdXR0b24oIk15dGhpY2FsIEd5bSIsIGZ1bmN0aW9uKCkKICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDI2NTkuNTA2MzUsIDIxLjYwOTUyMzgsIDkzNC42OTA2MTMpCmVuZCkKCm1pc2NUYWI6QWRkQnV0dG9uKCJFdGVybmFsIEd5bSIsIGZ1bmN0aW9uKCkKICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC03MTc2LjE5MTQxLCA0NS4zOTQxMDQsIC0xMTA2LjMxNDIxKQplbmQpCgptaXNjVGFiOkFkZEJ1dHRvbigiTGVnZW5kIEd5bSIsIGZ1bmN0aW9uKCkKICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDQ0NDYuOTE2OTksIDEwMDQuNDY2OTgsIC0zOTgzLjc2MDc0KQplbmQpCgptaXNjVGFiOkFkZEJ1dHRvbigiSnVuZ2xlIEd5bSIsIGZ1bmN0aW9uKCkKICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC04MTM3LCAyOCwgMjgyMCkKZW5kKQoKbG9jYWwgaW5mb1RhYiA9IHdpbmRvdzpBZGRUYWIoIkNyZWRpdHMiKQppbmZvVGFiOlNob3coKQppbmZvVGFiOkFkZExhYmVsKCJNYWRlIGJ5IFNlbvCfkpkiKS5UZXh0U2l6ZSA9IDIwCgppbmZvVGFiOkFkZExhYmVsKCIiKQpsb2NhbCB3TGFiZWwgPSBpbmZvVGFiOkFkZExhYmVsKCJWRVJTSU9OLy8xLjAuMCIpCndMYWJlbC5UZXh0U2l6ZSA9IDQwCndMYWJlbC5Gb250ID0gRW51bS5Gb250LkFyY2FkZQoKbG9jYWwgd0xhYmVsID0gaW5mb1RhYjpBZGRMYWJlbCgiVE1CIFYxIikKd0xhYmVsLlRleHRTaXplID0gNDAKd0xhYmVsLkZvbnQgPSBFbnVtLkZvbnQuQXJjYWRlCg==" local __map={};(function() local chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/' for i=1,#chars do __map[string.sub(chars,i,i)]=i-1 end end)() local out={};local i=1;while i<=#__b do local c1=__map[string.sub(__b,i,i)];local c2=__map[string.sub(__b,i+1,i+1)];local c3=__map[string.sub(__b,i+2,i+2)];local c4=__map[string.sub(__b,i+3,i+3)];if not c1 then break end;c2=c2 or 0;c3=c3 or 0;c4=c4 or 0;local n=c1*262144+c2*4096+c3*64+c4;local b1=math.floor(n/65536)%256;local b2=math.floor(n/256)%256;local b3=n%256;out[#out+1]=string.char(b1);if string.sub(__b,i+2,i+2)~='=' then out[#out+1]=string.char(b2) end;if string.sub(__b,i+3,i+3)~='=' then out[#out+1]=string.char(b3) end;i=i+4 end;local decoded=table.concat(out) local ok,err=pcall(function() local loader=loadstring or load;local f=loader(decoded);if type(f)=='function'then f() end end) if not ok then pcall(function() print('Wrapper error: '..tostring(err)) end) end end)()
