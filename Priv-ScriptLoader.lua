--[[Protected by Sen Obsfucator V3 | RMPG Services | Generated Time: 2025-11-27 15:03:13]] (function() local __b = "bG9jYWwgSHR0cFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIikKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCgpsb2NhbCBXSElURUxJU1RfVVJMID0gImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9IYXNyblh6ZWVlL1RNQi9yZWZzL2hlYWRzL21haW4vV2hpdGVsaXN0ZWRVc2Vycy5sdWEiCgpsb2NhbCBmdW5jdGlvbiBmZXRjaFdoaXRlbGlzdCh1cmwpCiAgICBsb2NhbCBzdWNjZXNzLCByZXNwb25zZSA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICByZXR1cm4gSHR0cFNlcnZpY2U6R2V0QXN5bmModXJsKQogICAgZW5kKQogICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgICAgIHdhcm4oIkZhaWxlZCB0byBmZXRjaCB3aGl0ZWxpc3Q6ICIgLi4gdG9zdHJpbmcocmVzcG9uc2UpKQogICAgICAgIHJldHVybiB7fQogICAgZW5kCgogICAgbG9jYWwgdXNlcnMgPSB7fQogICAgZm9yIGxpbmUgaW4gc3RyaW5nLmdtYXRjaChyZXNwb25zZSwgIlteXHJcbl0rIikgZG8KICAgICAgICBsb2NhbCB1c2VybmFtZSwgdmFsdWUgPSBzdHJpbmcubWF0Y2gobGluZSwgIl4lcyooWyV3X10rKSVzKj0lcyooJXcrKSVzKiwlcyokIikKICAgICAgICBpZiB1c2VybmFtZSBhbmQgdmFsdWUgYW5kIHZhbHVlOmxvd2VyKCkgPT0gInRydWUiIHRoZW4KICAgICAgICAgICAgdXNlcnNbdXNlcm5hbWVdID0gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gdXNlcnMKZW5kCgpsb2NhbCB3aGl0ZWxpc3RlZFVzZXJuYW1lcyA9IGZldGNoV2hpdGVsaXN0KFdISVRFTElTVF9VUkwpCgpsb2NhbCBmdW5jdGlvbiBpc1doaXRlbGlzdGVkKHVzZXJuYW1lKQogICAgcmV0dXJuIHdoaXRlbGlzdGVkVXNlcm5hbWVzW3VzZXJuYW1lXSA9PSB0cnVlCmVuZAoKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIGlmIG5vdCBpc1doaXRlbGlzdGVkKHBsYXllci5OYW1lKSB0aGVuCiAgICAgICAgcGxheWVyOktpY2soIllvdSBhcmUgbm90IHdoaXRlbGlzdGVkLiIpCiAgICBlbHNlCiAgICAgICAgcHJpbnQocGxheWVyLk5hbWUgLi4gIiBpcyB3aGl0ZWxpc3RlZCEiKQogICAgICAgIAogICAgICAgbG9jYWwgbGlicmFyeSA9IGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vSGFzcm5YemVlZS9OL3JlZnMvaGVhZHMvbWFpbi9JbWFnZS5wbmciLCB0cnVlKSkoKQpsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgcGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBzdGFydFRpbWUgPSBvcy50aW1lKCkKbG9jYWwgc3RhcnRSZWJpcnRocyA9IHBsYXllci5sZWFkZXJzdGF0cy5SZWJpcnRocy5WYWx1ZQpsb2NhbCBkaXNwbGF5TmFtZSA9IHBsYXllci5EaXNwbGF5TmFtZQoKLS0gQ3JlYXRlIE1haW4gV2luZG93CmxvY2FsIHdpbmRvdyA9IGxpYnJhcnk6QWRkV2luZG93KCJUTUIgfHwgUHJpdiBTY3JpcHQiLCB7CiAgICBtYWluX2NvbG9yID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksCiAgICBtaW5fc2l6ZSA9IFZlY3RvcjIubmV3KDY3MCwgMTAwMCksCiAgICBjYW5fcmVzaXplID0gdHJ1ZSwKfSkKCi0tIE1haW4gVGFiCmxvY2FsIE1haW4gPSB3aW5kb3c6QWRkVGFiKCJNYWluIikKbG9jYWwgZmFybVBsdXNUYWIgPSB3aW5kb3c6QWRkVGFiKCJGYXJtIikKCk1haW46QWRkTGFiZWwoIkxvY2FsIFBsYXllciIpCgpsb2NhbCB3YWxrU3BlZWRWYWx1ZSA9IDE2Ck1haW46QWRkVGV4dEJveCgiV2Fsa1NwZWVkIiwgZnVuY3Rpb24odGV4dCkKICAgIGxvY2FsIHNwZWVkID0gdG9udW1iZXIodGV4dCkKICAgIGlmIHNwZWVkIGFuZCBzcGVlZCA+PSAxIGFuZCBzcGVlZCA8PSA1MDAgdGhlbgogICAgICAgIHdhbGtTcGVlZFZhbHVlID0gc3BlZWQKICAgIGVuZAplbmQpCgpsb2NhbCBzZXRTcGVlZCA9IGZhbHNlCk1haW46QWRkU3dpdGNoKCJTZXQgU3BlZWQiLCBmdW5jdGlvbihzdGF0ZSkKICAgIHNldFNwZWVkID0gc3RhdGUKICAgIHdoaWxlIHNldFNwZWVkIGRvCiAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5XYWxrU3BlZWQgPSB3YWxrU3BlZWRWYWx1ZQogICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICBlbmQKICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMTYKZW5kKQoKbG9jYWwganVtcFBvd2VyVmFsdWUgPSA1MApNYWluOkFkZFRleHRCb3goIkp1bXBQb3dlciIsIGZ1bmN0aW9uKHRleHQpCiAgICBsb2NhbCBqdW1wID0gdG9udW1iZXIodGV4dCkKICAgIGlmIGp1bXAgdGhlbgogICAgICAgIGp1bXBQb3dlclZhbHVlID0ganVtcAogICAgZW5kCmVuZCkKCmxvY2FsIGFwcGx5SnVtcFBvd2VyID0gZmFsc2UKTWFpbjpBZGRTd2l0Y2goIkFwcGx5IEp1bXBQb3dlciIsIGZ1bmN0aW9uKHN0YXRlKQogICAgYXBwbHlKdW1wUG93ZXIgPSBzdGF0ZQogICAgbG9jYWwgaHVtYW5vaWQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkCiAgICBodW1hbm9pZC5Vc2VKdW1wUG93ZXIgPSB0cnVlCiAgICBodW1hbm9pZC5KdW1wUG93ZXIgPSBhcHBseUp1bXBQb3dlciBhbmQganVtcFBvd2VyVmFsdWUgb3IgNTAKZW5kKQoKbG9jYWwgc2l6ZVZhbHVlID0gMQpNYWluOkFkZFRleHRCb3goIlNpemUiLCBmdW5jdGlvbih0ZXh0KQogICAgbG9jYWwgc2l6ZSA9IHRvbnVtYmVyKHRleHQpCiAgICBpZiBzaXplIGFuZCBzaXplID49IDEgYW5kIHNpemUgPD0gMTAwIHRoZW4KICAgICAgICBzaXplVmFsdWUgPSBzaXplCiAgICBlbmQKZW5kKQoKbG9jYWwgc2V0U2l6ZSA9IGZhbHNlCk1haW46QWRkU3dpdGNoKCJTZXQgU2l6ZXMiLCBmdW5jdGlvbihzdGF0ZSkKICAgIHNldFNpemUgPSBzdGF0ZQogICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGlmIGNoYXIgdGhlbgogICAgICAgIGxvY2FsIGh1bWFub2lkID0gY2hhcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikKICAgICAgICBpZiBodW1hbm9pZCB0aGVuCiAgICAgICAgICAgIGZvciBfLCBzY2FsZSBpbiBwYWlycyh7IkJvZHlEZXB0aFNjYWxlIiwgIkJvZHlIZWlnaHRTY2FsZSIsICJCb2R5V2lkdGhTY2FsZSIsICJIZWFkU2NhbGUifSkgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHNjYWxlSW5zdGFuY2UgPSBodW1hbm9pZDpGaW5kRmlyc3RDaGlsZChzY2FsZSkKICAgICAgICAgICAgICAgIGlmIHNjYWxlSW5zdGFuY2UgdGhlbgogICAgICAgICAgICAgICAgICAgIHNjYWxlSW5zdGFuY2UuVmFsdWUgPSBzdGF0ZSBhbmQgc2l6ZVZhbHVlIG9yIDEKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpsb2NhbCByZWJpcnRoVGFiID0gd2luZG93OkFkZFRhYigiT1AgRmFybSIpCgotLSBUYXJnZXQgcmViaXJ0aCBpbnB1dCAtIGRpcmVjdCB0ZXh0IGlucHV0CnJlYmlydGhUYWI6QWRkVGV4dEJveCgiUmViaXJ0aCBUYXJnZXQiLCBmdW5jdGlvbih0ZXh0KQogICAgbG9jYWwgbmV3VmFsdWUgPSB0b251bWJlcih0ZXh0KQogICAgaWYgbmV3VmFsdWUgYW5kIG5ld1ZhbHVlID4gMCB0aGVuCiAgICAgICAgdGFyZ2V0UmViaXJ0aFZhbHVlID0gbmV3VmFsdWUKICAgICAgICB1cGRhdGVTdGF0cygpIC0tIENhbGwgdGhlIHN0YXRzIHVwZGF0ZSBmdW5jdGlvbgogICAgICAgIAogICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgICAgIFRpdGxlID0gIlVwZGF0ZWQgT2JqZWN0aXZlIiwKICAgICAgICAgICAgVGV4dCA9ICJOZXcgZ29hbDogIiAuLiB0b3N0cmluZyh0YXJnZXRSZWJpcnRoVmFsdWUpIC4uICIgcmViaXJ0aCIsCiAgICAgICAgICAgIER1cmF0aW9uID0gMAogICAgICAgIH0pCiAgICBlbHNlCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICAgICAgVGl0bGUgPSAiSW52YWxpZCBFbnRyeSIsCiAgICAgICAgICAgIFRleHQgPSAiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyIiwKICAgICAgICAgICAgRHVyYXRpb24gPSAwCiAgICAgICAgfSkKICAgIGVuZAplbmQpCgotLSBDcmVhdGUgdG9nZ2xlIHN3aXRjaGVzCmxvY2FsIGluZmluaXRlU3dpdGNoIC0tIEZvcndhcmQgZGVjbGFyYXRpb24KCmxvY2FsIHRhcmdldFN3aXRjaCA9IHJlYmlydGhUYWI6QWRkU3dpdGNoKCJBdXRvIFJlYmlydGggVGFyZ2V0IiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLnRhcmdldFJlYmlydGhBY3RpdmUgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIC0tIFR1cm4gb2ZmIGluZmluaXRlIHJlYmlydGggaWYgaXQncyBvbgogICAgICAgIGlmIF9HLmluZmluaXRlUmViaXJ0aEFjdGl2ZSBhbmQgaW5maW5pdGVTd2l0Y2ggdGhlbgogICAgICAgICAgICBpbmZpbml0ZVN3aXRjaDpTZXQoZmFsc2UpCiAgICAgICAgICAgIF9HLmluZmluaXRlUmViaXJ0aEFjdGl2ZSA9IGZhbHNlCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgLS0gU3RhcnQgdGFyZ2V0IHJlYmlydGggbG9vcAogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cudGFyZ2V0UmViaXJ0aEFjdGl2ZSBhbmQgd2FpdCgwLjEpIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBjdXJyZW50UmViaXJ0aHMgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIubGVhZGVyc3RhdHMuUmViaXJ0aHMuVmFsdWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgY3VycmVudFJlYmlydGhzID49IHRhcmdldFJlYmlydGhWYWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0U3dpdGNoOlNldChmYWxzZSkKICAgICAgICAgICAgICAgICAgICBfRy50YXJnZXRSZWJpcnRoQWN0aXZlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgICAgICAgICAgICAgICAgICBUaXRsZSA9ICJHb2FsIEFjaGlldmVkISEiLAogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIllvdSBoYXZlIHJlYWNoZWQgIiAuLiB0b3N0cmluZyh0YXJnZXRSZWJpcnRoVmFsdWUpIC4uICIgcmViaXJ0aCIsCiAgICAgICAgICAgICAgICAgICAgICAgIER1cmF0aW9uID0gNQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5yZWJpcnRoUmVtb3RlOkludm9rZVNlcnZlcigicmViaXJ0aFJlcXVlc3QiKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kLCAiQXV0b21hdGljIHJlYmlydGggdW50aWwgdGhlIGdvYWwgaXMgcmVhY2hlZCIpCgotLSBGYXN0IFdlaWdodCB0b2dnbGUgd2l0aCBhdXRvLXdlaWdodCBmdW5jdGlvbmFsaXR5IGFuZCBwZXJzaXN0ZW50IGVxdWlwcGluZwpyZWJpcnRoVGFiOkFkZFN3aXRjaCgiQXV0byBXZWlnaHQiLCBmdW5jdGlvbihib29sKQogICAgX0cuRmFzdFdlaWdodCA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgLS0gQ29udGludW91c2x5IGVxdWlwIGFuZCBtb2RpZnkgd2VpZ2h0IHRvb2wKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkZhc3RXZWlnaHQgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSBDaGVjayBpZiB0b29sIGlzIG5vdCBlcXVpcHBlZAogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIGFuZCBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgd2VpZ2h0VG9vbCA9IHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikKICAgICAgICAgICAgICAgICAgICBpZiB3ZWlnaHRUb29sIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgd2VpZ2h0VG9vbDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlaWdodFRvb2wucmVwVGltZS5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wod2VpZ2h0VG9vbCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIC0tIE1ha2Ugc3VyZSBlcXVpcHBlZCB0b29sIGlzIG1vZGlmaWVkCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpCiAgICAgICAgICAgICAgICAgICAgaWYgZXF1aXBwZWQ6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGVxdWlwcGVkLnJlcFRpbWUuVmFsdWUgPSAwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICAtLSBBdXRvIGRvIHdlaWdodCBsaWZ0aW5nCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5GYXN0V2VpZ2h0IGRvCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVsc2UKICAgICAgICAtLSBVbmVxdWlwIGFuZCByZXNldCB0b29sCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKQogICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgaWYgZXF1aXBwZWQ6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICBlcXVpcHBlZC5yZXBUaW1lLlZhbHVlID0gMQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZXF1aXBwZWQuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgLS0gQWxzbyByZXNldCB0aGUgYmFja3BhY2sgdG9vbAogICAgICAgIGxvY2FsIGJhY2twYWNrVG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikKICAgICAgICBpZiBiYWNrcGFja1Rvb2wgYW5kIGJhY2twYWNrVG9vbDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgYmFja3BhY2tUb29sLnJlcFRpbWUuVmFsdWUgPSAxCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKbG9jYWwgc2l6ZVN3aXRjaCA9IHJlYmlydGhUYWI6QWRkU3dpdGNoKCJBdXRvIFNpemUgMSIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5hdXRvU2l6ZUFjdGl2ZSA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5hdXRvU2l6ZUFjdGl2ZSBhbmQgd2FpdCgpIGRvCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5jaGFuZ2VTcGVlZFNpemVSZW1vdGU6SW52b2tlU2VydmVyKCJjaGFuZ2VTaXplIiwgMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCwgIkF1dG8gU2V0IFNpemUgMSIpCgoKbG9jYWwgdGVsZXBvcnRTd2l0Y2ggPSByZWJpcnRoVGFiOkFkZFN3aXRjaCgiQXV0byBUZWxlcG9ydCB0byBNdXNjbGUgS2luZyIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy50ZWxlcG9ydEFjdGl2ZSA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy50ZWxlcG9ydEFjdGl2ZSBhbmQgd2FpdCgpIGRvCiAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOk1vdmVUbyhWZWN0b3IzLm5ldygtODY0NiwgMTcsIC01NzM4KSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kLCAiQ29udGludW91cyB0ZWxlcG9ydGF0aW9uIHRvIE11c2NsZSBLaW5nIikKCnJlYmlydGhUYWI6QWRkTGFiZWwoIi0tLVRNQiBPUCBTVFVGRi0tLSIpCgpsb2NhbCBmdW5jdGlvbiB1bmVxdWlwQWxsUGV0cygpCiAgICBsb2NhbCBwZXRzRm9sZGVyID0gcGxheWVyLnBldHNGb2xkZXIKICAgIGZvciBfLCBmb2xkZXIgaW4gcGFpcnMocGV0c0ZvbGRlcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIGZvbGRlcjpJc0EoIkZvbGRlciIpIHRoZW4KICAgICAgICAgICAgZm9yIF8sIHBldCBpbiBwYWlycyhmb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlLnJFdmVudHMuZXF1aXBQZXRFdmVudDpGaXJlU2VydmVyKCJ1bmVxdWlwUGV0IiwgcGV0KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgdGFzay53YWl0KDAuMSkKZW5kCgpsb2NhbCBmdW5jdGlvbiBlcXVpcFVuaXF1ZVBldChwZXROYW1lKQogICAgdW5lcXVpcEFsbFBldHMoKQogICAgdGFzay53YWl0KDAuMDEpCiAgICBmb3IgXywgcGV0IGluIHBhaXJzKHBsYXllci5wZXRzRm9sZGVyLlVuaXF1ZTpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIHBldC5OYW1lID09IHBldE5hbWUgdGhlbgogICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5yRXZlbnRzLmVxdWlwUGV0RXZlbnQ6RmlyZVNlcnZlcigiZXF1aXBQZXQiLCBwZXQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBmaW5kTWFjaGluZShtYWNoaW5lTmFtZSkKICAgIGxvY2FsIG1hY2hpbmUgPSB3b3Jrc3BhY2UubWFjaGluZXNGb2xkZXI6RmluZEZpcnN0Q2hpbGQobWFjaGluZU5hbWUpCiAgICBpZiBub3QgbWFjaGluZSB0aGVuCiAgICAgICAgZm9yIF8sIGZvbGRlciBpbiBwYWlycyh3b3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgZm9sZGVyOklzQSgiRm9sZGVyIikgYW5kIGZvbGRlci5OYW1lOmZpbmQoIm1hY2hpbmVzIikgdGhlbgogICAgICAgICAgICAgICAgbWFjaGluZSA9IGZvbGRlcjpGaW5kRmlyc3RDaGlsZChtYWNoaW5lTmFtZSkKICAgICAgICAgICAgICAgIGlmIG1hY2hpbmUgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBtYWNoaW5lCmVuZAoKbG9jYWwgZnVuY3Rpb24gcHJlc3NFKCkKICAgIGxvY2FsIHZpbSA9IGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpCiAgICB2aW06U2VuZEtleUV2ZW50KHRydWUsICJFIiwgZmFsc2UsIGdhbWUpCiAgICB0YXNrLndhaXQoMC4xKQogICAgdmltOlNlbmRLZXlFdmVudChmYWxzZSwgIkUiLCBmYWxzZSwgZ2FtZSkKZW5kCgpsb2NhbCBmdW5jdGlvbiB1c2VPbmVFZ2coKQogICAgUmVwbGljYXRlZFN0b3JhZ2UuckV2ZW50cy5wcm90ZWluRWdnRXZlbnQ6RmlyZVNlcnZlcigidXNlRWdnIikKZW5kCgpsb2NhbCBwYWNrRmFybSA9IHJlYmlydGhUYWI6QWRkU3dpdGNoKCJGYXN0IFJlYmlydGgiLCBmdW5jdGlvbihib29sKQogICAgaXNSdW5uaW5nID0gYm9vbAogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBpc1J1bm5pbmcgZG8KICAgICAgICAgICAgbG9jYWwgY3VycmVudFJlYmlydGhzID0gcGxheWVyLmxlYWRlcnN0YXRzLlJlYmlydGhzLlZhbHVlCiAgICAgICAgICAgIGxvY2FsIHJlYmlydGhDb3N0ID0gMTAwMDAgKyAoNTAwMCAqIGN1cnJlbnRSZWJpcnRocykKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHBsYXllci51bHRpbWF0ZXNGb2xkZXI6RmluZEZpcnN0Q2hpbGQoIkdvbGRlbiBSZWJpcnRoIikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgZ29sZGVuUmViaXJ0aHMgPSBwbGF5ZXIudWx0aW1hdGVzRm9sZGVyWyJHb2xkZW4gUmViaXJ0aCJdLlZhbHVlCiAgICAgICAgICAgICAgICByZWJpcnRoQ29zdCA9IG1hdGguZmxvb3IocmViaXJ0aENvc3QgKiAoMSAtIChnb2xkZW5SZWJpcnRocyAqIDAuMSkpKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdW5lcXVpcEFsbFBldHMoKQogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBlcXVpcFVuaXF1ZVBldCgiU3dpZnQgU2FtdXJhaSIpCiAgICAgICAgICAgIAogICAgICAgICAgICB3aGlsZSBpc1J1bm5pbmcgYW5kIHBsYXllci5sZWFkZXJzdGF0cy5TdHJlbmd0aC5WYWx1ZSA8IHJlYmlydGhDb3N0IGRvCiAgICAgICAgICAgICAgICBmb3IgaSA9IDEsIDEwIGRvCiAgICAgICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB1bmVxdWlwQWxsUGV0cygpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIGVxdWlwVW5pcXVlUGV0KCJUcmliYWwgT3ZlcmxvcmQiKQogICAgICAgICAgICBsb2NhbCBtYWNoaW5lID0gZmluZE1hY2hpbmUoIkp1bmdsZSBCYXIgTGlmdCIpCiAgICAgICAgICAgIGlmIG1hY2hpbmUgYW5kIG1hY2hpbmU6RmluZEZpcnN0Q2hpbGQoImludGVyYWN0U2VhdCIpIHRoZW4KICAgICAgICAgICAgICAgIHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBtYWNoaW5lLmludGVyYWN0U2VhdC5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDMsIDApCiAgICAgICAgICAgICAgICByZXBlYXQKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIHByZXNzRSgpCiAgICAgICAgICAgICAgICB1bnRpbCBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLlNpdAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgbG9jYWwgaW5pdGlhbFJlYmlydGhzID0gcGxheWVyLmxlYWRlcnN0YXRzLlJlYmlydGhzLlZhbHVlCiAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuckV2ZW50cy5yZWJpcnRoUmVtb3RlOkludm9rZVNlcnZlcigicmViaXJ0aFJlcXVlc3QiKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgdW50aWwgcGxheWVyLmxlYWRlcnN0YXRzLlJlYmlydGhzLlZhbHVlID4gaW5pdGlhbFJlYmlydGhzCiAgICAgICAgICAgIGlmIG5vdCBpc1J1bm5pbmcgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKbG9jYWwgc3BlZWRHcmluZCA9IHJlYmlydGhUYWI6QWRkU3dpdGNoKCJGYXN0IFN0cmVuZ3RoIiwgZnVuY3Rpb24oYm9vbCkKICAgIGxvY2FsIGlzR3JpbmRpbmcgPSBib29sCiAgICAKICAgIGlmIG5vdCBib29sIHRoZW4KICAgICAgICB1bmVxdWlwQWxsUGV0cygpCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIAogICAgZXF1aXBVbmlxdWVQZXQoIlN3aWZ0IFNhbXVyYWkiKQogICAgCiAgICBmb3IgaSA9IDEsIDEwIGRvCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIGlzR3JpbmRpbmcgZG8KICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCmxvY2FsIGZyYW1lVG9nZ2xlID0gcmViaXJ0aFRhYjpBZGRTd2l0Y2goIkhpZGUgRnJhbWVzIiwgZnVuY3Rpb24oYm9vbCkKICAgIGxvY2FsIHJTdG8gPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKICAgIGZvciBfLCBvYmogaW4gcGFpcnMoclN0bzpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIG9iai5OYW1lOm1hdGNoKCJGcmFtZSQiKSB0aGVuCiAgICAgICAgICAgIG9iai5WaXNpYmxlID0gbm90IGJvb2wKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpyZWJpcnRoVGFiOkFkZFN3aXRjaCgiSGlkZSBQZXRzIiwgZnVuY3Rpb24oU3RhdGUpCiAgICBpZiBTdGF0ZSB0aGVuCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMuc2hvd1BldHNFdmVudDpGaXJlU2VydmVyKCJoaWRlUGV0cyIpCiAgICBlbHNlCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMuc2hvd1BldHNFdmVudDpGaXJlU2VydmVyKCJzaG93UGV0cyIpCiAgICBlbmQKZW5kKQoKCi0tIEZyZWUgQXV0b0xpZnQgR2FtZXBhc3MgQnV0dG9uCmZhcm1QbHVzVGFiOkFkZEJ1dHRvbigiVW5sb2NrIEF1dG9MaWZ0IEdhbWVwYXNzIiwgZnVuY3Rpb24oKQogICAgbG9jYWwgZ2FtZXBhc3NGb2xkZXIgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuZ2FtZXBhc3NJZHMKICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICBmb3IgXywgZ2FtZXBhc3MgaW4gcGFpcnMoZ2FtZXBhc3NGb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBsb2NhbCB2YWx1ZSA9IEluc3RhbmNlLm5ldygiSW50VmFsdWUiKQogICAgICAgIHZhbHVlLk5hbWUgPSBnYW1lcGFzcy5OYW1lCiAgICAgICAgdmFsdWUuVmFsdWUgPSBnYW1lcGFzcy5WYWx1ZQogICAgICAgIHZhbHVlLlBhcmVudCA9IHBsYXllci5vd25lZEdhbWVwYXNzZXMKICAgIGVuZAplbmQsICJVbmxvY2sgdGhlIEF1dG9MaWZ0IEdhbWUgUGFzcyBmb3IgZnJlZSIpCmxvY2FsIGF1dG9FcXVpcFRvb2xzRm9sZGVyID0gZmFybVBsdXNUYWI6QWRkRm9sZGVyKCJBdXRvIEVxdWlwIFRvb2xzIikKCi0tIEF1dG8gV2VpZ2h0IFRvZ2dsZQphdXRvRXF1aXBUb29sc0ZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gV2VpZ2h0IiwgZnVuY3Rpb24oVmFsdWUpCiAgICBfRy5BdXRvV2VpZ2h0ID0gVmFsdWUKICAgIAogICAgaWYgVmFsdWUgdGhlbgogICAgICAgIGxvY2FsIHdlaWdodFRvb2wgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpCiAgICAgICAgaWYgd2VpZ2h0VG9vbCB0aGVuCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHdlaWdodFRvb2wpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKQogICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgZXF1aXBwZWQuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgX0cuQXV0b1dlaWdodCBkbwogICAgICAgICAgICBpZiBub3QgX0cuQXV0b1dlaWdodCB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgIGVuZAogICAgZW5kKQplbmQsICJEbyBsaWZ0aW5nIGF1dG9tYXRpY2FsbHkiKQoKLS0gQXV0byBQdXNodXBzIFRvZ2dsZQphdXRvRXF1aXBUb29sc0ZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gUHVzaHVwcyIsIGZ1bmN0aW9uKFZhbHVlKQogICAgX0cuQXV0b1B1c2h1cHMgPSBWYWx1ZQogICAgCiAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgbG9jYWwgcHVzaHVwc1Rvb2wgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1c2h1cHMiKQogICAgICAgIGlmIHB1c2h1cHNUb29sIHRoZW4KICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wocHVzaHVwc1Rvb2wpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdXNodXBzIikKICAgICAgICBpZiBlcXVpcHBlZCB0aGVuCiAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIF9HLkF1dG9QdXNodXBzIGRvCiAgICAgICAgICAgIGlmIG5vdCBfRy5BdXRvUHVzaHVwcyB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgIGVuZAogICAgZW5kKQplbmQsICJEbyBwdXNoLXVwcyBhdXRvbWF0aWNhbGx5IikKCi0tIEF1dG8gSGFuZHN0YW5kcyBUb2dnbGUKYXV0b0VxdWlwVG9vbHNGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIEhhbmRzdGFuZHMiLCBmdW5jdGlvbihWYWx1ZSkKICAgIF9HLkF1dG9IYW5kc3RhbmRzID0gVmFsdWUKICAgIAogICAgaWYgVmFsdWUgdGhlbgogICAgICAgIGxvY2FsIGhhbmRzdGFuZHNUb29sID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJIYW5kc3RhbmRzIikKICAgICAgICBpZiBoYW5kc3RhbmRzVG9vbCB0aGVuCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKGhhbmRzdGFuZHNUb29sKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGFuZHN0YW5kcyIpCiAgICAgICAgaWYgZXF1aXBwZWQgdGhlbgogICAgICAgICAgICBlcXVpcHBlZC5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBfRy5BdXRvSGFuZHN0YW5kcyBkbwogICAgICAgICAgICBpZiBub3QgX0cuQXV0b0hhbmRzdGFuZHMgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kLCAiRG8gaGFuZC1zdGFuZHMgYXV0b21hdGljYWxseSIpCgotLSBBdXRvIFNpdHVwcyBUb2dnbGUKYXV0b0VxdWlwVG9vbHNGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIFNpdHVwcyIsIGZ1bmN0aW9uKFZhbHVlKQogICAgX0cuQXV0b1NpdHVwcyA9IFZhbHVlCiAgICAKICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICBsb2NhbCBzaXR1cHNUb29sID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTaXR1cHMiKQogICAgICAgIGlmIHNpdHVwc1Rvb2wgdGhlbgogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChzaXR1cHNUb29sKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU2l0dXBzIikKICAgICAgICBpZiBlcXVpcHBlZCB0aGVuCiAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIF9HLkF1dG9TaXR1cHMgZG8KICAgICAgICAgICAgaWYgbm90IF9HLkF1dG9TaXR1cHMgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kLCAiRG8gc2l0LXVwcyBhdXRvbWF0aWNhbGx5IikKCi0tIEF1dG8gUHVuY2ggVG9nZ2xlCmF1dG9FcXVpcFRvb2xzRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBQdW5jaCIsIGZ1bmN0aW9uKFZhbHVlKQogICAgX0cuZmFzdEhpdEFjdGl2ZSA9IFZhbHVlCiAgICAKICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAtLSBGdW5jdGlvbiB0byBlcXVpcCBhbmQgbW9kaWZ5IHB1bmNoCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLmZhc3RIaXRBY3RpdmUgZG8KICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5mYXN0SGl0QWN0aXZlIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgcHVuY2ggPSBwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICAgICAgICAgIGlmIHB1bmNoIHRoZW4KICAgICAgICAgICAgICAgICAgICBwdW5jaC5QYXJlbnQgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgaWYgcHVuY2g6RmluZEZpcnN0Q2hpbGQoImF0dGFja1RpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHB1bmNoLmF0dGFja1RpbWUuVmFsdWUgPSAwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICAtLSBGdW5jdGlvbiBmb3IgcmFwaWQgcHVuY2hpbmcKICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuZmFzdEhpdEFjdGl2ZSBkbwogICAgICAgICAgICAgICAgaWYgbm90IF9HLmZhc3RIaXRBY3RpdmUgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBwbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAicmlnaHRIYW5kIikKICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJsZWZ0SGFuZCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGlmIGNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcHVuY2hUb29sID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgICAgICAgICAgICAgaWYgcHVuY2hUb29sIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcHVuY2hUb29sOkFjdGl2YXRlKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgdGFzay53YWl0KDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVsc2UKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICBpZiBlcXVpcHBlZCB0aGVuCiAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgIGVuZAogICAgZW5kCmVuZCwgIkhpdHMgYXV0b21hdGljYWxseSIpCgotLSBGYXN0IFRvb2xzIFRvZ2dsZQphdXRvRXF1aXBUb29sc0ZvbGRlcjpBZGRTd2l0Y2goIkZhc3QgVG9vbHMiLCBmdW5jdGlvbihWYWx1ZSkKICAgIF9HLkZhc3RUb29scyA9IFZhbHVlCiAgICAKICAgIGxvY2FsIGRlZmF1bHRTcGVlZHMgPSB7CiAgICAgICAgewogICAgICAgICAgICAiUHVuY2giLAogICAgICAgICAgICAiYXR0YWNrVGltZSIsCiAgICAgICAgICAgIFZhbHVlIGFuZCAwIG9yIDAuMzUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIkdyb3VuZCBTbGFtIiwKICAgICAgICAgICAgImF0dGFja1RpbWUiLAogICAgICAgICAgICBWYWx1ZSBhbmQgMCBvciA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJTdG9tcCIsCiAgICAgICAgICAgICJhdHRhY2tUaW1lIiwKICAgICAgICAgICAgVmFsdWUgYW5kIDAgb3IgNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiSGFuZHN0YW5kcyIsCiAgICAgICAgICAgICJyZXBUaW1lIiwKICAgICAgICAgICAgVmFsdWUgYW5kIDAgb3IgMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiUHVzaHVwcyIsCiAgICAgICAgICAgICJyZXBUaW1lIiwKICAgICAgICAgICAgVmFsdWUgYW5kIDAgb3IgMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiV2VpZ2h0IiwKICAgICAgICAgICAgInJlcFRpbWUiLAogICAgICAgICAgICBWYWx1ZSBhbmQgMCBvciAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJTaXR1cHMiLAogICAgICAgICAgICAicmVwVGltZSIsCiAgICAgICAgICAgIFZhbHVlIGFuZCAwIG9yIDEKICAgICAgICB9CiAgICB9CiAgICAKICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgbG9jYWwgYmFja3BhY2sgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJCYWNrcGFjayIpCiAgICAKICAgIGZvciBfLCB0b29sSW5mbyBpbiBpcGFpcnMoZGVmYXVsdFNwZWVkcykgZG8KICAgICAgICBsb2NhbCB0b29sID0gYmFja3BhY2s6RmluZEZpcnN0Q2hpbGQodG9vbEluZm9bMV0pCiAgICAgICAgaWYgdG9vbCBhbmQgdG9vbDpGaW5kRmlyc3RDaGlsZCh0b29sSW5mb1syXSkgdGhlbgogICAgICAgICAgICB0b29sW3Rvb2xJbmZvWzJdXS5WYWx1ZSA9IHRvb2xJbmZvWzNdCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgZXF1aXBwZWRUb29sID0gcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCh0b29sSW5mb1sxXSkKICAgICAgICBpZiBlcXVpcHBlZFRvb2wgYW5kIGVxdWlwcGVkVG9vbDpGaW5kRmlyc3RDaGlsZCh0b29sSW5mb1syXSkgdGhlbgogICAgICAgICAgICBlcXVpcHBlZFRvb2xbdG9vbEluZm9bMl1dLlZhbHVlID0gdG9vbEluZm9bM10KICAgICAgICBlbmQKICAgIGVuZAplbmQsICJBY2NlbGVyYXRlcyBhbGwgdG9vbHMiKQoKLS0gSW5pY2lhbGl6YXIgdmFyaWFibGVzIGRlIHNlZ3VpbWllbnRvCmxvY2FsIHNlc3Npb25TdGFydFRpbWUgPSBvcy50aW1lKCkKbG9jYWwgc2Vzc2lvblN0YXJ0U3RyZW5ndGggPSAwCmxvY2FsIHNlc3Npb25TdGFydER1cmFiaWxpdHkgPSAwCmxvY2FsIHNlc3Npb25TdGFydEtpbGxzID0gMApsb2NhbCBzZXNzaW9uU3RhcnRSZWJpcnRocyA9IDAKbG9jYWwgc2Vzc2lvblN0YXJ0QnJhd2xzID0gMApsb2NhbCBoYXNTdGFydGVkVHJhY2tpbmcgPSBmYWxzZQoKbG9jYWwganVuZ2xlR3ltRm9sZGVyID0gZmFybVBsdXNUYWI6QWRkRm9sZGVyKCJKdW5nbGUgR3ltIikKCi0tIENhY2hlIHNlcnZpY2VzIGZvciBmYXN0ZXIgYWNjZXNzCmxvY2FsIFZJTSA9IGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKCi0tIEhlbHBlciBmdW5jdGlvbnMgZm9yIEp1bmdsZSBHeW0KbG9jYWwgZnVuY3Rpb24gcHJlc3NFKCkKICAgIFZJTTpTZW5kS2V5RXZlbnQodHJ1ZSwgIkUiLCBmYWxzZSwgZ2FtZSkKICAgIHRhc2sud2FpdCgwLjEpCiAgICBWSU06U2VuZEtleUV2ZW50KGZhbHNlLCAiRSIsIGZhbHNlLCBnYW1lKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGF1dG9MaWZ0KCkKICAgIHdoaWxlIGdldGdlbnYoKS53b3JraW5nIGRvCiAgICAgICAgTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICB0YXNrLndhaXQoKSAtLSBNb3JlIGVmZmljaWVudCB0aGFuIHRhc2sud2FpdCgwKSBvciB0YXNrLndhaXQoc21hbGwgbnVtYmVyKQogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gdGVsZXBvcnRBbmRTdGFydChtYWNoaW5lTmFtZSwgcG9zaXRpb24pCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGlmIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgIGNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHBvc2l0aW9uCiAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICBwcmVzc0UoKQogICAgICAgIHRhc2suc3Bhd24oYXV0b0xpZnQpIC0tIFVzZSB0YXNrLnNwYXduIHRvIHByZXZlbnQgVUkgZnJlZXppbmcKICAgIGVuZAplbmQKCi0tIEp1bmdsZSBHeW0gQmVuY2ggUHJlc3MKanVuZ2xlR3ltRm9sZGVyOkFkZFN3aXRjaCgiSnVuZ2xlIEJlbmNoIFByZXNzIiwgZnVuY3Rpb24oYm9vbCkKICAgIGlmIGdldGdlbnYoKS53b3JraW5nIGFuZCBub3QgYm9vbCB0aGVuCiAgICAgICAgZ2V0Z2VudigpLndvcmtpbmcgPSBmYWxzZQogICAgICAgIHJldHVybgogICAgZW5kCiAgICAKICAgIGdldGdlbnYoKS53b3JraW5nID0gYm9vbAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgdGVsZXBvcnRBbmRTdGFydCgiQmVuY2ggUHJlc3MiLCBDRnJhbWUubmV3KC04MTczLCA2NCwgMTg5OCkpCiAgICBlbmQKZW5kKQoKLS0gSnVuZ2xlIEd5bSBTcXVhdApqdW5nbGVHeW1Gb2xkZXI6QWRkU3dpdGNoKCJKdW5nbGUgU3F1YXQiLCBmdW5jdGlvbihib29sKQogICAgaWYgZ2V0Z2VudigpLndvcmtpbmcgYW5kIG5vdCBib29sIHRoZW4KICAgICAgICBnZXRnZW52KCkud29ya2luZyA9IGZhbHNlCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIAogICAgZ2V0Z2VudigpLndvcmtpbmcgPSBib29sCiAgICBpZiBib29sIHRoZW4KICAgICAgICB0ZWxlcG9ydEFuZFN0YXJ0KCJTcXVhdCIsIENGcmFtZS5uZXcoLTgzNTIsIDM0LCAyODc4KSkKICAgIGVuZAplbmQpCgotLSBKdW5nbGUgR3ltIFB1bGwgVXAKanVuZ2xlR3ltRm9sZGVyOkFkZFN3aXRjaCgiSnVuZ2xlIFB1bGwgVXBzIiwgZnVuY3Rpb24oYm9vbCkKICAgIGlmIGdldGdlbnYoKS53b3JraW5nIGFuZCBub3QgYm9vbCB0aGVuCiAgICAgICAgZ2V0Z2VudigpLndvcmtpbmcgPSBmYWxzZQogICAgICAgIHJldHVybgogICAgZW5kCiAgICAKICAgIGdldGdlbnYoKS53b3JraW5nID0gYm9vbAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgdGVsZXBvcnRBbmRTdGFydCgiUHVsbCBVcCIsIENGcmFtZS5uZXcoLTg2NjYsIDM0LCAyMDcwKSkKICAgIGVuZAplbmQpCgotLSBKdW5nbGUgR3ltIEJvdWxkZXIKanVuZ2xlR3ltRm9sZGVyOkFkZFN3aXRjaCgiSnVuZ2xlIEJvdWxkZXIiLCBmdW5jdGlvbihib29sKQogICAgaWYgZ2V0Z2VudigpLndvcmtpbmcgYW5kIG5vdCBib29sIHRoZW4KICAgICAgICBnZXRnZW52KCkud29ya2luZyA9IGZhbHNlCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIAogICAgZ2V0Z2VudigpLndvcmtpbmcgPSBib29sCiAgICBpZiBib29sIHRoZW4KICAgICAgICB0ZWxlcG9ydEFuZFN0YXJ0KCJCb3VsZGVyIiwgQ0ZyYW1lLm5ldygtODYyMSwgMzQsIDI2ODQpKQogICAgZW5kCmVuZCkKCi0tIE5FVzogRmFybSBHeW1zIEZvbGRlcgpsb2NhbCBmYXJtR3ltc0ZvbGRlciA9IGZhcm1QbHVzVGFiOkFkZEZvbGRlcigiR3ltIFdvcmtvdXRzIikKCi0tIFdvcmtvdXQgcG9zaXRpb25zIGRhdGEKbG9jYWwgd29ya291dFBvc2l0aW9ucyA9IHsKICAgIFsiQmVuY2ggUHJlc3MiXSA9IHsKICAgICAgICBbIkV0ZXJuYWwgR3ltIl0gPSBDRnJhbWUubmV3KC03MTc2LjE5MTQxLCA0NS4zOTQxMDQsIC0xMTA2LjMxNDIxKSwKICAgICAgICBbIkxlZ2VuZCBHeW0iXSA9IENGcmFtZS5uZXcoNDExMS45MTc0OCwgMTAyMC40NjY3NCwgLTM3OTkuOTcyMTcpLAogICAgICAgIFsiTXVzY2xlIEtpbmcgR3ltIl0gPSBDRnJhbWUubmV3KC04NTkwLjA2MTUyLCA0Ni4wMTY3NDI3LCAtNjA0My4zNDcxNykKICAgIH0sCiAgICBbIlNxdWF0Il0gPSB7CiAgICAgICAgWyJFdGVybmFsIEd5bSJdID0gQ0ZyYW1lLm5ldygtNzE3Ni4xOTE0MSwgNDUuMzk0MTA0LCAtMTEwNi4zMTQyMSksCiAgICAgICAgWyJMZWdlbmQgR3ltIl0gPSBDRnJhbWUubmV3KDQzMDQuOTkwMjMsIDk4Ny44Mjk5NTYsIC00MTI0LjIzMzQpLAogICAgICAgIFsiTXVzY2xlIEtpbmcgR3ltIl0gPSBDRnJhbWUubmV3KC04OTQwLjEyNDAyLCAxMy4xNjQyMDg0LCAtNTY5OS4xMzQ3NykKICAgIH0sCiAgICBbIkRlYWRsaWZ0Il0gPSB7CiAgICAgICAgWyJFdGVybmFsIEd5bSJdID0gQ0ZyYW1lLm5ldygtNzE3Ni4xOTE0MSwgNDUuMzk0MTA0LCAtMTEwNi4zMTQyMSksCiAgICAgICAgWyJMZWdlbmQgR3ltIl0gPSBDRnJhbWUubmV3KDQzMDQuOTkwMjMsIDk4Ny44Mjk5NTYsIC00MTI0LjIzMzQpLAogICAgICAgIFsiTXVzY2xlIEtpbmcgR3ltIl0gPSBDRnJhbWUubmV3KC04OTQwLjEyNDAyLCAxMy4xNjQyMDg0LCAtNTY5OS4xMzQ3NykKICAgIH0sCiAgICBbIlB1bGwgVXAiXSA9IHsKICAgICAgICBbIkV0ZXJuYWwgR3ltIl0gPSBDRnJhbWUubmV3KC03MTc2LjE5MTQxLCA0NS4zOTQxMDQsIC0xMTA2LjMxNDIxKSwKICAgICAgICBbIkxlZ2VuZCBHeW0iXSA9IENGcmFtZS5uZXcoNDMwNC45OTAyMywgOTg3LjgyOTk1NiwgLTQxMjQuMjMzNCksCiAgICAgICAgWyJNdXNjbGUgS2luZyBHeW0iXSA9IENGcmFtZS5uZXcoLTg5NDAuMTI0MDIsIDEzLjE2NDIwODQsIC01Njk5LjEzNDc3KQogICAgfQp9CgotLSBXb3Jrb3V0IHR5cGVzCmxvY2FsIHdvcmtvdXRUeXBlcyA9IHsKICAgICJCZW5jaCBQcmVzcyIsCiAgICAiU3F1YXQiLAogICAgIkRlYWRsaWZ0IiwKICAgICJQdWxsIFVwIgp9CgotLSBHeW0gbG9jYXRpb25zIChvbmx5IHRoZSB0aHJlZSByZXF1ZXN0ZWQpCmxvY2FsIGd5bUxvY2F0aW9ucyA9IHsKICAgICJFdGVybmFsIEd5bSIsCiAgICAiTGVnZW5kIEd5bSIsCiAgICAiTXVzY2xlIEtpbmcgR3ltIgp9CgotLSBTcGFuaXNoIHRyYW5zbGF0aW9ucyBmb3Igd29ya291dCB0eXBlcwpsb2NhbCB3b3Jrb3V0VHJhbnNsYXRpb25zID0gewogICAgWyJCZW5jaCBQcmVzcyJdID0gIkJlbmNoIFByZXNzIiwKICAgIFsiU3F1YXQiXSA9ICJTcXVhdCIsCiAgICBbIkRlYWRsaWZ0Il0gPSAiRGVhZCBMaWZ0IiwKICAgIFsiUHVsbCBVcCJdID0gIlB1bGwgVXAiCn0KCi0tIFN0b3JlIHJlZmVyZW5jZXMgdG8gdG9nZ2xlIG9iamVjdHMKbG9jYWwgZ3ltVG9nZ2xlcyA9IHt9CgotLSBDcmVhdGUgZHJvcGRvd25zIGFuZCB0b2dnbGVzIGZvciBlYWNoIHdvcmtvdXQgdHlwZQpmb3IgXywgd29ya291dFR5cGUgaW4gaXBhaXJzKHdvcmtvdXRUeXBlcykgZG8KICAgIC0tIENyZWF0ZSBkcm9wZG93biBmb3IgZ3ltIHNlbGVjdGlvbgogICAgbG9jYWwgZHJvcGRvd25OYW1lID0gd29ya291dFR5cGUgLi4gIkd5bURyb3Bkb3duIgogICAgbG9jYWwgc3BhbmlzaFdvcmtvdXROYW1lID0gd29ya291dFRyYW5zbGF0aW9uc1t3b3Jrb3V0VHlwZV0KICAgIAogICAgLS0gQ3JlYXRlIHRoZSBkcm9wZG93biB3aXRoIHRoZSBjb3JyZWN0IGZvcm1hdAogICAgbG9jYWwgZHJvcGRvd24gPSBmYXJtR3ltc0ZvbGRlcjpBZGREcm9wZG93bihzcGFuaXNoV29ya291dE5hbWUgLi4gIiAtIEd5bSIsIGZ1bmN0aW9uKHNlbGVjdGVkKQogICAgICAgIF9HWyJzZWxlY3RlZCIgLi4gc3RyaW5nLmdzdWIod29ya291dFR5cGUsICIgIiwgIiIpIC4uICJHeW0iXSA9IHNlbGVjdGVkCiAgICBlbmQpCiAgICAKICAgIC0tIEFkZCBneW0gbG9jYXRpb25zIHRvIHRoZSBkcm9wZG93bgogICAgZm9yIF8sIGd5bU5hbWUgaW4gaXBhaXJzKGd5bUxvY2F0aW9ucykgZG8KICAgICAgICBkcm9wZG93bjpBZGQoZ3ltTmFtZSkKICAgIGVuZAogICAgCiAgICAtLSBDcmVhdGUgdG9nZ2xlIGZvciB3b3Jrb3V0CiAgICBsb2NhbCB0b2dnbGVOYW1lID0gd29ya291dFR5cGUgLi4gIkd5bVRvZ2dsZSIKICAgIGxvY2FsIHRvZ2dsZSA9IGZhcm1HeW1zRm9sZGVyOkFkZFN3aXRjaChzcGFuaXNoV29ya291dE5hbWUsIGZ1bmN0aW9uKGJvb2wpCiAgICAgICAgZ2V0Z2VudigpLndvcmtpbmdHeW0gPSBib29sCiAgICAgICAgZ2V0Z2VudigpLmN1cnJlbnRXb3Jrb3V0VHlwZSA9IHdvcmtvdXRUeXBlCiAgICAgICAgCiAgICAgICAgaWYgYm9vbCB0aGVuCiAgICAgICAgICAgIGxvY2FsIHNlbGVjdGVkR3ltID0gX0dbInNlbGVjdGVkIiAuLiBzdHJpbmcuZ3N1Yih3b3Jrb3V0VHlwZSwgIiAiLCAiIikgLi4gIkd5bSJdIG9yIGd5bUxvY2F0aW9uc1sxXQogICAgICAgICAgICAKICAgICAgICAgICAgLS0gTWFrZSBzdXJlIHdlIGhhdmUgYSB2YWxpZCBwb3NpdGlvbgogICAgICAgICAgICBpZiB3b3Jrb3V0UG9zaXRpb25zW3dvcmtvdXRUeXBlXSBhbmQgd29ya291dFBvc2l0aW9uc1t3b3Jrb3V0VHlwZV1bc2VsZWN0ZWRHeW1dIHRoZW4KICAgICAgICAgICAgICAgIC0tIFN0b3AgYW55IG90aGVyIHdvcmtvdXQgdGhhdCBtaWdodCBiZSBydW5uaW5nCiAgICAgICAgICAgICAgICBmb3Igb3RoZXJUeXBlLCBvdGhlclRvZ2dsZSBpbiBwYWlycyhneW1Ub2dnbGVzKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG90aGVyVHlwZSB+PSB3b3Jrb3V0VHlwZSBhbmQgb3RoZXJUb2dnbGUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBvdGhlclRvZ2dsZTpTZXQoZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gU3RhcnQgdGhlIHdvcmtvdXQKICAgICAgICAgICAgICAgIHRlbGVwb3J0QW5kU3RhcnQod29ya291dFR5cGUsIHdvcmtvdXRQb3NpdGlvbnNbd29ya291dFR5cGVdW3NlbGVjdGVkR3ltXSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgLS0gTm90aWZ5IHVzZXIgaWYgcG9zaXRpb24gaXMgbm90IGZvdW5kCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgICAgICAgICAgICAgIFRpdGxlID0gIkVycm9yIiwKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIlBvc2l0aW9uIG5vdCBmb3VuZCBmb3IgIiAuLiB3b3Jrb3V0VHlwZSAuLiAiIGluICIgLi4gc2VsZWN0ZWRHeW0sCiAgICAgICAgICAgICAgICAgICAgRHVyYXRpb24gPSA1CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKICAgIAogICAgLS0gU3RvcmUgcmVmZXJlbmNlIHRvIHRvZ2dsZQogICAgZ3ltVG9nZ2xlc1t3b3Jrb3V0VHlwZV0gPSB0b2dnbGUKZW5kCgpsb2NhbCBzdGF0cyA9IHdpbmRvdzpBZGRUYWIoIlN0YXRzIikKbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIGxlYWRlcnN0YXRzID0gcGxheWVyOldhaXRGb3JDaGlsZCgibGVhZGVyc3RhdHMiKQpsb2NhbCBzdHJlbmd0aFN0YXQgPSBsZWFkZXJzdGF0czpXYWl0Rm9yQ2hpbGQoIlN0cmVuZ3RoIikKbG9jYWwgcmViaXJ0aHNTdGF0ID0gbGVhZGVyc3RhdHM6V2FpdEZvckNoaWxkKCJSZWJpcnRocyIpCmxvY2FsIGR1cmFiaWxpdHlTdGF0ID0gcGxheWVyOldhaXRGb3JDaGlsZCgiRHVyYWJpbGl0eSIpCmxvY2FsIGtpbGxzU3RhdCA9IGxlYWRlcnN0YXRzOldhaXRGb3JDaGlsZCgiS2lsbHMiKQpsb2NhbCBhZ2lsaXR5U3RhdCA9IHBsYXllcjpXYWl0Rm9yQ2hpbGQoIkFnaWxpdHkiKQpsb2NhbCBldmlsS2FybWFTdGF0ID0gcGxheWVyOldhaXRGb3JDaGlsZCgiZXZpbEthcm1hIikKbG9jYWwgZ29vZEthcm1hU3RhdCA9IHBsYXllcjpXYWl0Rm9yQ2hpbGQoImdvb2RLYXJtYSIpCmxvY2FsIGJyYXdsc1N0YXQgPSBsZWFkZXJzdGF0czpXYWl0Rm9yQ2hpbGQoIkJyYXdscyIpCgpsb2NhbCBmdW5jdGlvbiBBYmJyZXZOdW1iZXIobnVtKQogICAgbG9jYWwgYWJicmV2ID0geyIiLCAiSyIsICJNIiwgIkIiLCAiVCIsICJRYSIsICJRaSJ9CiAgICBsb2NhbCBpID0gMQogICAgd2hpbGUgbnVtID49IDEwMDAgYW5kIGkgPCAjYWJicmV2IGRvCiAgICAgICAgbnVtID0gbnVtIC8gMTAwMAogICAgICAgIGkgPSBpICsgMQogICAgZW5kCiAgICByZXR1cm4gc3RyaW5nLmZvcm1hdCgiJS4yZiVzIiwgbnVtLCBhYmJyZXZbaV0pCmVuZAoKc3RhdHM6QWRkTGFiZWwoIuKPse+4jyBTZXNzaW9uIFN0YXRpc3RpY3MiKS5UZXh0U2l6ZSA9IDMwCmxvY2FsIHN0b3B3YXRjaExhYmVsID0gc3RhdHM6QWRkTGFiZWwoIlNlc3Npb24gVGltZTogMGQgMGggMG0gMHMiKQpzdG9wd2F0Y2hMYWJlbC5UZXh0U2l6ZSA9IDIwCgpsb2NhbCBjdXN0b21UaW1lckxhYmVsID0gc3RhdHM6QWRkTGFiZWwoIkN1c3RvbSBUaW1lcjogTm90IHN0YXJ0ZWQiKQpjdXN0b21UaW1lckxhYmVsLlRleHRTaXplID0gMjAKCmxvY2FsIGlzQ3VzdG9tUnVubmluZyA9IGZhbHNlCmxvY2FsIGN1c3RvbVN0YXJ0ID0gMApsb2NhbCBjdXN0b21FbGFwc2VkID0gMAoKc3RhdHM6QWRkQnV0dG9uKCJTdGFydC9TdG9wIEN1c3RvbSBUaW1lciIsIGZ1bmN0aW9uKCkKICAgIGlmIG5vdCBpc0N1c3RvbVJ1bm5pbmcgdGhlbgogICAgICAgIGlzQ3VzdG9tUnVubmluZyA9IHRydWUKICAgICAgICBjdXN0b21TdGFydCA9IHRpY2soKSAtIGN1c3RvbUVsYXBzZWQKICAgIGVsc2UKICAgICAgICBpc0N1c3RvbVJ1bm5pbmcgPSBmYWxzZQogICAgICAgIGN1c3RvbUVsYXBzZWQgPSB0aWNrKCkgLSBjdXN0b21TdGFydAogICAgZW5kCmVuZCkKCnN0YXRzOkFkZEJ1dHRvbigiUmVzZXQgQ3VzdG9tIFRpbWVyIiwgZnVuY3Rpb24oKQogICAgaXNDdXN0b21SdW5uaW5nID0gZmFsc2UKICAgIGN1c3RvbVN0YXJ0ID0gMAogICAgY3VzdG9tRWxhcHNlZCA9IDAKICAgIGN1c3RvbVRpbWVyTGFiZWwuVGV4dCA9ICJDdXN0b20gVGltZXI6IE5vdCBzdGFydGVkIgplbmQpCgpsb2NhbCByZXNldFNlc3Npb24gPSBmYWxzZQpzdGF0czpBZGRCdXR0b24oIlJlc2V0IFNlc3Npb24gU3RhdHMiLCBmdW5jdGlvbigpCiAgICByZXNldFNlc3Npb24gPSB0cnVlCmVuZCkKCnN0YXRzOkFkZExhYmVsKCItLS0tLS0tLS0tLS0tLS0tLS0iKS5UZXh0U2l6ZSA9IDE0CgpzdGF0czpBZGRMYWJlbCgiUHJvamVjdGVkIFN0YXRzIikuVGV4dFNpemUgPSAzMApsb2NhbCBwcm9qZWN0ZWRTdHJlbmd0aExhYmVsID0gc3RhdHM6QWRkTGFiZWwoIlN0cmVuZ3RoIFBhY2U6IC0iKQpwcm9qZWN0ZWRTdHJlbmd0aExhYmVsLlRleHRTaXplID0gMjAKbG9jYWwgcHJvamVjdGVkRHVyYWJpbGl0eUxhYmVsID0gc3RhdHM6QWRkTGFiZWwoIkR1cmFiaWxpdHkgUGFjZTogLSIpCnByb2plY3RlZER1cmFiaWxpdHlMYWJlbC5UZXh0U2l6ZSA9IDIwCmxvY2FsIHByb2plY3RlZFJlYmlydGhzTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiUmViaXJ0aCBQYWNlOiAtIikKcHJvamVjdGVkUmViaXJ0aHNMYWJlbC5UZXh0U2l6ZSA9IDIwCgpzdGF0czpBZGRMYWJlbCgiLS0tLS0tLS0tLS0tLS0tLS0tIikuVGV4dFNpemUgPSAxNAoKc3RhdHM6QWRkTGFiZWwoIkxlYWRlcmJvYXJkIFN0YXRzIikuVGV4dFNpemUgPSAzMApsb2NhbCBzdHJlbmd0aExhYmVsID0gc3RhdHM6QWRkTGFiZWwoIlN0cmVuZ3RoOiAtIikKc3RyZW5ndGhMYWJlbC5UZXh0U2l6ZSA9IDIwCmxvY2FsIHJlYmlydGhzTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiUmViaXJ0aHM6IC0iKQpyZWJpcnRoc0xhYmVsLlRleHRTaXplID0gMjAKbG9jYWwga2lsbHNMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJLaWxsczogLSIpCmtpbGxzTGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBicmF3bHNMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJCcmF3bHM6IC0iKQpicmF3bHNMYWJlbC5UZXh0U2l6ZSA9IDIwCgpzdGF0czpBZGRMYWJlbCgiLS0tLS0tLS0tLS0tLS0tLS0tIikuVGV4dFNpemUgPSAxNAoKc3RhdHM6QWRkTGFiZWwoIlBsYXllciBTdGF0cyIpLlRleHRTaXplID0gMzAKbG9jYWwgZ29vZEthcm1hTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiR29vZCBLYXJtYTogLSIpCmdvb2RLYXJtYUxhYmVsLlRleHRTaXplID0gMjAKbG9jYWwgZXZpbEthcm1hTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiRXZpbCBLYXJtYTogLSIpCmV2aWxLYXJtYUxhYmVsLlRleHRTaXplID0gMjAKbG9jYWwgZHVyYWJpbGl0eUxhYmVsID0gc3RhdHM6QWRkTGFiZWwoIkR1cmFiaWxpdHk6IC0iKQpkdXJhYmlsaXR5TGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBhZ2lsaXR5TGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiQWdpbGl0eTogLSIpCmFnaWxpdHlMYWJlbC5UZXh0U2l6ZSA9IDIwCgpsb2NhbCBzdGFydFRpbWUgPSB0aWNrKCkKbG9jYWwgaW5pdGlhbFN0cmVuZ3RoID0gc3RyZW5ndGhTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxEdXJhYmlsaXR5ID0gZHVyYWJpbGl0eVN0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbFJlYmlydGhzID0gcmViaXJ0aHNTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxLaWxscyA9IGtpbGxzU3RhdC5WYWx1ZQpsb2NhbCBpbml0aWFsQWdpbGl0eSA9IGFnaWxpdHlTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxFdmlsS2FybWEgPSBldmlsS2FybWFTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxHb29kS2FybWEgPSBnb29kS2FybWFTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxCcmF3bHMgPSBicmF3bHNTdGF0LlZhbHVlCgp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIGxvY2FsIGxhc3RVcGRhdGUgPSAwCiAgICB3aGlsZSB0YXNrLndhaXQoMC4yKSBkbwogICAgICAgIGxvY2FsIGVsYXBzZWRUaW1lID0gdGljaygpIC0gc3RhcnRUaW1lCiAgICAgICAgbG9jYWwgZGF5cyA9IG1hdGguZmxvb3IoZWxhcHNlZFRpbWUgLyAoMjQgKiAzNjAwKSkKICAgICAgICBsb2NhbCBob3VycyA9IG1hdGguZmxvb3IoKGVsYXBzZWRUaW1lICUgKDI0ICogMzYwMCkpIC8gMzYwMCkKICAgICAgICBsb2NhbCBtaW51dGVzID0gbWF0aC5mbG9vcigoZWxhcHNlZFRpbWUgJSAzNjAwKSAvIDYwKQogICAgICAgIGxvY2FsIHNlY29uZHMgPSBtYXRoLmZsb29yKGVsYXBzZWRUaW1lICUgNjApCiAgICAgICAgc3RvcHdhdGNoTGFiZWwuVGV4dCA9IHN0cmluZy5mb3JtYXQoIlNlc3Npb24gVGltZTogJWRkICVkaCAlZG0gJWRzIiwgZGF5cywgaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMpCgogICAgICAgIGlmIGlzQ3VzdG9tUnVubmluZyB0aGVuCiAgICAgICAgICAgIGN1c3RvbUVsYXBzZWQgPSB0aWNrKCkgLSBjdXN0b21TdGFydAogICAgICAgIGVuZAogICAgICAgIGlmIGN1c3RvbUVsYXBzZWQgPiAwIHRoZW4KICAgICAgICAgICAgbG9jYWwgZCA9IG1hdGguZmxvb3IoY3VzdG9tRWxhcHNlZCAvICgyNCAqIDM2MDApKQogICAgICAgICAgICBsb2NhbCBoID0gbWF0aC5mbG9vcigoY3VzdG9tRWxhcHNlZCAlICgyNCAqIDM2MDApKSAvIDM2MDApCiAgICAgICAgICAgIGxvY2FsIG0gPSBtYXRoLmZsb29yKChjdXN0b21FbGFwc2VkICUgMzYwMCkgLyA2MCkKICAgICAgICAgICAgbG9jYWwgcyA9IG1hdGguZmxvb3IoY3VzdG9tRWxhcHNlZCAlIDYwKQogICAgICAgICAgICBjdXN0b21UaW1lckxhYmVsLlRleHQgPSBzdHJpbmcuZm9ybWF0KCJDdXN0b20gVGltZXI6ICVkZCAlZGggJWRtICVkcyIsIGQsIGgsIG0sIHMpCiAgICAgICAgZW5kCgogICAgICAgIGlmIHJlc2V0U2Vzc2lvbiB0aGVuCiAgICAgICAgICAgIHN0YXJ0VGltZSA9IHRpY2soKQogICAgICAgICAgICBpbml0aWFsU3RyZW5ndGggPSBzdHJlbmd0aFN0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbER1cmFiaWxpdHkgPSBkdXJhYmlsaXR5U3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsUmViaXJ0aHMgPSByZWJpcnRoc1N0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbEtpbGxzID0ga2lsbHNTdGF0LlZhbHVlCiAgICAgICAgICAgIGluaXRpYWxBZ2lsaXR5ID0gYWdpbGl0eVN0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbEV2aWxLYXJtYSA9IGV2aWxLYXJtYVN0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbEdvb2RLYXJtYSA9IGdvb2RLYXJtYVN0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbEJyYXdscyA9IGJyYXdsc1N0YXQuVmFsdWUKICAgICAgICAgICAgcmVzZXRTZXNzaW9uID0gZmFsc2UKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgY1N0ciA9IHN0cmVuZ3RoU3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNSZWIgPSByZWJpcnRoc1N0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjRHVyID0gZHVyYWJpbGl0eVN0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjS2lsbHMgPSBraWxsc1N0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjQWdpID0gYWdpbGl0eVN0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjRXZpbCA9IGV2aWxLYXJtYVN0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjR29vZCA9IGdvb2RLYXJtYVN0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjQnJhd2wgPSBicmF3bHNTdGF0LlZhbHVlCgogICAgICAgIGxvY2FsIGRTdHIgPSBjU3RyIC0gaW5pdGlhbFN0cmVuZ3RoCiAgICAgICAgbG9jYWwgZER1ciA9IGNEdXIgLSBpbml0aWFsRHVyYWJpbGl0eQogICAgICAgIGxvY2FsIGRSZWIgPSBjUmViIC0gaW5pdGlhbFJlYmlydGhzCiAgICAgICAgbG9jYWwgZEtpbGxzID0gY0tpbGxzIC0gaW5pdGlhbEtpbGxzCiAgICAgICAgbG9jYWwgZEFnaSA9IGNBZ2kgLSBpbml0aWFsQWdpbGl0eQogICAgICAgIGxvY2FsIGRFdmlsID0gY0V2aWwgLSBpbml0aWFsRXZpbEthcm1hCiAgICAgICAgbG9jYWwgZEdvb2QgPSBjR29vZCAtIGluaXRpYWxHb29kS2FybWEKICAgICAgICBsb2NhbCBkQnJhd2wgPSBjQnJhd2wgLSBpbml0aWFsQnJhd2xzCgogICAgICAgIHN0cmVuZ3RoTGFiZWwuVGV4dCA9ICJTdHJlbmd0aDogIiAuLiBBYmJyZXZOdW1iZXIoY1N0cikgLi4gIiB8ICsiIC4uIEFiYnJldk51bWJlcihkU3RyKQogICAgICAgIHJlYmlydGhzTGFiZWwuVGV4dCA9ICJSZWJpcnRoczogIiAuLiBBYmJyZXZOdW1iZXIoY1JlYikgLi4gIiB8ICsiIC4uIEFiYnJldk51bWJlcihkUmViKQogICAgICAgIGtpbGxzTGFiZWwuVGV4dCA9ICJLaWxsczogIiAuLiBBYmJyZXZOdW1iZXIoY0tpbGxzKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRLaWxscykKICAgICAgICBicmF3bHNMYWJlbC5UZXh0ID0gIkJyYXdsczogIiAuLiBBYmJyZXZOdW1iZXIoY0JyYXdsKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRCcmF3bCkKCiAgICAgICAgZ29vZEthcm1hTGFiZWwuVGV4dCA9ICJHb29kIEthcm1hOiAiIC4uIEFiYnJldk51bWJlcihjR29vZCkgLi4gIiB8ICsiIC4uIEFiYnJldk51bWJlcihkR29vZCkKICAgICAgICBldmlsS2FybWFMYWJlbC5UZXh0ID0gIkV2aWwgS2FybWE6ICIgLi4gQWJicmV2TnVtYmVyKGNFdmlsKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRFdmlsKQogICAgICAgIGR1cmFiaWxpdHlMYWJlbC5UZXh0ID0gIkR1cmFiaWxpdHk6ICIgLi4gQWJicmV2TnVtYmVyKGNEdXIpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZER1cikKICAgICAgICBhZ2lsaXR5TGFiZWwuVGV4dCA9ICJBZ2lsaXR5OiAiIC4uIEFiYnJldk51bWJlcihjQWdpKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRBZ2kpCgogICAgICAgIGlmIHRpY2soKSAtIGxhc3RVcGRhdGUgPj0gNiB0aGVuCiAgICAgICAgICAgIGxhc3RVcGRhdGUgPSB0aWNrKCkKICAgICAgICAgICAgbG9jYWwgc1NlYyA9IGRTdHIgLyBlbGFwc2VkVGltZQogICAgICAgICAgICBsb2NhbCBkU2VjID0gZER1ciAvIGVsYXBzZWRUaW1lCiAgICAgICAgICAgIGxvY2FsIHJTZWMgPSBkUmViIC8gZWxhcHNlZFRpbWUKCiAgICAgICAgICAgIGxvY2FsIGggPSAzNjAwCiAgICAgICAgICAgIGxvY2FsIGQgPSA4NjQwMAoKICAgICAgICAgICAgcHJvamVjdGVkU3RyZW5ndGhMYWJlbC5UZXh0ID0gIlN0cmVuZ3RoIFBhY2U6ICIgLi4gQWJicmV2TnVtYmVyKG1hdGguZmxvb3Ioc1NlYyAqIGgpKSAuLiAiL2ggfCAiIC4uIEFiYnJldk51bWJlcihtYXRoLmZsb29yKHNTZWMgKiBkKSkgLi4gIi9kIgogICAgICAgICAgICBwcm9qZWN0ZWREdXJhYmlsaXR5TGFiZWwuVGV4dCA9ICJEdXJhYmlsaXR5IFBhY2U6ICIgLi4gQWJicmV2TnVtYmVyKG1hdGguZmxvb3IoZFNlYyAqIGgpKSAuLiAiL2ggfCAiIC4uIEFiYnJldk51bWJlcihtYXRoLmZsb29yKGRTZWMgKiBkKSkgLi4gIi9kIgogICAgICAgICAgICBwcm9qZWN0ZWRSZWJpcnRoc0xhYmVsLlRleHQgPSAiUmViaXJ0aCBQYWNlOiAiIC4uIEFiYnJldk51bWJlcihtYXRoLmZsb29yKHJTZWMgKiBoKSkgLi4gIi9oIHwgIiAuLiBBYmJyZXZOdW1iZXIobWF0aC5mbG9vcihyU2VjICogZCkpIC4uICIvZCIKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpsb2NhbCBlc3RhZGlzdGljYXMgPSB3aW5kb3c6QWRkVGFiKCJTcGVjcyIpCgpsb2NhbCBTZWxlY3RQbGF5ZXJOYW1lID0gIiIKCmxvY2FsIFBsYXllckRyb3AgPSBlc3RhZGlzdGljYXM6QWRkRHJvcGRvd24oIlNlbGVjdCBQbGF5ZXIiLCBmdW5jdGlvbihWYWx1ZSkKICAgIFNlbGVjdFBsYXllck5hbWUgPSBWYWx1ZTptYXRjaCgifCAoLispIikKICAgIHByZXZpb3VzVmFsdWVzID0ge30KZW5kKQoKbG9jYWwgUGxheWVyc2xpc3QgPSB7fQpmb3IgXywgUGxyIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpOkdldFBsYXllcnMoKSkgZG8KICAgIGxvY2FsIGRpc3BsYXlOYW1lID0gUGxyLkRpc3BsYXlOYW1lIC4uICIgfCAiIC4uIFBsci5OYW1lCiAgICB0YWJsZS5pbnNlcnQoUGxheWVyc2xpc3QsIGRpc3BsYXlOYW1lKQplbmQKZm9yIF8sIEFkZFBsciBpbiBpcGFpcnMoUGxheWVyc2xpc3QpIGRvCiAgICBQbGF5ZXJEcm9wOkFkZChBZGRQbHIpCmVuZAoKbG9jYWwgZnVuY3Rpb24gRm9ybWF0TnVtYmVyV2l0aENvbW1hcyhudW1iZXIpCiAgICBsb2NhbCBmb3JtYXR0ZWQgPSB0b3N0cmluZyhudW1iZXIpOnJldmVyc2UoKTpnc3ViKCIoJWQlZCVkKSIsICIlMSwiKTpyZXZlcnNlKCkKICAgIHJldHVybiBmb3JtYXR0ZWQ6Z3N1YigiXiwiLCAiIikKZW5kCgpsb2NhbCBmdW5jdGlvbiBGb3JtYXRBYmJyZXZpYXRlZChudW1iZXIpCiAgICBsb2NhbCBhYmJyZXZpYXRpb25zID0geyIiLCAiSyIsICJNIiwgIkIiLCAiVCIsICJRYSIsICJRaSJ9CiAgICBsb2NhbCBhYmJyZXZpYXRpb25JbmRleCA9IDEKICAgIHdoaWxlIG51bWJlciA+PSAxMDAwIGRvCiAgICAgICAgbnVtYmVyID0gbnVtYmVyIC8gMTAwMAogICAgICAgIGFiYnJldmlhdGlvbkluZGV4ID0gYWJicmV2aWF0aW9uSW5kZXggKyAxCiAgICBlbmQKICAgIHJldHVybiBzdHJpbmcuZm9ybWF0KCIlLjJmIiwgbnVtYmVyKSAuLiBhYmJyZXZpYXRpb25zW2FiYnJldmlhdGlvbkluZGV4XQplbmQKCmxvY2FsIGZ1bmN0aW9uIEZvcm1hdERpc3BsYXkodmFsdWUpCiAgICBsb2NhbCBub3JtYWwgPSBGb3JtYXROdW1iZXJXaXRoQ29tbWFzKHZhbHVlKQogICAgbG9jYWwgYWJicmV2aWF0ZWQgPSBGb3JtYXRBYmJyZXZpYXRlZCh2YWx1ZSkKICAgIHJldHVybiAiWyAiIC4uIG5vcm1hbCAuLiAiIHwgIiAuLiBhYmJyZXZpYXRlZCAuLiAiIF0iCmVuZAoKbG9jYWwgcHJldmlvdXNWYWx1ZXMgPSB7fQoKbG9jYWwgVXBkYXRlID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUxID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUyID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUzID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGU0ID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGU1ID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGU2ID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGU5ID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUxMCA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMTEgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTEyID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUxMyA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDApIGRvCiAgICAgICAgaWYgU2VsZWN0UGxheWVyTmFtZSB+PSAiIiB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVyczpGaW5kRmlyc3RDaGlsZChTZWxlY3RQbGF5ZXJOYW1lKQogICAgICAgICAgICBpZiBwbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJHZW1zIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTEuVGV4dCA9ICJHZW1zOiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLkdlbXMuVmFsdWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQWdpbGl0eSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGUzLlRleHQgPSAiQWdpbGl0eTogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5BZ2lsaXR5LlZhbHVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkR1cmFiaWxpdHkiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlNC5UZXh0ID0gIkR1cmFiaWxpdHk6ICIgLi4gRm9ybWF0RGlzcGxheShwbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJtdXNjbGVLaW5nVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGU2LlRleHQgPSAiTXVzY2xlIEtpbmcgVGltZTogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5tdXNjbGVLaW5nVGltZS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJjdXN0b21TaXplIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTEwLlRleHQgPSAiQ3VzdG9tIFNpemU6ICIgLi4gRm9ybWF0RGlzcGxheShwbGF5ZXIuY3VzdG9tU2l6ZS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJjdXN0b21TcGVlZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGUxMS5UZXh0ID0gIkN1c3RvbSBTcGVlZDogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5jdXN0b21TcGVlZC5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJldmlsS2FybWEiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlMTIuVGV4dCA9ICJFdmlsIEthcm1hOiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLmV2aWxLYXJtYS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJnb29kS2FybWEiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlMTMuVGV4dCA9ICJHb29kIEthcm1hOiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLmdvb2RLYXJtYS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIGxlYWRlcnN0YXRzID0gcGxheWVyOkZpbmRGaXJzdENoaWxkKCJsZWFkZXJzdGF0cyIpCiAgICAgICAgICAgICAgICBpZiBsZWFkZXJzdGF0cyB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbGVhZGVyc3RhdHM6RmluZEZpcnN0Q2hpbGQoIlN0cmVuZ3RoIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGUuVGV4dCA9ICJTdHJlbmd0aDogIiAuLiBGb3JtYXREaXNwbGF5KGxlYWRlcnN0YXRzLlN0cmVuZ3RoLlZhbHVlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGxlYWRlcnN0YXRzOkZpbmRGaXJzdENoaWxkKCJSZWJpcnRocyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlMi5UZXh0ID0gIlJlYmlydGg6ICIgLi4gRm9ybWF0RGlzcGxheShsZWFkZXJzdGF0cy5SZWJpcnRocy5WYWx1ZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBsZWFkZXJzdGF0czpGaW5kRmlyc3RDaGlsZCgiS2lsbHMiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFVwZGF0ZTUuVGV4dCA9ICJLaWxsczogIiAuLiBGb3JtYXREaXNwbGF5KGxlYWRlcnN0YXRzLktpbGxzLlZhbHVlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJjdXJyZW50TWFwIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTkuVGV4dCA9ICJDdXJyZW50IE1hcDogIiAuLiB0b3N0cmluZyhwbGF5ZXIuY3VycmVudE1hcC5WYWx1ZSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBVcGRhdGU5LlRleHQgPSAiQ3VycmVudCBNYXA6IEF1Y3VuZSBkb25uw4PGksOG4oCZw4PigKDDouKCrOKEosODxpLDouKCrMWhw4PigJrDgsKpZSIKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpsb2NhbCBwZXRzID0gd2luZG93OkFkZFRhYiggICAgICAgIlBldCBTaG9wIikKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKCi0tIENyeXN0YWwgZGF0YSBzdHJ1Y3R1cmUgd2l0aCBleGFjdCBuYW1lcyBmcm9tIHlvdXIgb3JpZ2luYWwgY29kZQpsb2NhbCBjcnlzdGFsRGF0YSA9IHsKICAgIFsiQmx1ZSBDcnlzdGFsIl0gPSB7CiAgICAgICAge25hbWUgPSAiQmx1ZSBCaXJkaWUiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJPcmFuZ2UgSGVkZ2Vob2ciLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJCbHVlIEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJSZWQgS2l0dHkiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJEYXJrIFZhbXB5IiwgcmFyaXR5ID0gIkFkdmFuY2VkIn0sCiAgICAgICAge25hbWUgPSAiQmx1ZSBCdW5ueSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIlJlZCBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiQmx1ZSBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiR3JlZW4gQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIlB1cnBsZSBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiUmVkIEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJZZWxsb3cgQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9CiAgICB9LAogICAgWyJHcmVlbiBDcnlzdGFsIl0gPSB7CiAgICAgICAge25hbWUgPSAiU2lsdmVyIERvZyIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIkdyZWVuIEF1cmEiLCByYXJpdHkgPSAiQWR2YW5jZWQifSwKICAgICAgICB7bmFtZSA9ICJEYXJrIEdvbGVtIiwgcmFyaXR5ID0gIkFkdmFuY2VkIn0sCiAgICAgICAge25hbWUgPSAiR3JlZW4gQnV0dGVyZmx5IiwgcmFyaXR5ID0gIkFkdmFuY2VkIn0sCiAgICAgICAge25hbWUgPSAiQ3JpbXNvbiBGYWxjb24iLCByYXJpdHkgPSAiUmFyZSJ9LAogICAgICAgIHtuYW1lID0gIlJlZCBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiQmx1ZSBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiR3JlZW4gQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9LAogICAgICAgIHtuYW1lID0gIlB1cnBsZSBBdXJhIiwgcmFyaXR5ID0gIkJhc2ljIn0sCiAgICAgICAge25hbWUgPSAiUmVkIEF1cmEiLCByYXJpdHkgPSAiQmFzaWMifSwKICAgICAgICB7bmFtZSA9ICJZZWxsb3cgQXVyYSIsIHJhcml0eSA9ICJCYXNpYyJ9CiAgICB9LAogICAgWyJGcm9zdCBDcnlzdGFsIl0gPSB7CiAgICAgICAge25hbWUgPSAiWWVsbG93IEJ1dHRlcmZseSIsIHJhcml0eSA9ICJBZHZhbmNlZCJ9LAogICAgICAgIHtuYW1lID0gIlB1cnBsZSBEcmFnb24iLCByYXJpdHkgPSAiUmFyZSJ9LAogICAgICAgIHtuYW1lID0gIkJsdWUgUGhlb25peCIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiT3JhbmdlIFBlZ2FzdXMiLCByYXJpdHkgPSAiUmFyZSJ9LAogICAgICAgIHtuYW1lID0gIkxpZ2h0bmluZyIsIHJhcml0eSA9ICJSYXJlIn0sCiAgICAgICAge25hbWUgPSAiRWxlY3RybyIsIHJhcml0eSA9ICJBZHZhbmNlZCJ9CiAgICB9LAogICAgWyJNeXRoaWNhbCBDcnlzdGFsIl0gPSB7CiAgICAgICAge25hbWUgPSAiUHVycGxlIEZhbGNvbiIsIHJhcml0eSA9ICJSYXJlIn0sCiAgICAgICAge25hbWUgPSAiUmVkIERyYWdvbiIsIHJhcml0eSA9ICJSYXJlIn0sCiAgICAgICAge25hbWUgPSAiQmx1ZSBGaXJlY2FzdGVyIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJHb2xkZW4gUGhlb25peCIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiUG93ZXIgTGlnaHRuaW5nIiwgcmFyaXR5ID0gIlJhcmUifSwKICAgICAgICB7bmFtZSA9ICJEYXJrIExpZ2h0bmluZyIsIHJhcml0eSA9ICJFcGljIn0KICAgIH0sCiAgICBbIkluZmVybm8gQ3J5c3RhbCJdID0gewogICAgICAgIHtuYW1lID0gIlJlZCBGaXJlY2FzdGVyIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJJbmZlcm5hbCBEcmFnb24iLCByYXJpdHkgPSAiVW5pcXVlIn0sCiAgICAgICAge25hbWUgPSAiV2hpdGUgUGVnYXN1cyIsIHJhcml0eSA9ICJSYXJlIn0sCiAgICAgICAge25hbWUgPSAiR29sZGVuIFBoZW9uaXgiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIkluZmVybm8iLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIkRhcmsgU3Rvcm0iLCByYXJpdHkgPSAiVW5pcXVlIn0KICAgIH0sCiAgICBbIkxlZ2VuZHMgQ3J5c3RhbCJdID0gewogICAgICAgIHtuYW1lID0gIlVsdHJhIEJpcmRpZSIsIHJhcml0eSA9ICJVbmlxdWUifSwKICAgICAgICB7bmFtZSA9ICJNYWdpYyBCdXR0ZXJmbHkiLCByYXJpdHkgPSAiVW5pcXVlIn0sCiAgICAgICAge25hbWUgPSAiR3JlZW4gRmlyZWNhc3RlciIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiV2hpdGUgUGhlb25peCIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiU3VwZXJub3ZhIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJQdXJwbGUgTm92YSIsIHJhcml0eSA9ICJVbmlxdWUifQogICAgfSwKICAgIFsiTXVzY2xlIEVsaXRlIENyeXN0YWwiXSA9IHsKICAgICAgICB7bmFtZSA9ICJGcm9zdHdhdmUgTGVnZW5kcyBQZW5ndWluIiwgcmFyaXR5ID0gIlJhcmUifSwKICAgICAgICB7bmFtZSA9ICJQaGFudG9tIEdlbmVzaXMgRHJhZ29uIiwgcmFyaXR5ID0gIlJhcmUifSwKICAgICAgICB7bmFtZSA9ICJEYXJrIExlZ2VuZHMgTWFudGljb3JlIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJVbHRpbWF0ZSBTdXBlcm5vdmEgUGVnYXN1cyIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiQWV0aGVyIFNwaXJpdCBCdW5ueSIsIHJhcml0eSA9ICJVbmlxdWUifSwKICAgICAgICB7bmFtZSA9ICJDeWJlcm5ldGljIFNob3dkb3duIERyYWdvbiIsIHJhcml0eSA9ICJVbmlxdWUifQogICAgfSwKICAgIFsiR2FsYXh5IE9yYWNsZSBDcnlzdGFsIl0gPSB7CiAgICAgICAge25hbWUgPSAiRXRlcm5hbCBTdHJpa2UgTGV2aWF0aGFuIiwgcmFyaXR5ID0gIlJhcmUifSwKICAgICAgICB7bmFtZSA9ICJMaWdodG5pbmcgU3RyaWtlIFBoYW50b20iLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIkRhcmtzdGFyIEh1bnRlciIsIHJhcml0eSA9ICJVbmlxdWUifSwKICAgICAgICB7bmFtZSA9ICJNdXNjbGUgS2luZyIsIHJhcml0eSA9ICJVbmlxdWUifSwKICAgICAgICB7bmFtZSA9ICJBenVyZSBUdW5kcmEiLCByYXJpdHkgPSAiRXBpYyJ9LAogICAgICAgIHtuYW1lID0gIlVsdHJhIEluZmVybm8iLCByYXJpdHkgPSAiUmFyZSJ9CiAgICB9LAogICAgWyJKdW5nbGUgQ3J5c3RhbCJdID0gewogICAgICAgIHtuYW1lID0gIkVudHJvcGljIEJsYXN0IiwgcmFyaXR5ID0gIlVuaXF1ZSJ9LAogICAgICAgIHtuYW1lID0gIk11c2NsZSBTZW5zZWkiLCByYXJpdHkgPSAiVW5pcXVlIn0sCiAgICAgICAge25hbWUgPSAiR3JhbmQgU3VwZXJub3ZhIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJOZW9uIEd1YXJkaWFuIiwgcmFyaXR5ID0gIlVuaXF1ZSJ9LAogICAgICAgIHtuYW1lID0gIkV0ZXJuYWwgTWVnYXN0cmlrZSIsIHJhcml0eSA9ICJVbmlxdWUifSwKICAgICAgICB7bmFtZSA9ICJHb2xkZW4gVmlraW5nIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJBc3RyYWwgRWxlY3RybyIsIHJhcml0eSA9ICJFcGljIn0sCiAgICAgICAge25hbWUgPSAiRGFyayBFbGVjdHJvIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJFbmNoYW50ZWQgTWlyYWdlIiwgcmFyaXR5ID0gIkVwaWMifSwKICAgICAgICB7bmFtZSA9ICJVbHRyYSBNaXJhZ2UiLCByYXJpdHkgPSAiVW5pcXVlIn0sCiAgICAgICAge25hbWUgPSAiVW5zdGFibGUgTWlyYWdlIiwgcmFyaXR5ID0gIlVuaXF1ZSJ9CiAgICB9Cn0KCi0tIEZ1bmN0aW9uIHRvIGNvbGxlY3QgYWxsIHVuaXF1ZSBwZXRzIGFuZCBhdXJhcwpsb2NhbCBmdW5jdGlvbiBnZXRBbGxQZXRzQW5kQXVyYXMoKQogICAgbG9jYWwgYWxsUGV0cyA9IHt9CiAgICBsb2NhbCBhbGxBdXJhcyA9IHt9CiAgICAKICAgIGZvciBjcnlzdGFsTmFtZSwgcGV0cyBpbiBwYWlycyhjcnlzdGFsRGF0YSkgZG8KICAgICAgICBmb3IgXywgcGV0IGluIGlwYWlycyhwZXRzKSBkbwogICAgICAgICAgICBpZiBzdHJpbmcuZmluZChwZXQubmFtZSwgIkF1cmEiKSB0aGVuCiAgICAgICAgICAgICAgICBpZiBub3QgYWxsQXVyYXNbcGV0Lm5hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICBhbGxBdXJhc1twZXQubmFtZV0gPSB7bmFtZSA9IHBldC5uYW1lLCByYXJpdHkgPSBwZXQucmFyaXR5LCBjcnlzdGFsID0gY3J5c3RhbE5hbWV9CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWYgbm90IGFsbFBldHNbcGV0Lm5hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICBhbGxQZXRzW3BldC5uYW1lXSA9IHtuYW1lID0gcGV0Lm5hbWUsIHJhcml0eSA9IHBldC5yYXJpdHksIGNyeXN0YWwgPSBjcnlzdGFsTmFtZX0KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICByZXR1cm4gYWxsUGV0cywgYWxsQXVyYXMKZW5kCgotLSBGdW5jdGlvbiB0byBmaW5kIHdoaWNoIGNyeXN0YWwgY29udGFpbnMgYSBzcGVjaWZpYyBwZXQvYXVyYQpsb2NhbCBmdW5jdGlvbiBmaW5kQ3J5c3RhbEZvckl0ZW0oaXRlbU5hbWUpCiAgICBmb3IgY3J5c3RhbE5hbWUsIHBldHMgaW4gcGFpcnMoY3J5c3RhbERhdGEpIGRvCiAgICAgICAgZm9yIF8sIHBldCBpbiBpcGFpcnMocGV0cykgZG8KICAgICAgICAgICAgaWYgcGV0Lm5hbWUgPT0gaXRlbU5hbWUgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGNyeXN0YWxOYW1lCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gbmlsCmVuZAoKLS0gVmFyaWFibGVzIHRvIHRyYWNrIGN1cnJlbnQgc2VsZWN0aW9ucwpsb2NhbCBzZWxlY3RlZFBldCA9ICIiCmxvY2FsIHNlbGVjdGVkQXVyYSA9ICIiCgotLSBHZXQgYWxsIHBldHMgYW5kIGF1cmFzCmxvY2FsIGFsbFBldHMsIGFsbEF1cmFzID0gZ2V0QWxsUGV0c0FuZEF1cmFzKCkKCnBldHM6QWRkTGFiZWwoIkF1cmEgJiBQZXQgU2hvcCIpCgotLSBQZXQgZHJvcGRvd24KbG9jYWwgcGV0RHJvcGRvd24gPSBwZXRzOkFkZERyb3Bkb3duKCJTZWxlY3QgcGV0IiwgZnVuY3Rpb24odGV4dCkKICAgIHNlbGVjdGVkUGV0ID0gdGV4dAogICAgbG9jYWwgY3J5c3RhbCA9IGZpbmRDcnlzdGFsRm9ySXRlbSh0ZXh0KQogICAgcHJpbnQoIlBldCBzZWxlY3RlZDogIiAuLiB0ZXh0IC4uICIgKEZvdW5kIGluOiAiIC4uIChjcnlzdGFsIG9yICJVbmtub3duIikgLi4gIikiKQplbmQpCgotLSBBZGQgYWxsIHBldHMgbWFudWFsbHkgKHNvcnRlZCBieSByYXJpdHkpCi0tIEJhc2ljIFBldHMKcGV0RHJvcGRvd246QWRkKCJCbHVlIEJpcmRpZSAoQmFzaWMpIikKcGV0RHJvcGRvd246QWRkKCJPcmFuZ2UgSGVkZ2Vob2cgKEJhc2ljKSIpCnBldERyb3Bkb3duOkFkZCgiUmVkIEtpdHR5IChCYXNpYykiKQpwZXREcm9wZG93bjpBZGQoIkJsdWUgQnVubnkgKEJhc2ljKSIpCnBldERyb3Bkb3duOkFkZCgiU2lsdmVyIERvZyAoQmFzaWMpIikKCi0tIEFkdmFuY2VkIFBldHMKcGV0RHJvcGRvd246QWRkKCJEYXJrIFZhbXB5IChBZHZhbmNlZCkiKQpwZXREcm9wZG93bjpBZGQoIkRhcmsgR29sZW0gKEFkdmFuY2VkKSIpCnBldERyb3Bkb3duOkFkZCgiR3JlZW4gQnV0dGVyZmx5IChBZHZhbmNlZCkiKQpwZXREcm9wZG93bjpBZGQoIlllbGxvdyBCdXR0ZXJmbHkgKEFkdmFuY2VkKSIpCgotLSBSYXJlIFBldHMKcGV0RHJvcGRvd246QWRkKCJDcmltc29uIEZhbGNvbiAoUmFyZSkiKQpwZXREcm9wZG93bjpBZGQoIlB1cnBsZSBEcmFnb24gKFJhcmUpIikKcGV0RHJvcGRvd246QWRkKCJPcmFuZ2UgUGVnYXN1cyAoUmFyZSkiKQpwZXREcm9wZG93bjpBZGQoIlB1cnBsZSBGYWxjb24gKFJhcmUpIikKcGV0RHJvcGRvd246QWRkKCJSZWQgRHJhZ29uIChSYXJlKSIpCnBldERyb3Bkb3duOkFkZCgiV2hpdGUgUGVnYXN1cyAoUmFyZSkiKQpwZXREcm9wZG93bjpBZGQoIkZyb3N0d2F2ZSBMZWdlbmRzIFBlbmd1aW4gKFJhcmUpIikKcGV0RHJvcGRvd246QWRkKCJQaGFudG9tIEdlbmVzaXMgRHJhZ29uIChSYXJlKSIpCnBldERyb3Bkb3duOkFkZCgiRXRlcm5hbCBTdHJpa2UgTGV2aWF0aGFuIChSYXJlKSIpCgotLSBFcGljIFBldHMKcGV0RHJvcGRvd246QWRkKCJCbHVlIFBoZW9uaXggKEVwaWMpIikKcGV0RHJvcGRvd246QWRkKCJCbHVlIEZpcmVjYXN0ZXIgKEVwaWMpIikKcGV0RHJvcGRvd246QWRkKCJHb2xkZW4gUGhlb25peCAoRXBpYykiKQpwZXREcm9wZG93bjpBZGQoIlJlZCBGaXJlY2FzdGVyIChFcGljKSIpCnBldERyb3Bkb3duOkFkZCgiR3JlZW4gRmlyZWNhc3RlciAoRXBpYykiKQpwZXREcm9wZG93bjpBZGQoIldoaXRlIFBoZW9uaXggKEVwaWMpIikKcGV0RHJvcGRvd246QWRkKCJEYXJrIExlZ2VuZHMgTWFudGljb3JlIChFcGljKSIpCnBldERyb3Bkb3duOkFkZCgiVWx0aW1hdGUgU3VwZXJub3ZhIFBlZ2FzdXMgKEVwaWMpIikKcGV0RHJvcGRvd246QWRkKCJMaWdodG5pbmcgU3RyaWtlIFBoYW50b20gKEVwaWMpIikKcGV0RHJvcGRvd246QWRkKCJHb2xkZW4gVmlraW5nIChFcGljKSIpCgotLSBVbmlxdWUgUGV0cwpwZXREcm9wZG93bjpBZGQoIkluZmVybmFsIERyYWdvbiAoVW5pcXVlKSIpCnBldERyb3Bkb3duOkFkZCgiVWx0cmEgQmlyZGllIChVbmlxdWUpIikKcGV0RHJvcGRvd246QWRkKCJNYWdpYyBCdXR0ZXJmbHkgKFVuaXF1ZSkiKQpwZXREcm9wZG93bjpBZGQoIkFldGhlciBTcGlyaXQgQnVubnkgKFVuaXF1ZSkiKQpwZXREcm9wZG93bjpBZGQoIkN5YmVybmV0aWMgU2hvd2Rvd24gRHJhZ29uIChVbmlxdWUpIikKcGV0RHJvcGRvd246QWRkKCJEYXJrc3RhciBIdW50ZXIgKFVuaXF1ZSkiKQpwZXREcm9wZG93bjpBZGQoIk11c2NsZSBTZW5zZWkgKFVuaXF1ZSkiKQpwZXREcm9wZG93bjpBZGQoIk5lb24gR3VhcmRpYW4gKFVuaXF1ZSkiKQoKLS0gQXVyYSBkcm9wZG93bgpsb2NhbCBhdXJhRHJvcGRvd24gPSBwZXRzOkFkZERyb3Bkb3duKCJTZWxlY3QgQXVyYSIsIGZ1bmN0aW9uKHRleHQpCiAgICBzZWxlY3RlZEF1cmEgPSB0ZXh0CiAgICBsb2NhbCBjcnlzdGFsID0gZmluZENyeXN0YWxGb3JJdGVtKHRleHQpCiAgICBwcmludCgiQXVyYSBzZWxlY3RlZDogIiAuLiB0ZXh0IC4uICIgKEZvdW5kIGluOiAiIC4uIChjcnlzdGFsIG9yICJVbmtub3duIikgLi4gIikiKQplbmQpCgotLSBBZGQgYWxsIGF1cmFzIG1hbnVhbGx5IChzb3J0ZWQgYnkgcmFyaXR5KQotLSBCYXNpYyBBdXJhcwphdXJhRHJvcGRvd246QWRkKCJCbHVlIEF1cmEgKEJhc2ljKSIpCmF1cmFEcm9wZG93bjpBZGQoIkdyZWVuIEF1cmEgKEJhc2ljKSIpCmF1cmFEcm9wZG93bjpBZGQoIlB1cnBsZSBBdXJhIChCYXNpYykiKQphdXJhRHJvcGRvd246QWRkKCJSZWQgQXVyYSAoQmFzaWMpIikKYXVyYURyb3Bkb3duOkFkZCgiWWVsbG93IEF1cmEgKEJhc2ljKSIpCmF1cmFEcm9wZG93bjpBZGQoIlVsdHJhIEluZmVybm8gIChSYXJlKSIpCmF1cmFEcm9wZG93bjpBZGQoIkF6dXJlIFR1bmRyYSAoRXBpYykiKQphdXJhRHJvcGRvd246QWRkKCJHcmFuZCBTdXBlcm5vdmEgKEVwaWMpIikKYXVyYURyb3Bkb3duOkFkZCgiTXVzY2xlIEtpbmcgKFVuaXF1ZSkiKQphdXJhRHJvcGRvd246QWRkKCJFbnRyb3BpYyBCbGFzdCAoVW5pcXVlKSIpCmF1cmFEcm9wZG93bjpBZGQoIkV0ZXJuYWwgTWVnYXN0cmlrZSAoVW5pcXVlKSIpCgpwZXRzOkFkZExhYmVsKCJBdXRvIEJ1eSIpCgotLSBBdXRvIGJ1eSBwZXQgdG9nZ2xlCnBldHM6QWRkU3dpdGNoKCJBdXRvIEJ1eSBQZXQiLCBmdW5jdGlvbihib29sKQogICAgX0cuQXV0b0J1eVBldCA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgaWYgc2VsZWN0ZWRQZXQgPT0gIiIgdGhlbgogICAgICAgICAgICBwcmludCgiUGxlYXNlIHNlbGVjdCBhIHBldCBmaXJzdCEiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSBFeHRyYWN0IHBldCBuYW1lIGZyb20gZHJvcGRvd24gc2VsZWN0aW9uIChyZW1vdmUgcmFyaXR5IHBhcnQpCiAgICAgICAgbG9jYWwgcGV0TmFtZSA9IHNlbGVjdGVkUGV0Om1hdGNoKCJeKC4tKSVzKiUoIikKICAgICAgICBpZiBub3QgcGV0TmFtZSB0aGVuCiAgICAgICAgICAgIHBldE5hbWUgPSBzZWxlY3RlZFBldAogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIGNyeXN0YWwgPSBmaW5kQ3J5c3RhbEZvckl0ZW0ocGV0TmFtZSkKICAgICAgICBpZiBub3QgY3J5c3RhbCB0aGVuCiAgICAgICAgICAgIHByaW50KCJDb3VsZCBub3QgZmluZCBjcnlzdGFsIGZvciBwZXQ6ICIgLi4gcGV0TmFtZSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgcHJpbnQoIkF1dG8gYnV5IHBldCBzdGFydGVkIGZvcjogIiAuLiBwZXROYW1lIC4uICIgZnJvbSAiIC4uIGNyeXN0YWwpCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5BdXRvQnV5UGV0IGFuZCBzZWxlY3RlZFBldCB+PSAiIiBkbwogICAgICAgICAgICAgICAgbG9jYWwgcGV0VG9CdXkgPSBSZXBsaWNhdGVkU3RvcmFnZS5jUGV0U2hvcEZvbGRlcjpGaW5kRmlyc3RDaGlsZChwZXROYW1lKQogICAgICAgICAgICAgICAgaWYgcGV0VG9CdXkgdGhlbgogICAgICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlLmNQZXRTaG9wUmVtb3RlOkludm9rZVNlcnZlcihwZXRUb0J1eSkKICAgICAgICAgICAgICAgICAgICBwcmludCgiQm91Z2h0IHBldDogIiAuLiBwZXROYW1lKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHByaW50KCJQZXQgbm90IGZvdW5kOiAiIC4uIHBldE5hbWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVsc2UKICAgICAgICBwcmludCgiQXV0byBidXkgcGV0IHN0b3BwZWQiKQogICAgZW5kCmVuZCkKCi0tIEF1dG8gYnV5IGF1cmEgdG9nZ2xlCnBldHM6QWRkU3dpdGNoKCJBdXRvIGJ1eSBBdXJhIiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLkF1dG9CdXlBdXJhID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICBpZiBzZWxlY3RlZEF1cmEgPT0gIiIgdGhlbgogICAgICAgICAgICBwcmludCgiUGxlYXNlIHNlbGVjdCBhbiBhdXJhIGZpcnN0ISIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIC0tIEV4dHJhY3QgYXVyYSBuYW1lIGZyb20gZHJvcGRvd24gc2VsZWN0aW9uIChyZW1vdmUgcmFyaXR5IHBhcnQpCiAgICAgICAgbG9jYWwgYXVyYU5hbWUgPSBzZWxlY3RlZEF1cmE6bWF0Y2goIl4oLi0pJXMqJSgiKQogICAgICAgIGlmIG5vdCBhdXJhTmFtZSB0aGVuCiAgICAgICAgICAgIGF1cmFOYW1lID0gc2VsZWN0ZWRBdXJhCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgY3J5c3RhbCA9IGZpbmRDcnlzdGFsRm9ySXRlbShhdXJhTmFtZSkKICAgICAgICBpZiBub3QgY3J5c3RhbCB0aGVuCiAgICAgICAgICAgIHByaW50KCJDb3VsZCBub3QgZmluZCBjcnlzdGFsIGZvciBhdXJhOiAiIC4uIGF1cmFOYW1lKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBwcmludCgiQXV0byBidXkgYXVyYSBzdGFydGVkIGZvcjogIiAuLiBhdXJhTmFtZSAuLiAiIGZyb20gIiAuLiBjcnlzdGFsKQogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuQXV0b0J1eUF1cmEgYW5kIHNlbGVjdGVkQXVyYSB+PSAiIiBkbwogICAgICAgICAgICAgICAgbG9jYWwgYXVyYVRvQnV5ID0gUmVwbGljYXRlZFN0b3JhZ2UuY1BldFNob3BGb2xkZXI6RmluZEZpcnN0Q2hpbGQoYXVyYU5hbWUpCiAgICAgICAgICAgICAgICBpZiBhdXJhVG9CdXkgdGhlbgogICAgICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlLmNQZXRTaG9wUmVtb3RlOkludm9rZVNlcnZlcihhdXJhVG9CdXkpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIkJvdWdodCBhdXJhOiAiIC4uIGF1cmFOYW1lKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHByaW50KCJBdXJhIG5vdCBmb3VuZDogIiAuLiBhdXJhTmFtZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIHByaW50KCJBdXRvIGJ1eSBhdXJhIHN0b3BwZWQiKQogICAgZW5kCmVuZCkKCi0tIFNob3cgdGhlIHBldHMgdGFiCnBldHM6U2hvdygpCgpwZXRzOkFkZExhYmVsKCJUTUIgQXV0byBCdXkgVWx0aW1hdGVzIikKCi0tIFVsdGltYXRlIG9wdGlvbnMKbG9jYWwgdWx0aW1hdGVPcHRpb25zID0gewogICAgIisxIERhaWx5IFNwaW4iLAogICAgIisxIFBldCBTbG90IiwKICAgICIrMTAgSXRlbSBDYXBhY2l0eSIsCiAgICAiKzUlIFJlcCBTcGVlZCIsCiAgICAiRGVtb24gRGFtYWdlIiwKICAgICJHYWxheHkgR2FpbnMiLAogICAgIkdvbGRlbiBSZWJpcnRoIiwKICAgICJKdW5nbGUgU3dpZnQiLAogICAgIk11c2NsZSBNaW5kIiwKICAgICJ4MiBDaGVzdCBSZXdhcmRzIiwKICAgICJ4MiBRdWVzdCBSZXdhcmRzIgp9CgotLSBWYXJpYWJsZSB0byB0cmFjayBzZWxlY3RlZCB1bHRpbWF0ZQpsb2NhbCBzZWxlY3RlZFVsdGltYXRlID0gIiIKCi0tIFVsdGltYXRlIGRyb3Bkb3duCmxvY2FsIHVsdGltYXRlRHJvcGRvd24gPSBwZXRzOkFkZERyb3Bkb3duKCJTZWxlY3QgdWx0aW1hdGUiLCBmdW5jdGlvbih0ZXh0KQogICAgc2VsZWN0ZWRVbHRpbWF0ZSA9IHRleHQKICAgIHByaW50KCJVbHRpbWF0ZSBzZWxlY3RlZDogIiAuLiB0ZXh0KQplbmQpCgotLSBBZGQgYWxsIHVsdGltYXRlIG9wdGlvbnMgdG8gZHJvcGRvd24KZm9yIF8sIHVsdGltYXRlIGluIGlwYWlycyh1bHRpbWF0ZU9wdGlvbnMpIGRvCiAgICB1bHRpbWF0ZURyb3Bkb3duOkFkZCh1bHRpbWF0ZSkKZW5kCgotLSBBdXRvIHVwZ3JhZGUgdWx0aW1hdGUgdG9nZ2xlCnBldHM6QWRkU3dpdGNoKCJBdXRvIEJ1eSBVbHRpbWF0ZXMiLCBmdW5jdGlvbihib29sKQogICAgX0cuQXV0b1VwZ3JhZGVVbHRpbWF0ZSA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgaWYgc2VsZWN0ZWRVbHRpbWF0ZSA9PSAiIiB0aGVuCiAgICAgICAgICAgIHByaW50KCJQbGVhc2Ugc2VsZWN0IGFuIHVsdGltYXRlIGZpcnN0ISIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIHByaW50KCJBdXRvIHVwZ3JhZGUgdWx0aW1hdGUgc3RhcnRlZCBmb3I6ICIgLi4gc2VsZWN0ZWRVbHRpbWF0ZSkKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkF1dG9VcGdyYWRlVWx0aW1hdGUgYW5kIHNlbGVjdGVkVWx0aW1hdGUgfj0gIiIgZG8KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLnVsdGltYXRlc1JlbW90ZTpJbnZva2VTZXJ2ZXIoCiAgICAgICAgICAgICAgICAgICAgInVwZ3JhZGVVbHRpbWF0ZSIsCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRVbHRpbWF0ZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcHJpbnQoIlVwZ3JhZGVkIHVsdGltYXRlOiAiIC4uIHNlbGVjdGVkVWx0aW1hdGUpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIHByaW50KCJBdXRvIGNvbXByYXIgdWx0aW1hdGVzIikKICAgIGVuZAplbmQpCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIHBsYXllcldoaXRlbGlzdCA9IHt9CmxvY2FsIHRhcmdldFBsYXllck5hbWVzID0ge30KbG9jYWwgYXV0b0dvb2RLYXJtYSA9IGZhbHNlCmxvY2FsIGF1dG9CYWRLYXJtYSA9IGZhbHNlCmxvY2FsIGF1dG9LaWxsID0gZmFsc2UKbG9jYWwga2lsbFRhcmdldCA9IGZhbHNlCmxvY2FsIHNweWluZyA9IGZhbHNlCmxvY2FsIGF1dG9FcXVpcFB1bmNoID0gZmFsc2UKbG9jYWwgYXV0b1B1bmNoTm9BbmltID0gZmFsc2UKbG9jYWwgdGFyZ2V0RHJvcGRvd25JdGVtcyA9IHt9CmxvY2FsIGF2YWlsYWJsZVRhcmdldHMgPSB7fQoKbG9jYWwgS2lsbGVyID0gd2luZG93OkFkZFRhYigiT1AgS2lsbGluZyIpCgpsb2NhbCBkcm9wZG93biA9IEtpbGxlcjpBZGREcm9wZG93bigiU2VsZWN0IFBldCIsIGZ1bmN0aW9uKHRleHQpCiAgICBsb2NhbCBwZXRzRm9sZGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgicGV0c0ZvbGRlciIpCiAgICBmb3IgXywgZm9sZGVyIGluIHBhaXJzKHBldHNGb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiBmb2xkZXI6SXNBKCJGb2xkZXIiKSB0aGVuCiAgICAgICAgICAgIGZvciBfLCBwZXQgaW4gcGFpcnMoZm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5lcXVpcFBldEV2ZW50OkZpcmVTZXJ2ZXIoInVuZXF1aXBQZXQiLCBwZXQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICB0YXNrLndhaXQoMC4yKQogICAgbG9jYWwgcGV0TmFtZSA9IHRleHQKICAgIGxvY2FsIHBldHNUb0VxdWlwID0ge30KICAgIGZvciBfLCBwZXQgaW4gcGFpcnMocGV0c0ZvbGRlci5VbmlxdWU6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiBwZXQuTmFtZSA9PSBwZXROYW1lIHRoZW4KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBldHNUb0VxdWlwLCBwZXQpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGxvY2FsIG1heFBldHMgPSA4CiAgICBsb2NhbCBlcXVpcHBlZENvdW50ID0gbWF0aC5taW4oI3BldHNUb0VxdWlwLCBtYXhQZXRzKQogICAgZm9yIGkgPSAxLCBlcXVpcHBlZENvdW50IGRvCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMuZXF1aXBQZXRFdmVudDpGaXJlU2VydmVyKCJlcXVpcFBldCIsIHBldHNUb0VxdWlwW2ldKQogICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICBlbmQKZW5kKQpkcm9wZG93bjpBZGQoIldpbGQgV2l6YXJkIikKZHJvcGRvd246QWRkKCJNaWdodHkgTW9uc3RlciIpCgpLaWxsZXI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIFtObyBBbmltYXRpb25dIiwgZnVuY3Rpb24oc3RhdGUpCglhdXRvUHVuY2hOb0FuaW0gPSBzdGF0ZQoJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJd2hpbGUgYXV0b1B1bmNoTm9BbmltIGRvCgkJCWxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikgb3IgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKCQkJaWYgcHVuY2ggdGhlbgoJCQkJaWYgcHVuY2guUGFyZW50IH49IExvY2FsUGxheWVyLkNoYXJhY3RlciB0aGVuCgkJCQkJcHVuY2guUGFyZW50ID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCgkJCQllbmQKCQkJCUxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgInJpZ2h0SGFuZCIpCgkJCQlMb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJsZWZ0SGFuZCIpCgkJCWVsc2UKCQkJCWF1dG9QdW5jaE5vQW5pbSA9IGZhbHNlCgkJCWVuZAoJCQl0YXNrLndhaXQoMC4wMSkKCQllbmQKCWVuZCkKZW5kKQoKS2lsbGVyOkFkZFN3aXRjaCgiQXV0byBQdW5jaCIsIGZ1bmN0aW9uKHN0YXRlKQoJX0cuZmFzdEhpdEFjdGl2ZSA9IHN0YXRlCglpZiBzdGF0ZSB0aGVuCgkJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCXdoaWxlIF9HLmZhc3RIaXRBY3RpdmUgZG8KCQkJCWxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKCQkJCWlmIHB1bmNoIHRoZW4KCQkJCQlwdW5jaC5QYXJlbnQgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKCQkJCQlpZiBwdW5jaDpGaW5kRmlyc3RDaGlsZCgiYXR0YWNrVGltZSIpIHRoZW4KCQkJCQkJcHVuY2guYXR0YWNrVGltZS5WYWx1ZSA9IDAKCQkJCQllbmQKCQkJCWVuZAoJCQkJdGFzay53YWl0KDAuMSkKCQkJZW5kCgkJZW5kKQoJCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCQl3aGlsZSBfRy5mYXN0SGl0QWN0aXZlIGRvCgkJCQlsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJCQlpZiBwdW5jaCB0aGVuCgkJCQkJcHVuY2g6QWN0aXZhdGUoKQoJCQkJZW5kCgkJCQl0YXNrLndhaXQoMC4xKQoJCQllbmQKCQllbmQpCgllbHNlCgkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCWlmIHB1bmNoIHRoZW4KCQkJcHVuY2guUGFyZW50ID0gTG9jYWxQbGF5ZXIuQmFja3BhY2sKCQllbmQKCWVuZAplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJGYXN0IFB1bmNoIiwgZnVuY3Rpb24oc3RhdGUpCglfRy5hdXRvUHVuY2hBY3RpdmUgPSBzdGF0ZQoJaWYgc3RhdGUgdGhlbgoJCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCQl3aGlsZSBfRy5hdXRvUHVuY2hBY3RpdmUgZG8KCQkJCWxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKCQkJCWlmIHB1bmNoIHRoZW4KCQkJCQlwdW5jaC5QYXJlbnQgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKCQkJCQlpZiBwdW5jaDpGaW5kRmlyc3RDaGlsZCgiYXR0YWNrVGltZSIpIHRoZW4KCQkJCQkJcHVuY2guYXR0YWNrVGltZS5WYWx1ZSA9IDAKCQkJCQllbmQKCQkJCWVuZAoJCQkJdGFzay53YWl0KCkKCQkJZW5kCgkJZW5kKQoJCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCQl3aGlsZSBfRy5hdXRvUHVuY2hBY3RpdmUgZG8KCQkJCWxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKCQkJCWlmIHB1bmNoIHRoZW4KCQkJCQlwdW5jaDpBY3RpdmF0ZSgpCgkJCQllbmQKCQkJCXRhc2sud2FpdCgpCgkJCWVuZAoJCWVuZCkKCWVsc2UKCQlsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJaWYgcHVuY2ggdGhlbgoJCQlwdW5jaC5QYXJlbnQgPSBMb2NhbFBsYXllci5CYWNrcGFjawoJCWVuZAoJZW5kCmVuZCkKCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKbG9jYWwgU3RhcnRlclBhY2sgPSBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJQYWNrIikKbG9jYWwgbGlnaHRpbmcgPSBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCgotLSBTdGF0ZSAmIGNvbm5lY3Rpb24gdHJhY2tpbmcKbG9jYWwgY29tYm9BY3RpdmUgPSBmYWxzZQpsb2NhbCBjb25uZWN0aW9ucyA9IHt9IC0tIG1hcCBrZXlzIC0+IFJCWFNjcmlwdENvbm5lY3Rpb24gLyB0YXNrLnRocmVhZApsb2NhbCBsb29wcyA9IHt9IC0tIHN0b3JlIGNvcm91dGluZS90aHJlYWQgcmVmZXJlbmNlcyB0byBhbGxvdyBzYWZlIHN0b3BwaW5nCgpsb2NhbCBmdW5jdGlvbiBzYWZlRGlzY29ubmVjdChrZXkpCglsb2NhbCBjb25uID0gY29ubmVjdGlvbnNba2V5XQoJaWYgbm90IGNvbm4gdGhlbiByZXR1cm4gZW5kCglwY2FsbChmdW5jdGlvbigpCgkJaWYgdHlwZW9mKGNvbm4pID09ICJSQlhTY3JpcHRDb25uZWN0aW9uIiBhbmQgY29ubi5EaXNjb25uZWN0IHRoZW4KCQkJY29ubjpEaXNjb25uZWN0KCkKCQllbHNlaWYgdHlwZShjb25uKSA9PSAidGFibGUiIGFuZCBjb25uLkRpc2Nvbm5lY3QgdGhlbgoJCQljb25uOkRpc2Nvbm5lY3QoKQoJCWVuZAoJZW5kKQoJY29ubmVjdGlvbnNba2V5XSA9IG5pbAplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0b3BMb29wcygpCglmb3IgaywgdGhyIGluIHBhaXJzKGxvb3BzKSBkbwoJCWxvb3BzW2tdID0gbmlsCgllbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBjbGVhbnVwQWxsKCkKCV9HLkF1dG9QdW5jaFRvZ2dsZSA9IGZhbHNlCglfRy5BdXRvUHJvdGVpbkVnZyA9IGZhbHNlCglnZXRnZW52KCkuQW50aUZseUFjdGl2ZSA9IGZhbHNlCgoJZm9yIGssIF8gaW4gcGFpcnMoY29ubmVjdGlvbnMpIGRvCgkJc2FmZURpc2Nvbm5lY3QoaykKCWVuZAoJY29ubmVjdGlvbnMgPSB7fQoJc3RvcExvb3BzKCkKZW5kCgpsb2NhbCBmdW5jdGlvbiByZXNwYXduUGxheWVyKCkKCXBjYWxsKGZ1bmN0aW9uKCkKCQlpZiBMb2NhbFBsYXllciBhbmQgTG9jYWxQbGF5ZXI6SXNBKCJQbGF5ZXIiKSB0aGVuCgkJCWlmIHBjYWxsKGZ1bmN0aW9uKCkgTG9jYWxQbGF5ZXI6TG9hZENoYXJhY3RlcigpIGVuZCkgdGhlbiByZXR1cm4gZW5kCgkJCXBjYWxsKGZ1bmN0aW9uKCkKCQkJCWxvY2FsIFN0YXJ0ZXJHdWkgPSBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKQoJCQkJU3RhcnRlckd1aTpTZXRDb3JlKCJSZXNldEJ1dHRvbkNhbGxiYWNrIiwgdHJ1ZSkKCQkJZW5kKQoJCWVuZAoJZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGFwcGx5U2l6ZU5hTigpCglwY2FsbChmdW5jdGlvbigpCgkJbG9jYWwgZXZlbnRzID0gUmVwbGljYXRlZFN0b3JhZ2U6RmluZEZpcnN0Q2hpbGQoInJFdmVudHMiKQoJCWlmIGV2ZW50cyB0aGVuCgkJCWxvY2FsIGNoYW5nZSA9IGV2ZW50czpGaW5kRmlyc3RDaGlsZCgiY2hhbmdlU3BlZWRTaXplUmVtb3RlIikKCQkJaWYgY2hhbmdlIGFuZCBjaGFuZ2UuSW52b2tlU2VydmVyIHRoZW4KCQkJCXBjYWxsKGZ1bmN0aW9uKCkKCQkJCQljaGFuZ2U6SW52b2tlU2VydmVyKCJjaGFuZ2VTaXplIiwgMC8wKQoJCQkJZW5kKQoJCQllbmQKCQllbmQKCWVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBzdGFydEF1dG9QdW5jaCgpCglfRy5BdXRvUHVuY2hUb2dnbGUgPSB0cnVlCglsb2NhbCBpZCA9ICJBdXRvUHVuY2giCglsb29wc1tpZF0gPSB0cnVlCgl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQlsb2NhbCBiYWNrcGFjayA9IExvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKQoJCWxvY2FsIGhhbmQgPSAicmlnaHRIYW5kIgoJCWxvY2FsIGZ1bmN0aW9uIGdldE11c2NsZUV2ZW50KCkgcmV0dXJuIExvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJtdXNjbGVFdmVudCIpIGVuZAoKCQlzYWZlRGlzY29ubmVjdCgiQ2hhckFkZGVkRm9yQXV0b1B1bmNoIikKCQljb25uZWN0aW9ucy5DaGFyQWRkZWRGb3JBdXRvUHVuY2ggPSBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoYXIpCgkJCWlmIGNvbWJvQWN0aXZlIGFuZCBjb25uZWN0aW9ucy5IdW1hbm9pZFJlc2V0SG9vayA9PSBuaWwgdGhlbgoJCQkJbG9jYWwgaHVtID0gY2hhcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikKCQkJCWlmIGh1bSB0aGVuCgkJCQkJc2FmZURpc2Nvbm5lY3QoIlJlc2V0RGVhdGgiKQoJCQkJCWNvbm5lY3Rpb25zLlJlc2V0RGVhdGggPSBodW0uRGllZDpDb25uZWN0KGZ1bmN0aW9uKCkKCQkJCQkJdGFzay53YWl0KDAuNSkKCQkJCQkJcmVzcGF3blBsYXllcigpCgkJCQkJZW5kKQoJCQkJZW5kCgkJCWVuZAoJCWVuZCkKCgkJc2FmZURpc2Nvbm5lY3QoIkJhY2twYWNrQ2hpbGRGb3JBdXRvUHVuY2giKQoJCWNvbm5lY3Rpb25zLkJhY2twYWNrQ2hpbGRGb3JBdXRvUHVuY2ggPSBMb2NhbFBsYXllci5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCgkJCWlmIGNoaWxkLk5hbWUgPT0gIkJhY2twYWNrIiB0aGVuCgkJCQliYWNrcGFjayA9IGNoaWxkCgkJCWVuZAoJCWVuZCkKCgkJd2hpbGUgX0cuQXV0b1B1bmNoVG9nZ2xlIGFuZCBsb29wc1tpZF0gZG8KCQkJbG9jYWwgbXVzY2xlRXZlbnQgPSBnZXRNdXNjbGVFdmVudCgpCgkJCWxvY2FsIGNoYXJhY3RlciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgoJCQlpZiBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBhbmQgbXVzY2xlRXZlbnQgdGhlbgoJCQkJbG9jYWwgcHVuY2hFcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCQkJbG9jYWwgcHVuY2hJbkJhY2twYWNrID0gKExvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJCYWNrcGFjayIpIGFuZCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKSkKCQkJCWlmIG5vdCBwdW5jaEVxdWlwcGVkIGFuZCBwdW5jaEluQmFja3BhY2sgdGhlbgoJCQkJCXBjYWxsKGZ1bmN0aW9uKCkgY2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChwdW5jaEluQmFja3BhY2spIGVuZCkKCQkJCWVuZAoJCQkJcGNhbGwoZnVuY3Rpb24oKSBtdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsIGhhbmQpIGVuZCkKCQkJZW5kCgkJCXRhc2sud2FpdCgwLjAwMDEpCgkJZW5kCgllbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gc3RhcnRQcm90ZWluRWdnTG9naWMoKQoJX0cuQXV0b1Byb3RlaW5FZ2cgPSB0cnVlCglsb2NhbCBpZCA9ICJQcm90ZWluRWdnIgoJbG9vcHNbaWRdID0gdHJ1ZQoJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJbG9jYWwgdG9vbE5hbWUgPSAiUHJvdGVpbiBFZ2ciCgkJbG9jYWwgY2hhcmFjdGVyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIG9yIExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQoKCQlsb2NhbCBmdW5jdGlvbiByZXN0b3JlVmlzaWJpbGl0eSh0b29sKQoJCQlmb3IgXywgcGFydCBpbiBpcGFpcnModG9vbDpHZXREZXNjZW5kYW50cygpKSBkbwoJCQkJaWYgcGFydDpJc0EoIkJhc2VQYXJ0IikgdGhlbgoJCQkJCXBjYWxsKGZ1bmN0aW9uKCkgcGFydC5UcmFuc3BhcmVuY3kgPSAwIGVuZCkKCQkJCQlwY2FsbChmdW5jdGlvbigpIHBhcnQuTG9jYWxUcmFuc3BhcmVuY3lNb2RpZmllciA9IDAgZW5kKQoJCQkJZW5kCgkJCWVuZAoJCWVuZAoKCQlsb2NhbCBmdW5jdGlvbiBmaW5kVG9vbCgpCgkJCWxvY2FsIHRvb2wgPSAoTG9jYWxQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkJhY2twYWNrIikgYW5kIExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKHRvb2xOYW1lKSkKCQkJaWYgdG9vbCB0aGVuIHJldHVybiB0b29sIGVuZAoJCQl0b29sID0gU3RhcnRlclBhY2s6RmluZEZpcnN0Q2hpbGQodG9vbE5hbWUpCgkJCWlmIHRvb2wgdGhlbiByZXR1cm4gdG9vbCBlbmQKCQkJdG9vbCA9IFJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKHRvb2xOYW1lKQoJCQlyZXR1cm4gdG9vbAoJCWVuZAoKCQlsb2NhbCBmdW5jdGlvbiBmb3JjZUVxdWlwKHRvb2wpCgkJCWlmIG5vdCAoY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikpIHRoZW4gcmV0dXJuIGVuZAoJCQlwY2FsbChmdW5jdGlvbigpIGNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wodG9vbCkgZW5kKQoJCQl0YXNrLndhaXQoMC4xKQoJCQlpZiBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKHRvb2xOYW1lKSB0aGVuCgkJCQlwY2FsbChmdW5jdGlvbigpIHRvb2wuUGFyZW50ID0gY2hhcmFjdGVyIGVuZCkKCQkJCXRhc2sud2FpdCgwLjEpCgkJCWVuZAoJCQlsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCh0b29sTmFtZSkKCQkJaWYgZXF1aXBwZWQgdGhlbiByZXN0b3JlVmlzaWJpbGl0eShlcXVpcHBlZCkgZW5kCgkJZW5kCgoJCWxvY2FsIGZ1bmN0aW9uIHNhbml0aXplVG9vbCh0b29sKQoJCQlmb3IgXywgZGVzYyBpbiBpcGFpcnModG9vbDpHZXREZXNjZW5kYW50cygpKSBkbwoJCQkJaWYgZGVzYzpJc0EoIlNjcmlwdCIpIHRoZW4KCQkJCQlwY2FsbChmdW5jdGlvbigpIGRlc2M6RGVzdHJveSgpIGVuZCkKCQkJCWVsc2VpZiBkZXNjOklzQSgiTG9jYWxTY3JpcHQiKSB0aGVuCgkJCQkJcGNhbGwoZnVuY3Rpb24oKSBkZXNjLkRpc2FibGVkID0gdHJ1ZSBlbmQpCgkJCQllbmQKCQkJCWlmIGRlc2M6SXNBKCJSZW1vdGVFdmVudCIpIHRoZW4KCQkJCQlwY2FsbChmdW5jdGlvbigpIGRlc2MuRmlyZVNlcnZlciA9IGZ1bmN0aW9uKCkgZW5kIGVuZCkKCQkJCWVuZAoJCQllbmQKCQllbmQKCgkJbG9jYWwgZnVuY3Rpb24gZXF1aXBJZk5lZWRlZCgpCgkJCWlmIG5vdCBfRy5BdXRvUHJvdGVpbkVnZyB0aGVuIHJldHVybiBlbmQKCQkJY2hhcmFjdGVyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCgkJCWxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQodG9vbE5hbWUpCgkJCWxvY2FsIG5lZWRFcXVpcCA9IGZhbHNlCgkJCWlmIG5vdCBlcXVpcHBlZCB0aGVuCgkJCQluZWVkRXF1aXAgPSB0cnVlCgkJCWVsc2UKCQkJCWZvciBfLCBwYXJ0IGluIGlwYWlycyhlcXVpcHBlZDpHZXREZXNjZW5kYW50cygpKSBkbwoJCQkJCWlmIHBhcnQ6SXNBKCJCYXNlUGFydCIpIGFuZCBwYXJ0LlRyYW5zcGFyZW5jeSA+IDAgdGhlbgoJCQkJCQluZWVkRXF1aXAgPSB0cnVlCgkJCQkJCWJyZWFrCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgkJCWlmIG5lZWRFcXVpcCB0aGVuCgkJCQlsb2NhbCB0b29sID0gZmluZFRvb2woKQoJCQkJaWYgdG9vbCB0aGVuCgkJCQkJaWYgdG9vbC5QYXJlbnQgfj0gKExvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJCYWNrcGFjayIpIGFuZCBMb2NhbFBsYXllci5CYWNrcGFjaykgdGhlbgoJCQkJCQlsb2NhbCBjbG9uZSA9IHRvb2w6Q2xvbmUoKQoJCQkJCQljbG9uZS5QYXJlbnQgPSBMb2NhbFBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQmFja3BhY2siKSBvciBMb2NhbFBsYXllcgoJCQkJCQl0b29sID0gY2xvbmUKCQkJCQllbmQKCQkJCQlzYW5pdGl6ZVRvb2wodG9vbCkKCQkJCQlmb3JjZUVxdWlwKHRvb2wpCgkJCQllbmQKCQkJZW5kCgkJZW5kCgoJCWxvY2FsIGZ1bmN0aW9uIG1vbml0b3JUb29sQ29udGFpbmVyKGNvbnRhaW5lcikKCQkJaWYgbm90IGNvbnRhaW5lciB0aGVuIHJldHVybiBlbmQKCQkJZm9yIF8sIHRvb2wgaW4gaXBhaXJzKGNvbnRhaW5lcjpHZXRDaGlsZHJlbigpKSBkbwoJCQkJaWYgdG9vbDpJc0EoIlRvb2wiKSBhbmQgdG9vbC5OYW1lID09IHRvb2xOYW1lIHRoZW4KCQkJCQlzYW5pdGl6ZVRvb2wodG9vbCkKCQkJCWVuZAoJCQllbmQKCQkJbG9jYWwgY29ubiA9IGNvbnRhaW5lci5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCgkJCQlpZiBjaGlsZDpJc0EoIlRvb2wiKSBhbmQgY2hpbGQuTmFtZSA9PSB0b29sTmFtZSB0aGVuCgkJCQkJdGFzay5kZWZlcihmdW5jdGlvbigpCgkJCQkJCXNhbml0aXplVG9vbChjaGlsZCkKCQkJCQllbmQpCgkJCQllbmQKCQkJZW5kKQoJCQlyZXR1cm4gY29ubgoJCWVuZAoKCQlzYWZlRGlzY29ubmVjdCgiTW9uaXRvckJhY2twYWNrIikKCQlzYWZlRGlzY29ubmVjdCgiTW9uaXRvckNoYXJhY3RlciIpCgkJY29ubmVjdGlvbnMuTW9uaXRvckJhY2twYWNrID0gbW9uaXRvclRvb2xDb250YWluZXIoTG9jYWxQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkJhY2twYWNrIikgb3IgTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJCYWNrcGFjayIpKQoJCWNvbm5lY3Rpb25zLk1vbml0b3JDaGFyYWN0ZXIgPSBtb25pdG9yVG9vbENvbnRhaW5lcihMb2NhbFBsYXllci5DaGFyYWN0ZXIpCgoJCXNhZmVEaXNjb25uZWN0KCJDaGFyYWN0ZXJBZGRlZFByb3RlaW4iKQoJCWNvbm5lY3Rpb25zLkNoYXJhY3RlckFkZGVkUHJvdGVpbiA9IExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hhcikKCQkJY2hhcmFjdGVyID0gY2hhcgoJCQl0YXNrLndhaXQoMSkKCQkJc2FmZURpc2Nvbm5lY3QoIk1vbml0b3JCYWNrcGFjayIpCgkJCXNhZmVEaXNjb25uZWN0KCJNb25pdG9yQ2hhcmFjdGVyIikKCQkJY29ubmVjdGlvbnMuTW9uaXRvckJhY2twYWNrID0gbW9uaXRvclRvb2xDb250YWluZXIoTG9jYWxQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkJhY2twYWNrIikgb3IgTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJCYWNrcGFjayIpKQoJCQljb25uZWN0aW9ucy5Nb25pdG9yQ2hhcmFjdGVyID0gbW9uaXRvclRvb2xDb250YWluZXIoY2hhcikKCQkJZXF1aXBJZk5lZWRlZCgpCgkJZW5kKQoKCQlzYWZlRGlzY29ubmVjdCgiQmFja3BhY2tDaGlsZFByb3RlaW4iKQoJCWNvbm5lY3Rpb25zLkJhY2twYWNrQ2hpbGRQcm90ZWluID0gTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJCYWNrcGFjayIpLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKCQkJaWYgX0cuQXV0b1Byb3RlaW5FZ2cgYW5kIGNoaWxkLk5hbWUgPT0gdG9vbE5hbWUgdGhlbgoJCQkJdGFzay53YWl0KDAuMikKCQkJCWVxdWlwSWZOZWVkZWQoKQoJCQllbmQKCQllbmQpCgoJCXdoaWxlIF9HLkF1dG9Qcm90ZWluRWdnIGFuZCBsb29wc1tpZF0gZG8KCQkJcGNhbGwoZXF1aXBJZk5lZWRlZCkKCQkJdGFzay53YWl0KDAuNSkKCQllbmQKCWVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBzdGFydEFudGlGbHkoKQoJZ2V0Z2VudigpLkFudGlGbHlBY3RpdmUgPSB0cnVlCglzYWZlRGlzY29ubmVjdCgiQW50aUZseSIpCgljb25uZWN0aW9ucy5BbnRpRmx5ID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCgkJbG9jYWwgY2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgoJCWlmIG5vdCBjaGFyIHRoZW4gcmV0dXJuIGVuZAoJCWxvY2FsIHJvb3QgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKCQlpZiBub3Qgcm9vdCB0aGVuIHJldHVybiBlbmQKCQlsb2NhbCBodW1hbm9pZCA9IGNoYXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCgkJaWYgbm90IGh1bWFub2lkIHRoZW4gcmV0dXJuIGVuZAoJCWxvY2FsIHJheSA9IFJheS5uZXcocm9vdC5Qb3NpdGlvbiwgVmVjdG9yMy5uZXcoMCwgLTUwMCwgMCkpCgkJbG9jYWwgaGl0LCBwb3NpdGlvbiA9IHdvcmtzcGFjZTpGaW5kUGFydE9uUmF5KHJheSwgY2hhcikKCQlpZiBoaXQgdGhlbgoJCQlsb2NhbCBncm91bmRZID0gcG9zaXRpb24uWQoJCQlsb2NhbCBjdXJyZW50WSA9IHJvb3QuUG9zaXRpb24uWQoJCQlpZiBjdXJyZW50WSAtIGdyb3VuZFkgPiAwLjUgdGhlbgoJCQkJcm9vdC5DRnJhbWUgPSBDRnJhbWUubmV3KHJvb3QuUG9zaXRpb24uWCwgZ3JvdW5kWSArIDAuNSwgcm9vdC5Qb3NpdGlvbi5aKQoJCQkJaHVtYW5vaWQuUGxhdGZvcm1TdGFuZCA9IHRydWUKCQkJCWh1bWFub2lkLlBsYXRmb3JtU3RhbmQgPSBmYWxzZQoJCQllbmQKCQllbmQKCWVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBzb2Z0QW50aUxhZ0FuZFN1bnNldCgpCglwY2FsbChmdW5jdGlvbigpCgkJbG9jYWwgY2xhc3Nlc1RvQ2xlYW4gPSB7WyJQYXJ0aWNsZUVtaXR0ZXIiXT10cnVlLCBbIlRyYWlsIl09dHJ1ZSwgWyJTbW9rZSJdPXRydWUsIFsiRmlyZSJdPXRydWV9CgkJZm9yIF8sIG9iaiBpbiBpcGFpcnMod29ya3NwYWNlOkdldENoaWxkcmVuKCkpIGRvCgkJCWlmIG9iajpJc0EoIk1vZGVsIikgb3Igb2JqOklzQSgiUGFydCIpIHRoZW4KCQkJCWZvciBfLCBzdWIgaW4gaXBhaXJzKG9iajpHZXRDaGlsZHJlbigpKSBkbwoJCQkJCWlmIGNsYXNzZXNUb0NsZWFuW3N1Yi5DbGFzc05hbWVdIHRoZW4KCQkJCQkJcGNhbGwoZnVuY3Rpb24oKSBzdWI6RGVzdHJveSgpIGVuZCkKCQkJCQllbmQKCQkJCWVuZAoJCQllbmQKCQllbmQKCQlsb2NhbCB0ZXJyYWluID0gd29ya3NwYWNlOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiVGVycmFpbiIpCgkJaWYgdGVycmFpbiB0aGVuCgkJCXRlcnJhaW4uV2F0ZXJXYXZlU2l6ZSA9IDAKCQkJdGVycmFpbi5XYXRlclJlZmxlY3RhbmNlID0gMAoJCQl0ZXJyYWluLldhdGVyVHJhbnNwYXJlbmN5ID0gMQoJCWVuZAoJZW5kKQoJcGNhbGwoZnVuY3Rpb24oKQoJCWxpZ2h0aW5nLkNsb2NrVGltZSA9IDE4CgkJbGlnaHRpbmcuQnJpZ2h0bmVzcyA9IDEuNQoJCWxpZ2h0aW5nLk91dGRvb3JBbWJpZW50ID0gQ29sb3IzLmZyb21SR0IoMTUwLCAxMDAsIDgwKQoJCWxpZ2h0aW5nLkZvZ0NvbG9yID0gQ29sb3IzLmZyb21SR0IoMjAwLCAxMjAsIDEwMCkKCQlsaWdodGluZy5Gb2dFbmQgPSA1MDAKCQlmb3IgXywgdiBpbiBpcGFpcnMobGlnaHRpbmc6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJaWYgdjpJc0EoIlNreSIpIHRoZW4KCQkJCXBjYWxsKGZ1bmN0aW9uKCkgdjpEZXN0cm95KCkgZW5kKQoJCQllbmQKCQllbmQKCQlsb2NhbCBza3kgPSBJbnN0YW5jZS5uZXcoIlNreSIpCgkJc2t5Lk5hbWUgPSAiU3Vuc2V0U2t5IgoJCXNreS5Ta3lib3hCayA9ICJyYnhhc3NldGlkOi8vMTMxODg5MDE3IgoJCXNreS5Ta3lib3hEbiA9ICJyYnhhc3NldGlkOi8vMTMxODg5MDE3IgoJCXNreS5Ta3lib3hGdCA9ICJyYnhhc3NldGlkOi8vMTMxODg5MDE3IgoJCXNreS5Ta3lib3hMZiA9ICJyYnhhc3NldGlkOi8vMTMxODg5MDE3IgoJCXNreS5Ta3lib3hSdCA9ICJyYnhhc3NldGlkOi8vMTMxODg5MDE3IgoJCXNreS5Ta3lib3hVcCA9ICJyYnhhc3NldGlkOi8vMTMxODg5MDE3IgoJCXNreS5TdW5Bbmd1bGFyU2l6ZSA9IDEwCgkJc2t5Lk1vb25Bbmd1bGFyU2l6ZSA9IDAKCQlza3kuU3VuVGV4dHVyZUlkID0gInJieGFzc2V0aWQ6Ly82NDQ0MzI5OTIiCgkJc2t5LlBhcmVudCA9IGxpZ2h0aW5nCgllbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gaG9va1Jlc2V0T25DaGFyYWN0ZXIoY2hhcikKCWlmIG5vdCBjaGFyIHRoZW4gcmV0dXJuIGVuZAoJbG9jYWwgaHVtYW5vaWQgPSBjaGFyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQoJc2FmZURpc2Nvbm5lY3QoIlJlc2V0RGVhdGgiKQoJY29ubmVjdGlvbnMuUmVzZXREZWF0aCA9IGh1bWFub2lkLkRpZWQ6Q29ubmVjdChmdW5jdGlvbigpCgkJdGFzay53YWl0KDAuNSkKCQlyZXNwYXduUGxheWVyKCkKCWVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBzdGFydFRpbnlJc2xhbmRMb29wKCkKCWxvY2FsIGlkID0gIlRpbnlJc2xhbmRMb29wIgoJbG9vcHNbaWRdID0gdHJ1ZQoJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJbG9jYWwgdGVsZXBvcnRQb3MgPSBDRnJhbWUubmV3KC0zNy4xLCA5LjIsIDE5MTkpCgkJd2hpbGUgY29tYm9BY3RpdmUgYW5kIGxvb3BzW2lkXSBkbwoJCQlwY2FsbChmdW5jdGlvbigpCgkJCQlsb2NhbCBjaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCgkJCQlpZiBjaGFyIGFuZCBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgoJCQkJCWNoYXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSB0ZWxlcG9ydFBvcwoJCQkJZW5kCgkJCWVuZCkKCQkJdGFzay53YWl0KDAuMikKCQllbmQKCWVuZCkKZW5kCgotLSDwn5S5IEtpbGxlcjpBZGRTd2l0Y2ggdmVyc2lvbgpLaWxsZXI6QWRkU3dpdGNoKCJPUCBQdW5jaCBXaGVuIERlYWQgfCBDb21ibyIsIGZ1bmN0aW9uKGVuYWJsZWQpCgljb21ib0FjdGl2ZSA9IGVuYWJsZWQKCWNsZWFudXBBbGwoKQoKCWlmIGVuYWJsZWQgdGhlbgoJCWFwcGx5U2l6ZU5hTigpCgkJc3RhcnRBdXRvUHVuY2goKQoJCXN0YXJ0UHJvdGVpbkVnZ0xvZ2ljKCkKCQlzdGFydEFudGlGbHkoKQoJCXNvZnRBbnRpTGFnQW5kU3Vuc2V0KCkKCQlzdGFydFRpbnlJc2xhbmRMb29wKCkKCgkJaWYgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KCQkJaG9va1Jlc2V0T25DaGFyYWN0ZXIoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyKQoJCWVuZAoJCXNhZmVEaXNjb25uZWN0KCJDaGFyYWN0ZXJBZGRlZFJlc2V0IikKCQljb25uZWN0aW9ucy5DaGFyYWN0ZXJBZGRlZFJlc2V0ID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGFyKQoJCQl0YXNrLndhaXQoMC41KQoJCQlob29rUmVzZXRPbkNoYXJhY3RlcihjaGFyKQoJCWVuZCkKCWVuZAplbmQpCgpLaWxsZXI6QWRkQnV0dG9uKCJOYU4gU2l6ZSIsIGZ1bmN0aW9uKCkKICAgIGxvY2FsIGFyZ3MgPSB7ImNoYW5nZVNpemUiLCAwLzB9CiAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJyRXZlbnRzIik6V2FpdEZvckNoaWxkKCJjaGFuZ2VTcGVlZFNpemVSZW1vdGUiKTpJbnZva2VTZXJ2ZXIodW5wYWNrKGFyZ3MpKQplbmQpCgpsb2NhbCBidXR0b24gPSBLaWxsZXI6QWRkQnV0dG9uKCJSZW1vdmUgUHVuY2ggQW5pbSIsIGZ1bmN0aW9uKCkKICAgIGxvY2FsIGJsb2NrZWRBbmltYXRpb25zID0gewogICAgICAgIFsicmJ4YXNzZXRpZDovLzM2Mzg3MjkwNTMiXSA9IHRydWUsCiAgICAgICAgWyJyYnhhc3NldGlkOi8vMzYzODc2NzQyNyJdID0gdHJ1ZSwKICAgIH0KCiAgICBsb2NhbCBmdW5jdGlvbiBzZXR1cEFuaW1hdGlvbkJsb2NraW5nKCkKICAgICAgICBsb2NhbCBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGlmIG5vdCBjaGFyIG9yIG5vdCBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICBsb2NhbCBodW1hbm9pZCA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKCiAgICAgICAgZm9yIF8sIHRyYWNrIGluIHBhaXJzKGh1bWFub2lkOkdldFBsYXlpbmdBbmltYXRpb25UcmFja3MoKSkgZG8KICAgICAgICAgICAgaWYgdHJhY2suQW5pbWF0aW9uIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1JZCA9IHRyYWNrLkFuaW1hdGlvbi5BbmltYXRpb25JZAogICAgICAgICAgICAgICAgbG9jYWwgYW5pbU5hbWUgPSB0cmFjay5OYW1lOmxvd2VyKCkKCiAgICAgICAgICAgICAgICBpZiBibG9ja2VkQW5pbWF0aW9uc1thbmltSWRdIG9yCiAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInB1bmNoIikgb3IKICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgiYXR0YWNrIikgb3IKICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicmlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdHJhY2s6U3RvcCgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBfRy5BbmltQmxvY2tDb25uZWN0aW9uIHRoZW4KICAgICAgICAgICAgbG9jYWwgY29ubmVjdGlvbiA9IGh1bWFub2lkLkFuaW1hdGlvblBsYXllZDpDb25uZWN0KGZ1bmN0aW9uKHRyYWNrKQogICAgICAgICAgICAgICAgaWYgdHJhY2suQW5pbWF0aW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbmltSWQgPSB0cmFjay5BbmltYXRpb24uQW5pbWF0aW9uSWQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbmltTmFtZSA9IHRyYWNrLk5hbWU6bG93ZXIoKQoKICAgICAgICAgICAgICAgICAgICBpZiBibG9ja2VkQW5pbWF0aW9uc1thbmltSWRdIG9yCiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJwdW5jaCIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJhdHRhY2siKSBvcgogICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicmlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrOlN0b3AoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIF9HLkFuaW1CbG9ja0Nvbm5lY3Rpb24gPSBjb25uZWN0aW9uCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBzZXR1cEFuaW1hdGlvbkJsb2NraW5nKCkKCiAgICBsb2NhbCBmdW5jdGlvbiBvdmVycmlkZVRvb2xBY3RpdmF0aW9uKCkKICAgICAgICBsb2NhbCBmdW5jdGlvbiBwcm9jZXNzVG9vbCh0b29sKQogICAgICAgICAgICBpZiB0b29sIGFuZCAodG9vbC5OYW1lID09ICJQdW5jaCIgb3IgdG9vbC5OYW1lOm1hdGNoKCJBdHRhY2siKSBvciB0b29sLk5hbWU6bWF0Y2goIlJpZ2h0IikpIHRoZW4KICAgICAgICAgICAgICAgIGlmIG5vdCB0b29sOkdldEF0dHJpYnV0ZSgiQWN0aXZhdGVkT3ZlcnJpZGUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdG9vbDpTZXRBdHRyaWJ1dGUoIkFjdGl2YXRlZE92ZXJyaWRlIiwgdHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY29ubmVjdGlvbiA9IHRvb2wuQWN0aXZhdGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4wNSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoYXIgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHRyYWNrIGluIHBhaXJzKGNoYXIuSHVtYW5vaWQ6R2V0UGxheWluZ0FuaW1hdGlvblRyYWNrcygpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRyYWNrLkFuaW1hdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1JZCA9IHRyYWNrLkFuaW1hdGlvbi5BbmltYXRpb25JZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbmltTmFtZSA9IHRyYWNrLk5hbWU6bG93ZXIoKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYmxvY2tlZEFuaW1hdGlvbnNbYW5pbUlkXSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInB1bmNoIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJhdHRhY2siKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInJpZ2h0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2s6U3RvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IF9HLlRvb2xDb25uZWN0aW9ucyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIF9HLlRvb2xDb25uZWN0aW9ucyA9IHt9CiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgX0cuVG9vbENvbm5lY3Rpb25zW3Rvb2xdID0gY29ubmVjdGlvbgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBmb3IgXywgdG9vbCBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgcHJvY2Vzc1Rvb2wodG9vbCkKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBpZiBjaGFyIHRoZW4KICAgICAgICAgICAgZm9yIF8sIHRvb2wgaW4gcGFpcnMoY2hhcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgaWYgdG9vbDpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Rvb2wodG9vbCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgaWYgbm90IF9HLkJhY2twYWNrQWRkZWRDb25uZWN0aW9uIHRoZW4KICAgICAgICAgICAgX0cuQmFja3BhY2tBZGRlZENvbm5lY3Rpb24gPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2suQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQogICAgICAgICAgICAgICAgaWYgY2hpbGQ6SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Rvb2woY2hpbGQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbiBhbmQgY2hhciB0aGVuCiAgICAgICAgICAgIF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb24gPSBjaGFyLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKICAgICAgICAgICAgICAgIGlmIGNoaWxkOklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NUb29sKGNoaWxkKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIG92ZXJyaWRlVG9vbEFjdGl2YXRpb24oKQoKICAgIGlmIG5vdCBfRy5BbmltTW9uaXRvckNvbm5lY3Rpb24gdGhlbgogICAgICAgIF9HLkFuaW1Nb25pdG9yQ29ubmVjdGlvbiA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgdGljaygpICUgMC41IDwgMC4wMSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgaWYgY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHRyYWNrIGluIHBhaXJzKGNoYXIuSHVtYW5vaWQ6R2V0UGxheWluZ0FuaW1hdGlvblRyYWNrcygpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB0cmFjay5BbmltYXRpb24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5pbUlkID0gdHJhY2suQW5pbWF0aW9uLkFuaW1hdGlvbklkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbmltTmFtZSA9IHRyYWNrLk5hbWU6bG93ZXIoKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJsb2NrZWRBbmltYXRpb25zW2FuaW1JZF0gb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicHVuY2giKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJhdHRhY2siKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJyaWdodCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFjazpTdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKCiAgICBpZiBub3QgX0cuQ2hhcmFjdGVyQWRkZWRDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5DaGFyYWN0ZXJBZGRlZENvbm5lY3Rpb24gPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihuZXdDaGFyKQogICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgc2V0dXBBbmltYXRpb25CbG9ja2luZygpCiAgICAgICAgICAgIG92ZXJyaWRlVG9vbEFjdGl2YXRpb24oKQoKICAgICAgICAgICAgaWYgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgICAgICBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb24gPSBuZXdDaGFyLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKICAgICAgICAgICAgICAgIGlmIGNoaWxkOklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NUb29sKGNoaWxkKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKZnVuY3Rpb24gUmVjb3ZlcnlQdW5jaCgpCiAgICBpZiBfRy5BbmltQmxvY2tDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5BbmltQmxvY2tDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgIF9HLkFuaW1CbG9ja0Nvbm5lY3Rpb24gPSBuaWwKICAgIGVuZAogICAgaWYgX0cuQW5pbU1vbml0b3JDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5BbmltTW9uaXRvckNvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgX0cuQW5pbU1vbml0b3JDb25uZWN0aW9uID0gbmlsCiAgICBlbmQKICAgIGlmIF9HLlRvb2xDb25uZWN0aW9ucyB0aGVuCiAgICAgICAgZm9yIF8sIGNvbm4gaW4gcGFpcnMoX0cuVG9vbENvbm5lY3Rpb25zKSBkbwogICAgICAgICAgICBpZiBjb25uIHRoZW4gY29ubjpEaXNjb25uZWN0KCkgZW5kCiAgICAgICAgZW5kCiAgICAgICAgX0cuVG9vbENvbm5lY3Rpb25zID0gbmlsCiAgICBlbmQKICAgIGlmIF9HLkJhY2twYWNrQWRkZWRDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5CYWNrcGFja0FkZGVkQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBfRy5CYWNrcGFja0FkZGVkQ29ubmVjdGlvbiA9IG5pbAogICAgZW5kCiAgICBpZiBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgIF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb24gPSBuaWwKICAgIGVuZAogICAgaWYgX0cuQ2hhcmFjdGVyQWRkZWRDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5DaGFyYWN0ZXJBZGRlZENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgX0cuQ2hhcmFjdGVyQWRkZWRDb25uZWN0aW9uID0gbmlsCiAgICBlbmQKZW5kCgpLaWxsZXI6QWRkQnV0dG9uKCJSZWNvdmVyIFB1bmNoIEFuaW0iLCBmdW5jdGlvbigpCiAgICBSZWNvdmVyeVB1bmNoKCkKZW5kKQoKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBmcmllbmRXaGl0ZWxpc3RBY3RpdmUgPSBmYWxzZQoKS2lsbGVyOkFkZFN3aXRjaCgiQXV0byBXaGl0ZWxpc3QgRnJpZW5kcyAoRmFzdCBGdW5jdGlvbikgIiwgZnVuY3Rpb24oc3RhdGUpCiAgICBmcmllbmRXaGl0ZWxpc3RBY3RpdmUgPSBzdGF0ZQoKICAgIGlmIHN0YXRlIHRoZW4KICAgICAgICBmb3IgXywgcGxheWVyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIGFuZCBMb2NhbFBsYXllcjpJc0ZyaWVuZHNXaXRoKHBsYXllci5Vc2VySWQpIHRoZW4KICAgICAgICAgICAgICAgIHBsYXllcldoaXRlbGlzdFtwbGF5ZXIuTmFtZV0gPSB0cnVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBQbGF5ZXJzLlBsYXllckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24ocGxheWVyKQogICAgICAgICAgICBpZiBmcmllbmRXaGl0ZWxpc3RBY3RpdmUgYW5kIHBsYXllciB+PSBMb2NhbFBsYXllciBhbmQgTG9jYWxQbGF5ZXI6SXNGcmllbmRzV2l0aChwbGF5ZXIuVXNlcklkKSB0aGVuCiAgICAgICAgICAgICAgICBwbGF5ZXJXaGl0ZWxpc3RbcGxheWVyLk5hbWVdID0gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgZm9yIG5hbWUgaW4gcGFpcnMocGxheWVyV2hpdGVsaXN0KSBkbwogICAgICAgICAgICBsb2NhbCBmcmllbmQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKG5hbWUpCiAgICAgICAgICAgIGlmIGZyaWVuZCBhbmQgTG9jYWxQbGF5ZXI6SXNGcmllbmRzV2l0aChmcmllbmQuVXNlcklkKSB0aGVuCiAgICAgICAgICAgICAgICBwbGF5ZXJXaGl0ZWxpc3RbbmFtZV0gPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKS2lsbGVyOkFkZFRleHRCb3goIldoaXRlbGlzdCIsIGZ1bmN0aW9uKHRleHQpCiAgICBsb2NhbCB0YXJnZXQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKHRleHQpCiAgICBpZiB0YXJnZXQgdGhlbgogICAgICAgIHBsYXllcldoaXRlbGlzdFt0YXJnZXQuTmFtZV0gPSB0cnVlCiAgICBlbmQKZW5kKQoKS2lsbGVyOkFkZFRleHRCb3goIlVuV2hpdGVsaXN0IiwgZnVuY3Rpb24odGV4dCkKICAgIGxvY2FsIHRhcmdldCA9IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQodGV4dCkKICAgIGlmIHRhcmdldCB0aGVuCiAgICAgICAgcGxheWVyV2hpdGVsaXN0W3RhcmdldC5OYW1lXSA9IG5pbAogICAgZW5kCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIkF1dG8gS2lsbCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBhdXRvS2lsbCA9IGJvb2wKCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBhdXRvS2lsbCBkbwogICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3IgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCiAgICAgICAgICAgIGxvY2FsIHJpZ2h0SGFuZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikKICAgICAgICAgICAgbG9jYWwgbGVmdEhhbmQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikKCiAgICAgICAgICAgIGxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICAgICAgaWYgcHVuY2ggYW5kIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikgdGhlbgogICAgICAgICAgICAgICAgcHVuY2guUGFyZW50ID0gY2hhcmFjdGVyCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgcmlnaHRIYW5kIGFuZCBsZWZ0SGFuZCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdGFyZ2V0IGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB0YXJnZXQgfj0gTG9jYWxQbGF5ZXIgYW5kIG5vdCBwbGF5ZXJXaGl0ZWxpc3RbdGFyZ2V0Lk5hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0Q2hhciA9IHRhcmdldC5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSB0YXJnZXRDaGFyIGFuZCB0YXJnZXRDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcm9vdFBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpsb2NhbCB0YXJnZXREcm9wZG93biA9IEtpbGxlcjpBZGREcm9wZG93bigiU2VsZWN0IFRhcmdldCIsIGZ1bmN0aW9uKG5hbWUpCiAgICBpZiBuYW1lIGFuZCBub3QgdGFibGUuZmluZCh0YXJnZXRQbGF5ZXJOYW1lcywgbmFtZSkgdGhlbgogICAgICAgIHRhYmxlLmluc2VydCh0YXJnZXRQbGF5ZXJOYW1lcywgbmFtZSkKICAgIGVuZAplbmQpCgpLaWxsZXI6QWRkVGV4dEJveCgiUmVtb3ZlIFRhcmdldCIsIGZ1bmN0aW9uKG5hbWUpCiAgICBmb3IgaSwgdiBpbiBpcGFpcnModGFyZ2V0UGxheWVyTmFtZXMpIGRvCiAgICAgICAgaWYgdiA9PSBuYW1lIHRoZW4KICAgICAgICAgICAgdGFibGUucmVtb3ZlKHRhcmdldFBsYXllck5hbWVzLCBpKQogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmZvciBfLCBwbGF5ZXIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICB0YXJnZXREcm9wZG93bjpBZGQocGxheWVyLk5hbWUpCiAgICAgICAgdGFyZ2V0RHJvcGRvd25JdGVtc1twbGF5ZXIuTmFtZV0gPSB0cnVlCiAgICBlbmQKZW5kCgpQbGF5ZXJzLlBsYXllckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24ocGxheWVyKQogICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICB0YXJnZXREcm9wZG93bjpBZGQocGxheWVyLk5hbWUpCiAgICAgICAgdGFyZ2V0RHJvcGRvd25JdGVtc1twbGF5ZXIuTmFtZV0gPSB0cnVlCiAgICBlbmQKZW5kKQoKUGxheWVycy5QbGF5ZXJSZW1vdmluZzpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIGlmIHRhcmdldERyb3Bkb3duSXRlbXNbcGxheWVyLk5hbWVdIHRoZW4KICAgICAgICB0YXJnZXREcm9wZG93bkl0ZW1zW3BsYXllci5OYW1lXSA9IG5pbAogICAgICAgIHRhcmdldERyb3Bkb3duOkNsZWFyKCkKICAgICAgICBmb3IgbmFtZSBpbiBwYWlycyh0YXJnZXREcm9wZG93bkl0ZW1zKSBkbwogICAgICAgICAgICB0YXJnZXREcm9wZG93bjpBZGQobmFtZSkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGZvciBpID0gI3RhcmdldFBsYXllck5hbWVzLCAxLCAtMSBkbwogICAgICAgIGlmIHRhcmdldFBsYXllck5hbWVzW2ldID09IHBsYXllci5OYW1lIHRoZW4KICAgICAgICAgICAgdGFibGUucmVtb3ZlKHRhcmdldFBsYXllck5hbWVzLCBpKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIlN0YXJ0IEtpbGwgVGFyZ2V0IiwgZnVuY3Rpb24oc3RhdGUpCiAgICBraWxsVGFyZ2V0ID0gc3RhdGUKCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBraWxsVGFyZ2V0IGRvCiAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKCiAgICAgICAgICAgIGxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICAgICAgaWYgcHVuY2ggYW5kIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikgdGhlbgogICAgICAgICAgICAgICAgcHVuY2guUGFyZW50ID0gY2hhcmFjdGVyCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgcmlnaHRIYW5kID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiUmlnaHRIYW5kIiwgNSkKICAgICAgICAgICAgbG9jYWwgbGVmdEhhbmQgPSBjaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJMZWZ0SGFuZCIsIDUpCgogICAgICAgICAgICBpZiByaWdodEhhbmQgYW5kIGxlZnRIYW5kIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCBuYW1lIGluIGlwYWlycyh0YXJnZXRQbGF5ZXJOYW1lcykgZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKG5hbWUpCiAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0IGFuZCB0YXJnZXQgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCByb290UGFydCA9IHRhcmdldC5DaGFyYWN0ZXIgYW5kIHRhcmdldC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiByb290UGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocmlnaHRIYW5kLCByb290UGFydCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChsZWZ0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocmlnaHRIYW5kLCByb290UGFydCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChsZWZ0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmxvY2FsIHNweVRhcmdldERyb3Bkb3duID0gS2lsbGVyOkFkZERyb3Bkb3duKCJTZWxlY3QgVmlldyBUYXJnZXQiLCBmdW5jdGlvbihuYW1lKQogICAgdGFyZ2V0UGxheWVyTmFtZSA9IG5hbWUKZW5kKQoKZm9yIF8sIHBsYXllciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIHNweVRhcmdldERyb3Bkb3duOkFkZChwbGF5ZXIuTmFtZSkKICAgIGVuZAplbmQKClBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpCiAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIHNweVRhcmdldERyb3Bkb3duOkFkZChwbGF5ZXIuTmFtZSkKICAgIGVuZAplbmQpCgpQbGF5ZXJzLlBsYXllclJlbW92aW5nOkNvbm5lY3QoZnVuY3Rpb24ocGxheWVyKQogICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICBzcHlUYXJnZXREcm9wZG93bjpDbGVhcigpCiAgICAgICAgZm9yIF8sIHBsciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgIGlmIHBsciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgICAgICAgICBzcHlUYXJnZXREcm9wZG93bjpBZGQocGxyLk5hbWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIlZpZXcgUGxheWVyIiwgZnVuY3Rpb24oYm9vbCkKICAgIHNweWluZyA9IGJvb2wKICAgIGlmIG5vdCBzcHlpbmcgdGhlbgogICAgICAgIGxvY2FsIGNhbSA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhCiAgICAgICAgY2FtLkNhbWVyYVN1YmplY3QgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSBvciBMb2NhbFBsYXllcgogICAgICAgIHJldHVybgogICAgZW5kCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBzcHlpbmcgZG8KICAgICAgICAgICAgbG9jYWwgdGFyZ2V0ID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZCh0YXJnZXRQbGF5ZXJOYW1lKQogICAgICAgICAgICBpZiB0YXJnZXQgYW5kIHRhcmdldCB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBodW1hbm9pZCA9IHRhcmdldC5DaGFyYWN0ZXIgYW5kIHRhcmdldC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKICAgICAgICAgICAgICAgIGlmIGh1bWFub2lkIHRoZW4KICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DYW1lcmFTdWJqZWN0ID0gaHVtYW5vaWQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKS2lsbGVyOkFkZFN3aXRjaCgiQXV0byBHb29kIEthcm1hIiwgZnVuY3Rpb24oYm9vbCkKICAgIGF1dG9Hb29kS2FybWEgPSBib29sCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBhdXRvR29vZEthcm1hIGRvCiAgICAgICAgICAgIGxvY2FsIHBsYXllckNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgbG9jYWwgcmlnaHRIYW5kID0gcGxheWVyQ2hhciBhbmQgcGxheWVyQ2hhcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikKICAgICAgICAgICAgbG9jYWwgbGVmdEhhbmQgPSBwbGF5ZXJDaGFyIGFuZCBwbGF5ZXJDaGFyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpCiAgICAgICAgICAgIGlmIHBsYXllckNoYXIgYW5kIHJpZ2h0SGFuZCBhbmQgbGVmdEhhbmQgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHRhcmdldCBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0IH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXZpbEthcm1hID0gdGFyZ2V0OkZpbmRGaXJzdENoaWxkKCJldmlsS2FybWEiKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBnb29kS2FybWEgPSB0YXJnZXQ6RmluZEZpcnN0Q2hpbGQoImdvb2RLYXJtYSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGV2aWxLYXJtYSBhbmQgZ29vZEthcm1hIGFuZCBldmlsS2FybWE6SXNBKCJJbnRWYWx1ZSIpIGFuZCBnb29kS2FybWE6SXNBKCJJbnRWYWx1ZSIpIGFuZCBldmlsS2FybWEuVmFsdWUgPiBnb29kS2FybWEuVmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSB0YXJnZXQuQ2hhcmFjdGVyIGFuZCB0YXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJvb3RQYXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChyaWdodEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGxlZnRIYW5kLCByb290UGFydCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChyaWdodEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGxlZnRIYW5kLCByb290UGFydCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdGFzay53YWl0KDAuMDEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIkF1dG8gQmFkIEthcm1hIChGYXN0IEF1dG8gS2lsbCkgIiwgZnVuY3Rpb24oYm9vbCkKICAgIGF1dG9CYWRLYXJtYSA9IGJvb2wKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGF1dG9CYWRLYXJtYSBkbwogICAgICAgICAgICBsb2NhbCBwbGF5ZXJDaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgIGxvY2FsIHJpZ2h0SGFuZCA9IHBsYXllckNoYXIgYW5kIHBsYXllckNoYXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpCiAgICAgICAgICAgIGxvY2FsIGxlZnRIYW5kID0gcGxheWVyQ2hhciBhbmQgcGxheWVyQ2hhcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKQogICAgICAgICAgICBpZiBwbGF5ZXJDaGFyIGFuZCByaWdodEhhbmQgYW5kIGxlZnRIYW5kIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCB0YXJnZXQgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldCB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGV2aWxLYXJtYSA9IHRhcmdldDpGaW5kRmlyc3RDaGlsZCgiZXZpbEthcm1hIikKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZ29vZEthcm1hID0gdGFyZ2V0OkZpbmRGaXJzdENoaWxkKCJnb29kS2FybWEiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBldmlsS2FybWEgYW5kIGdvb2RLYXJtYSBhbmQgZXZpbEthcm1hOklzQSgiSW50VmFsdWUiKSBhbmQgZ29vZEthcm1hOklzQSgiSW50VmFsdWUiKSBhbmQgZ29vZEthcm1hLlZhbHVlID4gZXZpbEthcm1hLlZhbHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gdGFyZ2V0LkNoYXJhY3RlciBhbmQgdGFyZ2V0LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByb290UGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocmlnaHRIYW5kLCByb290UGFydCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChsZWZ0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocmlnaHRIYW5kLCByb290UGFydCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChsZWZ0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAxKQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCgpsb2NhbCBmb2xsb3dpbmcgPSBmYWxzZQpsb2NhbCBmb2xsb3dUYXJnZXQgPSBuaWwKCi0tIPCfk4wgRnVuY2nDs246IFRQIGRldHLDoXMgZGVsIGp1Z2Fkb3IKbG9jYWwgZnVuY3Rpb24gZm9sbG93UGxheWVyKHRhcmdldFBsYXllcikKICAgIGxvY2FsIG15Q2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgbG9jYWwgdGFyZ2V0Q2hhciA9IHRhcmdldFBsYXllci5DaGFyYWN0ZXIKCiAgICBpZiBub3QgKG15Q2hhciBhbmQgdGFyZ2V0Q2hhcikgdGhlbiByZXR1cm4gZW5kCiAgICBsb2NhbCBteUhSUCA9IG15Q2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBsb2NhbCB0YXJnZXRIUlAgPSB0YXJnZXRDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKCiAgICBpZiBteUhSUCBhbmQgdGFyZ2V0SFJQIHRoZW4KICAgICAgICBsb2NhbCBmb2xsb3dQb3MgPSB0YXJnZXRIUlAuUG9zaXRpb24gLSAodGFyZ2V0SFJQLkNGcmFtZS5Mb29rVmVjdG9yICogMykKICAgICAgICBteUhSUC5DRnJhbWUgPSBDRnJhbWUubmV3KGZvbGxvd1BvcywgdGFyZ2V0SFJQLlBvc2l0aW9uKQogICAgZW5kCmVuZAoKLS0g8J+TjCBEcm9wZG93biBkaW7DoW1pY28gZGUganVnYWRvcmVzCmxvY2FsIGZvbGxvd0Ryb3Bkb3duID0gS2lsbGVyOkFkZERyb3Bkb3duKCJUZWxlcG9ydCBwbGF5ZXIiLCBmdW5jdGlvbihzZWxlY3RlZERpc3BsYXlOYW1lKQogICAgaWYgc2VsZWN0ZWREaXNwbGF5TmFtZSBhbmQgc2VsZWN0ZWREaXNwbGF5TmFtZSB+PSAiIiB0aGVuCiAgICAgICAgLS0gQnVzY2FyIGp1Z2Fkb3IgcG9yIERpc3BsYXlOYW1lCiAgICAgICAgbG9jYWwgdGFyZ2V0ID0gbmlsCiAgICAgICAgZm9yIF8sIHBsciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgIGlmIHBsci5EaXNwbGF5TmFtZSA9PSBzZWxlY3RlZERpc3BsYXlOYW1lIHRoZW4KICAgICAgICAgICAgICAgIHRhcmdldCA9IHBscgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGlmIHRhcmdldCB0aGVuCiAgICAgICAgICAgIGZvbGxvd1RhcmdldCA9IHRhcmdldC5OYW1lIC0tIEd1YXJkYW1vcyBOYW1lIHJlYWwgcGFyYSBzZWd1aXIKICAgICAgICAgICAgZm9sbG93aW5nID0gdHJ1ZQogICAgICAgICAgICBwcmludCgi4pyFIFN0YXJ0ZWQgZm9sbG93aW5nOiIsIHRhcmdldC5OYW1lKQoKICAgICAgICAgICAgLS0gVFAgaW5tZWRpYXRvCiAgICAgICAgICAgIGZvbGxvd1BsYXllcih0YXJnZXQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKLS0g8J+TjCBJbmljaWFsaXphciBsaXN0YSBjb24gRGlzcGxheU5hbWVzCmZvciBfLCBwbGF5ZXIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICBmb2xsb3dEcm9wZG93bjpBZGQocGxheWVyLkRpc3BsYXlOYW1lKQogICAgZW5kCmVuZAoKLS0g8J+TjCBBY3R1YWxpemFyIGxpc3RhIGN1YW5kbyBlbnRyZW4ganVnYWRvcmVzClBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpCiAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIGZvbGxvd0Ryb3Bkb3duOkFkZChwbGF5ZXIuRGlzcGxheU5hbWUpCiAgICBlbmQKZW5kKQoKLS0g8J+TjCBBY3R1YWxpemFyIGxpc3RhIGN1YW5kbyBzZSB2YXlhbiBqdWdhZG9yZXMKUGxheWVycy5QbGF5ZXJSZW1vdmluZzpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIC0tIExpbXBpYW1vcyB5IGFncmVnYW1vcyBkZSBudWV2bwogICAgZm9sbG93RHJvcGRvd246Q2xlYXIoKQogICAgZm9yIF8sIHBsciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgaWYgcGxyIH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgZm9sbG93RHJvcGRvd246QWRkKHBsci5EaXNwbGF5TmFtZSkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tIERlamFyIGRlIHNlZ3VpciBzaSBzZSBmdWUKICAgIGlmIGZvbGxvd1RhcmdldCA9PSBwbGF5ZXIuTmFtZSB0aGVuCiAgICAgICAgZm9sbG93VGFyZ2V0ID0gbmlsCiAgICAgICAgZm9sbG93aW5nID0gZmFsc2UKICAgIGVuZAplbmQpCgotLSDwn5OMIEJvdMOzbiBwYXJhIGRlamFyIGRlIHNlZ3VpcgpLaWxsZXI6QWRkQnV0dG9uKCJTdG9wIEZvbGxvdyIsIGZ1bmN0aW9uKCkKICAgIGZvbGxvd2luZyA9IGZhbHNlCiAgICBmb2xsb3dUYXJnZXQgPSBuaWwKICAgIHByaW50KCLim5QgU3RvcHBlZCBmb2xsb3dpbmciKQplbmQpCgotLSDwn5OMIExvb3AgZGUgc2VndWltaWVudG8gYXV0b23DoXRpY28KdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0YXNrLndhaXQoMC4wMSkgZG8KICAgICAgICBpZiBmb2xsb3dpbmcgYW5kIGZvbGxvd1RhcmdldCB0aGVuCiAgICAgICAgICAgIGxvY2FsIHRhcmdldCA9IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoZm9sbG93VGFyZ2V0KQogICAgICAgICAgICBpZiB0YXJnZXQgdGhlbgogICAgICAgICAgICAgICAgZm9sbG93UGxheWVyKHRhcmdldCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZm9sbG93aW5nID0gZmFsc2UKICAgICAgICAgICAgICAgIGZvbGxvd1RhcmdldCA9IG5pbAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgotLSDwn5OMIFJlaW50ZW50YXIgY3VhbmRvIHJlc3Bhd25lZXMKTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICB0YXNrLndhaXQoMSkKICAgIGlmIGZvbGxvd2luZyBhbmQgZm9sbG93VGFyZ2V0IHRoZW4KICAgICAgICBsb2NhbCB0YXJnZXQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKGZvbGxvd1RhcmdldCkKICAgICAgICBpZiB0YXJnZXQgdGhlbgogICAgICAgICAgICBmb2xsb3dQbGF5ZXIodGFyZ2V0KQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmxvY2FsIGdvZERhbWFnZUFjdGl2ZSA9IGZhbHNlCgpLaWxsZXI6QWRkU3dpdGNoKCJhdXRvIHNsYW1zIiwgZnVuY3Rpb24oc3RhdGUpCiAgICBnb2REYW1hZ2VBY3RpdmUgPSBzdGF0ZQogICAgaWYgc3RhdGUgdGhlbgogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBnb2REYW1hZ2VBY3RpdmUgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IExvY2FsUGxheWVyCiAgICAgICAgICAgICAgICBsb2NhbCBncm91bmRTbGFtID0gcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJHcm91bmQgU2xhbSIpIG9yIChwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJHcm91bmQgU2xhbSIpKQoKICAgICAgICAgICAgICAgIGlmIGdyb3VuZFNsYW0gdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGdyb3VuZFNsYW0uUGFyZW50ID09IHBsYXllci5CYWNrcGFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VuZFNsYW0uUGFyZW50ID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGdyb3VuZFNsYW06RmluZEZpcnN0Q2hpbGQoImF0dGFja1RpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VuZFNsYW0uYXR0YWNrVGltZS5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBwbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigic2xhbSIpCiAgICAgICAgICAgICAgICAgICAgZ3JvdW5kU2xhbTpBY3RpdmF0ZSgpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKbG9jYWwgc2VydmVyVGFiID0gd2luZG93OkFkZFRhYigiU2VydmVyIikKCnNlcnZlclRhYjpBZGRMYWJlbCgiU2VydmVyIE9wdGlvbnMiKQoKLS0gQWRkIGFkIHJlbW92YWwgYnV0dG9uIHRvIE1pc2MgMQpzZXJ2ZXJUYWI6QWRkQnV0dG9uKCJSZW1vdmUgUG9ydGFscyIsIGZ1bmN0aW9uKCkKICAgIC0tIFJlbW92ZSBleGlzdGluZyBhZCBwb3J0YWxzCiAgICBmb3IgXywgcG9ydGFsIGluIHBhaXJzKGdhbWU6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICBpZiBwb3J0YWwuTmFtZSA9PSAiUm9ibG94Rm9yd2FyZFBvcnRhbHMiIHRoZW4KICAgICAgICAgICAgcG9ydGFsOkRlc3Ryb3koKQogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIC0tIFNldCB1cCBjb25uZWN0aW9uIHRvIHJlbW92ZSBmdXR1cmUgYWQgcG9ydGFscwogICAgaWYgX0cuQWRSZW1vdmFsQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQWRSZW1vdmFsQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgIGVuZAogICAgCiAgICBfRy5BZFJlbW92YWxDb25uZWN0aW9uID0gZ2FtZS5EZXNjZW5kYW50QWRkZWQ6Q29ubmVjdChmdW5jdGlvbihkZXNjZW5kYW50KQogICAgICAgIGlmIGRlc2NlbmRhbnQuTmFtZSA9PSAiUm9ibG94Rm9yd2FyZFBvcnRhbHMiIHRoZW4KICAgICAgICAgICAgZGVzY2VuZGFudDpEZXN0cm95KCkKICAgICAgICBlbmQKICAgIGVuZCkKICAgIAogICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICBUaXRsZSA9ICJBZHMgUmVtb3ZlZCIsCiAgICAgICAgVGV4dCA9ICJSb2Jsb3ggYWRzIGhhdmUgYmVlbiByZW1vdmVkIiwKICAgICAgICBEdXJhdGlvbiA9IDAKICAgIH0pCmVuZCkKCnNlcnZlclRhYjpBZGRCdXR0b24oIkFudGkgQUZLIiwgZnVuY3Rpb24oKQogICAgIGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vU29uenl4RGV2L0dQTVIvcmVmcy9oZWFkcy9tYWluL0dhcmFtb25kVjIiKSkoKQplbmQpCgpzZXJ2ZXJUYWI6QWRkQnV0dG9uKCJMZXNzIExhZyIsIGZ1bmN0aW9uKCkKICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWU6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICBpZiB2OklzQSgiUGFydGljbGVFbWl0dGVyIikgb3IgdjpJc0EoIlNtb2tlIikgb3IgdjpJc0EoIkZpcmUiKSBvciB2OklzQSgiU3BhcmtsZXMiKSB0aGVuCiAgICAgICAgICAgIHYuRW5hYmxlZCA9IGZhbHNlCiAgICAgICAgZW5kCiAgICBlbmQKIAogICAgbG9jYWwgbGlnaHRpbmcgPSBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikKICAgIGxpZ2h0aW5nLkdsb2JhbFNoYWRvd3MgPSBmYWxzZQogICAgbGlnaHRpbmcuRm9nRW5kID0gOWU5CiAgICBsaWdodGluZy5CcmlnaHRuZXNzID0gMAogCiAgICBzZXR0aW5ncygpLlJlbmRlcmluZy5RdWFsaXR5TGV2ZWwgPSAxCiAKICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWU6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICBpZiB2OklzQSgiRGVjYWwiKSBvciB2OklzQSgiVGV4dHVyZSIpIHRoZW4KICAgICAgICAgICAgdi5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgZWxzZWlmIHY6SXNBKCJCYXNlUGFydCIpIGFuZCBub3QgdjpJc0EoIk1lc2hQYXJ0IikgdGhlbgogICAgICAgICAgICB2Lk1hdGVyaWFsID0gRW51bS5NYXRlcmlhbC5TbW9vdGhQbGFzdGljCiAgICAgICAgICAgIGlmIHYuUGFyZW50IGFuZCAodi5QYXJlbnQ6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgb3Igdi5QYXJlbnQuUGFyZW50OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpKSB0aGVuCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHYuUmVmbGVjdGFuY2UgPSAwCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAKICAgIGZvciBfLCB2IGluIHBhaXJzKGxpZ2h0aW5nOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgdjpJc0EoIkJsdXJFZmZlY3QiKSBvciB2OklzQSgiU3VuUmF5c0VmZmVjdCIpIG9yIHY6SXNBKCJDb2xvckNvcnJlY3Rpb25FZmZlY3QiKSBvciB2OklzQSgiQmxvb21FZmZlY3QiKSBvciB2OklzQSgiRGVwdGhPZkZpZWxkRWZmZWN0IikgdGhlbgogICAgICAgICAgICB2LkVuYWJsZWQgPSBmYWxzZQogICAgICAgIGVuZAogICAgZW5kCiAKICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgVGl0bGUgPSAiT3B0aW1pemF0aW9uIiwKICAgICAgICBUZXh0ID0gIkZ1bGwgb3B0aW1pemF0aW9uIGFwcGxpZWQhIiwKICAgICAgICBEdXJhdGlvbiA9IDUKICAgIH0pCmVuZCkKCnNlcnZlclRhYjpBZGRCdXR0b24oIlJlam9pbiBTZXJ2ZXIiLCBmdW5jdGlvbigpCiAgICBsb2NhbCB0cyA9IGdhbWU6R2V0U2VydmljZSgiVGVsZXBvcnRTZXJ2aWNlIikKICAgIGxvY2FsIHAgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgogICAgdHM6VGVsZXBvcnQoZ2FtZS5QbGFjZUlkLCBwKQplbmQpCiAKbG9jYWwgam9pbkxvd1BsYXllclNlcnZlclN3aXRjaCA9IHNlcnZlclRhYjpBZGRTd2l0Y2goIkpvaW4gTG93IFBsYXllciBTZXJ2ZXIiLCBmdW5jdGlvbihib29sKQogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgbG9jYWwgbW9kdWxlID0gbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9MZW9LaG9sWXQvcm9ibG94L21haW4vbGtfc2VydmVyaG9wLmx1YSIpKSgpCiAgICAgICAgbW9kdWxlOlRlbGVwb3J0KGdhbWUuUGxhY2VJZCwgIkxvd2VzdCIpCiAgICBlbmQKZW5kKQoKbG9jYWwgYXV0b1JvY2tUYWIgPSB3aW5kb3c6QWRkVGFiKCJSb2NrcyIpCgphdXRvUm9ja1RhYjpBZGRMYWJlbCgiLS0tVE1CIEZhc3QgR2xpdGNoLS0tIikKCi0tIERlZmluZSB0aGUgZ2V0dG9vbCBmdW5jdGlvbiBmaXJzdApmdW5jdGlvbiBnZXR0b29sKCkKICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIHYuTmFtZSA9PSAiUHVuY2giIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wodikKICAgICAgICBlbmQKICAgIGVuZAogICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAibGVmdEhhbmQiKQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAicmlnaHRIYW5kIikKZW5kCgotLSBBZGQgYWxsIHJvY2sgZmFybWluZyB0b2dnbGVzIHRvIHRoZSBBdXRvIFJvY2sgZm9sZGVyCmF1dG9Sb2NrVGFiOkFkZFN3aXRjaCgiQXV0byBQdW5jaCBUaW55IFJvY2sgKDApIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIlRpbnkgSXNsYW5kIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0Zhcm0gZG8KICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvRmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSA+PSAwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDAgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgphdXRvUm9ja1RhYjpBZGRTd2l0Y2goIkF1dG8gUHVuY2ggU3RhcnRlciBSb2NrICgxMDApIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIlN0YXJ0ZXIgSXNsYW5kIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0Zhcm0gZG8KICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvRmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSA+PSAxMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gMTAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKYXV0b1JvY2tUYWI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIExlZ2VuZCBCZWFjaCBSb2NrICg1SykiLCBmdW5jdGlvbihWYWx1ZSkKICAgIHNlbGVjdHJvY2sgPSAiTGVnZW5kIEJlYWNoIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0Zhcm0gZG8KICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvRmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSA+PSA1MDAwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDUwMDAgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgphdXRvUm9ja1RhYjpBZGRTd2l0Y2goIkF1dG8gUHVuY2ggRnJvemVuIFJvY2sgKDE1MEspIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIkZyb3N0IEd5bSBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gMTUwMDAwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDE1MDAwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmF1dG9Sb2NrVGFiOkFkZFN3aXRjaCgiQXV0byBQdW5jaCBNeXRoaWNhbCBSb2NrICg0MDBLKSIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJNeXRoaWNhbCBHeW0gUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDQwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSA0MDAwMDAgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgphdXRvUm9ja1RhYjpBZGRTd2l0Y2goIkF1dG8gUHVuY2ggSW5mZXJubyBSb2NrICg3NTBLKSIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJJbmZlcm5vIEd5bSBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gNzUwMDAwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDc1MDAwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmF1dG9Sb2NrVGFiOkFkZFN3aXRjaCgiQXV0byBQdW5jaCBMZWdlbmQgUm9jayAoMU0pIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIkxlZ2VuZCBHeW0gUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDEwMDAwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gMTAwMDAwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmF1dG9Sb2NrVGFiOkFkZFN3aXRjaCgiQXV0byBQdW5jaCBNdXNjbGUgS2luZyBSb2NrICg1TSkiLCBmdW5jdGlvbihWYWx1ZSkKICAgIHNlbGVjdHJvY2sgPSAiTXVzY2xlIEtpbmcgR3ltIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0Zhcm0gZG8KICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvRmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSA+PSA1MDAwMDAwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDUwMDAwMDAgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgphdXRvUm9ja1RhYjpBZGRTd2l0Y2goIkF1dG8gUHVuY2ggSnVuZ2xlIFJvY2sgKDEwTSkiLCBmdW5jdGlvbihWYWx1ZSkKICAgIHNlbGVjdHJvY2sgPSAiQW5jaWVudCBKdW5nbGUgUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDEwMDAwMDAwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDEwMDAwMDAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKbG9jYWwgR2lmdCA9IHdpbmRvdzpBZGRUYWIoIkdpZnQiKQpHaWZ0OkFkZExhYmVsKCJHaWZ0aW5nIFByb3RlaW4gZWdnOiIpLlRleHRTaXplID0gMjIKCmxvY2FsIHByb3RlaW5FZ2dMYWJlbCA9IEdpZnQ6QWRkTGFiZWwoIlByb3RlaW4gRWdnczogMCIpCnByb3RlaW5FZ2dMYWJlbC5UZXh0U2l6ZSA9IDIwCgpsb2NhbCBzZWxlY3RlZEVnZ1BsYXllciA9IG5pbApsb2NhbCBlZ2dDb3VudCA9IDAKCmxvY2FsIGVnZ0Ryb3Bkb3duID0gR2lmdDpBZGREcm9wZG93bigiUGxheWVyIHRvIEdpZnQgRWdncyIsIGZ1bmN0aW9uKHNlbGVjdGVkRGlzcGxheU5hbWUpCiAgICBmb3IgXywgcGxyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICBpZiBwbHIuRGlzcGxheU5hbWUgPT0gc2VsZWN0ZWREaXNwbGF5TmFtZSB0aGVuCiAgICAgICAgICAgIHNlbGVjdGVkRWdnUGxheWVyID0gcGxyCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKZm9yIF8sIHBsciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICBpZiBwbHIgfj0gUGxheWVycy5Mb2NhbFBsYXllciB0aGVuCiAgICAgICAgZWdnRHJvcGRvd246QWRkKHBsci5EaXNwbGF5TmFtZSkKICAgIGVuZAplbmQKClBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihwbHIpCiAgICBpZiBwbHIgfj0gUGxheWVycy5Mb2NhbFBsYXllciB0aGVuCiAgICAgICAgZWdnRHJvcGRvd246QWRkKHBsci5EaXNwbGF5TmFtZSkKICAgIGVuZAplbmQpCgpHaWZ0OkFkZFRleHRCb3goIkFtb3VudCBvZiBFZ2dzIiwgZnVuY3Rpb24odGV4dCkKICAgIGVnZ0NvdW50ID0gdG9udW1iZXIodGV4dCkgb3IgMAplbmQpCgpHaWZ0OkFkZEJ1dHRvbigiR2lmdCBFZ2dzIiwgZnVuY3Rpb24oKQogICAgaWYgc2VsZWN0ZWRFZ2dQbGF5ZXIgYW5kIGVnZ0NvdW50ID4gMCB0aGVuCiAgICAgICAgZm9yIGkgPSAxLCBlZ2dDb3VudCBkbwogICAgICAgICAgICBsb2NhbCBlZ2cgPSBQbGF5ZXJzLkxvY2FsUGxheWVyLmNvbnN1bWFibGVzRm9sZGVyOkZpbmRGaXJzdENoaWxkKCJQcm90ZWluIEVnZyIpCiAgICAgICAgICAgIGlmIGVnZyB0aGVuCiAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5yRXZlbnRzLmdpZnRSZW1vdGU6SW52b2tlU2VydmVyKCJnaWZ0UmVxdWVzdCIsIHNlbGVjdGVkRWdnUGxheWVyLCBlZ2cpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpHaWZ0OkFkZExhYmVsKCJHaWZ0aW5nIFRyb3BpY2FsIFNoYWtlczoiKS5UZXh0U2l6ZSA9IDIyCgpsb2NhbCB0cm9waWNhbFNoYWtlTGFiZWwgPSBHaWZ0OkFkZExhYmVsKCJUcm9waWNhbCBTaGFrZXM6IDAiKQp0cm9waWNhbFNoYWtlTGFiZWwuVGV4dFNpemUgPSAxOAoKbG9jYWwgc2VsZWN0ZWRTaGFrZVBsYXllciA9IG5pbApsb2NhbCBzaGFrZUNvdW50ID0gMAoKbG9jYWwgc2hha2VEcm9wZG93biA9IEdpZnQ6QWRkRHJvcGRvd24oIlBsYXllciB0byBHaWZ0IFRyb3BpY2FsIFNoYWtlcyIsIGZ1bmN0aW9uKHNlbGVjdGVkRGlzcGxheU5hbWUpCiAgICBmb3IgXywgcGxyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICBpZiBwbHIuRGlzcGxheU5hbWUgPT0gc2VsZWN0ZWREaXNwbGF5TmFtZSB0aGVuCiAgICAgICAgICAgIHNlbGVjdGVkU2hha2VQbGF5ZXIgPSBwbHIKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpmb3IgXywgcGxyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgIGlmIHBsciB+PSBQbGF5ZXJzLkxvY2FsUGxheWVyIHRoZW4KICAgICAgICBzaGFrZURyb3Bkb3duOkFkZChwbHIuRGlzcGxheU5hbWUpCiAgICBlbmQKZW5kCgpQbGF5ZXJzLlBsYXllckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24ocGxyKQogICAgaWYgcGxyIH49IFBsYXllcnMuTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIHNoYWtlRHJvcGRvd246QWRkKHBsci5EaXNwbGF5TmFtZSkKICAgIGVuZAplbmQpCgpHaWZ0OkFkZFRleHRCb3goIlRyb3BpY2FsIFNoYWtlcyBnaWZ0IiwgZnVuY3Rpb24odGV4dCkKICAgIHNoYWtlQ291bnQgPSB0b251bWJlcih0ZXh0KSBvciAwCmVuZCkKCkdpZnQ6QWRkQnV0dG9uKCJHaWZ0IFRyb3BpY2FsIFNoYWtlcyIsIGZ1bmN0aW9uKCkKICAgIGlmIHNlbGVjdGVkU2hha2VQbGF5ZXIgYW5kIHNoYWtlQ291bnQgPiAwIHRoZW4KICAgICAgICBmb3IgaSA9IDEsIHNoYWtlQ291bnQgZG8KICAgICAgICAgICAgbG9jYWwgc2hha2UgPSBQbGF5ZXJzLkxvY2FsUGxheWVyLmNvbnN1bWFibGVzRm9sZGVyOkZpbmRGaXJzdENoaWxkKCJUcm9waWNhbCBTaGFrZSIpCiAgICAgICAgICAgIGlmIHNoYWtlIHRoZW4KICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlLnJFdmVudHMuZ2lmdFJlbW90ZTpJbnZva2VTZXJ2ZXIoImdpZnRSZXF1ZXN0Iiwgc2VsZWN0ZWRTaGFrZVBsYXllciwgc2hha2UpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpsb2NhbCBmdW5jdGlvbiB1cGRhdGVJdGVtQ291bnQoKQogICAgbG9jYWwgcHJvdGVpbkVnZ0NvdW50ID0gMAogICAgbG9jYWwgdHJvcGljYWxTaGFrZUNvdW50ID0gMAoKICAgIGxvY2FsIGJhY2twYWNrID0gUGxheWVycy5Mb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIkJhY2twYWNrIikKICAgIGlmIGJhY2twYWNrIHRoZW4KICAgICAgICBmb3IgXywgaXRlbSBpbiBpcGFpcnMoYmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgaXRlbS5OYW1lID09ICJQcm90ZWluIEVnZyIgdGhlbgogICAgICAgICAgICAgICAgcHJvdGVpbkVnZ0NvdW50ID0gcHJvdGVpbkVnZ0NvdW50ICsgMQogICAgICAgICAgICBlbHNlaWYgaXRlbS5OYW1lID09ICJUcm9waWNhbCBTaGFrZSIgb3IgaXRlbS5OYW1lID09ICJQacOxYXMiIHRoZW4KICAgICAgICAgICAgICAgIHRyb3BpY2FsU2hha2VDb3VudCA9IHRyb3BpY2FsU2hha2VDb3VudCArIDEKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBwcm90ZWluRWdnTGFiZWwuVGV4dCA9ICJQcm90ZWluIEVnZ3M6ICIgLi4gcHJvdGVpbkVnZ0NvdW50CiAgICB0cm9waWNhbFNoYWtlTGFiZWwuVGV4dCA9ICJUcm9waWNhbCBTaGFrZXM6ICIgLi4gdHJvcGljYWxTaGFrZUNvdW50CmVuZAoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgdXBkYXRlSXRlbUNvdW50KCkKICAgICAgICB0YXNrLndhaXQoMC4yNSkKICAgIGVuZAplbmQpCgpsb2NhbCBtaXNjVGFiID0gd2luZG93OkFkZFRhYigiTWlzYyIpCgpsb2NhbCBtaXNjMUZvbGRlciA9IG1pc2NUYWI6QWRkRm9sZGVyKCJNaXNjIDEiKQoKLS0gRmFzdCBQdW5jaCB0b2dnbGUgd2l0aCBhdXRvLXB1bmNoIGZ1bmN0aW9uYWxpdHkgYW5kIHBlcnNpc3RlbnQgZXF1aXBwaW5nCm1pc2MxRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBQdW5jaCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5GYXN0UHVuY2ggPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIC0tIEZ1bmN0aW9uIHRvIGNvbnRpbnVvdXNseSBlcXVpcCBhbmQgbW9kaWZ5IHB1bmNoCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5GYXN0UHVuY2ggZG8KICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSBDaGVjayBpZiB0b29sIGlzIG5vdCBlcXVpcHBlZAogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIGFuZCBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwdW5jaCA9IHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgICAgICAgICAgICAgIGlmIHB1bmNoIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgcHVuY2g6RmluZEZpcnN0Q2hpbGQoImF0dGFja1RpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdW5jaC5hdHRhY2tUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChwdW5jaCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgLS0gTWFrZSBzdXJlIGVxdWlwcGVkIHRvb2wgaXMgbW9kaWZpZWQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgICAgICAgICAgICAgIGlmIGVxdWlwcGVkOkZpbmRGaXJzdENoaWxkKCJhdHRhY2tUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBlcXVpcHBlZC5hdHRhY2tUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHdhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgLS0gRnVuY3Rpb24gdG8gcmFwaWRseSBwdW5jaAogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuRmFzdFB1bmNoIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJyaWdodEhhbmQiKQogICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgImxlZnRIYW5kIikKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGlmIGNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcHVuY2hUb29sID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgICAgICAgICAgICAgaWYgcHVuY2hUb29sIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcHVuY2hUb29sOkFjdGl2YXRlKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgd2FpdCgwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgLS0gVW5lcXVpcCBhbmQgcmVzZXQgdG9vbAogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgaWYgZXF1aXBwZWQ6RmluZEZpcnN0Q2hpbGQoImF0dGFja1RpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICBlcXVpcHBlZC5hdHRhY2tUaW1lLlZhbHVlID0gMC4zNQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZXF1aXBwZWQuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgLS0gQWxzbyByZXNldCB0aGUgYmFja3BhY2sgdG9vbAogICAgICAgIGxvY2FsIGJhY2twYWNrVG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgIGlmIGJhY2twYWNrVG9vbCBhbmQgYmFja3BhY2tUb29sOkZpbmRGaXJzdENoaWxkKCJhdHRhY2tUaW1lIikgdGhlbgogICAgICAgICAgICBiYWNrcGFja1Rvb2wuYXR0YWNrVGltZS5WYWx1ZSA9IDAuMzUKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgotLSBGYXN0IFdlaWdodCB0b2dnbGUgd2l0aCBhdXRvLXdlaWdodCBmdW5jdGlvbmFsaXR5IGFuZCBwZXJzaXN0ZW50IGVxdWlwcGluZwptaXNjMUZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gV2VpZ2h0IiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLkZhc3RXZWlnaHQgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIC0tIENvbnRpbnVvdXNseSBlcXVpcCBhbmQgbW9kaWZ5IHdlaWdodCB0b29sCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5GYXN0V2VpZ2h0IGRvCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gQ2hlY2sgaWYgdG9vbCBpcyBub3QgZXF1aXBwZWQKICAgICAgICAgICAgICAgIGlmIGNoYXJhY3RlciBhbmQgbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHdlaWdodFRvb2wgPSBwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpCiAgICAgICAgICAgICAgICAgICAgaWYgd2VpZ2h0VG9vbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHdlaWdodFRvb2w6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ZWlnaHRUb29sLnJlcFRpbWUuVmFsdWUgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBjaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHdlaWdodFRvb2wpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAtLSBNYWtlIHN1cmUgZXF1aXBwZWQgdG9vbCBpcyBtb2RpZmllZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKQogICAgICAgICAgICAgICAgICAgIGlmIGVxdWlwcGVkOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBlcXVpcHBlZC5yZXBUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHdhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgLS0gQXV0byBkbyB3ZWlnaHQgbGlmdGluZwogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuRmFzdFdlaWdodCBkbwogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgLS0gVW5lcXVpcCBhbmQgcmVzZXQgdG9vbAogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikKICAgICAgICBpZiBlcXVpcHBlZCB0aGVuCiAgICAgICAgICAgIGlmIGVxdWlwcGVkOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgZXF1aXBwZWQucmVwVGltZS5WYWx1ZSA9IDEKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIC0tIEFsc28gcmVzZXQgdGhlIGJhY2twYWNrIHRvb2wKICAgICAgICBsb2NhbCBiYWNrcGFja1Rvb2wgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpCiAgICAgICAgaWYgYmFja3BhY2tUb29sIGFuZCBiYWNrcGFja1Rvb2w6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgIGJhY2twYWNrVG9vbC5yZXBUaW1lLlZhbHVlID0gMQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCi0tIEZhc3QgUHVzaHVwcyB0b2dnbGUgd2l0aCBhdXRvLXB1c2h1cHMgZnVuY3Rpb25hbGl0eSBhbmQgcGVyc2lzdGVudCBlcXVpcHBpbmcKbWlzYzFGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIFB1c2h1cHMiLCBmdW5jdGlvbihib29sKQogICAgX0cuRmFzdFB1c2h1cHMgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIC0tIENvbnRpbnVvdXNseSBlcXVpcCBhbmQgbW9kaWZ5IHB1c2h1cHMgdG9vbAogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuRmFzdFB1c2h1cHMgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSBDaGVjayBpZiB0b29sIGlzIG5vdCBlcXVpcHBlZAogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIGFuZCBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdXNodXBzIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHB1c2h1cHNUb29sID0gcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdXNodXBzIikKICAgICAgICAgICAgICAgICAgICBpZiBwdXNodXBzVG9vbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHB1c2h1cHNUb29sOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaHVwc1Rvb2wucmVwVGltZS5WYWx1ZSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wocHVzaHVwc1Rvb2wpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1c2h1cHMiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgLS0gTWFrZSBzdXJlIGVxdWlwcGVkIHRvb2wgaXMgbW9kaWZpZWQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVzaHVwcyIpCiAgICAgICAgICAgICAgICAgICAgaWYgZXF1aXBwZWQ6RmluZEZpcnN0Q2hpbGQoInJlcFRpbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGVxdWlwcGVkLnJlcFRpbWUuVmFsdWUgPSAwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICAtLSBBdXRvIGRvIHB1c2h1cHMKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkZhc3RQdXNodXBzIGRvCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVsc2UKICAgICAgICAtLSBVbmVxdWlwIGFuZCByZXNldCB0b29sCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdXNodXBzIikKICAgICAgICBpZiBlcXVpcHBlZCB0aGVuCiAgICAgICAgICAgIGlmIGVxdWlwcGVkOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgZXF1aXBwZWQucmVwVGltZS5WYWx1ZSA9IDEKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIC0tIEFsc28gcmVzZXQgdGhlIGJhY2twYWNrIHRvb2wKICAgICAgICBsb2NhbCBiYWNrcGFja1Rvb2wgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1c2h1cHMiKQogICAgICAgIGlmIGJhY2twYWNrVG9vbCBhbmQgYmFja3BhY2tUb29sOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICBiYWNrcGFja1Rvb2wucmVwVGltZS5WYWx1ZSA9IDEKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgotLSBGYXN0IEhhbmRzdGFuZHMgdG9nZ2xlIHdpdGggYXV0by1oYW5kc3RhbmRzIGZ1bmN0aW9uYWxpdHkgYW5kIHBlcnNpc3RlbnQgZXF1aXBwaW5nCm1pc2MxRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBIYW5kc3RhbmRzIiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLkZhc3RIYW5kc3RhbmRzID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICAtLSBDb250aW51b3VzbHkgZXF1aXAgYW5kIG1vZGlmeSBoYW5kc3RhbmRzIHRvb2wKICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkZhc3RIYW5kc3RhbmRzIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gQ2hlY2sgaWYgdG9vbCBpcyBub3QgZXF1aXBwZWQKICAgICAgICAgICAgICAgIGlmIGNoYXJhY3RlciBhbmQgbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGFuZHN0YW5kcyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBoYW5kc3RhbmRzVG9vbCA9IHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiSGFuZHN0YW5kcyIpCiAgICAgICAgICAgICAgICAgICAgaWYgaGFuZHN0YW5kc1Rvb2wgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBoYW5kc3RhbmRzVG9vbDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRzdGFuZHNUb29sLnJlcFRpbWUuVmFsdWUgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBjaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKGhhbmRzdGFuZHNUb29sKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIYW5kc3RhbmRzIikgdGhlbgogICAgICAgICAgICAgICAgICAgIC0tIE1ha2Ugc3VyZSBlcXVpcHBlZCB0b29sIGlzIG1vZGlmaWVkCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhhbmRzdGFuZHMiKQogICAgICAgICAgICAgICAgICAgIGlmIGVxdWlwcGVkOkZpbmRGaXJzdENoaWxkKCJyZXBUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBlcXVpcHBlZC5yZXBUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHdhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgLS0gQXV0byBkbyBoYW5kc3RhbmRzCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5GYXN0SGFuZHN0YW5kcyBkbwogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgLS0gVW5lcXVpcCBhbmQgcmVzZXQgdG9vbAogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGFuZHN0YW5kcyIpCiAgICAgICAgaWYgZXF1aXBwZWQgdGhlbgogICAgICAgICAgICBpZiBlcXVpcHBlZDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgIGVxdWlwcGVkLnJlcFRpbWUuVmFsdWUgPSAxCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlcXVpcHBlZC5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSBBbHNvIHJlc2V0IHRoZSBiYWNrcGFjayB0b29sCiAgICAgICAgbG9jYWwgYmFja3BhY2tUb29sID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJIYW5kc3RhbmRzIikKICAgICAgICBpZiBiYWNrcGFja1Rvb2wgYW5kIGJhY2twYWNrVG9vbDpGaW5kRmlyc3RDaGlsZCgicmVwVGltZSIpIHRoZW4KICAgICAgICAgICAgYmFja3BhY2tUb29sLnJlcFRpbWUuVmFsdWUgPSAxCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKLS0gQ3JlYXRlIHRoZSBmaXJzdCBmb2xkZXIKbG9jYWwgbWlzYzJGb2xkZXIgPSBtaXNjVGFiOkFkZEZvbGRlcigiTWlzYyAyIikKCi0tIEFkZCBBdXRvIFNwaW4gV2hlZWwgdG9nZ2xlCm1pc2MyRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBTcGluIFdoZWVsIiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLkF1dG9TcGluV2hlZWwgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuQXV0b1NwaW5XaGVlbCBhbmQgd2FpdCgxKSBkbwogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMub3BlbkZvcnR1bmVXaGVlbFJlbW90ZTpJbnZva2VTZXJ2ZXIoIm9wZW5Gb3J0dW5lV2hlZWwiLCBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuZm9ydHVuZVdoZWVsQ2hhbmNlc1siRm9ydHVuZSBXaGVlbCJdKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKLS0gQWRkIEF1dG8gQ2xhaW0gR2lmdHMgdG9nZ2xlCm1pc2MyRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBDbGFpbSBHaWZ0cyIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5BdXRvQ2xhaW1HaWZ0cyA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5BdXRvQ2xhaW1HaWZ0cyBhbmQgd2FpdCgxKSBkbwogICAgICAgICAgICAgICAgZm9yIGkgPSAxLCA4IGRvCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMuZnJlZUdpZnRDbGFpbVJlbW90ZTpJbnZva2VTZXJ2ZXIoImNsYWltR2lmdCIsIGkpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCi0tIEFkZCBwb3NpdGlvbiBsb2NrIHRvZ2dsZQptaXNjMkZvbGRlcjpBZGRTd2l0Y2goIkxvY2sgUG9zaXRpb24iLCBmdW5jdGlvbihib29sKQogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgLS0gR2V0IGN1cnJlbnQgcG9zaXRpb24gYW5kIGxvY2sgaXQKICAgICAgICBpZiBwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgICAgICBsb2NhbCBjdXJyZW50UG9zaXRpb24gPSBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgICAgIGxvY2tQbGF5ZXJQb3NpdGlvbihjdXJyZW50UG9zaXRpb24pCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgLS0gVW5sb2NrIHBvc2l0aW9uCiAgICAgICAgdW5sb2NrUGxheWVyUG9zaXRpb24oKQogICAgZW5kCmVuZCkKCmxvY2FsIGZyYW1lVG9nZ2xlID0gbWlzYzJGb2xkZXI6QWRkU3dpdGNoKCJIaWRlIEZyYW1lcyIsIGZ1bmN0aW9uKGJvb2wpCiAgICBsb2NhbCByU3RvID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCiAgICBmb3IgXywgb2JqIGluIHBhaXJzKHJTdG86R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiBvYmouTmFtZTptYXRjaCgiRnJhbWUkIikgdGhlbgogICAgICAgICAgICBvYmouVmlzaWJsZSA9IG5vdCBib29sCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKLS0gQXV0byBFYXQgRWdncyBGZWF0dXJlCm1pc2MyRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBFYXQgRWdncyIsIGZ1bmN0aW9uKGVuYWJsZWQpCiAgICBfRy5BdXRvRWdnID0gZW5hYmxlZAogICAgaWYgZW5hYmxlZCB0aGVuCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkF1dG9FZ2cgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHByb3RlaW5FZ2cgPSBwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlByb3RlaW4gRWdnIikKICAgICAgICAgICAgICAgIGlmIHByb3RlaW5FZ2cgdGhlbgogICAgICAgICAgICAgICAgICAgIHByb3RlaW5FZ2cuUGFyZW50ID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIGZvciBpID0gMSwgNSBkbwogICAgICAgICAgICAgICAgICAgICAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRNb3VzZUJ1dHRvbkV2ZW50KDAsIDAsIDAsIHRydWUsIGdhbWUsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZE1vdXNlQnV0dG9uRXZlbnQoMCwgMCwgMCwgZmFsc2UsIGdhbWUsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKLS0gQXV0byBFYXQgVHJvcGljYWwgU2hha2UgKFBpbmVhcHBsZSkgRmVhdHVyZQptaXNjMkZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gRWF0IFBpbmVhcHBsZSIsIGZ1bmN0aW9uKGVuYWJsZWQpCiAgICBfRy5BdXRvUGluZWFwcGxlID0gZW5hYmxlZAogICAgaWYgZW5hYmxlZCB0aGVuCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkF1dG9QaW5lYXBwbGUgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHRyb3BpY2FsU2hha2UgPSBwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlRyb3BpY2FsIFNoYWtlIikKICAgICAgICAgICAgICAgIGlmIHRyb3BpY2FsU2hha2UgdGhlbgogICAgICAgICAgICAgICAgICAgIHRyb3BpY2FsU2hha2UuUGFyZW50ID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICBmb3IgaSA9IDEsIDUgZG8KICAgICAgICAgICAgICAgICAgICAgICAgVmlydHVhbElucHV0TWFuYWdlcjpTZW5kTW91c2VCdXR0b25FdmVudCgwLCAwLCAwLCB0cnVlLCBnYW1lLCAxKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRNb3VzZUJ1dHRvbkV2ZW50KDAsIDAsIDAsIGZhbHNlLCBnYW1lLCAxKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCm1pc2MyRm9sZGVyOkFkZFN3aXRjaCgiSGlkZSBQZXRzIiwgZnVuY3Rpb24oU3RhdGUpCiAgICBpZiBTdGF0ZSB0aGVuCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMuc2hvd1BldHNFdmVudDpGaXJlU2VydmVyKCJoaWRlUGV0cyIpCiAgICBlbHNlCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMuc2hvd1BldHNFdmVudDpGaXJlU2VydmVyKCJzaG93UGV0cyIpCiAgICBlbmQKZW5kKQoKCm1pc2MyRm9sZGVyOkFkZFN3aXRjaCgiVW5hYmxlIFRyYWRlIiwgZnVuY3Rpb24oU3RhdGUpCiAgICBpZiBTdGF0ZSB0aGVuCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMudHJhZGluZ0V2ZW50OkZpcmVTZXJ2ZXIoImRpc2FibGVUcmFkaW5nIikKICAgIGVsc2UKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy50cmFkaW5nRXZlbnQ6RmlyZVNlcnZlcigiZW5hYmxlVHJhZGluZyIpCiAgICBlbmQKZW5kKQoKCi0tIENyZWF0ZSB0aGUgZmlyc3QgZm9sZGVyCmxvY2FsIG1pc2MzRm9sZGVyID0gbWlzY1RhYjpBZGRGb2xkZXIoIk1pc2MgMyIpCgpsb2NhbCBnb2RNb2RlVG9nZ2xlID0gZmFsc2UKbWlzYzNGb2xkZXI6QWRkU3dpdGNoKCJHb2QgTW9kZSAoQnJhd2wpIiwgZnVuY3Rpb24oU3RhdGUpCiAgICBnb2RNb2RlVG9nZ2xlID0gU3RhdGUKICAgIGlmIFN0YXRlIHRoZW4KICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgZ29kTW9kZVRvZ2dsZSBkbwogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMuYnJhd2xFdmVudDpGaXJlU2VydmVyKCJqb2luQnJhd2wiKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgpsb2NhbCBhdXRvSm9pblRvZ2dsZSA9IGZhbHNlCm1pc2MzRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBKb2luIEJyYXdsIiwgZnVuY3Rpb24oU3RhdGUpCiAgICBhdXRvSm9pblRvZ2dsZSA9IFN0YXRlCiAgICBpZiBTdGF0ZSB0aGVuCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIGF1dG9Kb2luVG9nZ2xlIGRvCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5icmF3bEV2ZW50OkZpcmVTZXJ2ZXIoImpvaW5CcmF3bCIpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMikKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCi0tIFdhbGsgb24gV2F0ZXIgZmVhdHVyZQpsb2NhbCBwYXJ0cyA9IHt9CmxvY2FsIHBhcnRTaXplID0gMjA0OApsb2NhbCB0b3RhbERpc3RhbmNlID0gNTAwMDAKbG9jYWwgc3RhcnRQb3NpdGlvbiA9IFZlY3RvcjMubmV3KC0yLCAtOS41LCAtMikKbG9jYWwgbnVtYmVyT2ZQYXJ0cyA9IG1hdGguY2VpbCh0b3RhbERpc3RhbmNlIC8gcGFydFNpemUpCgpsb2NhbCBmdW5jdGlvbiBjcmVhdGVQYXJ0cygpCiAgICBmb3IgeCA9IDAsIG51bWJlck9mUGFydHMgLSAxIGRvCiAgICAgICAgZm9yIHogPSAwLCBudW1iZXJPZlBhcnRzIC0gMSBkbwogICAgICAgICAgICBsb2NhbCBuZXdQYXJ0U2lkZSA9IEluc3RhbmNlLm5ldygiUGFydCIpCiAgICAgICAgICAgIG5ld1BhcnRTaWRlLlNpemUgPSBWZWN0b3IzLm5ldyhwYXJ0U2l6ZSwgMSwgcGFydFNpemUpCiAgICAgICAgICAgIG5ld1BhcnRTaWRlLlBvc2l0aW9uID0gc3RhcnRQb3NpdGlvbiArIFZlY3RvcjMubmV3KHggKiBwYXJ0U2l6ZSwgMCwgeiAqIHBhcnRTaXplKQogICAgICAgICAgICBuZXdQYXJ0U2lkZS5BbmNob3JlZCA9IHRydWUKICAgICAgICAgICAgbmV3UGFydFNpZGUuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICBuZXdQYXJ0U2lkZS5DYW5Db2xsaWRlID0gdHJ1ZQogICAgICAgICAgICBuZXdQYXJ0U2lkZS5OYW1lID0gIlBhcnRfU2lkZV8iIC4uIHggLi4gIl8iIC4uIHoKICAgICAgICAgICAgbmV3UGFydFNpZGUuUGFyZW50ID0gd29ya3NwYWNlCiAgICAgICAgICAgIHRhYmxlLmluc2VydChwYXJ0cywgbmV3UGFydFNpZGUpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBuZXdQYXJ0TGVmdFJpZ2h0ID0gSW5zdGFuY2UubmV3KCJQYXJ0IikKICAgICAgICAgICAgbmV3UGFydExlZnRSaWdodC5TaXplID0gVmVjdG9yMy5uZXcocGFydFNpemUsIDEsIHBhcnRTaXplKQogICAgICAgICAgICBuZXdQYXJ0TGVmdFJpZ2h0LlBvc2l0aW9uID0gc3RhcnRQb3NpdGlvbiArIFZlY3RvcjMubmV3KC14ICogcGFydFNpemUsIDAsIHogKiBwYXJ0U2l6ZSkKICAgICAgICAgICAgbmV3UGFydExlZnRSaWdodC5BbmNob3JlZCA9IHRydWUKICAgICAgICAgICAgbmV3UGFydExlZnRSaWdodC5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgIG5ld1BhcnRMZWZ0UmlnaHQuQ2FuQ29sbGlkZSA9IHRydWUKICAgICAgICAgICAgbmV3UGFydExlZnRSaWdodC5OYW1lID0gIlBhcnRfTGVmdFJpZ2h0XyIgLi4geCAuLiAiXyIgLi4gegogICAgICAgICAgICBuZXdQYXJ0TGVmdFJpZ2h0LlBhcmVudCA9IHdvcmtzcGFjZQogICAgICAgICAgICB0YWJsZS5pbnNlcnQocGFydHMsIG5ld1BhcnRMZWZ0UmlnaHQpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBuZXdQYXJ0VXBMZWZ0ID0gSW5zdGFuY2UubmV3KCJQYXJ0IikKICAgICAgICAgICAgbmV3UGFydFVwTGVmdC5TaXplID0gVmVjdG9yMy5uZXcocGFydFNpemUsIDEsIHBhcnRTaXplKQogICAgICAgICAgICBuZXdQYXJ0VXBMZWZ0LlBvc2l0aW9uID0gc3RhcnRQb3NpdGlvbiArIFZlY3RvcjMubmV3KC14ICogcGFydFNpemUsIDAsIC16ICogcGFydFNpemUpCiAgICAgICAgICAgIG5ld1BhcnRVcExlZnQuQW5jaG9yZWQgPSB0cnVlCiAgICAgICAgICAgIG5ld1BhcnRVcExlZnQuVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICBuZXdQYXJ0VXBMZWZ0LkNhbkNvbGxpZGUgPSB0cnVlCiAgICAgICAgICAgIG5ld1BhcnRVcExlZnQuTmFtZSA9ICJQYXJ0X1VwTGVmdF8iIC4uIHggLi4gIl8iIC4uIHoKICAgICAgICAgICAgbmV3UGFydFVwTGVmdC5QYXJlbnQgPSB3b3Jrc3BhY2UKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBhcnRzLCBuZXdQYXJ0VXBMZWZ0KQogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgbmV3UGFydFVwUmlnaHQgPSBJbnN0YW5jZS5uZXcoIlBhcnQiKQogICAgICAgICAgICBuZXdQYXJ0VXBSaWdodC5TaXplID0gVmVjdG9yMy5uZXcocGFydFNpemUsIDEsIHBhcnRTaXplKQogICAgICAgICAgICBuZXdQYXJ0VXBSaWdodC5Qb3NpdGlvbiA9IHN0YXJ0UG9zaXRpb24gKyBWZWN0b3IzLm5ldyh4ICogcGFydFNpemUsIDAsIC16ICogcGFydFNpemUpCiAgICAgICAgICAgIG5ld1BhcnRVcFJpZ2h0LkFuY2hvcmVkID0gdHJ1ZQogICAgICAgICAgICBuZXdQYXJ0VXBSaWdodC5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgIG5ld1BhcnRVcFJpZ2h0LkNhbkNvbGxpZGUgPSB0cnVlCiAgICAgICAgICAgIG5ld1BhcnRVcFJpZ2h0Lk5hbWUgPSAiUGFydF9VcFJpZ2h0XyIgLi4geCAuLiAiXyIgLi4gegogICAgICAgICAgICBuZXdQYXJ0VXBSaWdodC5QYXJlbnQgPSB3b3Jrc3BhY2UKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBhcnRzLCBuZXdQYXJ0VXBSaWdodCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIG1ha2VQYXJ0c1dhbGt0aHJvdWdoKCkKICAgIGZvciBfLCBwYXJ0IGluIGlwYWlycyhwYXJ0cykgZG8KICAgICAgICBpZiBwYXJ0IGFuZCBwYXJ0LlBhcmVudCB0aGVuCiAgICAgICAgICAgIHBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBtYWtlUGFydHNTb2xpZCgpCiAgICBmb3IgXywgcGFydCBpbiBpcGFpcnMocGFydHMpIGRvCiAgICAgICAgaWYgcGFydCBhbmQgcGFydC5QYXJlbnQgdGhlbgogICAgICAgICAgICBwYXJ0LkNhbkNvbGxpZGUgPSB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLSBBZGQgV2FsayBvbiBXYXRlciB0b2dnbGUKbWlzYzNGb2xkZXI6QWRkU3dpdGNoKCJXYWxrIG9uIFdhdGVyIiwgZnVuY3Rpb24oYm9vbCkKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIGNyZWF0ZVBhcnRzKCkKICAgIGVsc2UKICAgICAgICBtYWtlUGFydHNXYWxrdGhyb3VnaCgpCiAgICBlbmQKZW5kKQoKLS0gQWRkIE5vLUNsaXAgdG9nZ2xlCm1pc2MzRm9sZGVyOkFkZFN3aXRjaCgiTm8tQ2xpcCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5Ob0NsaXAgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIGxvY2FsIG5vY2xpcExvb3AKICAgICAgICBub2NsaXBMb29wID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgX0cuTm9DbGlwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCBwYXJ0IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSBhbmQgcGFydC5DYW5Db2xsaWRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBub2NsaXBMb29wOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICAgICAgVGl0bGUgPSAiTm8tQ2xpcCIsCiAgICAgICAgICAgIFRleHQgPSAiVGF0YWdvcyBrYSBiYSIsCiAgICAgICAgICAgIER1cmF0aW9uID0gMAogICAgICAgIH0pCiAgICBlbmQKZW5kKQoKLS0gQWRkIEluZmluaXRlIEp1bXAgdG9nZ2xlCm1pc2MzRm9sZGVyOkFkZFN3aXRjaCgiSnVtcHkgSW5maW5pdGUiLCBmdW5jdGlvbihib29sKQogICAgX0cuSW5maW5pdGVKdW1wID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICBsb2NhbCBJbmZpbml0ZUp1bXBDb25uZWN0aW9uCiAgICAgICAgSW5maW5pdGVKdW1wQ29ubmVjdGlvbiA9IGdhbWU6R2V0U2VydmljZSgiVXNlcklucHV0U2VydmljZSIpLkp1bXBSZXF1ZXN0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBfRy5JbmZpbml0ZUp1bXAgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKTpDaGFuZ2VTdGF0ZSgiSnVtcGluZyIpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIEluZmluaXRlSnVtcENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgICAgICBUaXRsZSA9ICJIaWdoIG5hIEhpZ2giLAogICAgICAgICAgICBUZXh0ID0gIlN1bWFrc2VzIGthIGVoIiwKICAgICAgICAgICAgRHVyYXRpb24gPSAwCiAgICAgICAgfSkKICAgIGVuZAplbmQpCgpsb2NhbCB0aW1lRHJvcGRvd24gPSBtaXNjM0ZvbGRlcjpBZGREcm9wZG93bigiQ2hhbmdlIFRpbWUiLCBmdW5jdGlvbihzZWxlY3Rpb24pCiAgICBsb2NhbCBsaWdodGluZyA9IGdhbWU6R2V0U2VydmljZSgiTGlnaHRpbmciKQogICAgCiAgICBpZiBzZWxlY3Rpb24gPT0gIk5pZ2h0IiB0aGVuCiAgICAgICAgbGlnaHRpbmcuQ2xvY2tUaW1lID0gMAogICAgZWxzZWlmIHNlbGVjdGlvbiA9PSAiRGF5IiB0aGVuCiAgICAgICAgbGlnaHRpbmcuQ2xvY2tUaW1lID0gMTIKICAgIGVsc2VpZiBzZWxlY3Rpb24gPT0gIk1pZG5pZ2h0IiB0aGVuCiAgICAgICAgbGlnaHRpbmcuQ2xvY2tUaW1lID0gNgogICAgZW5kCiAgICAKICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgVGl0bGUgPSAiSG9yYSBDYW1iaWFkYSIsCiAgICAgICAgVGV4dCA9ICJMYSBob3JhIGRlbCBkw61hIGhhIHNpZG8gY2FtYmlhZGEgYTogIiAuLiBzZWxlY3Rpb24sCiAgICAgICAgRHVyYXRpb24gPSAwCiAgICB9KQplbmQpCgotLSBBZGQgdGltZSBvcHRpb25zCnRpbWVEcm9wZG93bjpBZGQoIk5pZ2h0IikKdGltZURyb3Bkb3duOkFkZCgiRGF5IikKdGltZURyb3Bkb3duOkFkZCgiTWlkbmlnaHQiKQoKbWlzY1RhYjpBZGRMYWJlbCgiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSIpLlRleHRTaXplID0gMTUKCm1pc2NUYWI6QWRkTGFiZWwoIiAiKS5UZXh0U2l6ZSA9IDE1Cm1pc2NUYWI6QWRkTGFiZWwoIlRlbGVwb3J0IikuVGV4dFNpemUgPSAyMAptaXNjVGFiOkFkZExhYmVsKCIgIikuVGV4dFNpemUgPSAxNQoKbWlzY1RhYjpBZGRCdXR0b24oIlRpbnkgSXNsYW5kIiwgZnVuY3Rpb24oKQogICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTMxLjg2MjYxOTQsIDYuMDU4ODAyNiwgMjA4Ny44ODY3MikKZW5kKQoKbWlzY1RhYjpBZGRCdXR0b24oIlN0YXJ0ZXIgSXNsYW5kIiwgZnVuY3Rpb24oKQogICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoMjI2LjI1MjQ3MiwgOC4xNTI2OTQ3LCAyMTkuMzY2NTE2KQplbmQpCgptaXNjVGFiOkFkZEJ1dHRvbigiTGVnZW5kIEJlYWNoIiwgZnVuY3Rpb24oKQogICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTM2NS43OTgzMDksIDQ0LjUwODI5MzIsIC01MDEuNjE4NTkxKQplbmQpCgptaXNjVGFiOkFkZEJ1dHRvbigiRnJvc3QgR3ltIiwgZnVuY3Rpb24oKQogICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTI5MzMuNDc5OTgsIDI5LjYzOTk2MTIsIC01NzkuOTQ2MDQ1KQplbmQpCgptaXNjVGFiOkFkZEJ1dHRvbigiTXl0aGljYWwgR3ltIiwgZnVuY3Rpb24oKQogICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoMjY1OS41MDYzNSwgMjEuNjA5NTIzOCwgOTM0LjY5MDYxMykKZW5kKQoKbWlzY1RhYjpBZGRCdXR0b24oIkV0ZXJuYWwgR3ltIiwgZnVuY3Rpb24oKQogICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTcxNzYuMTkxNDEsIDQ1LjM5NDEwNCwgLTExMDYuMzE0MjEpCmVuZCkKCm1pc2NUYWI6QWRkQnV0dG9uKCJMZWdlbmQgR3ltIiwgZnVuY3Rpb24oKQogICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoNDQ0Ni45MTY5OSwgMTAwNC40NjY5OCwgLTM5ODMuNzYwNzQpCmVuZCkKCm1pc2NUYWI6QWRkQnV0dG9uKCJKdW5nbGUgR3ltIiwgZnVuY3Rpb24oKQogICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTgxMzcsIDI4LCAyODIwKQplbmQpCgptaXNjVGFiOkFkZExhYmVsKCJUb29sczoiKS5UZXh0U2l6ZSA9IDIyCgpsb2NhbCBTZWxlY3RlZE1vZGUgPSBuaWwKbG9jYWwgQXV0b0Zhcm0gPSBmYWxzZQoKbG9jYWwgbW9kZURyb3Bkb3duID0gbWlzY1RhYjpBZGREcm9wZG93bigiU2VsZWN0IFRvb2wiLCBmdW5jdGlvbihzZWxlY3Rpb24pCiAgICBTZWxlY3RlZE1vZGUgPSBzZWxlY3Rpb24KZW5kKQoKbW9kZURyb3Bkb3duOkFkZCgiV2VpZ2h0IikKbW9kZURyb3Bkb3duOkFkZCgiUHVzaHVwcyIpCm1vZGVEcm9wZG93bjpBZGQoIlNpdHVwcyIpCm1vZGVEcm9wZG93bjpBZGQoIkhhbmRzdGFuZHMiKQptb2RlRHJvcGRvd246QWRkKCJGYXN0IFB1bmNoIikKbW9kZURyb3Bkb3duOkFkZCgiU3RvbXAiKQptb2RlRHJvcGRvd246QWRkKCJHcm91bmQgU2xhbSIpCgptb2RlRHJvcGRvd246QWRkKCJXZWlnaHQgKyBQdW5jaCIpCm1vZGVEcm9wZG93bjpBZGQoIlB1c2h1cHMgKyBQdW5jaCIpCm1vZGVEcm9wZG93bjpBZGQoIlNpdHVwcyArIFB1bmNoIikKCmxvY2FsIGZ1bmN0aW9uIGVxdWlwVG9vbEZhc3QocGxheWVyLCB0b29sTmFtZSwgcmVwTmFtZSwgcmVwVmFsdWUpCiAgICBsb2NhbCB0b29sID0gcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKHRvb2xOYW1lKSBvciBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKHRvb2xOYW1lKQogICAgaWYgdG9vbCBhbmQgcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgdG9vbC5QYXJlbnQgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgaWYgcmVwTmFtZSBhbmQgdG9vbDpGaW5kRmlyc3RDaGlsZChyZXBOYW1lKSB0aGVuCiAgICAgICAgICAgIHRvb2xbcmVwTmFtZV0uVmFsdWUgPSByZXBWYWx1ZQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gZmFzdFB1bmNoKHBsYXllcikKICAgIGxvY2FsIHB1bmNoID0gcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpIG9yIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgIGlmIHB1bmNoIHRoZW4KICAgICAgICBwdW5jaC5QYXJlbnQgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgaWYgcHVuY2g6RmluZEZpcnN0Q2hpbGQoImF0dGFja1RpbWUiKSB0aGVuIHB1bmNoLmF0dGFja1RpbWUuVmFsdWUgPSAwIGVuZAogICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJyaWdodEhhbmQiKQogICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJsZWZ0SGFuZCIpCiAgICAgICAgbG9jYWwgcHVuY2hUb29sID0gcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgIGlmIHB1bmNoVG9vbCB0aGVuIHB1bmNoVG9vbDpBY3RpdmF0ZSgpIGVuZAogICAgZW5kCmVuZAoKbWlzY1RhYjpBZGRTd2l0Y2goIlN0YXJ0IiwgZnVuY3Rpb24oZW5hYmxlZCkKICAgIEF1dG9GYXJtID0gZW5hYmxlZAogICAgbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKCiAgICBsb2NhbCBmdW5jdGlvbiB1bmVxdWlwQWxsKCkKICAgICAgICBsb2NhbCB0b29sc1RvVW5lcXVpcCA9IHt9CiAgICAgICAgaWYgc3RyaW5nLmZpbmQoU2VsZWN0ZWRNb2RlLCAiV2VpZ2h0Iikgb3Igc3RyaW5nLmZpbmQoU2VsZWN0ZWRNb2RlLCAiUHVzaHVwcyIpIG9yIHN0cmluZy5maW5kKFNlbGVjdGVkTW9kZSwgIlNpdHVwcyIpIG9yIHN0cmluZy5maW5kKFNlbGVjdGVkTW9kZSwgIkhhbmRzdGFuZHMiKSB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydCh0b29sc1RvVW5lcXVpcCwgU2VsZWN0ZWRNb2RlKQogICAgICAgIGVuZAogICAgICAgIGlmIFNlbGVjdGVkTW9kZSA9PSAiRmFzdCBQdW5jaCIgb3IgU2VsZWN0ZWRNb2RlID09ICJTdG9tcCIgb3IgU2VsZWN0ZWRNb2RlID09ICJHcm91bmQgU2xhbSIgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQodG9vbHNUb1VuZXF1aXAsIFNlbGVjdGVkTW9kZSA9PSAiRmFzdCBQdW5jaCIgYW5kICJQdW5jaCIgb3IgU2VsZWN0ZWRNb2RlKQogICAgICAgIGVuZAogICAgICAgIGlmIHN0cmluZy5maW5kKFNlbGVjdGVkTW9kZSwgIkNvbWJvOiIpIHRoZW4KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHRvb2xzVG9VbmVxdWlwLCAiUHVuY2giKQogICAgICAgICAgICBpZiBzdHJpbmcuZmluZChTZWxlY3RlZE1vZGUsICJXZWlnaHQiKSB0aGVuIHRhYmxlLmluc2VydCh0b29sc1RvVW5lcXVpcCwgIldlaWdodCIpIGVuZAogICAgICAgICAgICBpZiBzdHJpbmcuZmluZChTZWxlY3RlZE1vZGUsICJQdXNodXBzIikgdGhlbiB0YWJsZS5pbnNlcnQodG9vbHNUb1VuZXF1aXAsICJQdXNodXBzIikgZW5kCiAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKFNlbGVjdGVkTW9kZSwgIlNpdHVwcyIpIHRoZW4gdGFibGUuaW5zZXJ0KHRvb2xzVG9VbmVxdWlwLCAiU2l0dXBzIikgZW5kCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgY2hhciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICBmb3IgXywgdG9vbE5hbWUgaW4gaXBhaXJzKHRvb2xzVG9VbmVxdWlwKSBkbwogICAgICAgICAgICBsb2NhbCBlcSA9IGNoYXI6RmluZEZpcnN0Q2hpbGQodG9vbE5hbWUpCiAgICAgICAgICAgIGlmIGVxIHRoZW4gZXEuUGFyZW50ID0gcGxheWVyLkJhY2twYWNrIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgaWYgZW5hYmxlZCB0aGVuCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIEF1dG9GYXJtIGRvCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIFNlbGVjdGVkTW9kZSA9PSAiV2VpZ2h0IiBvciBTZWxlY3RlZE1vZGUgPT0gIlB1c2h1cHMiIG9yIFNlbGVjdGVkTW9kZSA9PSAiU2l0dXBzIiBvciBTZWxlY3RlZE1vZGUgPT0gIkhhbmRzdGFuZHMiIHRoZW4KICAgICAgICAgICAgICAgICAgICBlcXVpcFRvb2xGYXN0KHBsYXllciwgU2VsZWN0ZWRNb2RlLCAicmVwVGltZSIsIDApCiAgICAgICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCgogICAgICAgICAgICAgICAgZWxzZWlmIFNlbGVjdGVkTW9kZSA9PSAiRmFzdCBQdW5jaCIgdGhlbgogICAgICAgICAgICAgICAgICAgIGZhc3RQdW5jaChwbGF5ZXIpCgogICAgICAgICAgICAgICAgZWxzZWlmIFNlbGVjdGVkTW9kZSA9PSAiU3RvbXAiIHRoZW4KICAgICAgICAgICAgICAgICAgICBlcXVpcFRvb2xGYXN0KHBsYXllciwgIlN0b21wIiwgImF0dGFja1RpbWUiLCAwKQogICAgICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJzdG9tcCIpCiAgICAgICAgICAgICAgICAgICAgaWYgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU3RvbXAiKSB0aGVuIHBsYXllci5DaGFyYWN0ZXIuU3RvbXA6QWN0aXZhdGUoKSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiB0aWNrKCkgJSA2IDwgMC4xIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdmlydHVhbFVzZXIgPSBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIikKICAgICAgICAgICAgICAgICAgICAgICAgdmlydHVhbFVzZXI6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsVXNlcjpDbGlja0J1dHRvbjEoVmVjdG9yMi5uZXcoNTAwLCA1MDApKQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGVsc2VpZiBTZWxlY3RlZE1vZGUgPT0gIkdyb3VuZCBTbGFtIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgZXF1aXBUb29sRmFzdChwbGF5ZXIsICJHcm91bmQgU2xhbSIsICJhdHRhY2tUaW1lIiwgMCkKICAgICAgICAgICAgICAgICAgICBwbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigic2xhbSIpCiAgICAgICAgICAgICAgICAgICAgaWYgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiR3JvdW5kIFNsYW0iKSB0aGVuIHBsYXllci5DaGFyYWN0ZXJbIkdyb3VuZCBTbGFtIl06QWN0aXZhdGUoKSBlbmQKICAgICAgICAgICAgICAgICAgICBpZiB0aWNrKCkgJSA2IDwgMC4xIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdmlydHVhbFVzZXIgPSBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxVc2VyIikKICAgICAgICAgICAgICAgICAgICAgICAgdmlydHVhbFVzZXI6Q2FwdHVyZUNvbnRyb2xsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsVXNlcjpDbGlja0J1dHRvbjEoVmVjdG9yMi5uZXcoNTAwLCA1MDApKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbHNlaWYgU2VsZWN0ZWRNb2RlID09ICJXZWlnaHQgKyBQdW5jaCIgdGhlbgogICAgICAgICAgICAgICAgICAgIGVxdWlwVG9vbEZhc3QocGxheWVyLCAiV2VpZ2h0IiwgInJlcFRpbWUiLCAwKQogICAgICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICAgICAgICAgIGZhc3RQdW5jaChwbGF5ZXIpCgogICAgICAgICAgICAgICAgZWxzZWlmIFNlbGVjdGVkTW9kZSA9PSAiUHVzaHVwcyArIFB1bmNoIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgZXF1aXBUb29sRmFzdChwbGF5ZXIsICJQdXNodXBzIiwgInJlcFRpbWUiLCAwKQogICAgICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICAgICAgICAgIGZhc3RQdW5jaChwbGF5ZXIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbHNlaWYgU2VsZWN0ZWRNb2RlID09ICJTaXR1cHMgKyBQdW5jaCIgdGhlbgogICAgICAgICAgICAgICAgICAgIGVxdWlwVG9vbEZhc3QocGxheWVyLCAiU2l0dXBzIiwgInJlcFRpbWUiLCAwKQogICAgICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICAgICAgICAgIGZhc3RQdW5jaChwbGF5ZXIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIHVuZXF1aXBBbGwoKQogICAgZW5kCmVuZCkKCmxvY2FsIGluZm9UYWIgPSB3aW5kb3c6QWRkVGFiKCJDcmVkaXRzIikKaW5mb1RhYjpTaG93KCkKaW5mb1RhYjpBZGRMYWJlbCgiTWFkZSBieSBTZW7wn5KZIikuVGV4dFNpemUgPSAyMAoKaW5mb1RhYjpBZGRMYWJlbCgiIikKbG9jYWwgd0xhYmVsID0gaW5mb1RhYjpBZGRMYWJlbCgiVkVSU0lPTi8vMS4wLjAiKQp3TGFiZWwuVGV4dFNpemUgPSA0MAp3TGFiZWwuRm9udCA9IEVudW0uRm9udC5BcmNhZGUKCmxvY2FsIHdMYWJlbCA9IGluZm9UYWI6QWRkTGFiZWwoIlRNQiBWMSIpCndMYWJlbC5UZXh0U2l6ZSA9IDQwCndMYWJlbC5Gb250ID0gRW51bS5Gb250LkFyY2FkZQoKICAgICAgICAtLSBFeGFtcGxlIGFkbWluIHdlbGNvbWU6CiAgICAgICAgcGxheWVyOlNlbmROb3RpZmljYXRpb24oewogICAgICAgICAgICBUaXRsZSA9ICJNZXNzYWdlIEZyb20gU2VuIjsKICAgICAgICAgICAgVGV4dCA9ICJZdW4gV2hpdGVsaXN0ZWQgc2kgVGFuZ2EiOwogICAgICAgICAgICBEdXJhdGlvbiA9IDM7CiAgICAgICAgfSkKICAgICAgICAKICAgICAgICAtLSBQYXN0ZSB3aGF0ZXZlciBhZGRpdGlvbmFsIGNvZGUgeW91IHdhbnQgdG8gcnVuIGZvciB3aGl0ZWxpc3RlZCB1c2VycyEKICAgICAgICAtLSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIGVuZAplbmQp" local __map={};(function() local chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/' for i=1,#chars do __map[string.sub(chars,i,i)]=i-1 end end)() local out={};local i=1;while i<=#__b do local c1=__map[string.sub(__b,i,i)];local c2=__map[string.sub(__b,i+1,i+1)];local c3=__map[string.sub(__b,i+2,i+2)];local c4=__map[string.sub(__b,i+3,i+3)];if not c1 then break end;c2=c2 or 0;c3=c3 or 0;c4=c4 or 0;local n=c1*262144+c2*4096+c3*64+c4;local b1=math.floor(n/65536)%256;local b2=math.floor(n/256)%256;local b3=n%256;out[#out+1]=string.char(b1);if string.sub(__b,i+2,i+2)~='=' then out[#out+1]=string.char(b2) end;if string.sub(__b,i+3,i+3)~='=' then out[#out+1]=string.char(b3) end;i=i+4 end;local decoded=table.concat(out) local ok,err=pcall(function() local loader=loadstring or load;local f=loader(decoded);if type(f)=='function'then f() end end) if not ok then pcall(function() print('Wrapper error: '..tostring(err)) end) end end)()
